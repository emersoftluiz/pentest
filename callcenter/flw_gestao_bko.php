<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}

require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/cores.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/lib_criptografa.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_funcoes.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/mk_funcoes.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/MKParam.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/MontaFiltroAjax.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/pst/MKDistribuicaoIndicacao.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/String.php");

ini_set("memory_limit", "256M");

if ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0)) {
  $flag_monta_combo = "S";
}

if(strpos("xx".$combo_condicao,"£") <= 0) {
  $combo_cond[1] = "";
}

$tipo_tempo = substr($tipo_tempo,0,2);
$connect = ConnectDB();

if ((strpos("xx".$tipo_classe_discador, "reg_atd") > 0) || (strpos("xx".$tipo_classe_discador, "reg_acc") > 0)) {
  $variavel_ano_mes = "ano_mes";
} else {
  if (strpos(" ".$parm_busca_dia,"atualiza") > 0) {
    $variavel_ano_mes = "ano_mes_atu";
  } else {
    $variavel_ano_mes = "ano_mes_cri";
  }
}

function MontaDescTitulo($classe,$repre){
  $connect = ConnectDB();
  $q = "SELECT desc_classe FROM tb_classe WHERE cod_classe = '".$classe."'  AND representante = '".$repre."' AND tipo_reg = 'T'";
  $query = DescExecQuery($q,$connect,'N');
  if(!$rec = mysql_fetch_assoc($query)){
    $q = "SELECT desc_classe FROM tb_classe WHERE cod_classe = '".$classe."'  AND representante = 'URANET' AND tipo_reg = 'T'";
    $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
    $query = DescExecQuery($q,$connect,'N');
    $rec = mysql_fetch_assoc($query);
  }
  $desc = $rec["desc_classe"];
  return $desc;
}



/*************************************************************/
// DEFINIÇÃO DAS CLASSES DE FILTRO DO RELATORIO
/*************************************************************/
if ($discador_modelo) {

  $operacao = substr($discador_modelo,2,2);

 if((strpos("xx".$tipo_classe_discador, "flw_oco_taref") > 0)) {
    $classe_pro   = "GWPRO";
    $classe_sigla = "GT";
  } elseif ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0) || (strpos("xx".$tipo_classe_discador, "flw_oco_empre") > 0)) {
    $classe_pro   = "GWPRO";
    $classe_sigla = "GW";
  } elseif ((strpos("xx".$tipo_classe_discador, "reg_atd") > 0) || (strpos("xx".$tipo_classe_discador, "reg_acc") > 0)) {
    $classe_pro   = "GAPRO";
    $classe_sigla = "GA";
  }

 $var_aux = ValorClasse($classe_pro, substr($discador_modelo,2,2), "URANET");
  if(trim($var_aux) != "--")  {
    $var_aux = explode("§", $var_aux);

    if($var_aux[1]) {
      $discador_modelo_rel = $var_aux[1];
      $msg_ajuda = "Este discador/modelo utiliza o número do discador <strong>".$nro_aux."</strong>";
    } else {
      $discador_modelo_rel = substr($discador_modelo,2,2);
    }

    $classe_TLRE1 = $classe_sigla.$discador_modelo_rel."1";
    $classe_TLRE2 = $classe_sigla.$discador_modelo_rel."2";
    $classe_TLRE3 = $classe_sigla.$discador_modelo_rel."3";
    $classe_TLRE4 = $classe_sigla.$discador_modelo_rel."4";
    $classe_TLRE5 = $classe_sigla.$discador_modelo_rel."5";
    $classe_TLRE6 = $classe_sigla.$discador_modelo_rel."6";
    $classe_TLRE7 = $classe_sigla.$discador_modelo_rel."7";
    $classe_TLRE8 = $classe_sigla.$discador_modelo_rel."8";
    $classe_TLRE9 = $classe_sigla.$discador_modelo_rel."9";
    $classe_TLRE9 = $classe_sigla.$discador_modelo_rel."9";
    $classe_TLREA = $classe_sigla.$discador_modelo_rel."A";
    $classe_TLREB = $classe_sigla.$discador_modelo_rel."B";
    $classe_TLREK = $classe_sigla.$discador_modelo_rel."K";

    if (($classe_pro == "GCPRO") || ($classe_pro == "GOPRO")){
      $tit_combo_campanha = "Mailing";
      $combo_campanha =  MontaCombo($discador_modelo."C", $campanha,DefineRepre($repre),'S');
    }
  } else {
  	$discador_modelo_rel = substr($discador_modelo,2,2);
	  $classe_TLRE1 = $classe_sigla."PR1";
	  $classe_TLRE2 = $classe_sigla."PR2";
	  $classe_TLRE3 = $classe_sigla."PR3";
	  $classe_TLRE4 = $classe_sigla."PR4";
	  $classe_TLRE5 = $classe_sigla."PR5";
	  $classe_TLRE6 = $classe_sigla."PR6";
	  $classe_TLRE7 = $classe_sigla."PR7";
	  $classe_TLRE8 = $classe_sigla."PR8";
	  $classe_TLRE9 = $classe_sigla."PR9";
	  $classe_TLREA = $classe_sigla."PRA";
	  $classe_TLREB = $classe_sigla."PRB";
	  $classe_TLREK = $classe_sigla."PRK";
  }
  $nro_dk_md = $discador_modelo_rel;


  $param_bd              = "proposta";

  $arrParamTempA[strtoupper("host_". $param_bd) ] = "host_". $param_bd;
  $arrParamTempA[strtoupper("user_". $param_bd) ] = "user_". $param_bd;
  $arrParamTempA[strtoupper("senha_". $param_bd)] = "senha_". $param_bd;
  $arrParamTempA[strtoupper("bd_". $param_bd)   ] = "bd_". $param_bd;
  $arrParamTempA["BD"                           ] = "BD";
  $arrParamTempA["TABELA_HISTORICO"             ] = "TABELA_HISTORICO";
  $arrParamTempA["TABELA_PROPOSTA"              ] = "TABELA_PROPOSTA";
  $arrParamTempA["TABELA_REG_ATD"               ] = "TABELA_REG_ATD";
  $arrParamTempA = MKParam::retornaArrParam($discador_modelo."A",$repre,$arrParamTempA);

  if(!is_array($arrParamTempA)){
    $arrParamTempA = array();
  }

  $host                  = $arrParamTempA["host_". $param_bd ];
  $user                  = $arrParamTempA["user_". $param_bd ];
  $senha                 = $arrParamTempA["senha_". $param_bd];
  $bd                    = $arrParamTempA["bd_". $param_bd   ];

  $arrParamTempB["INCLUDE_DADOS"          ] = "INCLUDE_DADOS";
  $arrParamTempB["CONCLUSAO"              ] = "CONCLUSAO";
  $arrParamTempB["CAMPOS_CONSULTA"        ] = "CAMPOS_CONSULTA";
  $arrParamTempB["CAMPOS_CONSULTA_REG_ATD"] = "CAMPOS_CONSULTA_REG_ATD";
  $arrParamTempB["USA_NC"                 ] = "USA_NC";
  $arrParamTempB["REPRE_VENDEDOR"         ] = "REPRE_VENDEDOR";
  $arrParamTempB["DESC_TEL"               ] = "DESC_TEL";
  $arrParamTempB["CLASSE_RECUSA"          ] = "CLASSE_RECUSA";
  $arrParamTempB["CLASSE_C_IMP"           ] = "CLASSE_C_IMP";
  $arrParamTempB["CLASSE_VENDA"           ] = "CLASSE_VENDA";
  $arrParamTempB["CLASSE_AGENDA"          ] = "CLASSE_AGENDA";

  $arrParamTempB = MKParam::retornaArrParam($discador_modelo."B",$repre,$arrParamTempB);
  if(!is_array($arrParamTempB)){
    $arrParamTempB = array();
  }
  $arrParamTemp = array_merge($arrParamTempA, $arrParamTempB);

  $usa_nc                = $arrParamTemp["usa_nc"];

  if($discador_modelo && ($discador_modelo == "MDTU")) {
  	$usa_nc = "N";
  }

  $include_dados         = $arrParamTemp["include_dados"];
  $tit_st_venda          = $arrParamTemp["conclusao"    ];

  $array_titulos         = explode("¢",$tit_st_venda);

  if ((strpos($tipo_classe_discador, "reg_atd") === false) && (strpos($tipo_classe_discador, "reg_acc") === false)) {
    $param_campos_consulta = $arrParamTemp["campos_consulta"];
  } else {
    $param_campos_consulta = $arrParamTemp["campos_consulta_reg_atd"];
  }

  $connect_host = Conecta($host, $user, $senha, $bd);


  $vlrClasseTit = ValorClasse("FM".substr($discador_modelo,2,2)."K","TIT_".$operacao,"URANET");
  if (trim($vlrClasseTit) == "--") {
    $vlrClasseTit = ValorClasse("FM".substr($discador_modelo,2,2)."K","TIT",$repre);
    if (trim($vlrClasseTit) == "--") {
      $vlrClasseTit = ValorClasse("FM".substr($discador_modelo,2,2)."K","TIT","URANET");
      if (trim($vlrClasseTit) == "--") {?>
        <div align="center"><font class="txtvermelho"><strong>Titulo da classe <?print "FM".substr($discador_modelo,2,2)."K"?> não definido, favor contatar SAC.</strong></font></div><?
        exit;
      }
    }
  }

  $arr_tituloFlw  = explode("¢",$vlrClasseTit);
  $titDivisao     = $arr_tituloFlw[0];
  $titNivel       = $arr_tituloFlw[1];
  $titTema        = $arr_tituloFlw[2];
  $titResponsavel = $arr_tituloFlw[3];
  $titTemaPai     = $arr_tituloFlw[4];

  $vlrClasseTemaPai = ValorClasse("FM".substr($discador_modelo,2,2)."K","SUB_TEMA_".$operacao,$repre);

  if ($vlrClasseTemaPai == " -- ") {
    $vlrClasseTemaPai = ValorClasse("FM".substr($discador_modelo,2,2)."K","SUB_TEMA",$repre);
  }

  $mkParamFLW = carregaArrParamFLW(substr($discador_modelo,2,2), $repre);

}

//****************************************************************
//*****TRATAMENTO DE VARIAVEIS************************************
//****************************************************************

if($mesfim) {
  $data_ini = $anofim."-".$mesfim."-".$diaini;
  $data_fim = $anofim."-".$mesfim."-".$diafim;
}else {
  if ($data_ini) {
    $anofim = substr($data_ini,0,4);
    $mesfim = substr($data_ini,5,2);
    $diaini = substr($data_ini,8,2);
    $diafim = substr($data_fim,8,2);
  }

}



//SU 112962 - INI
if($deonde == "FAT_MENSAL_NOVO") {
  if(empty($_REQUEST['areas']) === false) {
    $expAreas = explode(",",$_REQUEST['areas']);
    $expAreas = array_filter($expAreas);
    $flw_rel_where = "AND EVE.grupo_acesso = '1' AND EVE.ano_mes_cri = '{$anofim}{$mesfim}' AND EVE.origem_nivel_acesso IN ('".implode("','",$expAreas)."') AND EVE.status_acao NOT IN('RC', 'RN')";
  }
}
//SU 112962 - FIM

if($hora_ini != ""){
  $StrHoraInicio = $hora_ini.':'.$min_ini;
  $StrHoraFim    = $hora_fim.':'.$min_fim;
}
if($StrHoraInicio != ""){
  $hora_ini = Substr($StrHoraInicio,"0","2");
  $min_ini  = Substr($StrHoraInicio,"3","5");

  $hora_fim = Substr($StrHoraFim,"0","2");
  $min_fim  = Substr($StrHoraFim,"3","5");
}

if (empty($tipo_produto) === true) {
  $tipo_produto = "TODOS";
}


if (empty($cod_produto) === true) {
  $cod_produto = "TODOS";
}

if (empty($status) === true) {
  if(strtoupper($empresa) == "TELEF_ATCAR" || $repre == "PORTOSEGURO"  || substr($repre,0,10) == "TELEFRESID" || substr($repre,0,8) == "TELEPOST" || substr($repre,0,9) == "URACENTER" || substr($repre,0,11) == "NSAPARECIDA") {
    $status = "TODOS";
  }
}


$arr_busca_dia = explode("¢",$parm_busca_dia);
$busca_dia         = $arr_busca_dia[0];
$busca_hora        = $arr_busca_dia[1];
$param_sem_ano_mes = $arr_busca_dia[2];

//****************************************************************
//****************************************************************


//****************************************************************
//*****CABECALHO HTML DO PROGRAMA*********************************
//****************************************************************

$rel_vars = split("§", $relatorio);
$param_anual = $rel_vars[2];
?>
<!doctype html>
<html>
<head>
<title><?print $session["sistema"];?></title>
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<!-- *************** CSS *************** -->
<!-- bootstrap -->
<?print IntergrAllHeader();?>
<script type="text/javascript" src="consistencia.js"></script>
<script type="text/javascript" src="/js/montaMascara.js"      ></script>
<script language="javascript" type="text/javascript">

<!--
function preencheComboAjax(){
  $("#qtd_agrupamento").val('<?print $qtd_agrupamento;?>');
}

function geraCampoQtd(valor) {
  var aux_valor;
  aux_valor = valor.split("¢");
  if (aux_valor[2] && aux_valor[2] != "TEXTO") {
    $("#texto_agrupamento").hide();
    $("#qtd_agrupamento_text").attr("disabled","true");
    carregaComboAjax("","qtd§"+aux_valor[2]+"§IGUAL","combo_agrupamento","qtd_agrupamento");
    preencheComboAjax();
    $("#combo_agrupamento").show();
  } else {
    $("#texto_agrupamento").show();
    $("#qtd_agrupamento_text").attr("disabled","");
    $("#combo_agrupamento").hide();
  }
}

function mudaData(tipo) {
  var auxiliar;
  auxiliar = tipo.split('§');
  if (auxiliar[0] == 'tot_mes') {
    //      alert('a');
    document.getElementById("mesfim_cmb").disabled = false;
    document.getElementById("anofim_id").disabled = false;
  } else {
    document.getElementById("mesfim_cmb").disabled = true;
    document.getElementById("anofim_id").disabled = true;
  }
}
function escodeFiltro(tipo) {
  if (tipo == '1') {
    $("#divFiltro").fadeOut("slow");
    $('#imgFiltro1').css("visibility","hidden");
    $('#imgFiltro1').css("display","none");
    $('#imgFiltro2').css("visibility","visible");
    $('#imgFiltro2').css("display","block");
  } else {
    $("#divFiltro").fadeIn("slow");
    $('#imgFiltro2').css("visibility","hidden");
    $('#imgFiltro2').css("display","none");
    $('#imgFiltro1').css("visibility","visible");
    $('#imgFiltro1').css("display","block");
  }
}

function alteraConsistencia() {
  var cons = document.frmBackOffice.campo_cons;
  if (document.frmBackOffice.campo_consulta.value == "cpf_cnpj£££CPF/CNPJ£££") {
    //      alert('1');
    document.frmBackOffice.campo_cons.tipodado = "cpf_cnpj";
    //colocado para 18 para poder colar cpf ou cnpj formatado. A montamascara já limita em 14 posições e retira a formatação;
    document.frmBackOffice.campo_cons.maxlength = "18";

    if(document.frmBackOffice.campo_cons.value) {
      document.frmBackOffice.campo_cons.value = montaMascara('##############',document.frmBackOffice.campo_cons.value);
    }

    DescLengthCPFCNPJ(document.frmBackOffice.campo_cons, document.getElementById('tamCpfCnpj2'));

    cons.onkeyup = function() {
      document.frmBackOffice.campo_cons.value = montaMascara('##############',document.frmBackOffice.campo_cons.value);
      DescLengthCPFCNPJ(this, document.getElementById('tamCpfCnpj2'));
    };

  } else {
    document.frmBackOffice.campo_cons.value = "";
    document.frmBackOffice.campo_cons.setAttribute("onkeyup","");
    document.getElementById("tamCpfCnpj2").innerHTML = "";
    document.frmBackOffice.campo_cons.tipodado = "todos";
    document.frmBackOffice.campo_cons.maxlength = "30";
    cons.onkeyup = function() {
    };
  }
}

function verificaCampoConsulta(campo) {
  //alert(campo.value);
  auxiliar = campo.value;
  //faz split do valor obtido por '§'
  auxiliar = auxiliar.split('§');
  //faz split do auxiliar por '¢'
  auxiliar = auxiliar[1].split('¢');
  comparador = auxiliar[1];
  if (comparador == "text"){
    document.getElementById("frmBackOffice").removeChild(document.getElementById("campo_cons"));
    var input = document.createElement('input');
    input.setAttribute('type','radio');
    document.getElementById('frmBackOffice').appendChild(input);
  }
  if (comparador.substring(0,5) == "combo") {
    alert('sou combo');
    var d = document.getElementById("campo_cons");
    d.setAttribute("type","radio");
  }

}

function verificaData(x){
  if (x.value == "SEMDATA") {
    if (document.frmBackOffice.mesini) {
      document.frmBackOffice.mesini.disabled = true;
    }
    if (document.frmBackOffice.diaini) {
      document.frmBackOffice.diaini.disabled = true;
    }
    if (document.frmBackOffice.diafim) {
      document.frmBackOffice.diafim.disabled = true;
    }
    if (document.frmBackOffice.mesfim) {
      document.frmBackOffice.mesfim.disabled = true;
    }
    if (document.frmBackOffice.anofim) {
      document.frmBackOffice.anofim.disabled = true;
    }
    document.frmBackOffice.desabilita.value = "verdadeiro";

    document.frmBackOffice.submit();
    //    verificaOptions(x,"SEMDATA",document.frmBackOffice.tipo_data);

  } else {
    if (document.frmBackOffice.mesini) {
      document.frmBackOffice.mesini.disabled = false;
    }
    if (document.frmBackOffice.diaini) {
      document.frmBackOffice.diaini.disabled = false;
    }
    if (document.frmBackOffice.diafim) {
      document.frmBackOffice.diafim.disabled = false;
    }
    if (document.frmBackOffice.mesfim) {
      document.frmBackOffice.mesfim.disabled = false;
    }
    if (document.frmBackOffice.anofim) {
      document.frmBackOffice.anofim.disabled = false;
    }
    document.frmBackOffice.desabilita.value = "falso";
    document.frmBackOffice.submit();
  }
}

function validaData(valor) {
  var date=valor;
  var ardt=new Array;
  var ExpReg=new RegExp("(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[012])/[12][0-9]{3}");
  ardt=date.split("/");
  erro=false;
  if (date.search(ExpReg)==-1) {
    erro = true;
  } else if (((ardt[1]==4)||(ardt[1]==6)||(ardt[1]==9)||(ardt[1]==11))&&(ardt[0]>30)) {
    erro = true;
  } else if (ardt[1]==2) {
    if ((ardt[0]>28)&&((ardt[2]%4)!=0))
      erro = true;
    if ((ardt[0]>29)&&((ardt[2]%4)==0))
      erro = true;
  }
  if (erro) {
    return false;
  }
  return true;
}

function EnviaDadosGestao() {

  if (document.frmBackOffice.parm_busca_dia.value != "SEMDATA" && "<?print $param_anual?>" != "anual") {
    if (document.frmBackOffice.campo_cons) {//campos consulta
      if (document.frmBackOffice.campo_cons.value == "") {
        <?if($faz_monitoria) {?>
          data_ini = $("#diapesq_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
        <?}elseif (($com_ano_mes == "N") && $usa_calendario_novo) {?>
          data_ini = $("#id_diaini").val()+"/"+$("#id_mesini").val()+"/"+$("#id_anoini").val();
          data_fim = $("#id_diafim").val()+"/"+$("#id_mesfim").val()+"/"+$("#id_anofim").val();
        <?}else{?>
          data_ini = $("#diaini_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
          data_fim = $("#diafim_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
        <?}?>

        if(validaData(data_ini) === false) {
          alert("Preencha Corretamente a Data Inicial!");
          return false;
        }

        <?if(!$faz_monitoria) {?>
          if(validaData(data_fim) === false) {
            alert("Preencha Corretamente a Data Final!");
            return false;
          }
        <?}?>
      }
    } else if(document.frmBackOffice.cpf_cnpj) {//cpf_cnpj
      if (document.frmBackOffice.cpf_cnpj.value == "") {
        <?if($faz_monitoria) {?>
          data_ini = $("#diapesq_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
        <?}elseif (($com_ano_mes == "N") && $usa_calendario_novo) {?>
          data_ini = $("#id_diaini").val()+"/"+$("#id_mesini").val()+"/"+$("#id_anoini").val();
          data_fim = $("#id_diafim").val()+"/"+$("#id_mesfim").val()+"/"+$("#id_anofim").val();
        <?}else{?>
          data_ini = $("#diaini_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
          data_fim = $("#diafim_cmb").val()+"/"+$("#mesfim_cmb").val()+"/"+$("#anofim_id").val();
        <?}?>

        if(validaData(data_ini) === false) {
          alert("Preencha Corretamente a Data Inicial!");
          return false;
        }
        <?if(!$faz_monitoria) {?>
          if(validaData(data_fim) === false) {
            alert("Preencha Corretamente a Data Final!");
            return false;
          }
        <?}?>
      }
    }
  }

  document.frmBackOffice.procurar.value = 'OK';
  if (document.frmBackOffice.combo_condicao) {
  }
  <?if (((strpos("xx".$tipo_classe_discador, "agrupado_repre") > 0)) && ($deonde == "pesqhist")) {?>
  if (document.frmBackOffice.campo_cons) {
    if (document.frmBackOffice.campo_cons.value == "") {
      alert("Preencha o CPF/CNPJ");
      return;
    }
  }
  if (document.frmBackOffice.cpfcnpj) {
    if (document.frmBackOffice.cpfcnpj.value == "") {
      alert("Preencha o CPF/CNPJ");
      return;
    }
  }
  <?}?>
  if (document.getElementById("tipo_data")) {
    if (document.getElementById("tipo_data").value == "tot_anual§mes§Mês à Mês") {
      if ((document.getElementById("mesini_cmb") != null) || (document.getElementById("mesfim_cmb") != null)) {
        if (parseInt(document.getElementById("mesfim_cmb").value) < parseInt(document.getElementById("mesini_cmb").value)) {
          alert("Mês inicial maior que o mês final");
          return;
        }
      }
    }
  }
  if (document.getElementById("diaini_cmb") || document.getElementById("diafim_cmb")) {
    if (document.getElementById("diafim_cmb").value < document.getElementById("diaini_cmb").value) {
      alert("Dia inicial maior que o dia final");
      return;
    }
  }

  <?if($discador_modelo == "MDSP" && ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0)) && (strpos("xx".$tipo_classe_discador, "flw_oco_taref") <= 0)) {?>
      var combo_condicao = $("#combo_condicao").val();
      if(combo_condicao.indexOf("like") >= 0 && $("#contrato").val() == "TODOS") {
        alert("Selecione um Contrato.");
        $("#contrato").focus();
        return false;
      }
  <?}?>

  enviar(document.frmBackOffice);
}


function FuncMandaValorRadio(radio, hidden) {
  hidden.value=radio.value;
}

function InseriTpSoma(obj)  {
  var TipoSoma = obj.value.split("¢");
  var TipoSomaAux = TipoSoma[0];
  aux = obj.value;
  document.frmBackOffice.tipo_campo_sum.value = TipoSomaAux;
}

function imprimeRelatorio(tipo) {
  document.simula.tipo.value=tipo;
  strHelpOptions =  "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=yes";
  strHelpOptions += ",top=1";
  strHelpOptions += ",left=1";
  strHelpOptions += ",width=720";
  strHelpOptions += ",height=520";
  Janela = window.open('', 'Janela', strHelpOptions);
  Janela.focus();
  document.simula.submit();
}

function carregaComboAjax(combo,valor_combo,id_direciona,nome_do_combo) {
  //  alert('combo = '+combo+'   valor_combo = '+valor_combo);
  combo_filtro = $("select[name='combo_condicao']").val();
  arr_combo_filtro = combo_filtro.split("§");

  if (arr_combo_filtro[1] == "TEXTO") {
    $("#desc_combo_cond_aux").html($("select[name='combo_condicao'] option:selected").html());
    if (arr_combo_filtro[4] && arr_combo_filtro[3]) {
      str_consistencia = " consistir='"+arr_combo_filtro[4]+"' tipodado='"+arr_combo_filtro[3]+"' msg='Preencha corretamente o campo "+$("select[name='combo_condicao'] option:selected").html()+"'       " ;
    } else {
      str_consistencia = "";
    }
    $("#combo_cond_aux").html("<input type='text' name='combo_cond[0]' value='<?if ($text_condicao) {print $text_condicao;} else {print $combo_cond[0];}?>'  "+str_consistencia+">");
    return false;
  }

  var desc_combo_cond_aux;
  var combo_cond_aux;
  if (combo && combo.value != "undefined" && combo.value != "") {
    $.ajax({
      url: 'tlfn_tvda_con_bko_ajax.php?nome_do_combo='+nome_do_combo+'&cmbParamClass='+combo.value+'&param2=<?print $repre;?>&discador_modelo=<?print $discador_modelo;?>',
      type: 'POST',
      data: $("form[name='frmBackOffice']").serialize(),
      dataType: 'text',
      async: false,
      timeout: 30000,
      contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
      beforeSend: function(){
      },
      error: function(){
        alert('erro ajax');
      },
      success: function(xml){
        array_aux_combos = xml.split("#|#");
        desc_combo_cond_aux = "";
        combo_cond_aux      = "";
        if (array_aux_combos.length == 0) {
          tamanho_array = 1;
        } else {
          tamanho_array = array_aux_combos.length;
        }
        var indice;
        var obj_combo;
        if (document.frmBackOffice.combo_condicao) {
          indice    = document.frmBackOffice.combo_condicao.selectedIndex;
          obj_combo = document.frmBackOffice.combo_condicao;
        }
        for (i=0;i<tamanho_array;i++) {
          if (array_aux_combos[i] != "") {
            array_xml = array_aux_combos[i].split("§");
            desc_combo_cond_aux = "<b>" + obj_combo[indice].text + "</b>";
            combo_cond_aux      = array_xml[0];
            if (id_direciona != "combo_agrupamento") {
              $("#desc_combo_cond_aux").html(desc_combo_cond_aux);
            }
            $("#"+id_direciona).html(combo_cond_aux);
          }
        }
      }
    });
  } else {
    if (valor_combo != "") {
      $.ajax({
        url: 'tlfn_tvda_con_bko_ajax.php?nome_do_combo='+nome_do_combo+'&cmbParamClass='+valor_combo+'&param2=<?print $repre;?>&discador_modelo=<?print $discador_modelo;?>',
        type: 'POST',
        data: $("form[name='frmBackOffice']").serialize(),
        dataType: 'text',
        async: false,
        timeout: 30000,
        contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
        beforeSend: function(){
        },
        error: function(){
          alert('erro ajax');
        },
        success: function(xml){
          array_aux_combos = xml.split("#|#");
          desc_combo_cond_aux = "";
          combo_cond_aux      = "";
          if (array_aux_combos.length == 0) {
            tamanho_array = 1;
          } else {
            tamanho_array = array_aux_combos.length;
          }
          var indice;
          var obj_combo;
          if (document.frmBackOffice.combo_condicao) {
            indice    = document.frmBackOffice.combo_condicao.selectedIndex;
            obj_combo = document.frmBackOffice.combo_condicao;
          }
          for (i=0;i<tamanho_array;i++) {
            if (array_aux_combos[i] != "") {
              array_xml = array_aux_combos[i].split("§");
              //desc_combo_cond_aux = "<b>" + obj_combo[indice].text + "</b>";
              combo_cond_aux      = array_xml[0];
              if (id_direciona != "combo_agrupamento") {
                $("#desc_combo_cond_aux").html(desc_combo_cond_aux);
              }
              $("#"+id_direciona).html(combo_cond_aux);
            }
          }
        }
      });
    } else {
      $("#desc_combo_cond_aux").html("");
      $("#combo_cond_aux").html("");
    }
  }
}

/////////FILTRO ADICIONAL NOVO ALFREDO /////////
function AddFiltroAdicional() {
  combo_filtro     = $("select[name='combo_condicao']").val();
  filtro_adicional = $("#id_filtro_adicional").val();
  arr_combo_filtro = combo_filtro.split("§");

  if (filtro_adicional.indexOf(combo_filtro) == -1){
    $("#id_filtro_adicional").val(filtro_adicional+combo_filtro+"¢A¢");
    AtuFiltroAdicional();
  }
}

function RemoveTodos() {
  combo_filtro = $("select[name='combo_condicao']").val();
  if (combo_filtro == ""){
    if (confirm('Deseja Limpar Todos os Filtros Adicionais?')) {
      $("#id_filtro_adicional").val('');
      AtuFiltroAdicional();
    }
  } else {
    $("#id_filtro_adicional").val(replaceString(combo_filtro+"¢A¢","", $("#id_filtro_adicional").val()));
    AtuFiltroAdicional();
  }
}

function RemoveUnico(valor) {
  combo_filtro = valor;
  if (combo_filtro != ""){
    $("#id_filtro_adicional").val(replaceString(combo_filtro+"¢A¢","", $("#id_filtro_adicional").val()));
    AtuFiltroAdicional();
  }
}

function AtuFiltroAdicional() {
  $.ajax({
    url: "tlfn_con_ret_gerencial_ajax_v2.php?deonde=AJAX&usa_div=S",
    type: "POST",
    data: $("form[name=frmBackOffice]").serialize(),
    dataType: "text",
    timeout: 1000,
    error: function () {
      //
    },
    success: function (data, textStatus) {
      $("#id_filtros_add").html(data);
    }
  });
}
/////////FIM FILTRO ADICIONAL NOVO ALFREDO /////////

function ordenaTotal(obj) {
  document.ordena.campo_ordena.value = obj.name;
  eval('document.ordena.ordena_'+obj.name).value = obj.value;
  if(obj.value != '') {
    document.ordena.ordena.value = "S";
  }else{
    document.ordena.ordena.value = "";
  }
  document.ordena.procurar.value = 'OK';
  document.ordena.submit();
}

function TrocaOperacao() {
  document.frmBackOffice.submit();
}

function OrdemArvore() {
  document.arvore.direcao.value = 'avancar';
  document.arvore.submit();
}

function utf8_encode (string) {

  string = (string+'').replace(/\r\n/g, "\n").replace(/\r/g, "\n");

  var utftext = "";
  var start, end;
  var stringl = 0;

  start = end = 0;
  stringl = string.length;
  for (var n = 0; n < stringl; n++) {
      var c1 = string.charCodeAt(n);
      var enc = null;

      if (c1 < 128) {
          end++;
      } else if((c1 > 127) && (c1 < 2048)) {
          enc = String.fromCharCode((c1 >> 6) | 192) + String.fromCharCode((c1 & 63) | 128);
      } else {
          enc = String.fromCharCode((c1 >> 12) | 224) + String.fromCharCode(((c1 >> 6) & 63) | 128) + String.fromCharCode((c1 & 63) | 128);
      }
      if (enc != null) {
          if (end > start) {
              utftext += string.substring(start, end);
          }
          utftext += enc;
          start = end = n+1;
      }
  }

  if (end > start) {
      utftext += string.substring(start, string.length);
  }

  return utftext;
}

function utf8_decode(str_data) {
  var tmp_arr = [], i = ac = c = c1 = c2 = 0;
  while (i < str_data.length) {
    c = str_data.charCodeAt(i);
    if (c < 128) {
      tmp_arr[ac++] = String.fromCharCode(c);
      i++;
    }else if ((c > 191) && (c < 224)) {
      c2 = str_data.charCodeAt(i + 1);
      tmp_arr[ac++] = String.fromCharCode(((c & 31) << 6) | (c2 & 63));
      i += 2;
    } else {
      c2 = str_data.charCodeAt(i + 1);
      c3 = str_data.charCodeAt(i + 2);
      tmp_arr[ac++] = String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
      i += 3;
    }
  }
  return tmp_arr.join('');
}

function carregaProxComboAjax(comboAtual,numIndiceAtual,valorProximo,classe) {
  if(numIndiceAtual == "") {
    numIndiceAtual = 0;
  }
  $("select[name='combo_cond["+(parseInt(numIndiceAtual)+1)+"]']").remove();
  $("select[name='combo_cond[]']").remove();
  $("img[id='ico_classe_1']").remove();
  carregaComboAjax(comboAtual,valorProximo,"combo_cond_aux","combo_cond["+(parseInt(numIndiceAtual)+1)+"]");
}

function carregaComboAjax(combo,valor_combo,id_direciona,nome_do_combo) {
  var desc_combo_cond_aux;
  var combo_cond_aux;

  combo_filtro = $("select[name='combo_condicao']").val();
  arr_combo_filtro = combo_filtro.split("§");

  if (arr_combo_filtro[1] == "TEXTO") {
    $("#desc_combo_cond_aux").html($("select[name='combo_condicao'] option:selected").html());
    if (arr_combo_filtro[4] && arr_combo_filtro[3]) {
      str_consistencia = " consistir='"+arr_combo_filtro[4]+"' tipodado='"+arr_combo_filtro[3]+"' msg='Preencha corretamente o campo "+$("select[name='combo_condicao'] option:selected").html()+"'       " ;
    } else {
      str_consistencia = "";
    }
    $("#combo_cond_aux").html("<input type='text' name='combo_cond[0]' value='<?if ($text_condicao) {print $text_condicao;} else {print $combo_cond[0];}?>' "+str_consistencia+">");
    return false;
  }
  if (combo) {
    if (combo.value == "") {
      valor_combo = $("#combo_cond_0").val();
    } else {
      valor_combo = combo.value;
      if(combo.id != "combo_condicao") {
        if($("#combo_condicao").val().indexOf("£",0) >= 0 && combo.id == "combo_cond_0") {
          array_combos = $("#combo_condicao").val().split("£");
          var aux_combo_2 = array_combos[1];
          valor_combo = aux_combo_2.replace(/[DEPENDE]+/g, valor_combo);
        }
      }
    }

    $("#valorCombo1").val($("#combo_cond_1").val());

    $.ajax({
      url: 'tlfn_tvda_con_bko_ajax.php?nome_do_combo='+nome_do_combo+'&cmbParamClass='+valor_combo+'&param2=<?print $repre;?>&discador_modelo=<?print $classe_mkpro;?>&comboPrincipalClasse='+$("#combo_condicao").val()+'&valorCombo0='+$("#combo_cond_0").val(),
      type: 'POST',
      data: $("form[name='frmBackOffice']").serialize(),
      dataType: 'text',
      async: false,
      timeout: 30000,
      contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
      beforeSend: function(){
      },
      error: function(){
        alert('erro ajax');
      },
      success: function(xml) {

        array_aux_combos = xml.split("#|#");
        desc_combo_cond_aux = "";
        combo_cond_aux      = "";
        if (array_aux_combos.length == 0) {
          tamanho_array = 1;
        } else {
          tamanho_array = array_aux_combos.length;
        }
        var indice;
        var obj_combo;
        indice    = document.frmBackOffice.combo_condicao.selectedIndex;
        obj_combo = document.frmBackOffice.combo_condicao;
        if(combo.id == "combo_condicao") {
          $("#"+id_direciona).html("");
          $("#desc_combo_cond_aux").html("");
        }
        for (i=0;i<1;i++) {
          if (array_aux_combos[i] != "" && $("#combo_condicao").val() != "") {
            array_xml = array_aux_combos[i].split("§");
            desc_combo_cond_aux = "<b>" + obj_combo[indice].text + "</b>";
            combo_cond_aux      = array_xml[0];
            if (id_direciona != "combo_agrupamento") {
              $("#desc_combo_cond_aux").html(desc_combo_cond_aux);
            }
            if(valor_combo.indexOf("§",0) >= 0) {
              $("#"+id_direciona).append(combo_cond_aux);
            } else {
              // ****** QUANDO APLICAR O COMBO DEPENDE TROCAR O (html) POR (apend) NA LINHA ABAIXO ********* //
              $("#"+id_direciona).append(combo_cond_aux);
            }
          }
        }
      }
    });
  } else {
    if (valor_combo) {

      if(valor_combo.indexOf("£",0) >= 0) {
        valor_combo = valor_combo.replace("DEPENDE", '<?print $combo_cond[0]?>');
      }

      $.ajax({
        url: 'tlfn_tvda_con_bko_ajax.php?nome_do_combo='+nome_do_combo+'&cmbParamClass='+valor_combo+'&param2=<?print $repre;?>&discador_modelo=<?print $classe_mkpro;?>&comboPrincipalClasse='+$("#combo_condicao").val(),
        type: 'POST',
        data: $("form[name='frmBackOffice']").serialize(),
        dataType: 'text',
        async: false,
        timeout: 30000,
        contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
        beforeSend: function(){
        },
        error: function(){
          alert('erro ajax');
        },
        success: function(xml){
          array_aux_combos = xml.split("#|#");
          desc_combo_cond_aux = "";
          combo_cond_aux      = "";
          if (array_aux_combos.length == 0) {
            tamanho_array = 1;
          } else {
            tamanho_array = array_aux_combos.length;
          }
          var indice;
          var obj_combo;
          indice    = document.frmBackOffice.combo_condicao.selectedIndex;
          obj_combo = document.frmBackOffice.combo_condicao;
          if(combo.id == "combo_condicao") {
            $("#"+id_direciona).html("");
            $("#desc_combo_cond_aux").html("");
          }
          for (i=0;i<tamanho_array;i++) {
            if (array_aux_combos[i] != "" && $("#combo_condicao").val() != "") {
              array_xml = array_aux_combos[i].split("§");
              desc_combo_cond_aux = "<b>" + obj_combo[indice].text + "</b>";
              combo_cond_aux      = array_xml[0];
              if (id_direciona != "combo_agrupamento") {
                $("#desc_combo_cond_aux").html(desc_combo_cond_aux);
              }
              if(valor_combo.indexOf("§",0) >= 0) {
                $("#"+id_direciona).append(combo_cond_aux);
              } else {
                // ****** QUANDO APLICAR O COMBO DEPENDE TROCAR O (html) POR (apend) NA LINHA ABAIXO ********* //
                $("#"+id_direciona).append(combo_cond_aux);
              }
            }
          }
        }
      });
    } else {
      $("#combo_cond_0").remove();
      $("#combo_cond_1").remove();
      $("#desc_combo_cond_aux").html("");
      $("#combo_cond_aux").html("");
    }
  }
}

<?if($deonde == "FAT_MENSAL_NOVO" && $isFat != "S") {?>
    $(document).ready(function(){
      $("#frmBackOffice").append("<input type=hidden name='isFat' id='isFat' value='S'>");
      $("input[type=button][name=btnProcurar]").click();
    });
  <?}?>

-->
</script>

</head>
<body>

<?
//****************************************************************
//****************************************************************
if($filtro_mkprw) {
  $where_filtro_mkprw = " AND filtro_classe = '".$filtro_mkprw."'";
}

if($usa_nc == "S") {

  $cond_classe_TLRE = trim(ValorClasse("TUSE3", $session["tp_user"], $repre));

  if ($repreVlrClasse == $repre) {
    $flag_usa_tuse3 = "S";
    $tp_user_tuse3  = $cond_classe_TLRE;
  }

  if ($flag_usa_tuse3 == "S") {
    $where_cond_classe = " AND (filtro_classe <= '".$tp_user_tuse3."' OR filtro_classe = 'ZD')";
  }

}

if($operacao) {
  $flw_permissoes            = explode("¢", getPermissoes($session["operador"], "MD", $operacao, "T", "1"));

  $flw_user_grupo_acesso     = $flw_permissoes[0];
  $flw_user_nivel_acesso     = $flw_permissoes[1];
  $flw_user_acesso_ida       = $flw_permissoes[2];
  $flw_user_acesso_volta     = $flw_permissoes[3];
  $flw_user_permissoes       = $flw_permissoes[4];
  $flw_user_tempo_exec       = $flw_permissoes[5];
  $flw_user_grupos_visao     = $flw_permissoes[6];
  $flw_login_reserva         = $flw_permissoes[7];
  $flw_user_nivel_acesso_adm = $flw_permissoes[9];
}

if(!$direcao) {
  $direcao = "avancar";
}
if(!$ordem_arvore) {
  $ordem_arvore = 1;
}

if(substr($rel_vars[3],0,8) == "(arvore)") {
  if($ordem_arvore > 1) {
    print GerarCabecalho("javascript: document.arvore.ordem_arvore.value = document.arvore.ordem_arvore_retorna.value; document.arvore.direcao.value = 'retorna'; document.arvore.ordem_arvore.value--; document.arvore.submit()", $titulo, "", "");
  }else{
    print GerarCabecalho("cc_consulta.php?nivel=K", $titulo, "", "");
  }
}else{
  print GerarCabecalho("cc_consulta.php?nivel=K", $titulo, "", "");
}

//QUANDO O RELATORIO FOR PESQUISA NAO MOSTRA NADA POIS PESQUISA NAO TEM VENDAS
if (($include_dados == "pesquisa"  || substr($include_dados, 0, 5) == "pesq_" || substr($include_dados, 0, 5) == "pesqu") && ((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0)) && ((strpos("xx".$tipo_classe_discador, "mailing") <= 0))) {
  print $msg_pesq = "<br><br><center><font class=\"txtvermelho\">Relatório não Disponivel para Pesquisa</font></center>";
  $botão_disabled = " disabled ";
  $procurar = "";
}
if ($campo_deonde) {
  if (strpos("xxx".$campo_deonde, "¢") > 0) {
    $arr_campo_deonde           = explode("¢", $campo_deonde);
    if($session[$arr_campo_deonde[1]] == "inbvda01") {
      $where_operador_performance = " AND ".$arr_campo_deonde[0]." = 're016029'";
    } else {
      $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".$session[$arr_campo_deonde[1]]."'";
    }
  } elseif (strpos("xxx".$campo_deonde, "-") > 0) {
    $arr_campo_deonde           = explode("-", $campo_deonde);
    if (${$arr_campo_deonde[0]}) {
      if (${$arr_campo_deonde[0]} == "TODOS") {
        $array_permissao = getArrayClasse("tb_classe", $connect, "descricao", $arr_campo_deonde[1], $repre, "A", "ZZ");
        if (is_array($array_permissao["itens"])) {
          foreach ($array_permissao["itens"] as $key => $value) {
            if ($value["valor"]) {
              $in_unidade .= ",'".$value["valor"]."'";
            }
          }
        }
        if(!$in_unidade) {
          $in_unidade = ",'SEM ACESSO A CLASSE ".$arr_campo_deonde[1]."'";
        }
        $where_operador_performance = " AND ".$arr_campo_deonde[0]." IN (".substr($in_unidade,1).")";
      } else {
        $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".${$arr_campo_deonde[0]}."'";
      }
    }
  }
}

$arrFiltroAdicionalTLREB = getArrayClasse("tb_classe", ConnectDB(), "descricao", $classe_TLREB, $repre, "A", " AND vlr_classe LIKE 'FILTRO_ADICIONAL_%' ");
if (is_array($arrFiltroAdicionalTLREB["itens"]) === true) {
  foreach ($arrFiltroAdicionalTLREB["itens"] as $chaveIndice => $arrValores) {
    switch ($arrValores["descricao"]) {
    	case "ROTINA_AUX_STATUS":
    	  $string_passa_get .= " &cmbRotinaAuxStatus=".$cmbRotinaAuxStatus."&";
    	  if($cmbRotinaAuxStatus == "TODOS") {
          $arrRotinaAuxStatus = getArrayClasse("tb_classe", ConnectDB(), "descricao", "SA".substr($discador_modelo,2,2)."T", $repre, "A", "ZZ");
          if (is_array($arrRotinaAuxStatus["itens"]) === true) {
            $where_operador_performance .= " AND (";
            foreach ($arrRotinaAuxStatus["itens"] as $chaveRotinaAuxStatus => $arrValoresRotinaAuxStatus) {
              $where_operador_performance_loop .= " (sistema_aux_status = '".$arrValoresRotinaAuxStatus["valor"]."' OR ".strtolower($arrValoresRotinaAuxStatus["valor"])."_data <> '1111-11-11') OR";
            }
            $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
          }
    	  } else {
    	    $where_operador_performance .= " AND (sistema_aux_status = '".$cmbRotinaAuxStatus."' OR ".strtolower($cmbRotinaAuxStatus)."_data <> '1111-11-11') ";
    	  }

    		break;

      case "AGRUPAMENTO_GRUPOS":

        $string_passa_get .= " &cmbAgrupamentoGrupos=".$cmbAgrupamentoGrupos."&";

        if ($cmbAgrupamentoGrupos != "") {

          if ($cmbAgrupamentoGrupos == "TODOS") {
            $agrupamentos = getArrayClasse("tb_classe", ConnectDB(), "descricao", "GRAPE", $repre, "A", "ZZ");
            if (is_array($agrupamentos['itens'])) {
              foreach ($agrupamentos["itens"] as $agrup) {
                $arr_grupo = explode('¢', $agrup["descricao"]);
                $grupos = $arr_grupo[1];

                $arr_grupo = explode(',', $grupos);
                if (is_array($arr_grupo)) {
                  foreach ($arr_grupo as $chave => $valor) {
                    $str_grupos .= "'".$valor."',";
                  }
                }
              }
              $str_grupos = substr($str_grupos, 0, -1);
              $where_operador_performance .= " AND left(servico_dac,4) IN('',".$str_grupos.") ";
            }
          } else if ($cmbAgrupamentoGrupos == "VAZIO") {

            $where_operador_performance .= " AND left(servico_dac,4) IN('') ";

          } else {

            $sql = "SELECT vlr_classe, desc_classe FROM tb_classe
                    WHERE cod_classe = 'GRAPE' AND representante = '".$repre."'
                    AND vlr_classe = '".$cmbAgrupamentoGrupos."' AND idioma = '1' AND tipo_reg = 'I' ";
            $query_classe_grape = DescExecQuery($sql, ConnectDB(), "N");
            if ($ret = mysql_fetch_assoc($query_classe_grape)) {
              $arr_grupo = explode('¢', $ret["desc_classe"]);
              $grupos = $arr_grupo[1];

              $arr_grupo = explode(',', $grupos);
              if (is_array($arr_grupo)) {
                foreach ($arr_grupo as $chave => $valor) {
                  $str_grupos .= "'".$valor."',";
                }
                $str_grupos = substr($str_grupos, 0, -1);
                $where_operador_performance .= " AND left(servico_dac,4) IN(".$str_grupos.") ";
              }
            } else {
              print "Grupo não localizado! Classe GRAPE";
            }

          }

        }

        break;

    	default:
    	  list($filtroAdicionalDesc,$filtroAdicionalCpo,$filtroAdicionalClasse,$filtroAdicionalLike,$filtroAdicionalConsistencia,$filtroAdicionalTipoDado) = explode("§", $arrValores["descricao"]);

    	  $string_passa_get .= " &filtroAdicionalTLREB".$filtroAdicionalCpo."=".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."&";

    	  if(empty(${"filtroAdicionalTLREB".$filtroAdicionalCpo}) === false) {
      	  switch ($filtroAdicionalLike) {
      	  	case "LIKE":

      	  	  if(empty($filtroAdicionalClasse) === false && ${"filtroAdicionalTLREB".$filtroAdicionalCpo} == "TODOS") {
      	  	    $arrRotinaFiltroAdc = getArrayClasse("tb_classe", ConnectDB(), "descricao", $filtroAdicionalClasse, $repre, "A", "ZZ");
                if (is_array($arrRotinaFiltroAdc["itens"]) === true) {
                  $where_operador_performance .= " AND (";
                  foreach ($arrRotinaFiltroAdc["itens"] as $chaveRotinaFiltroAdc => $arrValoresRotinaFiltroAdc) {
                    $where_operador_performance_loop .= " (".$filtroAdicionalCpo." LIKE '%".$arrValoresRotinaFiltroAdc["valor"]."%') OR";
                  }
                  $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
                }
      	  	  } else {
      	  	    $where_operador_performance .= " AND ".$filtroAdicionalCpo." LIKE '%".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."%'";
      	  	  }

      	  		break;

      	  	default:

      	  	  if(empty($filtroAdicionalClasse) === false && ${"filtroAdicionalTLREB".$filtroAdicionalCpo} == "TODOS") {
      	  	    $arrRotinaFiltroAdc = getArrayClasse("tb_classe", ConnectDB(), "descricao", $filtroAdicionalClasse, $repre, "A", "ZZ");
                if (is_array($arrRotinaFiltroAdc["itens"]) === true) {
                  $where_operador_performance .= " AND (";
                  foreach ($arrRotinaFiltroAdc["itens"] as $chaveRotinaFiltroAdc => $arrValoresRotinaFiltroAdc) {
                    $where_operador_performance_loop .= " (".$filtroAdicionalCpo." = '".$arrValoresRotinaFiltroAdc["valor"]."') OR";
                  }
                  $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
                }
      	  	  } else {
      	  	    $where_operador_performance .= " AND ".$filtroAdicionalCpo." = '".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."'";
      	  	  }

      	  		break;
      	  }
    	  }

    		break;
    }
  }
}

//****************************************************************
//*****MONTANDO OS WHERES DO SISTEMA******************************
//****************************************************************

if ($procurar == "OK") {

  if ((strpos("xx".$tipo_classe_discador, "separado") > 0)) {
    if($bd_hist && $bd_hist == "bd_sbt_consorcio") {
      $where_classe_mkpro = " AND mk_flag = '".substr($discador_modelo,0,2)."' AND mk_numero = '".substr($discador_modelo,-2)."' ";
    }else{
      $where_classe_mkpro = " AND classe_mkpro = '".$discador_modelo."' ";
    }
  }
  if($tipo_classe_discador != "empresa") {
    if($tipo_classe_discador != "ano_mes_cri") {
      if((strpos("xx".$tipo_classe_discador, "repre_vendedor") > 0)) {
        $repre_vendedor = $arrParamTemp["repre_vendedor"];
        $where_repre = " representante = '".DefineRepre($repre_vendedor)."' ";
      }else{
      	if ((strpos("xx".$tipo_classe_discador, "flw_oco_empre") <= 0) && (strpos("xx".$tipo_classe_discador, "flw_oco_taref") <= 0)) {
        $where_repre = " representante = '".$repre."' ";
      	}
      }
      if ((strpos("xx".$tipo_classe_discador, "agrupado_repre") <= 0)) {
        $where_empresa = " and representante = '".$empresa."'";
      }else{
        $where_empresa = "";
      }
    }else{
      $where_repre = " status <> 'T' ";
    }
  }else{
    if ((strpos("xx".$tipo_classe_discador, "agrupado_repre") <= 0)) {
      $where_empresa = " representante = '".$empresa."'";
    }else{
      $where_empresa = "";
    }
  }

	if ((strpos("xx".$tipo_classe_discador, "flw_oco_empre") > 0)) {
    $where_repre = "  ";
	}

  //*************************************************
  //ROTINA DE BUSCA DIRETO PARAMETREOS CAMPO_CONSULTA
  //*************************************************
  if($campo_cons != "") {

    $campo_consulta_aux = split("£££", $campo_consulta);
    if($campo_consulta_aux[2] == "like"){
      $where_cpf = "and ".$campo_consulta_aux[0]." like '%".$campo_cons."%'";
    }else{
      $where_cpf = "and ".$campo_consulta_aux[0]." = '".$campo_cons."'";
    }
  } else {
    if ($cpf_cnpj) {
      $campo_consulta_aux[0] = "cpf_cnpj";
      $where_cpf = "AND cpf_cnpj = '".$cpf_cnpj."' ";
    } else {
      $where_cpf = "";
    }
  }
  //*************************************************
  //*************************************************
  //*************************************************

  //TRATAMENTO DO WHERE DA DATA E HORA***************

  if($busca_dia != "data_pagto" && $busca_dia != "asus_dt_previsao_pagto") {
    if($busca_dia == "sa_data" && $discador_modelo == "MDR2") {
      $where_data  = "  AND sa_ano_mes = '".$anofim.$mesfim."' ";
    } elseif ($busca_dia == "SEMDATA"){
      $where_data  = " ";
    } else {
      $where_data  = "  AND ".$variavel_ano_mes." = '".$anofim.$mesfim."' ";
    }
  }

  if ($busca_dia == "SEMDATA") {
    $where_data2 = "";

  }elseif($faz_monitoria) {

     if ((strpos("xx".$tipo_classe_discador, "reg_ligacao") > 0)) {
       $where_data2 = "".$busca_dia." = '".$data_ini."'";
     }else{
       $where_data2 = " AND ".$busca_dia." = '".$anofim."-".$mesfim."-".$dia_pesq."'";
     }

  } else {
    if ((strpos("xx".$tipo_classe_discador, "reg_ligacao") > 0)) {
      $where_data2 = " ".$busca_dia." between '".$data_ini."' AND '".$data_fim."' ";
    } else {
      $where_data2 = "  AND ".$busca_dia." between '".$data_ini."' AND '".$data_fim."' ";
    }

  }
  if ($busca_dia == "bo_data") {
    $where_data  = "";
  }
  if ($busca_dia == "sa_data") {
    $where_data  = " AND sa_data between '".$data_ini."' AND '".$data_fim."' ";
  }
  if($StrHoraInicio != "00:00" || $StrHoraFim != "24:00") {
    if($busca_dia == "data_venda") {
      $where_hora = " and ".$busca_hora." between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
    } else{
      $where_hora = " and ".$busca_hora." between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
    }
  }
  //*************************************************

  //*****************************************************************************
  //CAMPOS DOS PARAMETROS QUE EXECUTARAO O RELATORIO*****************************
  //*****************************************************************************

  $param_outro = split("¢", $rel_vars[1]);
  $mostra_sub_total = $param_outro[0];
  $libera_link      = $param_outro[1];
  if($tipo_data_campo == "mensal") {
    $libera_link = "N";
  }

  $tipo_data_spl        = explode("§", $tipo_data);
  if($tipo_data_spl[0] == "tot_anual") {
    $param_tot_anual  = $tipo_data_spl[0];
    $tipo_data_param  = $tipo_data_spl[1];
    $tipo_data_desc   = $tipo_data_spl[2];
  }else{
    $tipo_data_desc   = $tipo_data_spl_1[1];
  }
  $tipo_data_classe_array = explode("-",$tipo_data_spl[0]);
  $tipo_data_campo  = $tipo_data_classe_array[0];
  $tipo_data_classe = $tipo_data_classe_array[1];

  //*********************************************************************
  //********************** Estrutura de Árvore **************************
  //*********************************************************************
  if(substr($rel_vars[3],0,8) == "(arvore)") {

    $mostra_sub_total = "N";

    if($ordem_arvore == "1" && $direcao == "retorna") {
      $str_valor_arvore = "";
      $str_ant_tipo_data = "";
      $rel_vars_ant = "";
      $existe_arvore_ant = "";
      $prox_tipo_data = "";
      $direcao = "";
      $prox_arvore = "";
      $desc_valor_coluna = "";
      $desc_titulo_arvore = "";
    }

    if(!$direcao) {
      $direcao = "avancar";
    }

    if($direcao == "avancar") {

      if($prox_tipo_data) {
        $rel_vars[0] = $prox_tipo_data;
      }

      // -------- WHERE -------- //

      if($value_where_arvore) {
        $str_valor_arvore .= $value_where_arvore.",";
        $str_ant_tipo_data .= $ant_tipo_data_where.",";

        $arr_valor_arvore = explode(",", $str_valor_arvore);
        $arr_ant_tipo_data = explode(",", $str_ant_tipo_data);
        if (is_array($arr_valor_arvore)) {
          foreach ($arr_valor_arvore as $x => $valor_campo) {
            if($valor_campo) {
              $where_arvore .= " AND ".$arr_ant_tipo_data[$x]." = '".$valor_campo."' ";
            }
          }
        }

      }
      // ------ FIM WHERE ------ //

      if($rel_vars_ant) {
        $arr_rel_vars_ant = explode(",", $rel_vars_ant);

        if(is_array($arr_rel_vars_ant)) {

          foreach ($arr_rel_vars_ant as $i => $desc) {
            if($desc) {
              $voltar_rel_vars = $desc;
            }
          }
        }
      }

      if($valor_coluna) {

        $arr_titulo_arvore = explode(",", $rel_vars[3]);
        $titulo_arvore = explode("¢", $arr_titulo_arvore[2]);
        $rel_vars[4] = $titulo_arvore[($ordem_arvore - 2)];


        if(($ordem_arvore - 2) == 0) {
          $desc_titulo_arvore .= trim($str_valor_coluna).",";
        }else{
          $desc_titulo_arvore .= $titulo_arvore[($ordem_arvore - 3)].",";
        }
        $desc_valor_coluna .= $valor_coluna.",";

        $arr_desc_titulo_arvore = explode(",", $desc_titulo_arvore);
        $arr_desc_valor_coluna = explode(",", $desc_valor_coluna);

        $titulo_princ_arvore .= "<table width='100%' align='center'><tr><td align='center'><font class='txt5'>";

        if (is_array($arr_desc_titulo_arvore)) {
          foreach ($arr_desc_titulo_arvore as $i => $desc_coluna) {
            if($desc_coluna) {
              $titulo_princ_arvore .= "<strong>".$desc_coluna.": </strong>".$arr_desc_valor_coluna[$i]." &nbsp;&nbsp;&nbsp;";
            }
          }
        }

        $titulo_princ_arvore .= "</font></td></tr></table>";

        $str_valor_coluna .= $valor_coluna.",";
        $arr_valor_coluna = explode(",", $str_valor_coluna);
        if (is_array($arr_valor_coluna)) {
          foreach ($arr_valor_coluna as $i => $desc_coluna) {
            if($desc_coluna) {
              $titulo_coluna .= ucwords(strtolower($desc_coluna))." / ";
            }
          }
        }

      }else{
        $str_valor_coluna = $rel_vars[4]. " ";
      }

      if($prox_arvore) {
        $existe_arvore = $prox_arvore;
      }else{
        if(substr($rel_vars[3],0,8) == "(arvore)") {
          $existe_arvore = $rel_vars[3];
        }
      }

      if(!$existe_arvore_ant) {
        $existe_arvore_ant = substr($rel_vars[3],0,8).",";
      }

    }else if($direcao == "retorna") {
      $ult_tipo_data  = $prox_tipo_data;
      $prox_tipo_data = "";

      if($str_valor_arvore) {
        $arr_valor_arvore       = explode(",", $str_valor_arvore);
        $arr_ant_tipo_data      = explode(",", $str_ant_tipo_data);
        $arr_valor_coluna       = explode(",", $str_valor_coluna);
        $arr_rel_vars_ant       = explode(",", $rel_vars_ant);
        $arr_desc_valor_coluna  = explode(",", $desc_valor_coluna);
        $arr_desc_titulo_arvore = explode(",", $desc_titulo_arvore);

        $str_valor_arvore = "";
        $str_ant_tipo_data = "";
        $str_valor_coluna = "";
        $rel_vars_ant = "";
        $desc_valor_coluna = "";
        $desc_titulo_arvore = "";
        if (is_array($arr_valor_arvore)) {
          foreach ($arr_valor_arvore as $x => $valor_campo) {
            if($valor_campo) {
              if(($x + 1) < $ordem_arvore) {
                $where_arvore .= " AND ".$arr_ant_tipo_data[$x]." = '".$valor_campo."' ";
                $str_valor_arvore .= $valor_campo.",";
                $str_ant_tipo_data .= $arr_ant_tipo_data[$x].",";
                $str_valor_coluna .= $arr_valor_coluna[$x].",";
                $desc_valor_coluna .= $arr_desc_valor_coluna[$x].",";
                $desc_titulo_arvore .= $arr_desc_titulo_arvore[$x].",";
              }
              if($x <= $ordem_arvore) {
                $rel_vars_ant .= $arr_rel_vars_ant[$x].",";
              }
            }
          }
        }

      }
      $prox_tipo_data = $arr_rel_vars_ant[$x];

      $arr_valor_coluna = explode(",", $str_valor_coluna);
      if (is_array($arr_valor_coluna)) {
        foreach ($arr_valor_coluna as $i => $desc_coluna) {
          if($desc_coluna) {
            $titulo_coluna .= ucwords(strtolower($desc_coluna))." / ";
          }
        }
      }

      $arr_titulo_arvore = explode(",", $rel_vars[3]);
      $titulo_arvore = explode("¢", $arr_titulo_arvore[2]);
      $rel_vars[4] = $titulo_arvore[($ordem_arvore - 2)];

      $arr2_rel_vars_ant = explode(",", $rel_vars_ant);
      if (is_array($arr2_rel_vars_ant)) {
        foreach ($arr2_rel_vars_ant as $i => $desc) {
          if($desc) {
            $rel_vars[0] = $desc;
            $i_ultimo_campo = $i;
          }
        }
      }

      $existe_arvore_ant = "(arvore),";
      $x = ($i_ultimo_campo + 1);
      while($arr_rel_vars_ant[$x]) {
        $existe_arvore_ant .= $arr_rel_vars_ant[$x]."¢";
        $x++;
      }
      $existe_arvore_ant .= $ult_tipo_data;

      if($existe_arvore_ant) {
        $existe_arvore = $existe_arvore_ant;
      }

      $arr_desc_titulo_arvore = explode(",", $desc_titulo_arvore);
      $arr_desc_valor_coluna = explode(",", $desc_valor_coluna);

      $titulo_princ_arvore .= "<table width='100%' align='center'><tr><td align='center'><font class='txt5'>";
      if (is_array($arr_desc_titulo_arvore)) {
        foreach ($arr_desc_titulo_arvore as $i => $desc_coluna) {
          if($desc_coluna) {
            $titulo_princ_arvore .= "<strong>".$desc_coluna.": </strong>".$arr_desc_valor_coluna[$i]." &nbsp;&nbsp;&nbsp;";
          }
        }
      }

      $titulo_princ_arvore .= "</font></td></tr></table>";
    }

    if($existe_arvore) {
      $arr_arvore = explode(",", $existe_arvore);
      $param_arvore = $arr_arvore[0];
      $campos_arvore = explode("¢", $arr_arvore[1]);
      if($direcao != "retorna") {
        $prox_tipo_data = $campos_arvore[0];
        $rel_vars_ant .= $rel_vars[0].",";
      }
      $arr_tipo_data_ant = explode("-", $rel_vars[0]);
      $ant_tipo_data_where = $arr_tipo_data_ant[0];

      $prox_arvore = $arr_arvore[0].",";
      if (is_array($campos_arvore)) {
        foreach ($campos_arvore as $z => $campos) {
          if($z > 0) {
            $prox_arvore .= $campos."¢";
          }
        }
      }

      if($direcao == 'avancar') {
        if($existe_arvore && $prox_tipo_data) {
          $ordem_arvore_retorna = $ordem_arvore;
          $ordem_arvore++;
        }else{
          $ordem_arvore_retorna = $ordem_arvore;
          $ordem_arvore++;
        }
      }else{
        $ordem_arvore_retorna = $ordem_arvore;
        $ordem_arvore++;
      }

      print "<form name='arvore'>
            <input type='hidden' name='prox_arvore' value='".$prox_arvore."'>
            <input type='hidden' name='prox_tipo_data' value='".$prox_tipo_data."'>
            <input type='hidden' name='ant_tipo_data_where' value='".$ant_tipo_data_where."'>
            <input type='hidden' name='str_valor_arvore' value='".$str_valor_arvore."'>
            <input type='hidden' name='str_ant_tipo_data' value='".$str_ant_tipo_data."'>
            <input type='hidden' name='str_valor_coluna' value='".$str_valor_coluna."'>
            <input type='hidden' name='rel_vars_ant' value='".$rel_vars_ant."'>
            <input type='hidden' name='voltar_rel_vars' value='".$voltar_rel_vars."'>
            <input type='hidden' name='value_where_arvore' value=''>
            <input type='hidden' name='valor_coluna' value=''>
            <input type='hidden' name='direcao' value=''>
            <input type='hidden' name='existe_arvore_ant' value='".$existe_arvore_ant."'>
            <input type='hidden' name='ordem_arvore' value='".$ordem_arvore."'>
            <input type='hidden' name='desc_titulo_arvore' value='".$desc_titulo_arvore."'>
            <input type='hidden' name='desc_valor_coluna' value='".$desc_valor_coluna."'>
            <input type='hidden' name='ordem_arvore_retorna' value='".$ordem_arvore_retorna."'>
          ";
      foreach ($_GET as $campos_get => $valor_get) {
        if($campos_get != "prox_arvore" && $campos_get != "prox_tipo_data" && $campos_get != "value_where_arvore" && $campos_get != "ant_tipo_data_where" && $campos_get != "str_valor_arvore" && $campos_get != "str_ant_tipo_data" && $campos_get != "valor_coluna" && $campos_get != "str_valor_coluna" && $campos_get != "titulo_coluna" && $campos_get != "direcao" && $campos_get != "rel_vars_ant" && $campos_get != "voltar_rel_vars" && $campos_get != "existe_arvore_ant" && $campos_get != "ordem_arvore" && $campos_get != "ordem_arvore" && $campos_get != "desc_titulo_arvore" && $campos_get != "desc_valor_coluna" && $campos_get != "ordem_arvore_retorna" ) {
          print "<input type='hidden' name='".$campos_get."' value='".$valor_get."'>";
        }
      }
      print "</form>";

      $prox_arvore = substr($prox_arvore,0,-1);

    }

    print $titulo_princ_arvore;

  }

  //*********************************************************************
  //******************** Fim Estrutura de Arvore ************************
  //*********************************************************************

  if($tipo_data_campo) {
    switch($tipo_data_campo) {
      case"diario":
      case"quinzenal":
      case"semanal":
      $campo = " ,".$busca_dia;
      break;
      case"calcula_sla":
      if((strpos("xx".$tipo_classe_discador, "flw_oco_taref") > 0)) {
        $campo = " ,if (status = 'P' OR  status = 'A',if (unix_timestamp(now()) - unix_timestamp(concat(data_cri,' ',hora_cri))>pend_tempo_max_exec,'FP','DP'),if (pend_tempo_exec>pend_tempo_max_exec,'FP','DP')) as tipo_sla";
      } else {
        $campo = " ,if (status = 'P' OR  status = 'A',if (unix_timestamp(now()) - unix_timestamp(concat(data_ini_ativ,' ',hora_ini_ativ))>ativ_tempo_max_exec,'FP','DP'),if (ativ_tempo_exec>ativ_tempo_max_exec,'FP','DP')) as tipo";
      }
      break;
      case"pg_npg":

      if($bd_hist && $bd_hist == "bd_sbt_consorcio") {
        $campo = " ,data_1_pagto";
      }else{
        $campo = " ,data_pagto";
      }
      break;
      case"calc_prazo":
      $campo = " ,flw_data_previsao,flw_hora_previsao,flw_tempo_previsao,flw_duracao,flw_status";
      break;
      case "tot_mes":
        $campo_order_by = " qtd desc,";
        break;

        case"tot_anual":
        if($tipo_data_param == "mes") {
          $campo_order_by = " qtd desc,";
          $mesger = $mesini;
          $libera_link = "N";

          while( intval($mesger) <= intval($mesfim) ) {
            $anomes_in .= "'".$anofim.$mesger."',";
            if($mesger == "12"){
              break;
            }else{
              $mesger = Date("m",mktime(0,0,0,($mesger+1),1,$anofim));
            }
          }

          $campo .= " ,".$variavel_ano_mes." ";
          $where_data  = "  AND left(".$variavel_ano_mes.",4) = '".$anofim."' AND ".$variavel_ano_mes." in (".substr($anomes_in,0,-1).") ";
          $where_data2 = " ";

        }else if($tipo_data_param == "resumido") {
          $campo_order_by = " qtd desc,";

          $libera_link = "N";

          $mesger = $mesini;
          while(intval($mesger) <= intval($mesfim)) {
            $anomes_in .= "'".$anofim.$mesger."',";
            if($mesger == "12"){
              break;
            }else{
              $mesger = Date("m",mktime(0,0,0,($mesger+1),1,$anofim));
            }
          }

          $where_data  = "  AND left(".$variavel_ano_mes.",4) = '".$anofim."' AND ".$variavel_ano_mes." in (".substr($anomes_in,0,-1).") ";
          $where_data2 = " ";

        }else{
          $tipo_data_classe_array = explode("-",$tipo_data_param);
          $tipo_data_campo  = $tipo_data_classe_array[0];
          $tipo_data_classe = $tipo_data_classe_array[1];

          $campo_order_by = " qtd desc,";
          $mesger = $mesini;
          $diaini = "01";
          $diafim = "31";
          $data_ini = $anofim."-".$mesini."-".$diaini;
          $data_fim = $anofim."-".$mesfim."-".$diafim;

          if($param_arvore == "(arvore)") {
            $libera_link = "N";
          }

          while(intval($mesger) <= intval($mesfim)) {
            $anomes_in .= "'".$anofim.$mesger."',";
            if($mesger == "12"){
              break;
            }else{
              $mesger = Date("m",mktime(0,0,0,($mesger+1),1,$anofim));
            }
          }

          $campo .= " ,".$tipo_data_campo;
          $where_data  = "  AND left(".$variavel_ano_mes.",4) = '".$anofim."' AND ".$variavel_ano_mes." in (".substr($anomes_in,0,-1).") ";
          $where_data2 = " ";
        }

        break;

        case"quartil_d":
        $campo_order_by = " qtd desc,";
        $where_data  = "  AND ".$variavel_ano_mes." = '".$anofim.$mesfim."' and data_venda='".Date("Y-m-d")."' ";
        $where_data2 = " ";
        break;

        case"quartil_m":
        $campo_order_by = " qtd desc,";
        $where_data  = "  AND ".$variavel_ano_mes." = '".$anofim.$mesfim."' AND data_venda between '".$data_ini."' and '".$data_fim."'  and data_venda <> '".Date("Y-m-d")."' ";
        $where_data2 = " ";
        break;

        case"sva_resid":
        include_once "funcoes/ClasseFuncoes.php";
        $arr_sva = Monta_Array_Classe("NR".substr($discador_modelo,2,2)."S",DefineRepre($repre),"S");
        if(is_array($arr_sva)){
          foreach($arr_sva as $chave_sva => $valor_sva){
            $campo_sva_2 .= ",sum(".strtolower($chave_sva).") as ".strtolower($chave_sva);
          }
        }
        break;

      default:
        $campo = " ,".$tipo_data_campo;
        break;

    }
  }

  if($existe_arvore) {
    if(!$prox_tipo_data) {
      if($libera_link) {
        $libera_link_arvore = $param_outro[1];
      }
    }
  }

  //*****************************************************************************
  //*****************************************************************************

?>
  <form name='ordena'>

    <input type='hidden' name='ordena_tot'>
    <input type='hidden' name='ordena'>
    <input type='hidden' name='ordena_col0'>
    <input type='hidden' name='campo_ordena' >
<?
foreach ($_GET as $variavel => $valor_var) {
  if($variavel != 'ordena_tot' && $variavel != 'ordena' && $variavel != 'ordena_col0' && $variavel != 'campo_ordena') {
    print "<input type='hidden' name='".$variavel."' value='".$valor_var."'>";
  }
}

?>
  </form>

<?

//*****************************************************************************
//*****************************************************************************
//PROGRAMA QUE FAZ TODA A LOGICA DO RELATORIO
//*****************************************************************************
//*****************************************************************************

include "flw_gestao_bko_param.php";
//*****************************************************************************
//*****************************************************************************
//*****************************************************************************
//*****************************************************************************

//**TABELA GERADA PELO INCLUDE******
if ($usa_fcr) {
  ?>
  <div class="row">
    <div class="alert alert-info center col-sm-10 col-md-offset-1">
      <i class="icon16 i-info"></i>
        Para consulta FCR foram utilizadas as datas de filtro.
    </div>
  </div>
  <?
}
print $tabela_principal;
//********************************
?>
<br>
<div class="text-center">
  <div class="row pad-top5">
  	<div class="col-sm-12">
  	  <i class="icon20 i-print       dark cursor-pointer" onclick="imprimeRelatorio('imprime')"></i>
  	  <i class="icon20  i-file-excel dark cursor-pointer" onclick="imprimeRelatorio('excel')"></i>
  	</div>
  </div><!-- End .row  -->
</div>
<?
if ($diaini == $diafim) {
  $imprime_periodo = "Dia: ".$diaini."/".$mesfim."/".$anofim;
} else {
  $imprime_periodo = "Período: ".$diaini."/".$mesfim."/".$anofim." à ".$diafim."/".$mesfim."/".$anofim;
}
?>
<form name="simula" method="post" action="tlfn_tvda_con_bko_impressao.php" target="Janela">
   <input type="hidden" name="tabelao_rel"    value="<?print urlencode($titulo."<br>".$imprime_periodo.$tabela_principal)?>">
   <input type="hidden" name="tabelao_titulo" value="<?print urlencode($tabela_titulo."</table>")?>">
   <input type="hidden" name="tipo"           value="">
   <input type="hidden" name="titulo"         value="<?print $titulo?>">
</form>
<?
}
//*****************************************************************************
//*****************************************************************************
if ($session["print_sql"] != "N") {
?>
<center>
<div align="left" class="txt5" style="color:<?print $session["td_destaque"];?>;width:650px;border-width: 2px; border-style: dotted; border-color: <?print $session["td_destaque1"];?>;">
<br>
<ul style="text-align:center;">
<strong>Instruções Gerais</strong>
</ul>
<ul>
<li>Verifique se a classe <strong>MKPRW</strong> esta devidamente cadastrada</li>
<li>Verifique se as classes <strong>GAPRN*</strong>,<strong>GW__N*</strong> (Dependendo do relatório) estam devidamente cadastradas</li>
<li>Verifique se no MK os campos cadastrados fazem parte dos <strong>índices</strong> da tabela</li>
</ul>
*Onde <strong>N</strong> é o número da classe e <strong>__</strong> é o número do discador/modelo.
<br>
<br>
<br>
</div>
</center>
<?
}

//FILTRO DO GESTÃO DE VENDAS
?>
<form id="frmBackOffice" action="<?print $_SERVER['PHP_SELF'];?>" name="frmBackOffice" method="POST"  <?=(($_POST['isFat'] == "S" || $deonde == "FAT_MENSAL_NOVO") ? "style='display:none!important'" : "")?>>
<?
if (($classe_TLRE9 && $repre) && (!$desc_conds)) {
  $q = "SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLRE9."' AND representante = '".$repre."' and tipo_reg = 'I'".$where_cond_classe;
  $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
  $query = mysql_query($q,$connect);
  if ($rec = mysql_fetch_assoc($query)) {
    do {
      $mtr_desc_classe[$rec["vlr_classe"]] = $rec["desc_classe"];
    } while ($rec = mysql_fetch_assoc($query));

    /*************************************************************/
    if (is_array($mtr_desc_classe)) {
      foreach ($mtr_desc_classe as $key => $value) {
        if ($key == $combo_condicao) {
?>
          <input type="hidden" name='desc_conds' id="desc_conds" value="<?print $value;?>">
<?
        }

      }
    }

  }
}

if($discador_modelo == "MDSP" && ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0)) && (strpos("xx".$tipo_classe_discador, "flw_oco_taref") <= 0)) {
	//Foi adicionado os representantes URANET-PRE,URANET-TVO,URANET-TWE,URANET-SAC,URANET-COM,URANET-MSU
	//Modificado por Vitor Bailon - (10/04/2015) - Motivo: Pedido do Tico.
  if($session["representante"] == "URANET" || $session["representante"] == "URANET-PRE" || $session["representante"] == "URANET-TVO" || $session["representante"] == "URANET-TWE" || $session["representante"] == "URANET-SAC" || $session["representante"] == "URANET-COM" || $session["representante"] == "URANET-MSU") {
    $q = "SELECT codigo, descricao FROM tb_follow_contrato WHERE mk_flag = 'MD' and mk_numero = '".substr($discador_modelo,2,2)."' AND status = 'A' ORDER BY descricao";
    $query = DescExecQuery($q, ConnectFLW());
    if($rec = mysql_fetch_array($query)){
      do{
         $array_contrato[$rec["codigo"]] = $rec["descricao"];
      }while($rec = mysql_fetch_array($query));
    }
  }elseif(representanteRH($session["operador"]) == "URANET") {
    $array_contrato_2 = getArrContratoFLWGOP("MD",substr($discador_modelo,2,2),$session["operador"]);
  }else{
    $array_contrato_2 = getArrContratoFLWADM("MD",substr($discador_modelo,2,2),$session["operador"]);
    if(!is_array($array_contrato_2)) {
      $array_contrato = getArrContratoFLW("MD",substr($discador_modelo,2,2),$session["representante"]);
    }
  }
}
?>
<input type="hidden" name="titulo" value="<?print $titulo?>">
<input type="hidden" name="filtro_mkprw" value="<?print $filtro_mkprw?>">
<input type="hidden" name="abre_cmb_servico" value="<?print $abre_cmb_servico?>">
<input type="hidden" name="nivel_direto" value="<?print $nivel_direto?>">
<input type="hidden" name="filtro_area" value="<?print $filtro_area?>">
<input type="hidden" name="procurar" value="">
<input type="hidden" name="deonde" value="<?print $deonde;?>">
<input type="hidden" name="campo_deonde" value="<?print $campo_deonde;?>">
<input type="hidden" name="relatorio_aux" id="relatorio_aux" value="">
<input type="hidden" name="faz_monitoria" value="<?print $faz_monitoria?>">
<input type="hidden" name="form" value="<?print $form?>">
<input type="hidden" name="combo_cond[1]" value="<?print urlencode($combo_cond[1])?>">
<input type="hidden" name="valorCombo1">


<div class='simple-panel simple-panel-primary' style="width: 60%;">
  <h4 class="simple-panel-title">
    <i class="icon16 i-filter"></i>
    Filtrar Ocorrências
  </h4>
  <div class='simple-panel-body'>
<?
    if($discador_modelo == "MDSP" && ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0)) && (strpos("xx".$tipo_classe_discador, "flw_oco_taref") <= 0)) {
?>
      <div class="row pad-top5">
        <div class="col-sm-2">
        	<label>Contrato:</label>
        </div>
        <div class="col-sm-10">
        	<select name="contrato" id="contrato" consistencia='sempre' consistencia1='pre' msg='Selecione um Contrato'>
           <option value="">-- Selecione --</option>
<?
           	 if($session["representante"] == "URANET" || $session["representante"] == "URANET-PRE" || $session["representante"] == "URANET-TVO" || $session["representante"] == "URANET-TWE" || $session["representante"] == "URANET-SAC" || $session["representante"] == "URANET-COM" || $session["representante"] == "URANET-MSU") {
               if(is_array($array_contrato)){
                 foreach($array_contrato as $codigo => $descricao) {
?>
                   <option value="<?print $codigo?>" <?if($contrato == $codigo){print "selected";}?>><?print $descricao?></option>
<?
                 }
               }
?>
               <option value="TODOS" <?if($contrato == "TODOS" || $contrato == ""){print "selected";}?>>Todos</option>
<?
             }else{

               if(is_array($array_contrato_2)) {
                 $x=0;
                 while($array_contrato_2[$x]) {
?>
                   <option value="<?print $array_contrato_2[$x]["codigo"]?>" <?if($contrato == $array_contrato_2[$x]["codigo"]){print "selected";}?>><?print $array_contrato_2[$x]["descricao"]?></option>
<?
                   $x++;
                 }
               }else{
?>
                 <option value="<?print $array_contrato["codigo"]?>" <?if($contrato == $array_contrato["codigo"]){print "selected";}?>><?print $array_contrato["descricao"]?></option>
<?
               }
             }
?>
         </select>
        </div>
      </div><!-- End .row  -->
<?
    }
    $combo_repre = MontaCombo("REPRE", $repre, $session["representante"]);
?>
    <div class="row pad-top5">
      <div class="col-sm-2">
      	<label><?print $titClasse;?>:</label>
      </div>
      <div class="col-sm-10">
<?
//        if($repre && $filtro_mkprw && $repre == "URANET") { Removendo o repre Uranet para poder funcionar na Zurich
        if($repre && ($filtro_mkprw || $nivel_direto == "S")) {
          print ValorClasse("REPRE", $repre, "URANET");
?>
          <input type="hidden" name="repre" value="<?print $repre?>">
<?
        }else{
?>
          <select name="repre" OnChange="window.location='<?print $_SERVER['PHP_SELF'];?>?repre='+this.value+'&titulo=<?print $titulo?>&abre_cmb_servico=<?print $abre_cmb_servico?>&filtro_mkprw=<?print $filtro_mkprw?>&nivel_direto=<?print $nivel_direto?>&filtro_area=<?print $filtro_area?>&deonde=<?print $deonde?>&campo_deonde=<?print $campo_deonde?>&faz_monitoria=<?print $faz_monitoria?>&form=<?print $form?>'"  consistencia="sempre" consistencia1="pre" msg="Selecione o Representante" style="width: 100%;">
            <?print $combo_repre;?>
          </select>
<?
        }
?>
      </div>
    </div><!-- End .row  -->
<?
    if ($repre) {
      //LINHA DO TIPO DE SELEÇÃO AGRUPADO OU SEPARADO
      if (empty($repre) === false) {

        $achou_mkprg = 'N';
        if(($session["representante"] == "URANET") || ($session["valida_versao"] == "GEST_VEN") || ($filtro_mkprw)) {
          $status_mkprg = ",'U'";
        }
        if ($deonde == "pesqhist") {
          $classe_mkpr = "MKPRI";
        } else {
          $classe_mkpr = "MKPRW";
        }

        if($nivel_direto == "S" && $tipo_classe_discador) {
          $where_filtro_mkprw = " AND vlr_classe = '".$tipo_classe_discador."' ";
        }

        $q = "SELECT vlr_classe,desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_mkpr."' AND tipo_reg = 'I' AND representante = '".$repre."' AND status in('A'".$status_mkprg.") ".$where_filtro_mkprw." order by desc_classe";
        if($session["print_sql"] != "N") {print $q."<br><br>";}
        $q     = DescQuery($q, $session["operador"], $_SERVER['PHP_SELF']);
        $query = DescExecQuery($q, $connect,'N') or die (mysql_error($connect)."<br>SQL:".$q);
        if (!($rec = mysql_fetch_assoc($query))) {
          $q = "SELECT vlr_classe,desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_mkpr."' AND tipo_reg = 'I' AND representante = 'URANET' AND status in('A'".$status_mkprg.") ".$where_filtro_mkprw." order by desc_classe";
          if ($session["print_sql"] != "N") {print $q."<br><br>";}
          $q     = DescQuery($q, $session["operador"], $_SERVER['PHP_SELF']);
          $query = DescExecQuery($q, $connect,'N') or die (mysql_error($connect)."<br>SQL:".$q);
          if ($rec = mysql_fetch_assoc($query)) {
            $achou_mkprg = 'S';
          }
        } else {
          $achou_mkprg = 'S';
        }

        if ($achou_mkprg == "S") {

          if ((mysql_num_rows($query) == 1) && ($deonde != "pesqhist")) {
            $tipo_classe_discador = $rec["vlr_classe"];
            $desc_tipo_classe_discador[$rec["vlr_classe"]] = $rec["desc_classe"];
?>
            <input type="hidden" name="tipo_classe_discador" id="tipo_classe_discador_<?print $rec["vlr_classe"];?>" value="<?print $rec["vlr_classe"];?>">
<?
          } else {
?>
            <div class="row pad-top5 text-center">
              <div class="col-sm-12">
<?
                do {
                  if(!$tipo_classe_discador && $rec["filtro_classe"] == "ZD") {
                    $tipo_classe_discador = $rec["vlr_classe"];
                  }

                  $desc_tipo_classe_discador[$rec["vlr_classe"]] = $rec["desc_classe"];
?>
                  <input type="radio" name="tipo_classe_discador" id="tipo_classe_discador_<?print $rec["vlr_classe"];?>" value="<?print $rec["vlr_classe"];?>" onclick="document.frmBackOffice.submit();"<?if ($tipo_classe_discador == $rec["vlr_classe"]) {?>checked<?}?>>
                  <label for="tipo_classe_discador_<?print $rec["vlr_classe"];?>"><?print $rec["desc_classe"];?></label>&nbsp;
<?
                } while ($rec = mysql_fetch_assoc($query));
                if ($session["print_sql"] != "N") {
?>
                  <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_mkpr;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_mkpr, $repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
                }
?>
              </div>
            </div><!-- End .row  -->
<?
          }
          $int_qtd_mkprg = intval($rec["total"]);
        } else {
          $tipo_classe_discador = "default";
        }
        if(((strpos("xx".$tipo_classe_discador, "flw_oco_empre") > 0) && !$discador_modelo) && ($repre == "URANET" || ($filtro_mkprw || $nivel_direto == "S"))) {
          if($repre == "URANET" && !$discador_modelo) {
            $discador_modelo = "MDSP";
          }
?>
          <input type="hidden" name="discador_modelo" value="<?print $discador_modelo?>">
          <script language="javascript">
            TrocaOperacao();
          </script>
<?
        }

        if(!$filtro_mkprw || ($filtro_mkprw && $repre != "URANET") || ($filtro_mkprw && $abre_cmb_servico)) {
?>
          <div class="row pad-top5">
            <div class="col-sm-2">
            	<label><?print "Serviço";?>:</label>
            </div>
            <div class="col-sm-10">
              <?
              if($nivel_direto == "S" && !$abre_cmb_servico) {
                print ValorClasse("MDPRO", substr($discador_modelo,2,2), $repre);
                print "<input type=\"hidden\" name=\"discador_modelo\" value=\"".$discador_modelo."\">";
              } else {
                $mtr_mkpro = MontaComboMKPRO($discador_modelo, $repre, $tipo_classe_discador);
              ?>
                <select name="discador_modelo" consistencia="sempre" consistencia1="pre" msg="Selecione o Serviço" OnChange="TrocaOperacao();" style="width: 100%;">
                  <?print $mtr_mkpro;?>
                </select>
              <?
              }
              ?>
            </div>
          </div><!-- End .row  -->
<?
          $int_qtd_mkprg = intval($rec["total"]);
        } else {
          print "<input type=\"hidden\" name=\"discador_modelo\" value=\"".$discador_modelo."\">";
        }
        if (is_array($arrFiltroAdicionalTLREB["itens"]) === true) {
          foreach ($arrFiltroAdicionalTLREB["itens"] as $chaveIndice => $arrValores) {
            switch ($arrValores["descricao"]) {
            	case "ROTINA_AUX_STATUS":
            	  $comboRotinaAuxStatus = MontaCombo("SA".substr($discador_modelo,2,2)."T", $cmbRotinaAuxStatus, $repre);
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label><?print $titClasse;?>:</label>
                  </div>
                  <div class="col-sm-10">
                    <select name="cmbRotinaAuxStatus" consistencia="sempre" consistencia1="pre" msg="Selecione a(o) <?print $titClasse;?>" style="width: 100%;">
                      <?print $comboRotinaAuxStatus;?>
                      <option value="TODOS" <?if ($cmbRotinaAuxStatus == "TODOS" || !$cmbRotinaAuxStatus){print "SELECTED";}?>>TODOS</option>
                    </select>
                  </div>
                </div><!-- End .row  -->
<?
            		break;

              case "AGRUPAMENTO_GRUPOS":
                $agrupamentos = getArrayClasse("tb_classe", ConnectDB(), "descricao", "GRAPE", $repre, "A", "ZZ");
                foreach ($agrupamentos["itens"] as $agrup){
                  $desc_agrup = explode("¢", $agrup["descricao"]);
                  $selected = ($agrup['valor'] == $cmbAgrupamentoGrupos) ? "selected" : "";
                  $opt_grupos .= "<option value='".$agrup["valor"]."' ".$selected." >".$desc_agrup[0]."</option>";
                }
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label>Agrupamento de Grupos:</label>
                  </div>
                  <div class="col-sm-10">
                    <select name="cmbAgrupamentoGrupos" consistencia="sempre" consistencia1="pre" msg="Selecione o Agrupamento" style="width: 100%;">
                      <option value="">-- Selecione --</option>
                      <?print $opt_grupos;?>
                      <option value="TODOS" <?if ($cmbAgrupamentoGrupos == "TODOS" || !$cmbAgrupamentoGrupos){print "SELECTED";}?>>TODOS</option>
                      <option value="VAZIO" <?if ($cmbAgrupamentoGrupos == "VAZIO"){print "SELECTED";}?>>Sem Grupo Identificado</option>
                    </select>
                  </div>
                </div><!-- End .row  -->
<?
                break;

            	default:

            	  list($filtroAdicionalDesc,$filtroAdicionalCpo,$filtroAdicionalClasse,$filtroAdicionalLike,$filtroAdicionalConsistencia,$filtroAdicionalTipoDado) = explode("§", $arrValores["descricao"]);

            	  if($filtroAdicionalClasse) {
            	    $cmbfiltroAdicionalTLREB = MontaCombo($filtroAdicionalClasse, ${"filtroAdicionalTLREB".$filtroAdicionalCpo}, $repre);
?>
                  <div class="row pad-top5">
                    <div class="col-sm-2">
                    	<label><?print $filtroAdicionalDesc;?>:</label>
                    </div>
                    <div class="col-sm-10">
                      <select name="filtroAdicionalTLREB<?print $filtroAdicionalCpo?>" consistencia="sempre" consistencia1="pre" msg="Selecione a(o) <?print $titClasse;?>" style="width: 100%;">
                        <?print $cmbfiltroAdicionalTLREB;?>
                        <option value="TODOS" <?if (${"filtroAdicionalTLREB".$filtroAdicionalCpo} == "TODOS" || !${"filtroAdicionalTLREB".$filtroAdicionalCpo}){print "SELECTED";}?>>TODOS</option>
                      </select>
                    </div>
                  </div><!-- End .row  -->
<?
            	  } else {
?>
                  <div class="row pad-top5">
                    <div class="col-sm-2">
                    	<label><?print $filtroAdicionalDesc;?>:</label>
                    </div>
                    <div class="col-sm-10">
                      <input type="text" id="filtroAdicionalTLREB<?print $filtroAdicionalCpo?>" name="filtroAdicionalTLREB<?print $filtroAdicionalCpo?>" value="<?print ${"filtroAdicionalTLREB".$filtroAdicionalCpo};?>" maxlength="60" size="60" consistir="<?print $filtroAdicionalConsistencia?>" tipodado="<?print $filtroAdicionalTipoDado?>" msg="Preencha corretamente <?print $filtroAdicionalDesc;?>!">
                    </div>
                  </div><!-- End .row  -->
<?
            	  }
            		break;
            }
          }
        }
      }

      if(empty($filtro_area) === false) {
        $usa_nc = "N";
      }

      if($usa_nc == "S") {
        require_once("funcoes/NCFuncoes.php");

        $q     = " SELECT equipe, login_sistema_cliente FROM tbadmin WHERE login = '".$session["operador"]."' ";
        $query = DescExecQuery ($q, ConnectDB(), 'N');
        $rec   = mysql_fetch_assoc($query);

        //ROTINA NOVOS CANAIS
        $filtro_array = montaCombosFiltro($session["tp_user"], $rec["equipe"], $rec["login_sistema_cliente"], "frmBackOffice", $repre, $discador_modelo, "array");

        $filtro_array = $arrNC;

        if (is_array($filtro_array)) {

          if($NCTipo == "v2") {
            $filtro_array = $arrNC;
            foreach ($filtro_array as $campo_nc =>$arr_campo_nc){
              if ($filtro_array[$campo_nc]["desc"] !="" && $filtro_array[$campo_nc]["tipo_impressao"] != "VAZIO") {
          ?>
                  <div class='row row-nc' style='min-height:25px'>
                    <div class='col-sm-2 right'><strong><? print $filtro_array[$campo_nc]["desc"];?> </strong>:</div>
                    <div class='col-sm-10 '><? print $filtro_array[$campo_nc]["vlr"];?> </div>
                  </div>
          <?

              } else {
                print $filtro_array[$campo_nc]["vlr_hidden"];
              }
            }
          } else {
            if ($filtro_array["vend_regional"]["desc"]) {
  ?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $filtro_array["vend_regional"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $filtro_array["vend_regional"]["vlr"];?>
                </div>
              </div><!-- End .row  -->
  <?
            } else {
              print $filtro_array["vend_regional"]["hidden"];
            }
            if ($filtro_array["vend_eps"]["desc"]) {
  ?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $filtro_array["vend_eps"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $filtro_array["vend_eps"]["vlr"];?>
                </div>
              </div><!-- End .row  -->
  <?
            } else {
              print $filtro_array["vend_eps"]["hidden"];
            }
            if ($filtro_array["vend_base"]["desc"]) {
  ?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $filtro_array["vend_base"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $filtro_array["vend_base"]["vlr"];?>
                </div>
              </div><!-- End .row  -->
  <?
            } else {
              print $filtro_array["vend_base"]["hidden"];
            }
            if ($filtro_array["vend_depto"]["desc"]) {
  ?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $filtro_array["vend_depto"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $filtro_array["vend_depto"]["vlr"];?>
                </div>
              </div><!-- End .row  -->
  <?
            } else {
              print $filtro_array["vend_depto"]["hidden"];
            }
            if ($filtro_array["vend_login"]["desc"]) {
  ?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $filtro_array["vend_login"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $filtro_array["vend_login"]["vlr"];?>
                </div>
              </div><!-- End .row  -->
  <?
            } else {
              print $filtro_array["vend_login"]["hidden"];
            }
          }


        }
      }

      if ($discador_modelo && $tipo_classe_discador) {
          if ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0) || (strpos("xx".$tipo_classe_discador, "flw_oco_empre") > 0) || (strpos("xx".$tipo_classe_discador, "flw_oco_taref") > 0)) {
            $array_combos = montaCombosFLW("frmBackOffice", $repre, $discador_modelo);
            if($array_combos && $usa_nc != "S") {
?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $array_combos["0"]["desc"];?>:</label>
                </div>
                <div class="col-sm-10">
                  <?print $array_combos["0"]["vlr" ];?>
                </div>
              </div><!-- End .row  -->
<?
              if ($flw_user_nivel_acesso_adm) {
                $ValorClasseArea = ValorClasse("FM".$operacao."N", $flw_user_nivel_acesso, "URANET");
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label><?print $titNivel;?>:</label>
                  </div>
                  <div class="col-sm-10">
                    <select name="rel_nivel_acesso" onChange="TrocaOperacao();" consistir="sempre" tipodado="preenchido" msg="Selecione a(o) <?print $titNivel;?>.">
                      <?print flwMontaComboNA("FM".$operacao."N", $repre, $rel_nivel_acesso, "A",  $flw_user_nivel_acesso_adm);?>
                      <option value="TODOS" <?if($rel_nivel_acesso == "TODOS" || $rel_nivel_acesso == ""){print "SELECTED";}?>>Todos</option>
                    </select>
                  </div>
                </div><!-- End .row  -->
<?
              } else {
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label><?print $array_combos["1"]["desc"];?>:</label>
                  </div>
                  <div class="col-sm-10">
                    <?

                    if (($operacao != "SP") || ($operacao == "SP" && $session["representante"] == "URANET")) {
                    	print $array_combos["1"]["vlr" ];
                    } else {
                    ?>
                      <input type="hidden" name="rel_nivel_acesso" value="">TODOS
                    <?
                    }
                    ?>
                  </div>
                </div><!-- End .row  -->
<?
              }
              if($operacao != "SP" || ($flw_user_nivel_acesso != "7" && $operacao == "SP")) {
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label><?print $array_combos["2"]["desc"];?>:</label>
                  </div>
                  <div class="col-sm-10">
                    <?
                    if (($operacao != "SP") || ($operacao == "SP" && $session["representante"] == "URANET")) {
                    	print $array_combos["2"]["vlr" ];
                    } else {
                    ?>
                      <input type="hidden" name="rel_login" value="">TODOS
                    <?
                    }
                    ?>
                  </div>
                </div><!-- End .row  -->
<?
              }else{
?>
                <input type="hidden" name="rel_login"  value="">
<?
              }
            } else {
?>
              <input type="hidden" name="rel_grupo_acesso" id="rel_grupo_acesso"  value="<?print $flw_user_grupo_acesso?>">
              <input type="hidden" name="rel_nivel_acesso" id="rel_nivel_acesso"  value="<?print $flw_user_nivel_acesso?>">
              <input type="hidden" name="rel_login"        id="rel_login"         value="<?print $session["operador"]?>">
<?
            }
          }
          if ((strpos("xx".$tipo_classe_discador, "reg_atd") <= 0) && (strpos("xx".$tipo_classe_discador, "reg_acc") <= 0)) {
            if($vlrClasseTemaPai == "S") {
              if($filtro_mkprw) {
                if ($flw_user_nivel_acesso == "7") {
                  //tema
                  $filtro_classe_flw_tema = " AND filtro_classe = 'ZZ' ";
                  //tema_pai
                  $filtro_classe_flw_tema_pai = " AND filtro_classe = 'ZZ'  ";
                }
              }

              $utilizaFiltroTemaPai = trim(ValorClasse("FM".substr($discador_modelo,2,2)."K", "FILTRA_TEMA_PAI", DefineRepre($repre)));
              if(empty($utilizaFiltroTemaPai) === false && $utilizaFiltroTemaPai != "--" && $utilizaFiltroTemaPai != "N") {
                $arrFiltroTemaiPai = getArrayClasse("tb_classe", $connect, "descricao", $utilizaFiltroTemaPai, DefineRepre($repre), "T", "ZZ");
                if(is_array($arrFiltroTemaiPai["itens"]) === true) {
                  foreach ($arrFiltroTemaiPai["itens"] as $arrChave => $arrValores) {
                  	$inFiltro .= ",'".$arrValores["valor"]."'";
                  }
                  $filtro_classe_flw_tema_pai = " AND filtro_classe IN (".substr($inFiltro,1).",'ZZ')";
                } else {
                  $filtro_classe_flw_tema_pai = " AND filtro_classe = 'ZZ'";
                }
              }
?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $titTemaPai;?>:</label>
                </div>
                <div class="col-sm-10">
                  <?
                  if (($operacao != "SP") || ($operacao == "SP" && $session["representante"] == "URANET")) {
                	?>
                    <select name="combo_tema_pai" consistir="sempre" tipodado="todos" msg="Selecione <?print $titTemaPai;?>" OnChange="document.frmBackOffice.submit();" style='width:100%'>
                      <?print MontaCombo("FM".substr($discador_modelo,2,2)."T",$combo_tema_pai,DefineRepre($repre), "A", $filtro_classe_flw_tema_pai);?>
                      <option value="todos" <?if  (($combo_tema_pai == "todos") || $combo_tema_pai == "") { print " SELECTED ";}?>>Todos</option>
                    </select>
                  <?
                  } else {
                  ?>
                    <input type="hidden" name="combo_tema_pai" value="todos">TODOS
                  <?
                  }
                  ?>
                </div>
              </div><!-- End .row  -->
<?
              if($combo_tema_pai != "todos" && $combo_tema_pai) {
?>
                <div class="row pad-top5">
                  <div class="col-sm-2">
                  	<label><?print $titTema;?>:</label>
                  </div>
                  <div class="col-sm-10">
                    <select name="combo_tema" consistir="sempre" tipodado="todos" msg="Selecione <?print $titTema;?>" style='width:100%'>
                      <?print MontaCombo($combo_tema_pai,$combo_tema,DefineRepre($repre));?>
                      <option value="todos" <?if ($combo_tema == "todos" || !$combo_tema) { print " SELECTED ";}?>>Todos</option>
                    </select>
                  </div>
                </div><!-- End .row  -->
<?
              }
            } else {
?>
              <div class="row pad-top5">
                <div class="col-sm-2">
                	<label><?print $titTema;?>:</label>
                </div>
                <div class="col-sm-10">
                  <select name="combo_tema" consistir="sempre" tipodado="todos" msg="Selecione <?print $titTema;?>" style='width:100%'>
                    <?print MontaCombo("FM".substr($discador_modelo,2,2)."T",$combo_tema,DefineRepre($repre));?>
                    <option value="todos" <?if ($combo_tema == "todos" || !$combo_tema) { print " SELECTED ";}?>>Todos</option>
                  </select>
                </div>
              </div><!-- End .row  -->
<?
            }
          }
?>
          <div class="row pad-top5">
            <div class="col-sm-2">
            	<label>Relatório:</label>
            </div>
            <div class="col-sm-4">
<?
              if ($relatorio_aux) {
                $relatorio = $relatorio_aux;
              }

              if ($session["representante"] == "URANET") {
                $status_combo_rel = " AND status in ('A','U')";
              } else {
                $status_combo_rel = " AND status ='A' ";
              }

              $q = "SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_TLRE1."' AND representante = '".$repre."' AND tipo_reg = 'I' ".$status_combo_rel.$where_cond_classe." ORDER BY desc_classe";
              $query = DescExecQuery($q, $connect, "N", $session["operador"], $PHP_SELF);
              if (((mysql_numrows($query) < 1) && (($classe_TLRE1 == "GCPR1") || ($classe_TLRE1 == "GOPR1") || ($classe_TLRE1 == "MORL1"))) || !$rec = mysql_fetch_assoc($query))  {
                $q = "SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_TLRE1."' AND representante = 'URANET' AND tipo_reg = 'I' ".$status_combo_rel.$where_cond_classe." ORDER BY desc_classe";
                $query = DescExecQuery($q, $connect,"N",$session["operador"], $PHP_SELF);
              }

              $s=0;
              do{

                $mt_rel[$s]["vlr_classe"]    = $rec["vlr_classe"];
                $mt_rel[$s]["desc_classe"]   = $rec["desc_classe"];
                $mt_rel[$s]["filtro_classe"] = $rec["filtro_classe"];
                $s++;

              }while ($rec = mysql_fetch_assoc($query));
?>

              <select name="relatorio" id="relatorio" consistencia="sempre" consistencia1="pre" msg="Selecione o Relatório" OnChange="document.frmBackOffice.submit();" style="width:90%;" >
<?
                if($session["print_sql"] != "N") {
?>
                  <option value="" style="background-color: #FFAAAA;"><?print $classe_TLRE1;?></option>
<?
                }
?>
                <option value="">-- Selecione -- </option>
<?
                $h=0;
                while($mt_rel[$h]){
               	  if ($mt_rel[$h]["desc_classe"]) {
?>
                    <option value="<?print $mt_rel[$h]["vlr_classe"]."§".$mt_rel[$h]["desc_classe"];?>"<?if(!$relatorio && $mt_rel[$h]["filtro_classe"] == 'ZD') {print " selected";}else{ if($relatorio == $mt_rel[$h]["vlr_classe"]."§".$mt_rel[$h]["desc_classe"]) {print "selected";}}?>><?print $mt_rel[$h]["desc_classe"];?></option>
<?
               	  }
                  $h++;
                }
?>
              </select>
<?
              if ($session["print_sql"] != "N") {
?>
                <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE1;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE1,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
              }
?>
            </div>
            <div class="col-sm-2">
            	<label>Coluna:</label>
            </div>
            <div class="col-sm-4">
<?
              if($param_anual == "anual") {
                $where_anual = " AND left(vlr_classe, 9) = 'tot_anual' ";
              }else{
                $where_anual = " AND left(vlr_classe, 9) != 'tot_anual' ";
              }

              $q     = "SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_TLRE2."' AND representante = '".$repre."' AND tipo_reg = 'I' ".$status_combo_rel.$where_cond_classe.$where_anual." ORDER BY desc_classe";
              $query = DescExecQuery($q, $connect,"N", $session["operador"], $PHP_SELF);
              if (((mysql_numrows($query) < 1) && (($classe_TLRE2 == "GCPR2") || ($classe_TLRE2 == "GOPR2") || ($classe_TLRE2 == "MORL2"))) || !$rec = mysql_fetch_assoc($query))  {
                $q     = "SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_TLRE2."' AND representante = 'URANET' AND tipo_reg = 'I' ".$status_combo_rel.$where_cond_classe.$where_anual." ORDER BY desc_classe";
                $query = DescExecQuery($q, $connect, "N", $session["operador"], $PHP_SELF);
              }

              $s=0;
              do{

                $mt_col[$s]["vlr_classe"]    = $rec["vlr_classe"];
                $mt_col[$s]["desc_classe"]   = $rec["desc_classe"];
                $mt_col[$s]["filtro_classe"] = $rec["filtro_classe"];
                $s++;

              }while ($rec = mysql_fetch_assoc($query));
?>
                <select id="tipo_data" name="tipo_data" consistencia="sempre" consistencia1="pre" msg="Selecione a Coluna" style="width: 87%;" >
<?
                if ($session["print_sql"] != "N") {
?>
                    <option value="" style="background-color: #FFAAAA;"><?print $classe_TLRE2;?></option>
<?
                }
?>
                <option value="">-- Selecione -- </option>
<?
                  $h=0;
                  while($mt_col[$h]){
                   	if ($mt_col[$h]["desc_classe"]) {
?>
                      <option value="<?print $mt_col[$h]["vlr_classe"]."§".$mt_col[$h]["desc_classe"];?>"<?if(!$tipo_data && $mt_col[$h]["filtro_classe"] == 'ZD') {print " selected";}else{ if($tipo_data == $mt_col[$h]["vlr_classe"]."§".$mt_col[$h]["desc_classe"]) {print "selected";}}?>><?print $mt_col[$h]["desc_classe"];?></option>
<?
                   	}
                    $h++;
                  }
?>
                </select>
<?
                if ($session["print_sql"] != "N") {
?>
                  <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE2;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE2,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
                }
?>
            </div>
          </div><!-- End .row  -->
<?
          $combo_status = MontaCombo($classe_TLRE3, $status, DefineRepre($repre), "A", $where_cond_classe);
          $titStatus = $titClasse;
?>
          <div class="row pad-top5">
            <div class="col-sm-2">
            	<label><?print $titStatus?></label>
            </div>
            <div class="col-sm-4">
              <select name="status" id="parm_busca_status" consistencia="sempre" consistencia1="pre" msg="Selecione o Status!" style="width: 90%;">
                <?print $combo_status?>
              </select>
               <?if ($session["print_sql"] != "N") {?>
                   <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE3;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE3,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
               <?}?>
            </div>
<?
            if ((strpos("xx".$tipo_classe_discador, "flw_oco") > 0) || (strpos("xx".$tipo_classe_discador, "flw_oco_empre") > 0)) {
              if(!$tipo_tempo     ){ $tipo_tempo     = "DI";                      }
              $repre_vendedor = $arrParamTemp["repre_vendedor"];
              if (RepreTemClasse("FM".substr($discador_modelo,2,2)."T",DefineRepre($repre)) != "") {
                $repre_usa = DefineRepre($repre);
              } else {
                if (RepreTemClasse("FM".substr($discador_modelo,2,2)."T",$repre_vendedor) != "") {
                  $repre_usa = $repre_vendedor;
                } else {
                  $repre_usa = "URANET";
                }
              }

              $connect_classe = ConnectDB();
              $q_classe = "SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = 'FM".substr($discador_modelo,2,2)."K' AND representante = '".$repre_usa."' AND idioma = '".$session["idioma"]."' AND tipo_reg = 'I' AND vlr_classe IN ('TEMPO_SLA_DI','TEMPO_SLA_HR') and status = 'A' ";
              if ($query_classe = DescExecQuery($q_classe, $connect_classe, "N")) {
                if ($rec_classe = mysql_fetch_assoc($query_classe)) {
                  do {
                    $aux_tipo = str_replace("TEMPO_SLA_", "", $rec_classe["vlr_classe"]);
                    $mtr_option_tempo[$aux_tipo] = $rec_classe["desc_classe"];
                  } while ($rec_classe = mysql_fetch_assoc($query_classe));
                } else {
                  print "<font color='red'><strong>ERRO ENTRE EM CONTATO COM O SAC URANET E INFORME O OCORRIDO<br>PARÂMETRO TEMPO_SLA_ NÃO CADASTRADO.<br>CLASSE: FM".$mk_numero."K&nbsp;&nbsp;&nbsp;&nbsp;REPRE: ".$repre_usa."</strong></font>";
                  exit();
                }
              } else {
                print "<font color='red'><strong>ERRO ENTRE EM CONTATO COM O SAC URANET E INFORME O OCORRIDO<br>".mysql_error($connect_classe)."<br><br>".$q."</strong></font>";
                exit();
              }
              ?>
              <div class="col-sm-2">
              	<label>Tempo em:</label>
              </div>
              <div class="col-sm-4">
                <select name="tipo_tempo" consistencia="sempre" consistencia1="pre" msg="Selecione o Tempo!">
<?
                  $option_tempo = "";
                  $option_tempo .= "<option value=\"\"> -- Selecione -- </option>";
                  if (is_array($mtr_option_tempo)) {
                    foreach ($mtr_option_tempo as $chave_option => $desc_option) {
                      if ($tipo_tempo == $chave_option || count((array)$mtr_option_tempo) == 1) {
                        $select = " selected ";
                      } else {
                        $select = "";
                      }

                      $option_tempo .= "<option value=\"".$chave_option."\" ".$select.">".$desc_option."</option>";
                    }
                  }
                  print $option_tempo;
?>
                </select>
              </div>
<?
            } else {
?>
              <div class="col-sm-2">
              	&nbsp;
              </div>
              <div class="col-sm-4">
                &nbsp;
              </div>
<?
            }
?>
          </div><!-- End .row  -->
          <div class="row pad-top5">
            <div class="col-sm-2">
            	<label>Data:</label>
            </div>
            <div class="col-sm-4">
<?
              $q = "SELECT vlr_classe,desc_classe,filtro_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLRE5."' AND representante = '".$repre."'".$where_cond_classe;
              $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
              $query = mysql_query($q,$connect);
              if (mysql_numrows($query) < 1) {
                $q = "SELECT vlr_classe,desc_classe,filtro_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLRE5."' AND representante = 'URANET'".$where_cond_classe;
                $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
                $query = mysql_query($q,$connect);
              }
              if ($rec = mysql_fetch_assoc($query)) {
                do {
                  //          print $rec["filtro_classe"]."<BR>";
                  if ($rec["vlr_classe"] == "SEMDATA") {
                    if ($rec["filtro_classe"] == "ZD") {
                      if (!$parm_busca_dia) {
                        $parm_busca_dia_aux = "SEMDATA";
                      }
                    }
                  }
                } while ($rec = mysql_fetch_assoc($query));
              }
?>
              <select name="parm_busca_dia" id="parm_busca_dia" consistencia="sempre" consistencia1="pre" msg="Selecione a Data!" style="width: 90%;" OnChange="javascript:verificaData(this);">
                <?print MontaCombo($classe_TLRE5, $parm_busca_dia, DefineRepre($repre), "A", "ZD");?>
              </select>
<?
              if ($session["print_sql"] != "N") {
?>
                <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE5;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE5,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
              }
?>
            </div>
<?
            if (empty($tipo_info) === true) {
              $tipo_info = "quantidade";
            }
            if (empty($tit_visao) === true) {
              $tit_visao = "horiz";
            }
            if ($tipo_campo_combo != "") {
              if (is_array($tipo_campo_combo)){
                $vlr_combo = implode("¢",$tipo_campo_combo);
              } else {
                $vlr_combo = $tipo_campo_combo;
              }
              if($vlr_combo == "Array"){
                $vlr_combo = $tipo_campo_sum."¢¢";
              }
            } else {
              $vlr_combo = "";
            }
            $option_TLRE4 = MontaCombo($classe_TLRE4, $vlr_combo, DefineRepre($repre),"A",$where_cond_classe);
?>
            <div class="col-sm-2">
            	<label>Totalizar:</label>
            </div>
            <div class="col-sm-4">
              <select name="tipo_campo_combo" consistencia="sempre" consistencia1="pre" msg="Selecione o Tipo Soma" OnChange="InseriTpSoma(this)" style="width: 87%;" >
                <?print $option_TLRE4;?>
              </select>
<?
              if ($session["print_sql"] != "N") {
?>
                <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE4;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE4,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
              }
?>
              <input type="hidden" name="tipo_campo_sum" value="<?print $tipo_campo_sum;?>">
              <input type="hidden" name="tipo_campo_combo_aux" value="<?print $tipo_campo_combo;?>">
              <script>
              if(document.frmBackOffice.tipo_campo_combo.value) {
                var TipoSoma = document.frmBackOffice.tipo_campo_combo.value.split("¢");
                var TipoSomaAux = TipoSoma[0];
                document.frmBackOffice.tipo_campo_sum.value = TipoSomaAux;
              }
              </script>
<?
              /*************************************************************/
              // Verifica se tem classe ____A, se tiver, monta o filtro
              /*************************************************************/
              $q = "SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE '$classe_TLREA' AND representante = '".$repre."'".$where_cond_classe;
              $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
              $query = mysql_query($q,$connect);
              if ($rec = mysql_fetch_assoc($query)) {
                do {
                  $mtr_existe_tlreA[$rec["vlr_classe"]] = $rec["desc_classe"];
                } while ($rec = mysql_fetch_assoc($query));
              }
              /*************************************************************/
              if (count((array)$mtr_existe_tlreA) > 0) {
                $option_TLREA = MontaCombo($classe_TLREA, $tipo_agrupamento_combo, DefineRepre($repre),"A",$where_cond_classe)
?>
                <select style="float:left;" name="tipo_agrupamento_combo" consistir="sopreenchido" tipodado="preenchido" msg="Selecione a <?print $titClasse;?>" onchange="geraCampoQtd(this.value);">
                  <?print $option_TLREA;?>
                </select>
<?
                if($session["print_sql"] != "N") {
?>
                  <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLREA;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLREA,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
                }
?>
                <span id="combo_agrupamento" style="float:left;"></span>
                <span id="texto_agrupamento" style="float:left;"><input type="text" style="float:left;disabled:true;" id="qtd_agrupamento_text" name="qtd_agrupamento" value="<?print $qtd_agrupamento;?>" maxlength="8" size="8" consistir="sopreenchido" tipodado="numeros" msg="Preencha corretamente a <?print $titClasse;?>"></span>
<?
              }
              if ($qtd_agrupamento) {
?>
                <script language="javascript">
                  preencheComboAjax();
                </script>
<?
              }
?>
            </div>
          </div><!-- End .row  -->
<?
          /*************************************************************/
          // Verifica se tem classe ____9, se tiver, monta o filtro
          /*************************************************************/
          $q = "SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLRE9."' AND representante = '".$repre."' ".$where_cond_classe;
          $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
          $query = mysql_query($q,$connect);
          if ($rec = mysql_fetch_assoc($query)) {
            do {
              $mtr_existe_tlre9[$rec["vlr_classe"]] = $rec["desc_classe"];
            } while ($rec = mysql_fetch_assoc($query));
          }
          /*************************************************************/

          /********************************************************************************/
          /* ROTINA QUE MONTA FILTRO COM AJAX
          /********************************************************************************/
          $option_TLRE9 = MontaCombo($classe_TLRE9, $tipo_filtro_combo, $repre, "A", $where_cond_classe);
          $titfiltroclasse = $titClasse;

          $q     = "SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".$classe_TLREK."' AND representante = '".$repre."' AND tipo_reg = 'I' ".$where_cond_classe." ORDER BY desc_classe";
          $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
          $query = DescExecQuery ($q, $connect,'N');
          if (mysql_numrows($query) < 1)  {
            $option_TLREK = MontaCombo($classe_TLREK, $tipo_visao_combo, $repre,"A",$where_cond_classe);
          } else {
            $option_TLREK = MontaCombo($classe_TLREK, $tipo_visao_combo, $repre,"A",$where_cond_classe);
          }

          $titclasselista = $titClasse;

          $tipo_data_spl = explode("§", $tipo_data);

          if($repre == "VIVORES-U" && strpos("xxx".$tipo_data_spl[0], "coluna_fixa") > 0) {
             unset($mtr_existe_tlre9);
             unset($filtro_adicional);
          }
?>
          <div class="row pad-top5">
<?
            if (count((array)$mtr_existe_tlre9) > 0) {
?>
              <div class="col-sm-2">
              	<label><?print $titfiltroclasse;?>:</label>
              </div>
              <div class="col-sm-10">
                <select name="combo_condicao" id="combo_condicao">
                  <?print $option_TLRE9;?>
                </select>
                <img align="absmiddle" vspace="0" src="imagens/ico_add.gif" width="15px" style="cursor:pointer;" onClick="AddFiltroAdicional();" title="Adicionar <?print $titfiltroclasse;?> Selecionado">&nbsp;
                <img align="absmiddle" vspace="0" src="imagens/ico_del.gif" width="15px" style="cursor:pointer;" onClick="RemoveTodos();"        title="Remover <?print $titfiltroclasse;?> Selecionado"  >
<?
                if ($session["print_sql"] != "N") {
?>
                  <i class="icon16 glyphicon glyphicon-floppy-disk red cursor-pointer" onclick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_combo;?>&repre=<?print $repre;?>&acesso=A', 'janelaLupa', 650, 350,'Mostra Classe')"></i>
<?
                }
?>
              </div>
<?
              } elseif($repre == "VIVORES-U" && strpos("xxx".$tipo_data_spl[0], "coluna_fixa") > 0) {
?>
                <div class="col-sm-12 text-center">
                	<font class="badge badge-important">Filtro Adicional não Permitido para <?print $tipo_data_spl[1];?></font>
                </div>
<?
              } else {
                if ($session["print_sql"] != "N") {
?>
                <div class="col-sm-12 text-center">
                	<font class="badge badge-important">Filtro Adicional não Permitido para <?print $tipo_data_spl[1];?></font>
                </div>
<?
                }
              }
?>
          </div><!-- End .row  -->
<?
          /*************************************************************/
          $q = "SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLREK."' AND representante = '".$repre."'".$where_cond_classe;
          $query = DescExecQuery($q,$connect,'N',$session["operador"], $_SERVER["PHP_SELF"]);

          if ($rec = mysql_fetch_assoc($query)) {
          	$tem_classe_TLREK = "S";
          }
          /*************************************************************/
?>
          <div class="row pad-top5">
<?
            if ($tem_classe_TLREK) {
?>
              <div class="col-sm-2">
              	<label><?print $titclasselista;?>:</label>
              </div>
              <div class="col-sm-10">
                <select name="tipo_visao_combo" consistir="sempre" tipodado="preenchido" msg="Selecione o campo <?print $titclasselista;?>"><?print $option_TLREK;?></select>
              </div>
<?
          	} else {
?>
              <div class="col-sm-12 text-center">
<?
            	  if ($session["print_sql"] != "N") {
?>
            	    <font class="badge badge-important">Para parametrizar outras visões, crie a classe <?print $classe_TLREK;?></font>
<?
            	  }
?>
              </div>
<?
          	}
?>
          </div><!-- End .row  -->
          <input type="hidden" name="filtro_adicional"        id="id_filtro_adicional" value="<?print $filtro_adicional;?>">
          <input type="hidden" name="classe_filtro_adicional" id="id_classe_filtro"    value="<?print $classe_TLRE9;    ?>">
          <div class="row pad-top5">
          	<div class="col-sm-12" id="id_filtros_add">
          	  <?
              if ($filtro_adicional) {
                $array_filtros = explode("¢A¢",$filtro_adicional);
                foreach($array_filtros as $chave => $valor){
                  if ($valor){
                    $ajax_parametros = explode("§",$valor);

                    $ajax_parametros_aux_cp = explode(",",$ajax_parametros[0]);
                    $ajax_parametros[0]     = $ajax_parametros_aux_cp[0];
                    $ajax_parametros_aux_cp = $ajax_parametros_aux_cp[1];

                    if (is_array(${$ajax_parametros[0]."_filtro"})){
                      foreach(${$ajax_parametros[0]."_filtro"} as $chave_fil => $valor_fil){
                        print "<input type='hidden' name='".$ajax_parametros[0]."_filtro[".$chave_fil."]' value='".$valor_fil."'>";
                      }
                    } else {
                      print "<input type='hidden' name='".$ajax_parametros[0]."_filtro' value='".${$ajax_parametros[0]."_filtro"}."'>";
                    }

                    if ($ajax_parametros_aux_cp){
                      if (is_array(${$ajax_parametros_aux_cp."_filtro"})){
                        foreach(${$ajax_parametros_aux_cp."_filtro"} as $chave_fil => $valor_fil){
                          print "<input type='hidden' name='".$ajax_parametros_aux_cp."_filtro[".$chave_fil."]' value='".$valor_fil."'>";
                        }
                      } else {
                        print "<input type='hidden' name='".$ajax_parametros_aux_cp."_filtro' value='".${$ajax_parametros_aux_cp."_filtro"}."'>";
                      }
                    }
                  }
                }
                ?>
                <script language="javascript">
                  AtuFiltroAdicional();
                </script>
              <?
              }
              ?>
          	</div>
          </div><!-- End .row  -->
          <div class="row pad-top5 text-center">
          	<div class="col-sm-12">
<?
              if($faz_monitoria) {
?>
                <label>Dia:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <select name="dia_pesq"  id="diapesq_cmb" <?if ($parm_busca_dia == "SEMDATA") {print "disabled";}?>>
                  <?print ComboData("D", $dia_pesq, date("d"));?>
                </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<?
              }elseif($param_anual == "anual") {
?>
                <input type="hidden" name="diaini" id="diaini" value="<?print $diaini?>">
                <input type="hidden" name="diafim" id="diafim" value="<?print $diafim?>">
                <label>Mês Inicial:</label>
                <select name="mesini" id="mesini_cmb" <?if ($parm_busca_dia == "SEMDATA") {print "disabled";}?>>
                  <?print ComboData("M", $mesini, $mesfim);?>
                </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<?
              }else{
?>
                <label>Dia Inicial:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <select name="diaini"  id="diaini_cmb" <?if ($parm_busca_dia == "SEMDATA") {print "disabled";}?>>
                  <?print ComboData("D", $diaini, date("d"));?>
                </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label>Dia Final:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <select name="diafim"  id="diafim_cmb" <?if ($parm_busca_dia == "SEMDATA") {print "disabled";}?>>
                  <?print ComboData("D", $diafim, date("d"));?>
                </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<?
              }
?>
              <label>Mês<?if ($param_anual == "anual") {print " Final";}?>:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <select name="mesfim" id="mesfim_cmb" <?if (($parm_busca_dia == "SEMDATA")) {print "disabled";}?>>
                <?print ComboData("M", $mesfim, date("m"));?>
              </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <label>Ano:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <select id="anofim_id" name="anofim" <?if (($parm_busca_dia == "SEMDATA")) {print "disabled";}?>>
                <?print ComboData("A", $anofim, date("Y"));?>
              </select>
          	</div>
          </div><!-- End .row  -->
          <input type="hidden" name="tipo_info" value="<?print $tipo_info;?>">
          <input type="hidden" name="tit_visao" value="<?print $tit_visao;?>">
          <div class="row pad-top5 text-center">
  <?
            if ($deonde == "pesqhist") {
  ?>
              <input type="hidden" name="hora_ini" value="00">
              <input type="hidden" name="min_ini" value="00">
              <input type="hidden" name="hora_fim" value="24">
              <input type="hidden" name="min_fim" value="00">
  <?
            } else {
              if($busca_hora && $busca_hora != "nenhuma") {
  ?>
                <div class="col-sm-12">
              		<label>
                		Hora:
                	  Inicial:
              	  </label>
                  <select name="hora_ini">
                    <?print ComboData("H2", $hora_ini, "00");?>
                  </select>
                  :
                  <select name="min_ini">
                    <option value="00"<?if ($min_ini == "00" || $min_fim == "") { print " selected"; }?>>00</option>
                    <option value="15"<?if ($min_ini == "15") { print " selected"; }?>>15</option>
                    <option value="30"<?if ($min_ini == "30") { print " selected"; }?>>30</option>
                    <option value="45"<?if ($min_ini == "45") { print " selected"; }?>>45</option>
                  </select>
                  <label>Final:</label>
                  <select name="hora_fim">
                    <?print ComboData("H", $hora_fim, "24");?>
                  </select>
                  :
                  <select name="min_fim">
                    <option value="00"<?if ($min_fim == "00" || $min_fim == "") { print " selected";}?>>00</option>
                    <option value="15"<?if ($min_fim == "15") { print " selected";}?>>15</option>
                    <option value="30"<?if ($min_fim == "30") { print " selected";}?>>30</option>
                    <option value="45"<?if ($min_fim == "45") { print " selected";}?>>45</option>
                  </select>
              	</div>
  <?
              }else{
  ?>
                <div class="col-sm-12">&nbsp;</div>
                <input type="hidden" name="hora_ini" value="00">
                <input type="hidden" name="min_ini"  value="00">
                <input type="hidden" name="hora_fim" value="24">
                <input type="hidden" name="min_fim"  value="00">
  <?
              }
            }

            // Pega o parametro campos_consulta, e monta a matriz de valores para a consulta alternativa
            $campos_consulta = trim($param_campos_consulta);
            $mostra_combo = "N";

            if($campos_consulta && ($campos_consulta != "--")) {
  ?>
              <input type="hidden" name="campos_na_consulta" value="status">
  <?
              $campos_consulta = substr($campos_consulta, 1, strlen($campos_consulta)-1);
              $campos_consulta_array1 = split("§", $campos_consulta);
              $nro_campos_consulta = count((array)$campos_consulta_array1);
              for($i=0;$i<$nro_campos_consulta;$i++){
                $campos_consulta_array_aux = split("¢", $campos_consulta_array1[$i]);
                if($campos_consulta_array_aux[0] != "")
                $mostra_combo = "S";
                $campos_consulta_array[$i]["desc"]       = $campos_consulta_array_aux[0];
                $campos_consulta_array[$i]["nome_campo"] = $campos_consulta_array_aux[1];
                $campos_consulta_array[$i]["like"]       = $campos_consulta_array_aux[2];
              }
            }
  ?>
          </div><!-- End .row  -->
<?
        if ($deonde != "pesqhist") {
?>
          <div class="row pad-top5 text-center">
          	<div class="col-sm-12">
              <input type="radio" name="tipo_info_rd" id="tipo_info_rd_quantidade" value="quantidade" OnClick="FuncMandaValorRadio(this, document.frmBackOffice.tipo_info);"<?
              if ($tipo_info == "quantidade"){
                ?> checked <?
              }
?>
              >
              <label for="tipo_info_rd_quantidade">Qtd</label>
              <input type="radio" name="tipo_info_rd" id="tipo_info_rd_perc_horiz" value="perc_horiz" OnClick="FuncMandaValorRadio(this, document.frmBackOffice.tipo_info);"<?
              if ($tipo_info == "perc_horiz") {
                ?> checked<?
              }
?>
              >
              <label for="tipo_info_rd_perc_horiz">% Horizontal</label>
              <input type="radio" name="tipo_info_rd" id="tipo_info_rd_perc_verti" value="perc_verti" OnClick="FuncMandaValorRadio(this, document.frmBackOffice.tipo_info);"<?
              if ($tipo_info == "perc_verti") {
                ?> checked<?
              }
?>
              >
              <label for="tipo_info_rd_perc_verti">% Vertical</label>
              <input type="radio" name="tit_visao_rd" id="tit_visao_rd_horiz" value="horiz" onclick="document.frmBackOffice.tit_visao.value = this.value;"<?
              if ($tit_visao == "horiz") {
                ?> checked<?
              }
?>
              >
              <label for="tit_visao_rd_horiz">Título Horizontal</label>
              <input type="radio" name="tit_visao_rd" id="tit_visao_rd_verti" value="verti" onclick="document.frmBackOffice.tit_visao.value = this.value;"<?
              if ($tit_visao == "verti") {
                ?> checked<?
              }
?>
              >
              <label for="tit_visao_rd_verti">Título Vertical</label>
          	</div>
          </div><!-- End .row  -->
<?
        }
?>
        <div class="row pad-top5 text-center">
<?
         if($mostra_combo == "S") {
?>
           <div class="col-sm-12">
             <img src="imagens/blank.gif" height="1px" width="48px"><font class="txt5"><b>
             <input type="hidden" name="mostra_combo_aux" value="S">
             <select name="campo_consulta" id="campo_consulta" onchange="javascript:alteraConsistencia();">
<?
             if($nro_campos_consulta) {
                for($i=0;$i<$nro_campos_consulta;$i++){
                  if(trim($campo_consulta) ==          trim($campos_consulta_array[$i]["nome_campo"]."£££".$campos_consulta_array[$i]["desc"]."£££".$campos_consulta_array[$i]["like"])){
                    $select_campo = "selected";
                  }else{
                    $select_campo = "";
                  }
                  print "<option value='".$campos_consulta_array[$i]["nome_campo"]."£££".$campos_consulta_array[$i]["desc"]."£££".$campos_consulta_array[$i]["like"]."'  ".$select_campo.">".$campos_consulta_array[$i]["desc"]."</option>";
                }
              }
?>
             </select>:
             <input type="hidden" name="escolha_tipo" value="<?print $escolha_tipo?>">
             <input type="text"   id="campo_cons" name="campo_cons" value="<?print $campo_cons?>" consistencia="<?if ($deonde == "pesqhist") {?>sempre<?} else {?>sopreenchido<?}?>" maxlength="80"<?if (strpos("**".$campo_consulta, "cpf")  > 0) {?>onkeyup="javascript: this.value = montaMascara('##############',this.value); DescLengthCPFCNPJ(this, document.getElementById('tamCpfCnpj2')); "<?}?> consistir="sempre" minlength="11" tipodado="cpfcnpj" msg="Preencha corretamente o número do CPF" >
             <span id="tamCpfCnpj2" class="txt5" style="width: 35px; border: none; background: none; color: #DD0000;"></span>
<?
             if (!$campo_consulta) {
?>
               <script type="text/javascript">
                 alteraConsistencia();
               </script>
<?
             }
             if (strpos("**".$campo_consulta, "cpf")  > 0) {
?>
               <script type="text/javascript">
                 if (document.frmBackOffice.campo_cons.value) {
                   document.frmBackOffice.campo_cons.value = montaMascara('##############',document.frmBackOffice.campo_cons.value);
                 }
                 DescLengthCPFCNPJ(document.frmBackOffice.campo_cons, document.getElementById('tamCpfCnpj2'));
               </script>
<?
             }
?>
        	 </div>
<?
         }else{
?>
           <input type="hidden" name="mostra_combo_aux" value="N">
        	 <div class="col-sm-2">
        	 	<label>CPF/CNPJ:</label>
        	 </div>
        	 <div class="col-sm-10">
        	   <input type="text" value="<?print $cpf_cnpj?>" name="cpf_cnpj" id="cpf_cnpj" size="20" consistencia="<?if (Decriptografa($deonde) == 3) {?>sopreenchido<?} else {?>sempre<?}?>" maxlength="18" onkeyup="javascript: this.value = montaMascara('##############',this.value); DescLengthCPFCNPJ(this, document.getElementById('tamCpfCnpj2'));" consistir="sempre" minlength="11" tipodado="cpfcnpj" msg="Preencha corretamente o número do CPF" style="float: left; width: 105px;">
             <span id="tamCpfCnpj2" class="txt5" style="padding-left: 3px; width: 35px; border: none; background: none; color: #DD0000;"></span>
             <script type="text/javascript">
               if (document.frmBackOffice.cpf_cnpj.value) {
                 document.frmBackOffice.cpf_cnpj.value = montaMascara('##############',document.frmBackOffice.cpf_cnpj.value);
               }
               DescLengthCPFCNPJ(document.frmBackOffice.cpf_cnpj, document.getElementById('tamCpfCnpj2'));
             </script>
<?
             if (Decriptografa($deonde) != 3) {
               print "*";
             }
?>
             <input type="text" name="sizer" size="7" readonly style="width: 48px; border: none; background: none; color: #DD0000;">
        	 </div>
<?
         }
?>
        </div><!-- End .row  -->
<?
      if ($discador_modelo == "MDYB") {
        if ($usa_fcr) {
          $usa_fcr_checked = " checked ";
        }else{
          $usa_fcr_checked = "";
        }
?>
        <div class="row pad-top5 text-center">
          <div class="col-sm-12">
            <label><input type="checkbox" name="usa_fcr" id="usa_fcr" <?=$usa_fcr_checked?>> Pesquisa FCR (First Call Resolution)</label>
          </div>
        </div>
<?
      }


      }
    }
?>
  </div><!-- End .simple-panel-body  -->
</div><!-- End .simple-panel simple-panel-primary  -->
<input type='hidden' name='ordena_tot' value='D'>
<input type='hidden' name='ordena' value='S'>
<input type='hidden' name='campo_ordena' value='tot'>
<input type="hidden" name='desabilita' value="falso">
<input type="hidden" name='desc_conds' value="<?print $desc_conds;?>">
</form>

<br>
<br>
<?
if($discador_modelo && $tipo_classe_discador) {
?>
 <div align="center"><input type="button" name="btnProcurar" value=" Consultar " OnClick="EnviaDadosGestao();" class="btn btn-primary" <?print $botão_disabled?>></div>
<?
}
if(substr($rel_vars[3],0,8) == "(arvore)") {
  if($ordem_arvore > 1) {
    print GerarRodape("javascript: document.arvore.ordem_arvore.value = document.arvore.ordem_arvore_retorna.value; document.arvore.direcao.value = 'retorna'; document.arvore.ordem_arvore.value--; document.arvore.submit()", $titulo, "", "");
  }else{
    print GerarRodape("cc_consulta.php?nivel=K");
  }
}else{
  print GerarRodape("cc_consulta.php?nivel=K");
}
?>
<script type="text/javascript">
  if ((document.getElementById("teste1")) && (document.getElementById("desc_conds"))) {
    $("#teste1").attr("href", $("#teste1").attr("href") + $("#desc_conds").val());
    if (document.getElementById("vlr_cmp0")) {
      $("#vlr_cmp0").html($("#desc_conds").val());
    }
  }
  geraCampoQtd('<?print $tipo_agrupamento_combo;?>');
<?
  if (!$tipo_agrupamento_combo) {
?>
    $("#texto_agrupamento").hide();
    $("#qtd_agrupamento_text").attr("disabled","true");
<?
  }
  if ($rel_grupo_acesso && $rel_nivel_acesso) {
?>
    $(document).ready(function () {
      montaWhere();
    });
<?
  }
?>
</script>
</body>
</html>