<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}
require_once("funcoes/iaEFView.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/GestaoFuncoes.php");
require_once("/libs/func/MobileDetect.php");
include "mk_funcoes.php";

require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/MKParam.php");

require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/rotinas/CamposExtrasFUNC.php");
require_once($_SERVER["DOCUMENT_ROOT"]."/libs/bd/ConexaoCallCenter.php");
require_once($_SERVER["DOCUMENT_ROOT"]."/libs/bd/ConexaoBDADO.php");

ini_set("memory_limit","256M");

$connectCallCenter = new ConexaoCallCenter();

if ($_GET["id_request"] && $_GET["id_request"] != "") {
  // SU BMG ACCESS DENIED POR CAUSA DO WAF BLOQUEAR POSSIVEIS SQL INJECTION
  $connectCallCenter->query("SELECT request_url FROM tb_gv_request_string WHERE id_request = '".addslashes($_GET["id_request"])."'");
  $return_url = $connectCallCenter->result["request_url"];
  $_GET = parse_str($return_url);
}

$detect = new MobileDetect();

$arr_busca_dia     = explode("¢",$parm_busca_dia);
$param_coluna_data = $arr_busca_dia[0];
$param_timestamp   = strtoupper($arr_busca_dia[4]);

//str_replace("00:00:00 00:00:00", "00:00:00", )\'  and \'2018-10-29 23:59:59 23:59:59\'

function formatDataWhereGV($campo, $data_ini, $data_fim, $parte){
  global $param_timestamp, $param_coluna_data;

  if($param_timestamp == "TIMESTAMP" && $campo == $param_coluna_data){
    if($data_ini == $data_fim || !$data_fim){
      if (strlen($data_ini) == 19) {
        return $parte." ".$campo." between '".$data_ini."' and '".$data_ini."' ";
      } else {
        return $parte." ".$campo." between '".$data_ini." 00:00:00' and '".$data_ini." 23:59:59' ";
      }
    }else{
      if (strlen($data_ini) == 19) {
        return $parte." ".$campo." between '".$data_ini."' and '".$data_fim."' ";
      } else {
        return $parte." ".$campo." between '".$data_ini." 00:00:00' and '".$data_fim." 23:59:59' ";
      }
    }
  }else{
    if($data_ini == $data_fim || !$data_fim){
      return $parte." ".$campo." = '".addslashes($data_ini)."' ";
    }else{
      return $parte." ".$campo." between '".$data_ini."' and '".$data_fim."' ";
    }
  }
}

if($discador_modelo) {

  $arrParamTempA[strtoupper("host")             ] = "host";
  $arrParamTempA[strtoupper("user")             ] = "user";
  $arrParamTempA[strtoupper("senha")            ] = "senha";
  $arrParamTempA[strtoupper("bd")               ] = "bd";
  $param_bd              = "_historico";
  $arrParamTempA[strtoupper("host". $param_bd) ] = "host". $param_bd;
  $arrParamTempA[strtoupper("user". $param_bd) ] = "user". $param_bd;
  $arrParamTempA[strtoupper("senha". $param_bd)] = "senha". $param_bd;
  $arrParamTempA[strtoupper("bd". $param_bd)   ] = "bd". $param_bd;
  $param_bd              = "_proposta";
  $arrParamTempA[strtoupper("host". $param_bd) ] = "host". $param_bd;
  $arrParamTempA[strtoupper("user". $param_bd) ] = "user". $param_bd;
  $arrParamTempA[strtoupper("senha". $param_bd)] = "senha". $param_bd;
  $arrParamTempA[strtoupper("bd". $param_bd)   ] = "bd". $param_bd;
  $arrParamTempA["BD"                           ] = "BD";
  $arrParamTempA["TABELA"                       ] = "TABELA";
  $arrParamTempA["TABELA_HISTORICO"             ] = "TABELA_HISTORICO";
  $arrParamTempA["TABELA_PROPOSTA"              ] = "TABELA_PROPOSTA";
  $arrParamTempA["TABELA_REG_ATD"               ] = "TABELA_REG_ATD";
  $arrParamTempA = MKParam::retornaArrParam($discador_modelo."A",$repre,$arrParamTempA);

  if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  	$param_bd            = "";
  }

  $host                  = $arrParamTempA["host". $param_bd ];
  $user                  = $arrParamTempA["user". $param_bd ];
  $senha                 = $arrParamTempA["senha". $param_bd];
  $bd                    = $arrParamTempA["bd". $param_bd   ];

  $arrParamTempB["INCLUDE_DADOS"          ] = "INCLUDE_DADOS";
  $arrParamTempB["CONCLUSAO"              ] = "CONCLUSAO";
  $arrParamTempB["CAMPOS_CONSULTA"        ] = "CAMPOS_CONSULTA";
  $arrParamTempB["CAMPOS_CONSULTA_REG_ATD"] = "CAMPOS_CONSULTA_REG_ATD";
  $arrParamTempB["NRO_NC"                 ] = "NRO_NC";
  $arrParamTempB["USA_NC"                 ] = "USA_NC";
  $arrParamTempB["REPRE_VENDEDOR"         ] = "REPRE_VENDEDOR";
  $arrParamTempB["DESC_TEL"               ] = "DESC_TEL";
  $arrParamTempB["CLASSE_RECUSA"          ] = "CLASSE_RECUSA";
  $arrParamTempB["CLASSE_C_IMP"           ] = "CLASSE_C_IMP";
  $arrParamTempB["CLASSE_VENDA"           ] = "CLASSE_VENDA";
  $arrParamTempB["CLASSE_AGENDA"          ] = "CLASSE_AGENDA";
  $arrParamTempB["PARAM_EMPRESA"          ] = "PARAM_EMPRESA";
  $arrParamTempB["PARAM_EMPRESA_PRODUTO"  ] = "PARAM_EMPRESA_PRODUTO";
  $arrParamTempB["CONCLUSAO"              ] = "CONCLUSAO";
  $arrParamTempB["TIPO_AGENDA"            ] = "TIPO_AGENDA";
  $arrParamTempB["DISK_POWER_FICHA"       ] = "DISK_POWER_FICHA";
  $arrParamTempB["DISK_POWER_LISTA"       ] = "DISK_POWER_LISTA";
  $arrParamTempB["TIPO_DISCADOR"          ] = "TIPO_DISCADOR";
  $arrParamTempB["TIPO_DISCADOR_INFRA"    ] = "TIPO_DISCADOR_INFRA";

  $arrParamTempB = MKParam::retornaArrParam($discador_modelo."B",$repre,$arrParamTempB);

//  print "<pre>";
//  var_dump($arrParamTempA, $arrParamTempB);

  $arrParamTemp = array_merge($arrParamTempA, $arrParamTempB);

}

$repre_backup_mk = repreParam($repre);

if (($discador_modelo == "DKK0" || $discador_modelo == "DKKU") && $rel_vend_regional && !$campo_cons) { // gambi do fabio
  $aux = explode("<SEP>", $rel_vend_regional);
  if($aux[0] && $aux[0] != "TODOS")
    $where_filtro_add.= " and ".str_replace("(A)", "'", ValorClasse("EKK0D", $aux[0]."_F", "BMG-LOJA"))." ";
  if($aux[1] && $aux[1] != "TODOS")
    $where_filtro_add.= " and ".str_replace("(A)", "'", ValorClasse("EKK0D", $aux[1]."_F", "BMG-LOJA"))." ";
}

if (($discador_modelo == "DKK0" || $discador_modelo == "DKKU") && $rel_vend_eps && !$campo_cons) { // gambi do fabio
  $bmg_base_propria = $rel_vend_eps;
  $where_filtro_add.= " and id_base_propria = '".addslashes($bmg_base_propria)."' ";
}

//print $rel_vend_regional."*****";
$arrOperacoes[0] = $discador_modelo;

if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO" && $agrupa_operacao) {
  $arrAgrupa_operacao = explode("¢", ValorClasse("AGROP", $agrupa_operacao, $repre));
  $arrOperacoes       = explode(",", str_replace("|", "", $arrAgrupa_operacao[1]));

  $array_REPRE_agrupa = getArrayClasse("tb_classe", $connectCallCenter, "descricao", "REPRE", $session["representante"], "A", "ZZ");

  //  print "<pre>";
  //  print_r($array_REPRE_agrupa);

  if(is_array($array_REPRE_agrupa["itens"])) {
    foreach($array_REPRE_agrupa["itens"] as $id => $arr_dados_repre) {

      $array_DKPRO = getArrayClasse("tb_classe", $connectCallCenter, "descricao", "DKPRO", $arr_dados_repre["valor"], "A", "ZZ");

      if(is_array($array_DKPRO["itens"])) {
        foreach($array_DKPRO["itens"] as $id_dkpro => $arr_dados_dkpro) {
          $mtDKMDPRO["DK".$arr_dados_dkpro["valor"]] = "1";
        }
      }

      $array_MDPRO = getArrayClasse("tb_classe", $connectCallCenter, "descricao", "MDPRO", $arr_dados_repre["valor"], "A", "ZZ");

      if(is_array($array_MDPRO["itens"])) {
        foreach($array_MDPRO["itens"] as $id_mdpro => $arr_dados_mdpro) {
          $mtDKMDPRO["MD".$arr_dados_mdpro["valor"]] = "1";
        }
      }
    }
  }

  //  if($session["operador"] == "re015863") {
  //    print_r($arrOperacoes);
  //  }

  if(is_array($arrOperacoes)) {
    foreach($arrOperacoes as $id_operacoes => $cod_ope) {
      if($mtDKMDPRO[$cod_ope]) {
        $nova_arrOperacoes[] = $cod_ope;
      }
    }

    $arrOperacoes = $nova_arrOperacoes;
  }



  if(is_array($arrAgrupa_operacao)) {
    if($arrAgrupa_operacao[1]) {
      $arrAgrupa_operacao[1] = "|".implode("|,|",$arrOperacoes)."|";
      //print $arrAgrupa_operacao[1];
    }
  }

  //  if($session["operador"] == "re015863") {
  //    print_r($arrOperacoes);
  //  }

}

if (substr(strtoupper($tipo_classe_discador),0,2) != "DX") {
  $where_status_t = " status <> 'T' ";
  $campo_status   = " , status ";
} else {
  $where_status_t = " 1=1 ";
}

//funcionalidade para abrir o programa de alteração da proposta igual funciona na ramal
//Marcelo 29/08/2014
$isPermiteAlterar = false;
$retornaPermissao = GetPermissaoEquipe($session["operador"], $session["representante"], $session["equipe"]);
if($retornaPermissao == "ADM" || $retornaPermissao == "SAC_NV1" || $retornaPermissao == "SAC_NV2" || $retornaPermissao == "WEB_NV1" || $retornaPermissao == "WEB_NV2"){
  $isPermiteAlterar = true;
}

if (($repre)) {
  if (($repre == "URANETGOP" || $repre == "URANET-RH") && representanteRh($session["operador"]) == "URANET") {
  }elseif (($session["representante"] == "TELEFVDA-AVA" || $session["representante"] == "TELEFVDA-ATD" || $session["representante"] == "TELEFVDA-DCS") && $deonde == "MK_HIST_CLIENTE") {

  } else {
    if (ValorClasse("REPRE",$repre,$session["representante"]) == " -- ") {
      $debug_server = "<pre>".print_r($_SERVER,true).print_r($_REQUEST,true).print_r($_SESSION,true);
      require_once("/libs/ctr/AlarmeCTR.php");
      $arrAlarme["re000161"] = "re000161";
      $arrAlarme["re000064"] = "re000064";
      $arrAlarme["re013822"] = "re013822";

      AlarmeCTR::setAlarmeIntegrAll($arrAlarme,"<pre><font color=red size=4>GESTÃO ".$session["operador"]."-</font>".$debug_server."</font>","N");

      require_once("funcoes/Login.php");
      setPassword($session["operador"], "xxxxxxxxxx");
      header ("Location: /callcenter/cc_logout.php");
      exit;
    }
  }
}

function montaBiOs($status) {

  switch (substr($status,0,1)) {
    case "F":
      return "<img src='imagens/led_verde.gif' title='".ValorClasse("GECFP", $status, "URANET")."'>";
      break;
    case "E":
      return "<img src='imagens/led_azul.gif' title='".ValorClasse("GECFP", $status, "URANET")."'>";
      break;
    default:
      return "<img src='imagens/led_vermelho.gif' title='".ValorClasse("GECFP", $status, "URANET")."'>";
      break;
  }

}

function mostraTitulo($assunto, $titulo) {
  return " onmouseover=\"javascript: mostraTitle('".$titulo."', '".$assunto."');\" onmouseout=\"javascript:escondeTitle();\" ";
}

$param_repre_vendedor = $arrParamTemp["repre_vendedor"];

if ($nro_modelo == "ZV") {
  if (substr($session["representante"], 0, 3) == "BMC" && ($session["tp_user"] == "VDA" || $session["tp_user"] == "EPS" || $session["tp_user"] == "REG"  || $session["tp_user"] == "CAN")) {
    if (!$session["equipe"])       {
?>
      <div align="center"><font class="txtvermelho"><strong>EQUIPE EM BRANCO</strong></font></div><br>
<?
    }
    if (!$session["login_sistema_cliente"]) {
?>
      <div align="center"><font class="txtvermelho">LOGIN SISTEMA CLIENTE EM BRANCO<BR>
<?
    }
    if (strpos(" ".$session["login_sistema_cliente"],",") > 0) {
      $login_cliente_in = str_replace(",", "','", substr($session["login_sistema_cliente"], 0, -1));
      $where_trava_permissao = " AND ".$session["equipe"]." IN ('".$login_cliente_in."')";
    } else {
      $where_trava_permissao = " AND ".$session["equipe"]." = '".addslashes($session["login_sistema_cliente"])."'";
    }
  }
}

/**
 * Retorna Descrição Código Registro de Atendimento
 *
 * @param string $cod_atd
 * @param string $status
 * @return string
 * @author Eduardo Pereira
 *
 * @since 12/03/2010
 *
 * @version 20/05/2016 - Eduardo Pereira
 */
function getDescCodAtdHondaCNH($cod_atd, $status, $origem, $principal) {
  //COM A IMPLANTAÇÃO DO NUMERÁRIO FOI PRECISO CRIAR UM CÓDIGO DE ATD. PRINCIPAL COM 03 CARACACTERES, COM ISSO O CAMPO CNH_COD_ATD PASSOU A TER 04 CARACTERES
  // MAS PARA PASSAR PARA A HONDA SÓ PODEMOS ENVIAR 03 CARACTERES, SENDO ASSIM CRIAMOS ESTA REGRA DE EXCEÇÃO, ONDE PARA EXIBIR PODEMOS LER ATÉ 04 CARACTERES.
  if (strlen($cod_atd) < strlen($origem.$principal)) {
    $cod_atd = $origem.$principal;
  }

  $atd_origem = substr($cod_atd, 0, 1);
  $atd_principal = substr($cod_atd, 1);

  if ($status != "4") {
    return ValorClassePrint("RABI1", $atd_origem, "HONDA-U")." - ".ValorClassePrint("RABI2", $atd_principal, "HONDA-U");
  } else {
    if ($atd_origem != "1" && $atd_origem != "2" && $atd_origem != "3" && $atd_origem != "4") {
      return ValorClassePrint("EKBIW", $atd_origem.$atd_principal, "HONDA-U");
    } else {
      return ValorClassePrint("RABI1", $atd_origem, "HONDA-U")." - ".ValorClassePrint("RABI2", $atd_principal, "HONDA-U");
    }
  }
}

function ListaProtocolosRet($protocolos){
  $protocolos = str_replace(", ,",",",$protocolos);
  $array_prot = explode(",",$protocolos);
  if($array_prot){
    foreach($array_prot as $chave => $valor){
      if($valor){
        $array_prot_aux[$valor] = $valor;
      }
    }

  }

  if($array_prot_aux){
    print "<img src=\"imagens/pedidos.png\" align=\"top\" title=\"Exibir Protocolos Gerados.\" height=\"22\" width=\"22\" onClick=\"AbreProtocolos('".$protocolos."');\" style=\"cursor: pointer;\">";
  }
}

function retornaDefineRepre($repre, $var_nao_usar_define_repre = "S",$repre_vendedor = "") {


    if($repre_vendedor == "PORTOSEGURO-P"){
    return  $repre_vendedor;
  }
  if($repre_vendedor == "BMC¢RET"){
    return  $repre_vendedor;
  }
  if ($var_nao_usar_define_repre == "S") {
    return DefineRepre($repre);
  } else if (strlen($var_nao_usar_define_repre) > 1) {
    return $var_nao_usar_define_repre;
  } else {
    return $repre;
  }
}

if (strpos("xxx".$busca_dia, "¬") > 0) {
  $arr_busca_dia = explode("¬", $busca_dia);
  $busca_dia = $arr_busca_dia[0];
  $val_ano_mes = $arr_busca_dia[1];
}

$tipo_campo_sum = urlencode($tipo_campo_sum);
$tipo_campo_sum = str_replace("%28","(",$tipo_campo_sum);
$tipo_campo_sum = str_replace("%29",")",$tipo_campo_sum);
$tipo_campo_sum = str_replace("%2A","*",$tipo_campo_sum);
if (is_array($tipo_campo_combo)) {
  foreach ($tipo_campo_combo as $key => $value) {
    $value = urlencode($value);
    $value = str_replace("%28","(",$value);
    $value = str_replace("%29",")",$value);
  }
} else {
  $tipo_campo_combo = urlencode($tipo_campo_combo);
  $tipo_campo_combo = str_replace("%28","(",$tipo_campo_combo);
  $tipo_campo_combo = str_replace("%29",")",$tipo_campo_combo);
}

require_once("/libs/ctr/Formata.php");
require_once("funcoes/FormInteligente.php");
require_once("funcoes/NCFuncoes.php");

if(!$deonde_dac) {
  require_once("funcoes/CEFuncoes.php");
  require_once("funcoes/getDadosBitCom.php");
  require_once("cores.php");
  require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/ScriptInteligente.php");//Include do Ação Inteligente
  require_once("sa_funcoes.php");
  require_once("flw_funcoes.php");
}

require_once("mk_funcoes.php");

function MontaPesqUra($dk_campanha, $campo_valor, $repre) {
  global $session;

  $tab_pesq .= "<style>";
  $tab_pesq .= "  fieldset {";
  $tab_pesq .= "    width: 450px;";
  $tab_pesq .= "    background:".$session["td_dado3"].";";
  $tab_pesq .= "    padding: 0 5px 0px 5px;";
  $tab_pesq .= "    border:1px solid ".$session["td_dado3"]."?>;";
  $tab_pesq .= "    text-align: left;";
  $tab_pesq .= "  }";
  $tab_pesq .= "  legend {";
  $tab_pesq .= "    padding: 0px 3px 0px 3px;";
  $tab_pesq .= "    font-weight: bold;";
  $tab_pesq .= "    font-size: 12;";
  $tab_pesq .= "  }";
  $tab_pesq .= "  fieldset ol {";
  $tab_pesq .= "    margin: 0;";
  $tab_pesq .= "    padding: 0;";
  $tab_pesq .= "  }";
  $tab_pesq .= "  fieldset ol li{";
  $tab_pesq .= "    margin: 0px 0px 0px 20px;";
  $tab_pesq .= "    padding: 0;";
  $tab_pesq .= "  }";
  $tab_pesq .= "</style>";
  //        $tab_pesq .= "<center>";
  $tab_pesq .= "<fieldset style='margin: 1px auto; '>";
  $tab_pesq .= "<legend>Pesquisa</legend>";
  $tab_pesq .= "<ol>";
  $tab_pesq .= "<li style='border-bottom: none;' class='txt5'>";

  $get_pesq_ura = getArrayClasse("tb_classe", ConnectDB(), "descricao", "URANV", $repre, "A", " AND vlr_classe LIKE '".$dk_campanha."%' AND LENGTH(vlr_classe) <= '6'");
  if (is_array($get_pesq_ura["itens"]) === true) {
    foreach ($get_pesq_ura["itens"] as $key => $value) {
      $arr_pesq_ura[substr($value["valor"],0,5)][$value["valor"]] = $value["descricao"];
    }
  }

  $get_resp_ura = explode(";", $campo_valor);
  if (is_array($get_resp_ura) === true) {
    foreach ($get_resp_ura as $key => $value) {
      $arr_resp_ura[$dk_campanha.$value] = "X";
    }
  }

  if (is_array($arr_pesq_ura) === true) {
    ksort($arr_pesq_ura);
  }

  if (is_array($arr_resp_ura) === true) {
    ksort($arr_resp_ura);
  }

  if ($arr_resp_ura[$dk_campanha."O"]) {
    $tab_pesq .= $arr_pesq_ura[$dk_campanha."O"][$dk_campanha."O"];
  } else {
    unset($arr_pesq_ura[$dk_campanha."O"]);
    if (is_array($arr_pesq_ura) === true) {
      foreach ($arr_pesq_ura as $pergunta => $array_perg) {

        if (is_array($array_perg) === true) {
          ksort($array_perg);
          foreach ($array_perg as $cod => $desc) {

            if (strlen($cod) == 5) {
              $num_perg++;
              if ($num_perg > 1) {
                $br = "<br><br>";
              }
              $tab_pesq .= $br.$num_perg.") ".$desc."<br>";
            } else {
              if ($arr_resp_ura[$cod]) {
                $tab_pesq .= "&nbsp;&nbsp;&nbsp;(".$arr_resp_ura[$cod].")".$desc."&nbsp;&nbsp;&nbsp;";
              } else {
                $tab_pesq .= "&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;)".$desc."&nbsp;&nbsp;&nbsp;";
              }
            }

          }
        }

      }
    }
  }

  $tab_pesq .= "</li>";
  $tab_pesq .= "</ol>";
  $tab_pesq .= "</fieldset>";
  //        $tab_pesq .= "</center>";

  return $tab_pesq;

}
//CUIDADO - VARIAVEIS DE OUTROS PROGRAMAS
/*
$deonde = "MK_HIST_CLIENTE" -> mk_hist_cliente.php - Historico DK/MD;
*/
//CUIDADO - VARIAVEIS DE OUTROS PROGRAMAS

//if ($campo_deonde) {
//  if (strpos("xxx".$campo_deonde, "¢") > 0) {
//    $arr_campo_deonde           = explode("¢", $campo_deonde);
//    $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".$session[$arr_campo_deonde[1]]."'";
//  } elseif (strpos("xxx".$campo_deonde, "-") > 0) {
//    $arr_campo_deonde           = explode("-", $campo_deonde);
//    if (${$arr_campo_deonde[0]}) {
//      if (${$arr_campo_deonde[0]} == "TODOS") {
//        foreach ($_SESSION["ssitgl_permissao_consulta"][$arr_campo_deonde[1]] as $key => $value) {
//          if ($value) {
//            $in_unidade .= ",'".$value."'";
//          }
//        }
//        $where_operador_performance = " AND ".$arr_campo_deonde[0]." in (".substr($in_unidade,1).")";
//      } else {
//        $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".${$arr_campo_deonde[0]}."'";
//      }
//    }
//  }
//}
// showvars();

if ($campo_deonde) {
  if (strpos("xxx".$campo_deonde, "¢") > 0) {
    $arr_campo_deonde           = explode("¢", $campo_deonde);
    if ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0) && $arr_campo_deonde[0] == "login_operador") {
      $where_operador_performance = " AND oco.".$arr_campo_deonde[0]." = '".addslashes($session[$arr_campo_deonde[1]])."'";
    } else {
      $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".addslashes($session[$arr_campo_deonde[1]])."'";
    }
  } elseif (strpos("xxx".$campo_deonde, "-") > 0) {
    $arr_campo_deonde           = explode("-", $campo_deonde);
    if (${$arr_campo_deonde[0]}) {
      if (${$arr_campo_deonde[0]} == "TODOS") {
        $array_permissao = getArrayClasse("tb_classe", ConnectDB(), "descricao", $arr_campo_deonde[1], $repre, "A", "ZZ");
        //        print "<pre>";xxx
        if (is_array($array_permissao["itens"])) {
          foreach ($array_permissao["itens"] as $key => $value) {
            if ($value["valor"]) {
              $in_unidade .= ",'".$value["valor"]."'";
            }
          }
        }
        if (!$in_unidade) {
          $in_unidade = ",'SEM ACESSO A CLASSE ".$arr_campo_deonde[1]."'";
        }
        $where_operador_performance = " AND ".$arr_campo_deonde[0]." IN (".substr($in_unidade,1).")";
      } else {
        $where_operador_performance = " AND ".$arr_campo_deonde[0]." = '".addslashes(${$arr_campo_deonde[0]})."'";
      }
    }
  }
}//VINICIUS

// ************* ANTES ******************
//if (substr($_GET["nivel"],0,1) == "N") {
//  $where_operador_performance = " AND login_operador = '".$session["operador"]."'";
//}

// Removido o sistema da porto nesse if, pois estava dando erro no relatório de coluna diário
//(($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data_aux_mensal[0] != "tot_mes")) ||
$usa_calendario_novo =
(
(($arrParamTemp["bd"] == "bd_medial_novo") && ($tipo_data_aux_mensal[0] != "tot_mes"))   ||
((ValorClasse($classe_TLREB,"TIPO_DATA",$repre) == "INTERVALO") && ($tipo_data_aux_mensal[0] != "tot_mes"))    );



if ((((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data_aux_mensal[0] != "tot_mes")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data_aux_mensal[0] != "tot_mes")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data_aux_mensal[0] != "tot_mes")) || (($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data_aux_mensal[0] != "tot_mes")) || (($arrParamTemp["bd"] == "bd_medial_novo") && ($tipo_data_aux_mensal[0] != "tot_mes"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads") && (((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0)) && ((strpos("xx".$tipo_classe_discador, "mailing") <= 0)))) {
  $com_ano_mes = "N";
  //  $com_ano_mes = "S";
} else {
  $com_ano_mes = "S";
}
if (substr($deonde,0,19) == "visao_personalizada") {
  //comentado pelo david sem ter motivo acredito que o gestão não precisa mais disso
  //$com_ano_mes = "N";
}

$item_col     = urldecode(base64_decode($item_col));
$repre_define = retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor);


if (strtoupper($session["operador"]) == "TRACKER0065") {
  $where_gambi_tracker = " AND campo_extra_5 = 'SEG0007'";
}

//SRH
if (($discador_modelo == "MDZ1" || $discador_modelo == "MDSY" || ($discador_modelo == "MDZX" && $repre == "URANET-RH")) && $usa_permissao_srh_hist != "N") {

  $array_permissao_gecfu = getArrayClasse("tb_classe", ConnectDB(), "descricao", "GECFU", $repre, "A", "ZZ");

  if (is_array($array_permissao_gecfu["itens"]) === true) {
    foreach ($array_permissao_gecfu["itens"] as $key => $value) {
      $where_responsavel_SRH .= "'".$value["valor"]."',";
    }
    if (!$where_responsavel_SRH) {
      $where_responsavel_SRH = "'SEM ACESSO A CLASSE GECFU',";
    }
    $where_responsavel_SRH = " AND responsavel IN (".substr($where_responsavel_SRH,0,-1).")";
  } else {
    print "<center><font class=\"txtvermelho\"><strong>Não há permissão para esta consulta.</strong></font></center>";
    if ($session["representante"] == "URANET") {
      print "<center><font class=\"txtvermelho\">Falta permissão para o usuário ".NomeResumido($session["operador"])."(".$session["operador"].") na classe GECFU</font></center>";
    }
    $where_responsavel_SRH = " AND responsavel = 'N_PERMITE'";
  }

  require_once("funcoes/PermissoesDoUsuario.php");

  $tp_user_permissao = $session["tp_user"];
  $entrou_rotina_epuser_esp = "N";

  if ($discador_modelo == "MDZ1") {
    require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/SRHFuncoes.php");
    $tp_user_permissao = tpuserAutorizadoSRH();
    $entrou_rotina_epuser_esp = "S";
  }

  if (!$permissao_usuario = PermissoesDoUsuario($tp_user_permissao, $session["representante"])) {
    $permissao_usuario = PermissoesDoUsuario($tp_user_permissao, "URANET");
  }

  if ($permissao_usuario === false) {
    print "<font class='txtvermelho3'><strong>Permissão do usuário não cadastrada na classe TUSE1 para o tipo de usuário ".$tp_user_permissao.".<br>Rotina espelho TUSE2 [".ValorClasse("ADSON", $entrou_rotina_epuser_esp, "URANET")."]</strong></font>";
  }

  $where_tp_user_SRH = " AND ".$permissao_usuario;

  if ($discador_modelo == "MDZX" && $repre == "URANET-RH") {
    $where_responsavel_SRH = str_replace("responsavel", "func_responsavel", $where_responsavel_SRH);
    $where_tp_user_SRH     = str_replace("tp_user", "func_tp_user", $where_tp_user_SRH);
  }

}

if($discador_modelo == "MDSY" && $deonde == "email_batch") {
  $where_tp_user_SRH .= " AND responsavel NOT IN ('GOP4', 'GOP6','todos','', 'GOP9') ";
}

if ($filtro_adicional) {
  $array_filtros     = explode("¢A¢",$filtro_adicional);
  $where_filtro_add  = " ";
  $string_passa_get .= "&filtro_adicional=".$filtro_adicional;

  foreach($array_filtros as $chave => $valor) {
    if ($valor) {

      $consulta_parametros = explode("§",$valor);

      //$consulta_parametros[0] = campo banco de dados
      //$consulta_parametros[1] = tipo de campo text,combo(classe)
      //$consulta_parametros[2] = tipo de comparação like, igual
      //$consulta_parametros[3] = tipo de dado email, cpfcnpj,munero,etc
      //$consulta_parametros[4] = consistir sempre, sopreenchido
      //$consulta_parametros[5] = status para monta combo A = ativo S = Todos
      //$consulta_parametros[6] = where adicional " AND campo = (A)XXX(A) ";

      $ajax_parametros_aux_cp = explode(",",$consulta_parametros[0]);
      $consulta_parametros[0]     = $ajax_parametros_aux_cp[0];
      $ajax_parametros_aux_cp = $ajax_parametros_aux_cp[1];

      $ajax_parametros_aux_tp = explode(",",$consulta_parametros[1]);
      $consulta_parametros[1]     = $ajax_parametros_aux_tp[0];
      $ajax_parametros_aux_tp = $ajax_parametros_aux_tp[1];

      $ajax_parametros_aux_cd = explode(",",$consulta_parametros[2]);
      $consulta_parametros[2]     = $ajax_parametros_aux_cd[0];
      $ajax_parametros_aux_cd = $ajax_parametros_aux_cd[1];

      $ajax_parametros_aux_td = explode(",",$consulta_parametros[3]);
      $consulta_parametros[3]     = $ajax_parametros_aux_td[0];
      $ajax_parametros_aux_td = $ajax_parametros_aux_td[1];

      $ajax_parametros_aux_cs = explode(",",$consulta_parametros[4]);
      $consulta_parametros[4]     = $ajax_parametros_aux_cs[0];
      $ajax_parametros_aux_cs = $ajax_parametros_aux_cs[1];

      $ajax_parametros_aux_st = explode(",",$consulta_parametros[5]);
      $consulta_parametros[5]     = $ajax_parametros_aux_st[0];
      $ajax_parametros_aux_st = $ajax_parametros_aux_st[1];

      $ajax_parametros_aux_wh = explode(",",$consulta_parametros[6]);
      $consulta_parametros[6]     = $ajax_parametros_aux_wh[0];
      $ajax_parametros_aux_wh = $ajax_parametros_aux_wh[1];


      if ($consulta_parametros[6]) {
        $consulta_parametros[6] = str_replace("(A)","'",$consulta_parametros[6]);
      }

      if (is_array(${$consulta_parametros[0]."_filtro"})) {
        $in_multiplos = "";
        foreach(${$consulta_parametros[0]."_filtro"} as $chave_fil => $valor_fil) {
          $string_passa_get .= "&".$consulta_parametros[0]."_filtro[".$chave_fil."]=".$valor_fil;
          if ($valor_fil) {
            $in_multiplos .= "'".$valor_fil."',";
          }
        }
        $in_multiplos = substr($in_multiplos,0,-1);
        if ($in_multiplos) {
          $where_filtro_add .= " AND ".$consulta_parametros[0]." IN (".$in_multiplos.") ".$consulta_parametros[6];
        }
      } else {
        $string_passa_get .= "&".$consulta_parametros[0]."_filtro=".${$consulta_parametros[0]."_filtro"};
        if (strtoupper($consulta_parametros[2]) == "IGUAL") {
          if (strpos("a".${$consulta_parametros[0]."_filtro"},"³£³") > 0) {
            $in_multiplos = "";
            $array_filtro_todos = explode("³£³",${$consulta_parametros[0]."_filtro"});
            foreach($array_filtro_todos as $chave_fil => $valor_fil) {
              if ($valor_fil) {
                $in_multiplos .= "'".$valor_fil."',";
              }
            }

            $in_multiplos = substr($in_multiplos,0,-1);
            if ($in_multiplos) {
              $where_filtro_add .= " AND ".$consulta_parametros[0]." IN (".$in_multiplos.") ".$consulta_parametros[6];
            }
          } else {
            $where_filtro_add .= " AND ".$consulta_parametros[0]." = '".${$consulta_parametros[0]."_filtro"}."' ".$consulta_parametros[6];
          }
        }elseif (strtoupper($consulta_parametros[2]) == "NOT LIKE") {
          $where_filtro_add .= " AND ".$consulta_parametros[0]." NOT LIKE '%".${$consulta_parametros[0]."_filtro"}."%' ".$consulta_parametros[6];
        }elseif (strtoupper($consulta_parametros[2]) != "LIKE") {
          switch ($consulta_parametros[2]) {
            case "MAIOR":
              $campo_compara = ">";
              break;
            case "MENOR":
              $campo_compara = "<";
              break;
          }
          $where_filtro_add .= " AND ".$consulta_parametros[0]." ".$campo_compara." '".${$consulta_parametros[0]."_filtro"}."' ".$consulta_parametros[6];
        } else {
          $where_filtro_add .= " AND ".$consulta_parametros[0]." LIKE '%".${$consulta_parametros[0]."_filtro"}."%' ".$consulta_parametros[6];
        }
      }

      if ($ajax_parametros_aux_cp) {
        if ($ajax_parametros_aux_wh) {
          $ajax_parametros_aux_wh = str_replace("(A)","'",$ajax_parametros_aux_wh);
        }

        if (is_array(${$ajax_parametros_aux_cp."_filtro"})) {
          $in_multiplos = "";
          foreach(${$ajax_parametros_aux_cp."_filtro"} as $chave_fil => $valor_fil) {
            $string_passa_get .= "&".$ajax_parametros_aux_cp."_filtro[".$chave_fil."]=".$valor_fil;
            if ($valor_fil) {
              $in_multiplos .= "'".$valor_fil."',";
            }
          }
          $in_multiplos = substr($in_multiplos,0,-1);
          if ($in_multiplos) {
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." IN (".$in_multiplos.") ".$ajax_parametros_aux_wh;
          }
        } else {
          $string_passa_get .= "&".$ajax_parametros_aux_cp."_filtro=".${$ajax_parametros_aux_cp."_filtro"};
          if (strtoupper($ajax_parametros_aux_cd) == "IGUAL") {
            if (strpos("a".${$ajax_parametros_aux_cp."_filtro"},"³£³") > 0) {
              $in_multiplos = "";
              $array_filtro_todos = explode("³£³",${$ajax_parametros_aux_cp."_filtro"});
              foreach($array_filtro_todos as $chave_fil => $valor_fil) {
                if ($valor_fil) {
                  $in_multiplos .= "'".$valor_fil."',";
                }
              }

              $in_multiplos = substr($in_multiplos,0,-1);
              if ($in_multiplos) {
                $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." IN (".$in_multiplos.") ".$ajax_parametros_aux_wh;
              }
            } else {
              $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." = '".${$ajax_parametros_aux_cp."_filtro"}."' ".$ajax_parametros_aux_wh;
            }
          }elseif (strtoupper($ajax_parametros_aux_cd) == "NOT LIKE") {
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." NOT LIKE '%".${$ajax_parametros_aux_cp."_filtro"}."%' ".$ajax_parametros_aux_wh;
          }elseif (strtoupper($ajax_parametros_aux_cd) != "LIKE") {
            switch ($consulta_parametros[2]) {
              case "MAIOR":
                $campo_compara = ">";
                break;
              case "MENOR":
                $campo_compara = "<";
                break;
            }
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." ".$campo_compara." '".${$ajax_parametros_aux_cp."_filtro"}."' ".$ajax_parametros_aux_wh;
          } else {
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." LIKE '%".${$ajax_parametros_aux_cp."_filtro"}."%' ".$ajax_parametros_aux_wh;
          }
        }
      }
    }
  }
}


function MontaDescTitulo($classe,$repre) {
  $connectCallCenter = new ConexaoCallCenter();
  $connectCallCenter->query("SELECT desc_classe FROM tb_classe WHERE cod_classe = '".addslashes($classe)."'  AND representante = '".addslashes($repre)."' AND tipo_reg = 'T' and idioma = '1'");
  if($connectCallCenter->count < 1) {
    $connectCallCenter->query("SELECT desc_classe FROM tb_classe WHERE cod_classe = '".addslashes($classe)."'  AND representante = 'URANET' AND tipo_reg = 'T' and idioma = '1'");
  }
  return $connectCallCenter->result["desc_classe"];
}
/**
 * Retorna 1 ou 2 Query's e HTML da Função do Paginador
 *
 * @param string $select_1
 * @param string $select_qtd_1
 * @param string $select_2
 * @param string $select_qtd_2
 * @return array
 * @author Adriano Terruel
 * @version 25/08/2008 Eduardo Pereira
 */


function paginadorDuplo($select_1, $select_qtd_1, $select_2, $select_qtd_2) {
  global $repre;
  global $repre_define;
  global $session;

  global $discador_modelo;
  global $tipo_classe_discador;

  if($discador_modelo == 'DKK0' && $tipo_classe_discador == 'mailing' && $repre == 'BMG-LOJA'){
    $select_2     = str_replace("tb_ativo_bmg_ljemp", "tb_ativo_bmg_ljemp_hist", $select_1);
    $select_qtd_2 = str_replace("tb_ativo_bmg_ljemp", "tb_ativo_bmg_ljemp_hist", $select_qtd_1);
  }

  if(strtoupper($session["operador"]) == "RE000064" || strtoupper($session["operador"]) == "ADM"){
    //print  "<br><br>tipo_classe_discador:".$tipo_classe_discador."<br><br>";
  }

  if($discador_modelo == 'DKK0' && $tipo_classe_discador == 'dx1¢DKK0§GV' && $repre == 'BMG-LOJA'){
    $select_2     = str_replace("tb_historico_bmg", "tb_historico_bmg_".date("Y"), $select_1);
    $select_qtd_2 = str_replace("tb_historico_bmg", "tb_historico_bmg_".date("Y"), $select_qtd_1);
    $select_3     = str_replace("tb_historico_bmg", "tb_historico_bmg_".(date("Y")-1), $select_1);
    $select_qtd_3 = str_replace("tb_historico_bmg", "tb_historico_bmg_".(date("Y")-1), $select_qtd_1);
  if(strtoupper($session["operador"]) == "RE000064" || strtoupper($session["operador"]) == "ADM"){
    //print  "<br><br>AQUI 111111111111111111111<br><br>";
  }
  }

  //PARA PEGAR LIMITE
  global $classe_TLRE7;
  global $connectTel;

  //CAPTURANDO LIMITE DA CLASSE ____7
  $qtd_lim = ValorClasse($classe_TLRE7, "QTD_POR_PAGINA", $repre_define, false);


  if ($qtd_lim == " -- ") {
    //CASO NAO PARAMETRIZE NA CLASSE ____7, SETA PARA 40 O LIMITE
    $qtd_lim = 40;
  }
  $qtd_lim = intval($qtd_lim);

  //CONSTRUINDO FORM INTELIGENTE
  $forminteligente = new FormInteligente('frmPagina', $_SERVER['PHP_SELF']);
  $forminteligente->montaFormGETPOST();
  $forminteligente->setmethod('GET');

  //GERANDO HIDDEN DA PAGINA, PARA PODER DAR SUBMIT E TROCAR DE PAGINA
  if (!$_GET["pag"]) {
    $forminteligente->carregaVariavel("pag","1");
  }

  //QUANTIDADE DE REGISTROS NA PROPOSTA
  //SUM ADICIONADO POIS AO APRESENTAR UMA TABELA SEM REGISTROS, ERA CONSIDERADO O REGISTRO ZERADO - JASON - 19/07/17
  if(strpos($select_qtd_1,"UNION") > 0) {
    $select_qtd_1 = "SELECT SUM(qtd) qtd FROM ({$select_qtd_1})alias";
  }


  $connectTel->query($select_qtd_1);

  if($connectTel->count > 0) {
    $rec = $connectTel->result;
    $qtd_total_prop = intval($rec["qtd"]);
  } else {
    $qtd_total_prop = 0;
  }

  //QUANTIDADE DE REGISTROS NA HISTÓRICO
  //NO GV QUANDO TB_HIST = TB_PROP, ELE SOH VAI EM UMA TABELA, PORTANTO, TABELA HIST VEM VAZIA
  //SUM ADICIONADO POIS AO APRESENTAR UMA TABELA SEM REGISTROS, ERA CONSIDERADO O REGISTRO ZERADO - JASON - 19/07/17
  if(strpos($select_qtd_2,"UNION") > 0) {
    $select_qtd_2 = "SELECT SUM(qtd) qtd FROM ({$select_qtd_2})alias";
  }

  if ($select_qtd_2) {
    $connectTel->query($select_qtd_2);
    if($connectTel->count > 0) {
      $rec = $connectTel->result;
      $qtd_total_hist = intval($rec["qtd"]);
    } else {
      $qtd_total_hist = 0;
    }
  } else {
    $qtd_total_hist = 0;
  }


  //DIVIDE TOTAL DE REGISTROS (PROP+HIST) PELO LIMITE, RETORNANDO QUANTIDADE DE PAGINAS
  $qtd_total   = $qtd_total_prop + $qtd_total_hist;

  $qtd_paginas = $qtd_total / $qtd_lim;

  //SE NÃO VIER PAGINA PELO GET, SE TRATA DA PRIMEIRA PAGINA
  if (empty($_GET["pag"]) === true) {
    $_GET["pag"] = 1;
  }
  if ($qtd_total_prop > 0 || $qtd_total_hist > 0) {
    //CONTROLES DE PAGINAÇÃO
    $retorno =  "<table class='table table-bordered'>";
    $retorno .= "   <tr class=\"txt5\">";
    $retorno .= "       <td><strong>Página: </strong>";


    if (ceil($qtd_paginas) > 1) {
      $resto_hist = $qtd_total_hist;
      $resto_prop = $qtd_total_prop;

      $retorno .= "<select name=\"pag\" onchange=\"javascript:mudaPagina(this.value);\">";
      for ($i = 1, $min = 1, $max = $qtd_lim; $i <= ceil($qtd_paginas); $i++, $min += $qtd_lim, $max += $qtd_lim) {
        if ($max > $qtd_total) {
          $max = $qtd_total;
        }
        $retorno .= "<option value=\"".$i."\"";
        if ($_GET["pag"] == $i) {
          $retorno .= " selected";
        }
        $retorno .= ">de ".$min." à ".$max."</option>";

        //CONTROLES DE PAGINAÇÃO - PROPOSTA
        if ($resto_prop > 0) {
          if ($i == 1) {
            $arr_pag[$i]["prop_ini"] = 0;
          } else {
            $arr_pag[$i]["prop_ini"] = ($qtd_total_prop - $resto_prop);
          }

          if ($qtd_lim < $resto_prop) {
            $arr_pag[$i]["prop_lim"] = $qtd_lim;

            $resto_prop -= $qtd_lim;
          } else {
            $arr_pag[$i]["prop_lim"] = $resto_prop;
            $resto_prop = 0;
          }
        } else {
          $arr_pag[$i]["prop_ini"] = 0;
          $arr_pag[$i]["prop_lim"] = 0;
        }

        //CONTROLES DE PAGINAÇÃO - HISTÓRICO
        if ($resto_prop == 0) {
          if ($arr_pag[$i]["prop_lim"] > 0) {
            $arr_pag[$i]["hist_ini"] = 0;
            $arr_pag[$i]["hist_lim"] = ($qtd_lim - $arr_pag[$i]["prop_lim"]);

            $resto_hist -= $arr_pag[$i]["hist_lim"];
          } else {
            if ($resto_hist > 0) {
              $arr_pag[$i]["hist_ini"] = ($arr_pag[($i - 1)]["hist_ini"] + $arr_pag[($i - 1)]["hist_lim"]);

              if ($qtd_lim < $resto_hist) {
                $arr_pag[$i]["hist_lim"] = $qtd_lim;
              } else {
                $arr_pag[$i]["hist_lim"] = $resto_hist;
                $resto_hist = 0;
              }
            }
          }
        } else {
          $arr_pag[$i]["hist_ini"] = 0;
          $arr_pag[$i]["hist_lim"] = 0;
        }
      }
      $retorno .= "</select>";
    } else {
      $min = 1;
      $max = $qtd_lim;
      if ($max > $qtd_total) {
        $max = $qtd_total;
      }
      $retorno .= "de ".$min." à ".$max;

      if ($qtd_total_prop > 0) {
        $arr_pag[1]["prop_ini"] = 0;
        $arr_pag[1]["prop_lim"] = $qtd_total_prop;

       if($_REQUEST["discador_modelo"] == 'DKK0' && ($_REQUEST["tipo_classe_discador"] == 'mailing' || $_REQUEST["tipo_classe_discador"] == 'dx1¢DKK0§GV') && $_REQUEST["repre"] == 'BMG-LOJA'){
         $arr_pag[1]["prop_lim"] = $qtd_total;
       }
      }

      if ($qtd_total_hist > 0) {
        $arr_pag[1]["hist_ini"] = 0;
        $arr_pag[1]["hist_lim"] = $qtd_total_hist;
      }
    }

    $retorno .= "</td>";
    $retorno .= "<td><strong>Clientes:</strong> ".$qtd_total."</td>";
    $retorno .= "<td width=\"25%\" align=\"center\">";
    if ($_GET["pag"] != 1) {
      $retorno .= "<strong><a href=\"javascript:mudaPaginaAnterior()\"> << Anterior </a></strong>";
    }
    $retorno .= "</td>";
    $retorno .= "<td width=\"25%\" align=\"center\">";
    if ($_GET["pag"] != ceil($qtd_paginas)) {
      $retorno .= "<strong><a href=\"javascript:mudaPaginaProxima()\">Próximo >></a></strong>";
    }
    $retorno .= "</td>";
    $retorno .= "</tr>";
    $retorno .= "</table>";
    $retorno .= "<br>";
  } else {
    $retorno = "<center><font class='txtvermelho'><strong>Nenhum registro encontrado</strong></font></center>";
  }
  $array_retorno["string"] = $retorno;

  //SELECT DA PROPOSTA
  if ($arr_pag[$_GET["pag"]]["prop_lim"] > 0) {
    if($_REQUEST["discador_modelo"] == 'DKK0' && $_REQUEST["tipo_classe_discador"] == 'mailing' && $_REQUEST["repre"] == 'BMG-LOJA'){
      $where_camp_ativo = " AND relatorio = 'S' ";
      $select_1 = $select_1.$where_camp_ativo;
      $select_1 = $select_1." UNION ALL ".$select_2.$where_camp_ativo;
      $select_2 = "";
    }

    if($_REQUEST["discador_modelo"] == 'DKK0' && $_REQUEST["tipo_classe_discador"] == 'dx1¢DKK0§GV' && $_REQUEST["repre"] == 'BMG-LOJA'){
      $select_1 = $select_1." UNION ALL ".$select_2." UNION ALL ".$select_3;
      $select_2 = "";
      $select_3 = "";
    }


    $array_retorno["query1"] = $select_1." LIMIT ".$arr_pag[$_GET["pag"]]["prop_ini"].", ".$arr_pag[$_GET["pag"]]["prop_lim"];
  }


  //SELECT DA HISTÓRICO
  if ($arr_pag[$_GET["pag"]]["hist_lim"] > 0) {
    if ($select_2 != "") {
      $array_retorno["query2"] = $select_2." LIMIT ".$arr_pag[$_GET["pag"]]["hist_ini"].", ".$arr_pag[$_GET["pag"]]["hist_lim"];
    }
  }

  //IMPRIMINDO O FORMULÁRIO CONSTRUÍDO
  print $forminteligente->printForm();

  return $array_retorno;
}

function FormataBina($bina) {
  return Formata::Fone(substr($bina,0,2),substr($bina,2,strlen($bina)));
}

function retornaDescTelefone($valor,$discador_modelo,$repre) {
  global $session, $arrParamTemp;
  $mtr_fones = explode("¢",$arrParamTemp["desc_tel"]);
  if (is_array($mtr_fones)) {
    foreach ($mtr_fones as $key => $value) {
      if ($valor == $key+1) {
        return $value;
      }
    }
  }
}

//DEFINIÇÃO DAS CLASSES DE FILTRO DO RELATORIO


//if (substr($discador_modelo,2,2) == "AG") {
  $cond_classe_TLRE = ValorClasse("TUSE3", $session["tp_user"], $repre);
  if ($repreVlrClasse == $repre) {
    $flag_usa_tuse3 = "S";
    $tp_user_tuse3  = $cond_classe_TLRE;
  }
  if ($flag_usa_tuse3 != "S" && substr($discador_modelo,2,2) == "AG") {
    $flag_usa_tuse3   = "S";
    $cond_classe_TLRE = ValorClasse("TUSE3", $session["tp_user"], "URANET");
  }
  if ($flag_usa_tuse3 == "S") {
    $where_cond_classe = " AND (filtro_classe <= '".addslashes($cond_classe_TLRE)."' OR filtro_classe = 'ZD')";
  }
//}

/*decodificando valores codificados*/
for ($i=0;$i<5;$i++) {

  $aux_nome = "parm_".$i;
  $$aux_nome = urldecode(base64_decode($$aux_nome));

}

if ((strpos("xx".$tipo_classe_discador, "mailing_reativa") > 0)) {
  $classe_pro   = "GDPRO";
  $classe_sigla = "GD";
  $mostra_hist  = "N";
  $seq_tabela   = "seq";
} elseif ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  $classe_pro   = "GCPRO";
  $classe_sigla = "GC";
  $mostra_hist  = "N";
  $seq_tabela   = "seq";
} elseif ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0)) {
  $classe_pro   = "GOPRO";
  $classe_sigla = "GO";
  $mostra_hist  = "N";
  $seq_tabela = "num_prop";
} elseif ((strpos("xx".$tipo_classe_discador, "reg_atd") > 0)) {
  $classe_pro   = "GAPRO";
  $classe_sigla = "GA";
  $mostra_hist  = "N";
  $seq_tabela = "num_atd";
} else {
  if ((strpos("xx".$tipo_classe_discador, "§") > 0)) {
    $arr_sigla = explode("§", $tipo_classe_discador);
    $classe_pro   = $arr_sigla[1]."PRO";
    $classe_sigla = $arr_sigla[1];
  } else {
    $classe_pro   = "GVPRO";
    $classe_sigla = "GV";
  }
  $seq_tabela = "num_prop";
}

$var_aux = ValorClasse($classe_pro, substr($discador_modelo,2,2), $repre);
if($session["print_sql"] != "N") {
  print "<li><li>".$var_aux." <-> ".$classe_sigla." <-> ".$classe_pro." <-> ".substr($discador_modelo,2,2)." <-> ".$repre."<br>";
}
if (trim($var_aux) != "--") {
  $var_aux = explode("§", $var_aux);
  if ($var_aux[1]) {
    $discador_modelo_rel = $var_aux[1];
  } else {
    $discador_modelo_rel = substr($discador_modelo,2,2);
  }

  $classe_TLRE1 = $classe_sigla.$discador_modelo_rel."1";
  $classe_TLRE2 = $classe_sigla.$discador_modelo_rel."2";
  $classe_TLRE3 = $classe_sigla.$discador_modelo_rel."3";
  $classe_TLRE4 = $classe_sigla.$discador_modelo_rel."4";
  $classe_TLRE5 = $classe_sigla.$discador_modelo_rel."5";
  $classe_TLRE6 = $classe_sigla.$discador_modelo_rel."6";
  $classe_TLRE7 = $classe_sigla.$discador_modelo_rel."7";
  $classe_TLREK = $classe_sigla.$discador_modelo_rel."K";
  $classe_TLREB = $classe_sigla.$discador_modelo_rel."B";

  if ($var_aux[2] == "SEMPRE") {
    $var_nao_usar_mat_reg_can_eps = "S";
  }
  //verificar se usar DefineRepre ou não com defult sim como anteriormente.
  if ($var_aux[3] == "N") {
    $var_nao_usar_define_repre = "N";
  } elseif (strlen($var_aux[3]) > 1) {
    $var_nao_usar_define_repre = $var_aux[3];
  } else {
    $var_nao_usar_define_repre = "S";
  }

} else {
  $discador_modelo_rel = substr($discador_modelo,2,2);
  if ($classe_sigla == "GC") {
    $classe_TLRE1 = "GCPR1";
    $classe_TLRE2 = "GCPR2";
    $classe_TLRE3 = "GCPR3";
    $classe_TLRE4 = "GCPR4";
    $classe_TLRE5 = "GCPR5";
    $classe_TLRE6 = "GCPR6";
    $classe_TLRE7 = "GCPR7";
    $classe_TLREK = "GCPRK";
    $classe_TLREB = "GCPRB";
    //$combo_campanha =  MontaCombo($discador_modelo."C", $campanha,$repre,"S");
  } elseif ($classe_sigla == "GD") {
    $classe_TLRE1 = "GDPR1";
    $classe_TLRE2 = "GDPR2";
    $classe_TLRE3 = "GDPR3";
    $classe_TLRE4 = "GDPR4";
    $classe_TLRE5 = "GDPR5";
    $classe_TLRE6 = "GDPR6";
    $classe_TLRE7 = "GDPR7";
    $classe_TLREK = "GDPRK";
    $classe_TLREB = "GDPRB";
  } elseif ($classe_sigla == "GO") {
    $classe_TLRE1 = "GOPR1";
    $classe_TLRE2 = "GOPR2";
    $classe_TLRE3 = "GOPR3";
    $classe_TLRE4 = "GOPR4";
    $classe_TLRE5 = "GOPR5";
    $classe_TLRE6 = "GOPR6";
    $classe_TLRE7 = "GOPR7";
    $classe_TLREK = "GOPRK";
    $classe_TLREB = "GCPRB";
    //$combo_campanha =  MontaCombo($discador_modelo."C", $campanha,$repre,"S");
  }
  //    elseif ($classe_sigla == "GV") {
  //      $classe_TLRE1 = "GVPR1";
  //      $classe_TLRE2 = "GVPR2";
  //      $classe_TLRE3 = "GVPR3";
  //      $classe_TLRE4 = "GVPR4";
  //      $classe_TLRE5 = "GVPR5";
  //      $classe_TLRE6 = "GVPR6";
  //      $classe_TLRE7 = "GVPR7";
  //      $classe_TLRE8 = "GVPR8";
  //      $classe_TLRE9 = "GVPR9";
  //      $classe_TLREA = "GVPRA";
  ////      $tit_combo_campanha = "Grupo";
  ////      $combo_campanha =  MontaCombo("GRATE", $campanha,$repre,"S","ZZ","valor-descricao");
  //    }
  elseif ($classe_sigla == "GA") {
    $classe_TLRE1 = "GAPR1";
    $classe_TLRE2 = "GAPR2";
    $classe_TLRE3 = "GAPR3";
    $classe_TLRE4 = "GAPR4";
    $classe_TLRE5 = "GAPR5";
    $classe_TLRE6 = "GAPR6";
    $classe_TLRE7 = "GAPR7";
    $classe_TLREK = "GAPRK";
    $classe_TLREB = "GCPRB";
    //$combo_campanha =  MontaCombo($discador_modelo."C", $campanha,$repre,"S");
  } elseif (($session["tp_user"] == "MAT") || ($session["tp_user"] == "REG") || ($session["tp_user"] == "EPS") || ($session["tp_user"] == "CAN") || ($session["tp_user"] == "VDA")) {
    //USUÁRIOS DO SISTEMA NOVOS CANAIS (NC)
    if ($var_nao_usar_mat_reg_can_eps != "S") {

      $classe_TLRE1 = $session["tp_user"]."01";
      $classe_TLRE2 = $session["tp_user"]."02";
      $classe_TLRE3 = $session["tp_user"]."03";
      $classe_TLRE4 = $session["tp_user"]."04";
      $classe_TLRE5 = $session["tp_user"]."05";
      $classe_TLRE6 = $session["tp_user"]."06";
      $classe_TLRE7 = $session["tp_user"]."07";
      $classe_TLREK = $session["tp_user"]."0K";
      $classe_TLREB = $session["tp_user"]."0B";
    }
  } else {
    //DEMAIS USUÁRIOS DO INTERGRALL
    $classe_TLRE1 = "TLRE1";
    $classe_TLRE2 = "TLRE2";
    $classe_TLRE3 = "TLRE3";
    $classe_TLRE4 = "TLRE4";
    $classe_TLRE5 = "TLRE5";
    $classe_TLRE6 = "TLRE6";
    $classe_TLRE7 = "TLRE7";
    $classe_TLREK = "TLREK";
    $classe_TLREB = "TLREB";
  }
}
if($session["print_sql"] != "N") {
  var_dump($classe_TLRE7);
}
if ($discador_modelo_rel == "H6" || $discador_modelo_rel == "FE" || $discador_modelo_rel == "4E" || $discador_modelo_rel == "4F") {
  $com_ano_mes = "N";
  $usa_calendario_novo = "S";
}
//$arr_usa_nc = carregaArrParam($discador_modelo."B",$repre_backup_mk,array("USA_NC","DISK_POWER_FICHA","DISK_POWER_LISTA"));
$param_disk_power_ficha = $arrParamTemp["disk_power_ficha"];
$param_disk_power_lista = $arrParamTemp["disk_power_lista"];

if (((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0)) && ((strpos("xx".$tipo_classe_discador, "mailing") <= 0))) {
  if ($discador_modelo) {
    if (!(strpos("...DKZ5,DKZ9,MDZ6,DKIK,DKIL,DKIS,DKIX,DKIZ,MDI7,MDIK,MDIR,MDIX,MDIZ,MDSR,MD6J,", $discador_modelo) > 1)) {
      if ($arrParamTemp["usa_nc"] == "S" && ($session["tp_user"] == "MAT" || $session["tp_user"] == "REG" || $session["tp_user"] == "EPS" || $session["tp_user"] == "VDA" || $session["tp_user"] == "CAN")) {
        if ($var_nao_usar_mat_reg_can_eps != "S") {

          $classe_TLRE1 = $session["tp_user"]."01";
          $classe_TLRE2 = $session["tp_user"]."02";
          $classe_TLRE3 = $session["tp_user"]."03";
          $classe_TLRE4 = $session["tp_user"]."04";
          $classe_TLRE5 = $session["tp_user"]."05";
          $classe_TLRE6 = $session["tp_user"]."06";
          $classe_TLRE7 = $session["tp_user"]."07";
          $classe_TLRE8 = $session["tp_user"]."08";
          $classe_TLRE9 = $session["tp_user"]."09";
          $classe_TLREA = $session["tp_user"]."0A";
          $classe_TLREK = $session["tp_user"]."0K";
          $classe_TLREB = $session["tp_user"]."0B";
        }
      }
    }
  }
}

if ($session["representante"] == "TELEFVDA-MO" || $session["representante"] == "TELEFVDA-MOP") {
  if ($discador_modelo) {
    $include_dados = $arrParamTemp["include_dados"];
    if($include_dados == "vpg_emu_a20" || $include_dados == "vpg_a20" || $include_dados == "nc_vpg_emu_v2" || $include_dados == "inb_vpg_emu_v2" || $include_dados == "inbound_emu"){
      if ($session["tp_user"] == "SUP" || $session["tp_user"] == "ANA" || $session["tp_user"] == "BKO") {
        $perfil_telefonica_movel = "S";
        $classe_TLRE1 = "SUP01";
        $classe_TLRE2 = "SUP02";
        $classe_TLRE3 = "SUP03";
        $classe_TLRE4 = "SUP04";
        $classe_TLRE5 = "SUP05";
        $classe_TLRE6 = "SUP06";
        $classe_TLRE7 = "SUP07";
        $classe_TLRE8 = "SUP08";
        $classe_TLRE9 = "SUP09";
        $classe_TLREA = "SUP0A";
        $classe_TLREK = "SUP0K";
        $classe_TLREP = "SUP0P";
        $classe_TLREI = "SUP0I";
        $classe_TLREB = "SUP0B";
      }
    }
  }
}

$str_passa_filtro_fixo = "";
for($x = 1;$x<=30;$x++){
  if(${"filtro_fixo_".$x}){

    $connectCallCenter->query("SELECT vlr_classe FROM tb_classe WHERE cod_classe LIKE '".substr($classe_TLRE7,0,4)."9' AND representante = '".addslashes($repre)."' and vlr_classe like 'FIXO_WHERE|".${"filtro_fixo_".$x}."|%' ".$where_cond_classe);
    if($connectCallCenter->count > 0) {
      do{
        if(substr($connectCallCenter->result["vlr_classe"],0,10) == "FIXO_WHERE"){
          $vetor_ffv = explode("|", $connectCallCenter->result["vlr_classe"]);
          $where_filtro_add.= str_replace("(A)", "'", $vetor_ffv["2"]);
          $str_passa_filtro_fixo.="&filtro_fixo_".$x."=".$vetor_ffv[1];
        }
      } while($connectCallCenter->getFetchAssoc());
    }
  }
}
//print "*****".$filtro_fixo_1."*****".$where_filtro_add;

$arrFiltroAdicionalTLREB = getArrayClasse("tb_classe", ConnectDB(), "descricao", $classe_TLREB, $repre, "A", " AND vlr_classe LIKE 'FILTRO_ADICIONAL_%' ");
if (is_array($arrFiltroAdicionalTLREB["itens"]) === true) {
  foreach ($arrFiltroAdicionalTLREB["itens"] as $chaveIndice => $arrValores) {
    switch ($arrValores["descricao"]) {
      case "ROTINA_AUX_STATUS":
        $string_passa_get .= " &cmbRotinaAuxStatus=".$cmbRotinaAuxStatus."&";
        if($cmbRotinaAuxStatus == "TODOS") {
          $arrRotinaAuxStatus = getArrayClasse("tb_classe", ConnectDB(), "descricao", "SA".substr($discador_modelo,2,2)."T", $repre, "A", "ZZ");
          if (is_array($arrRotinaAuxStatus["itens"]) === true) {
            $where_operador_performance .= " AND (";
            foreach ($arrRotinaAuxStatus["itens"] as $chaveRotinaAuxStatus => $arrValoresRotinaAuxStatus) {
              $where_operador_performance_loop .= " (sistema_aux_status = '".$arrValoresRotinaAuxStatus["valor"]."' OR ".strtolower($arrValoresRotinaAuxStatus["valor"])."_data <> '1111-11-11') OR";
            }
            $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
          }
        } else {
          $where_operador_performance .= " AND (sistema_aux_status = '".addslashes($cmbRotinaAuxStatus)."' OR ".strtolower($cmbRotinaAuxStatus)."_data <> '1111-11-11') ";
        }

        break;

      case "AGRUPAMENTO_GRUPOS":

        $string_passa_get .= " &cmbAgrupamentoGrupos=".$cmbAgrupamentoGrupos."&";

        if ($cmbAgrupamentoGrupos != "") {

          if ($cmbAgrupamentoGrupos == "TODOS") {
            $agrupamentos = getArrayClasse("tb_classe", ConnectDB(), "descricao", "GRAPE", $repre, "A", "ZZ");
            if (is_array($agrupamentos['itens'])) {
              foreach ($agrupamentos["itens"] as $agrup) {
                $arr_grupo = explode('¢', $agrup["descricao"]);
                $grupos = $arr_grupo[1];

                $arr_grupo = explode(',', $grupos);
                if (is_array($arr_grupo)) {
                  foreach ($arr_grupo as $chave => $valor) {
                    $str_grupos .= "'".$valor."',";
                  }
                }
              }
              $str_grupos = substr($str_grupos, 0, -1);
              $where_operador_performance .= " AND left(servico_dac,4) IN('',".$str_grupos.") ";
            }
          } else if ($cmbAgrupamentoGrupos == "VAZIO") {

            $where_operador_performance .= " AND left(servico_dac,4) IN('') ";

          } else {

            $connectCallCenter->query("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = 'GRAPE' AND representante = '".addslashes($repre)."' AND vlr_classe = '".addslashes($cmbAgrupamentoGrupos)."' AND idioma = '1' AND tipo_reg = 'I'");
            if($connectCallCenter->count > 0) {
              $ret = $connectCallCenter->result;
              $arr_grupo = explode('¢', $ret["desc_classe"]);
              $grupos = $arr_grupo[1];

              $arr_grupo = explode(',', $grupos);
              if (is_array($arr_grupo)) {
                foreach ($arr_grupo as $chave => $valor) {
                  $str_grupos .= "'".$valor."',";
                }
                $str_grupos = substr($str_grupos, 0, -1);
                $where_operador_performance .= " AND left(servico_dac,4) IN(".$str_grupos.") ";
              }
            } else {
              print "Grupo não localizado! Classe GRAPE";
            }

          }

        }

        break;

      default:
        list($filtroAdicionalDesc,$filtroAdicionalCpo,$filtroAdicionalClasse,$filtroAdicionalLike,$filtroAdicionalConsistencia,$filtroAdicionalTipoDado) = explode("§", $arrValores["descricao"]);

        $string_passa_get .= " &filtroAdicionalTLREB".$filtroAdicionalCpo."=".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."&";

        if(empty(${"filtroAdicionalTLREB".$filtroAdicionalCpo}) === false) {
          switch ($filtroAdicionalLike) {
            case "LIKE":

              if(empty($filtroAdicionalClasse) === false && ${"filtroAdicionalTLREB".$filtroAdicionalCpo} == "TODOS") {
                $arrRotinaFiltroAdc = getArrayClasse("tb_classe", ConnectDB(), "descricao", $filtroAdicionalClasse, $repre, "A", "ZZ");
                if (is_array($arrRotinaFiltroAdc["itens"]) === true) {
                  $where_operador_performance .= " AND (";
                  foreach ($arrRotinaFiltroAdc["itens"] as $chaveRotinaFiltroAdc => $arrValoresRotinaFiltroAdc) {
                    $where_operador_performance_loop .= " (".$filtroAdicionalCpo." LIKE '%".$arrValoresRotinaFiltroAdc["valor"]."%') OR";
                  }
                  $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
                }
              } else {
                $where_operador_performance .= " AND ".$filtroAdicionalCpo." LIKE '%".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."%'";
              }

              break;

            default:

              if(empty($filtroAdicionalClasse) === false && ${"filtroAdicionalTLREB".$filtroAdicionalCpo} == "TODOS") {
                $arrRotinaFiltroAdc = getArrayClasse("tb_classe", ConnectDB(), "descricao", $filtroAdicionalClasse, $repre, "A", "ZZ");
                if (is_array($arrRotinaFiltroAdc["itens"]) === true) {
                  $where_operador_performance .= " AND (";
                  foreach ($arrRotinaFiltroAdc["itens"] as $chaveRotinaFiltroAdc => $arrValoresRotinaFiltroAdc) {
                    $where_operador_performance_loop .= " (".$filtroAdicionalCpo." = '".$arrValoresRotinaFiltroAdc["valor"]."') OR";
                  }
                  $where_operador_performance .= substr($where_operador_performance_loop,0,-2)." )";
                }
              } else {
                $where_operador_performance .= " AND ".$filtroAdicionalCpo." = '".${"filtroAdicionalTLREB".$filtroAdicionalCpo}."'";
              }

              break;
          }
        }

        break;
    }
  }
}



//
if ($tipo_visao_combo) {
  $classe_TLRE7 = str_replace("__",$discador_modelo_rel,$tipo_visao_combo);
}

if($session["print_sql"] != "N") {
  var_dump($tipo_visao_combo);
}

$arrTipoClaseDiscador = explode("¢", $tipo_classe_discador);
$flag_dx = strtoupper($arrTipoClaseDiscador[0]);

//*************TRATAMENTO DA CLASSE TLREB*********************************************
//*************************************************************************************
$where_adicional_TLREB = ValorClasse($classe_TLREB,"WHERE_ADICIONAL",$repre);
$where_adicional_TLREB = ValorClasse($classe_TLREB,"WHERE_ADICIONAL",$repre);
//$dx_bdado_TLREB        = trim(ValorClasse($classe_TLREB,$flag_dx."_BDADO",$repre));
if(trim(ValorClasse($classe_TLREB,$flag_dx."_BDADO",$repre)) != "--") {
  $dx_bdado_TLREB        = trim(ValorClasse($classe_TLREB,$flag_dx."_BDADO",$repre));
}
$dx_chave_TLREB        = ValorClasse($classe_TLREB,$flag_dx."_CHAVE",$repre);
$dx_ficha_TLREB        = ValorClasse($classe_TLREB,$flag_dx."_FICHA",$repre);
//$dx_tabela_TLREB       = ValorClasse($classe_TLREB,$flag_dx."_TABELA",$repre);
if(trim(ValorClasse($classe_TLREB,$flag_dx."_TABELA",$repre)) != "--") {
  $dx_tabela_TLREB       = ValorClasse($classe_TLREB,$flag_dx."_TABELA",$repre);
}
$dx_ficha_gvfor_TLREB  = ValorClasse($classe_TLREB,$flag_dx."_USA_FICHA_GVFOR",$repre);
$dx_campo_equip_TLREB  = ValorClasse($classe_TLREB,$flag_dx."_CAMPO_EQUIP",$repre);
list($dx_campo_equip_campo_TLREB,$dx_campo_equip_classe_TLREB) = explode("-", $dx_campo_equip_TLREB);
$dx_campo_status_TLREB = ValorClasse($classe_TLREB,$flag_dx."_CAMPO_STATUS",$repre);
if(trim($dx_campo_status_TLREB) != "--" && trim($dx_campo_status_TLREB) != "") {
  $campo_status_bd = $dx_campo_status_TLREB;
} else {
  $campo_status_bd = "status";
}
if ($where_adicional_TLREB != " -- " && $where_adicional_TLREB != "N") {
  $where_adicional_TLREB = str_replace("(A)","'",$where_adicional_TLREB);
} else {
  $where_adicional_TLREB = "";
}


//Where específico para Porto Seguro PMO
if($repre == 'PORTOSEGURO-P') {
  // $where_adicional_TLREB = str_replace(" AND st_venda_cartao = '1'", "", $where_adicional_TLREB);
}
//*************************************************************************************
//*************************************************************************************

if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  $param_bd            = "";
} else {
  $param_bd = "_proposta";
}

$host    = $arrParamTemp["host".  $param_bd];
$user    = $arrParamTemp["user".  $param_bd];
$senha   = $arrParamTemp["senha". $param_bd];
$bd      = $arrParamTemp["bd".    $param_bd];
$host = IPMaqRelatorio($host, $bd);
$include_dados = $arrParamTemp["include_dados"];

$bd_hist  = $arrParamTemp["bd_historico"];

if ($bd_hist != $bd && strtoupper(substr($tipo_classe_discador,0,2)) != "DX") {
  $host_hist      = $arrParamTemp["host_historico"];
  $host_hist = IPMaqRelatorio($host_hist, $bd_hist);

  $user_hist      = $arrParamTemp["user_historico"];
  $senha_hist     = $arrParamTemp["senha_historico"];
  $connect_hist   = Conecta($host_hist, $user_hist, $senha_hist, $bd_hist);
  $connectHist    = new ConexaoBDADO($bd_hist, $host_hist);
}

$bd_atv = $arrParamTemp["bd"];

if ($bd_atv != $bd && strtoupper(substr($tipo_classe_discador,0,2)) != "DX" && strtoupper(substr($discador_modelo,0,2)) != "CG") {
  $host_atv      = $arrParamTemp["host"];
  $host_atv = IPMaqRelatorio($host_atv, $bd_atv);
  $user_atv      = $arrParamTemp["user"];
  $senha_atv     = $arrParamTemp["senha"];
  $connect_atv   = Conecta($host_atv, $user_atv, $senha_atv, $bd_atv);
  $connectAtv    = new ConexaoBDADO($bd_atv, $host_atv);
}
//parametro para pegar se usa nc de outro discador
$nro_nc_param = $arrParamTemp["nro_nc"];

if ($session["print_sql"] != "N") {
  print "<center>NRO. NC = ".$nro_nc_param."</center>\n";
  print "<center>DISCADOR_MODELO = ".$discador_modelo."</center>\n";

}

if(strtoupper(substr($tipo_classe_discador,0,2)) == "DX" && trim(ValorClasse($classe_TLREB,$flag_dx."_BDADO",$repre)) != "--") {
  // VAI BUSCAR NA CLASSE BDADO A CONEXÃO PARA O BANCO DE DADOS //
  $arrBaddo = getArrayClasse("tb_classe",$connectCallCenter,"valor-exibir_descricao","BDADO","URANET","A"," AND vlr_classe like '".$dx_bdado_TLREB."%' AND desc_classe = '".$dx_bdado_TLREB."'");
  $arrBaddo = $arrBaddo["itens"];
  if(is_array($arrBaddo)) {
    foreach ($arrBaddo as $connectBdado => $descBdado) {
      if($descBdado["descricao"] == $dx_bdado_TLREB) {
        $arrConnect  = explode("¢", $descBdado["valor"]);
        $connectTel  = new ConexaoBDADO($arrConnect[0], $arrConnect[1]);
      }
    }
  }
} else {
  $connectTel  = new ConexaoBDADO($bd, $host);
}


$rel_where = str_replace("§","-",str_replace("\\\\\'", "'", $rel_where));



if(strtoupper($session["login"]) == "RE000064"){
  print "<br>antes: ".$rel_where."<br>";
}
$rel_where = str_replace("\'", "'", $rel_where);
if(strtoupper($session["login"]) == "RE000064"){
  print "<br>depois: ".$rel_where."<br>";
}


if($discador_modelo){
  $rel_where_aux = relWhereDecode($rel_where,$discador_modelo);
}else{
  $rel_where_aux = $rel_where;
}


$tipo_data_spl        = explode("§", $tipo_data);

if ($tipo_data_spl[0] == "tot_anual") {
  $tipo_data_param  = $tipo_data_spl[1];
  $tipo_data_desc   = $tipo_data_spl[2];
} else {
  if (!$tipo_data_desc) {
    $tipo_data_desc   = $tipo_data_spl[1];
  }
}
$tipo_data_classe_array = explode("-",$tipo_data_spl[0]);
$tipo_data_campo  = $tipo_data_classe_array[0];
$tipo_data_classe = $tipo_data_classe_array[1];



switch ($tipo_data_campo) {
  case "ranking":
    if (empty($cmprank) === false) {
      $where_var_sum_count = " AND ".$cmprank." > 0 ";
    }
    break;
  case "coluna_fixa":
    $col_fixa_col = ValorClasse(str_replace("__",$discador_modelo_rel,$tipo_data_classe),substr($item_col,9),$repre);
    $arr_col_fixa_col = explode("§",$col_fixa_col);

    switch ($arr_col_fixa_col[1]) {
      case "REGRA":
        $where_col_fixa_aux = $arr_col_fixa_col[2];
        $where_col_fixa_aux = str_replace("(A)","'",$where_col_fixa_aux);
        $where_col_fixa_aux = str_replace("rec[","",$where_col_fixa_aux);
        $where_col_fixa_aux = str_replace("]","",$where_col_fixa_aux);
        $where_col_fixa_aux = str_replace("==","=",$where_col_fixa_aux);

        $where_var_sum_count = " AND ".$where_col_fixa_aux." ";
        break;
      case "CAMPO":
        $where_col_fixa_aux = $arr_col_fixa_col[2];

        $where_col_fixa_aux = str_replace(")","",$where_col_fixa_aux);
        $where_col_fixa_aux = str_replace("sum(","",$where_col_fixa_aux);
        $where_col_fixa_aux = str_replace("count(*","",$where_col_fixa_aux);//faz pq no replace de cima retira o parenteses
        $where_col_fixa_aux = str_replace("count(distinct","",$where_col_fixa_aux);//faz pq no replace de cima retira o parenteses

        $where_var_sum_count = " AND ".$where_col_fixa_aux . " > 0 ";
        break;
    }

    break;

  default:
    if ($tipo_campo_sum) {
      if (strpos(" ".$tipo_campo_sum,"sum") > 0) {
        $var_sum_count = str_replace(")","",str_replace("count(","",str_replace("sum(","",$tipo_campo_sum)));
        $where_var_sum_count = " AND ".$var_sum_count." > 0 ";
      }
    }
    break;
}



// ------------------------------------------------------------ //
// -------------- IF FIXO DA MULTIBENEFÍCIO ------------------- //
// ------------------------------------------------------------ //

// IF CRIADO PARA O SISTEMA DA MULTIBENEFÍCIO NÃO LER A HISTÓRICO

if ($repre == "MULTIBENEF") {
  $mostra_hist = "N";
}

if ($data_fim == date("Y-m-d")) {
  $banco = "P";
} else {
  $banco = "H";
}
if ($StrHoraInicio != "") {
  $hora_ini = Substr($StrHoraInicio,"0","2");
  $min_ini  = Substr($StrHoraInicio,"3","5");

  $hora_fim = Substr($StrHoraFim,"0","2");
  $min_fim  = Substr($StrHoraFim,"3","5");
}

if ($StrHoraInicio != "00:00" || $StrHoraFim != "24:00") {
  $where_hora = " and ".$busca_hora." between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
}

$nro_dk_md = substr($discador_modelo_rel,2,2);

$tb_hist = $arrParamTemp["tabela_historico"];


if ((strpos("xx".$tipo_classe_discador, "reg_atd") > 0)) {
  $tb_prop = $arrParamTemp["tabela_reg_atd"];
} else {
  $tb_prop = $arrParamTemp["tabela_proposta"];
}

if (strtoupper(substr($tipo_classe_discador,0,2)) == "DX") {
  $tb_hist = $tb_prop;
}

if($repre == "ODONTOSAFE" && substr($data_fim,0,4) < "2021" && substr($data_fim,0,4) > "2010") {
  $tb_prop = $tb_prop."_".substr($data_fim,0,4);
  $tb_hist = $tb_prop;
}

if (substr($discador_modelo,2,2) == "SA" && $classe_sigla == "GV") {
  $tb_prop = "tb_prop_tsac_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
  $tb_hist = "tb_prop_tsac_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
}
$tb_atv  = $arrParamTemp["tabela"];
//$tb_oco  = "tb_resultado_lig";
$tb_oco  = "tb_resultado_lig".substr($data_fim,2,2).substr($data_fim,5,2);

$nro_dk_md = substr($discador_modelo,2,2);

if((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  require_once($_SERVER["DOCUMENT_ROOT"]."/callcenter/dk_funcoes.php");
  //**************************************************************
  //*MONTA CONEXÃO PARA TABELA ATIVO (MAILING, LEADS, EMAIL_REC)**
  //**************************************************************/
  $arrConnectMailing = mkConnectMailing($campanha, $nro_dk_md);
  $connectHOST = $arrConnectMailing["mk_connect_mailing"];
  $tb_atv      = $arrConnectMailing["mk_tabela_mailing"];
  $connect_atv = $arrConnectMailing["mk_connect_mailing"];
  $bd_atv      = $arrConnectMailing["param_bd_paginador"];
  $connectAtv    = new ConexaoBDADO($bd_atv);

  //**************************************************************
  //**************************************************************
  //**************************************************************/
}

if((strpos("xx".$tipo_classe_discador, "mailing_reativa") > 0)) {
  $tb_atv = $tb_atv."_reativa";
}

if (((strpos("xx".$tipo_classe_discador, "mailing") <= 0)) && ((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0))) {
  if ($tb_hist == $tb_prop || substr($discador_modelo,2,2) == "ZE") {
    $mostra_hist = "N";
  }
}

if(substr($discador_modelo,2,2) == "SR" && substr($data_fim,0,4) < 2018 && !$campo_cons) {
  $tb_hist.= "_".substr($data_fim,0,4);
}

$titulo_det = "<b>".$titulo."</b>";

if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
  $titulo_det.= "<br><b>Agrupado por Operação: </b>".$arrAgrupa_operacao[0];
} else {
  $titulo_det.= "<br><b>Operação: </b>".ValorClasse("REPRE", $repre, $session["representante"]);
  $titulo_det.= "&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;<b>Serviço: </b>".ValorClasse("EMPRE", $empresa, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}

if ($campo_cons != "") {
  $campo_consulta_aux = explode("£££", $campo_consulta);
  if ($campo_consulta_aux[2] == "like") {

    if (substr($campo_consulta_aux[0],0,4) == "nome") {

      if ($repre == "SFC") {
        $where_cpf = " and ".$campo_consulta_aux[0]." like '%".$campo_cons."%' ";
      } else {
        $where_cpf = " and ".$campo_consulta_aux[0]." like '".$campo_cons."%'";
        $data_aux_ano_mes = explode("-",$data_ini);
        $where_cpf .= " and ano_mes = '".$data_aux_ano_mes[0].$data_aux_ano_mes[1]."'";
      }

    } else {
      $where_cpf = " and ".$campo_consulta_aux[0]." like '%".$campo_cons."%'";
    }
  }elseif (strtoupper($campo_consulta_aux[2]) == "NOT LIKE") {
    $where_cpf = " and ".$campo_consulta_aux[0]." NOT LIKE '".$campo_cons."'";
  } elseif (strtoupper($campo_consulta_aux[2]) == "FUNCAO") {

    if(function_exists($campo_consulta_aux[3]) === false) {
      print "<br><center><font class='txtvermelho'>ERRO NO PARAMETRO <b>CAMPOS_CONSULTA</b> FUNÇÃO: <b>".$campo_consulta_aux[3]."</b> NÃO EXISTE!</font></center>";
      exit;
    }

    $where_cpf  = " and ".$campo_consulta_aux[0]." ".$campo_consulta_aux[3]($campo_consulta_aux[5], $campo_consulta_aux[4], $campo_cons);
  } else {
    $where_cpf = " and ".$campo_consulta_aux[0]." = '".$campo_cons."'";
  }
} else {
  if ($cpf_cnpj) {
    $where_cpf = " AND cpf_cnpj = '".$cpf_cnpj."' ";
  } else {
    $where_cpf = "";
  }
}

if ((strpos("xx".$tipo_classe_discador, "separado") > 0) || (strpos("xx".$tipo_classe_discador, "classe_mkpro") > 0)) {
  if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
    $where_classe_mkpro = " AND mk_flag = '".substr($discador_modelo,0,2)."' AND mk_numero = '".substr($discador_modelo,-2)."' ";
  } else {
    $where_classe_mkpro = " AND classe_mkpro = '".addslashes($discador_modelo)."' ";
  }
} else {
  $where_classe_mkpro = "";
}

if (substr(strtoupper($tipo_classe_discador),0,2) != "DX") {
  if ((strpos("xx".$tipo_classe_discador, "agrupado_repre") <= 0)) {
    if (!(strpos("xx".$tipo_classe_discador, "empresa_bradpromo") > 0)) {
      $where_empresa = " and empresa = '".addslashes($empresa)."'";
    } else {
      $where_empresa = " and (empresa = '".addslashes($empresa)."' OR empresa LIKE 'CALL___".substr($empresa,-5)."')";
    }
  } else {
    $where_empresa = "";
  }
} else {
  $where_empresa = " 1=1 ";
}

if ($cod_produto && $cod_produto != "TODOS") {
  $where_prod = " AND cod_produto = '".addslashes($cod_produto)."'";
  $connectCallCenter->query("SELECT nomeproduto FROM tbproduto WHERE codproduto = '".addslashes($cod_produto)."'");
  $titulo_det.="<br><b>Produto: </b>".$connectCallCenter->result["nomeproduto"];
} else {
  if ($tipo_produto && $tipo_produto != "TODOS") {
    $where_prod = " AND tipo_produto = '".$tipo_produto."'";
    $titulo_det.="<br><b>Grupo Produto: </b>".ValorClasse("TPCON", $tipo_produto, $repre);
  }
}

//showvars();
$tabela_titulo_det = $titulo_det;
$rel_vars = explode("§", $relatorio);
$colunas  = explode("¢", $rel_vars[0]);

$param_anual = $rel_vars[2];

$aux_relatorio_params = explode("¢",$rel_vars[1]);

$tit_cols = explode("-", $rel_vars[2]);

if (($com_ano_mes == "N") && $usa_calendario_novo) {
  if ($tipo_data_campo == "diario" || $tipo_data_campo == "diario_2_meses") {
    $ano = substr($item_col,0,4);
    $mes = substr($item_col,4,2);
    $dia = substr($item_col,-2);
  } else {
    $ano = substr($data_ini,0,4);
    $mes = substr($data_ini,5,2);
    $dia = substr($data_ini,8,2);
  }

  $anofim = substr($data_fim,0,4);
  $mesfim = substr($data_fim,5,2);
  $diafim = substr($data_fim,8,2);

  $data_cri = $ano."-".$mes."-".$dia;
} else {
  $ano = substr($data_ini,0,4);
  $mes = substr($data_ini,5,2);
  if($deonde_dac) {
    $dia = substr($data_ini,-2);
  } else {
    $dia = substr($item_col,-2);
  }
  $data_cri = $ano."-".$mes."-".$dia;
}

//print "<li>akiiiii   ".$ano.$mes.$dia;

//print $data_ini;

if (($com_ano_mes == "N") && $usa_calendario_novo) {
  $data_fim = $anofim."-".$mesfim."-".$diafim;
}
/********************************************************************************************************************/
/* MONTA O CABEÇALHO
/********************************************************************************************************************/
if ($tipo_data_campo == "diario" || $tipo_data_campo == "diario_2_meses") {
  if ($busca_dia == "bo_data") {
    $titulo_det.= "<br><b>Data da Emissão: </b>".BRdate($data_cri);
  } else {
    $titulo_det.= "<br><b>Data da Venda: </b>".BRdate($data_cri);
  }

}elseif ($tipo_data_campo == "quinzenal") {

  if ($item_col == "01" && (substr($data_fim,8) > 15)) {
    $data_fim_aux = substr($data_fim,0,8)."15";
    $titulo_det.= "<br><b>De: </b>".BRdate($data_ini)." <b>Até: </b>".BRDate($data_fim_aux)."";
  } elseif ($item_col == "02" && (substr($data_ini,8) < 16)) {
    $data_ini_aux = substr($data_ini,0,8)."16";
    $titulo_det.= "<br><b>De: </b>".BRDate($data_ini_aux)." <b>Até: </b>".BRDate($data_fim)."";
  } else {
    $titulo_det.= "<br><b>De: </b>".BRDate($data_ini)." <b>Até: </b>".BRDate($data_fim)."";
  }

  $titulo_det.= "<br><b>".str_replace("0","",$item_col)."ª Quinzena";

}elseif ($tipo_data_campo == "semanal") {

  $titulo_det.= "<br><b>De: </b>".BRdate($data_ini_aux)." <b>Até: </b>".BRDate($data_fim_aux)."";
  $titulo_det.= "<br><b>".str_replace("0","",$item_col)."ª Semana";

} else {

  if (substr($rel_vars[3],0,8) == "(arvore)") {
    if ($data_ini) {
      $titulo_det.= "<br><b>De: </b>".$mesini.BRdate($data_ini)." <b>Até: </b>".$mesfim.BRdate($data_fim);
    }
  }else {
    /******************************************************************************/
    /* COLUNAS
    /******************************************************************************/

    if ($data_ini) {
      $titulo_det.= "<br><b>De: </b>".BRdate($data_ini)." <b>Até: </b>".BRdate($data_fim);
    }
    if (($equipe != "TODAS") && ($equipe != "")) {
      $connectCallCenter->query("SELECT vlr_classe,desc_classe,tipo_reg FROM tb_classe WHERE cod_classe = 'EQUIP' AND representante = '".retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."' AND tipo_reg in ('T','I') AND status = 'A' and idioma = '1' ");
      if($connectCallCenter->count > 0) {
        if ($connectCallCenter->result["tipo_reg"] == 'T') {
          $titulo_equipe = $connectCallCenter->result["desc_classe"] ;
        }
        if ($connectCallCenter->result["tipo_reg"] == 'I' && $connectCallCenter->result["vlr_classe"] == $equipe) {
          $equipe_desc = $connectCallCenter->result["desc_classe"] ;
        }
      }
      $titulo_det.= " - <b>".$titulo_equipe.":</b> ".$equipe_desc;
    }

    if ($tipo_data_classe == "OPER") {
      $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".NomeResumido($item_col);
    }else if ($tipo_data_classe == "VEND") {
      $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".NomeVendedor($item_col, $discador_modelo, $repre);
    }else if ($tipo_data_classe == "VENN") {
      $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".NomeVendedor("VENN¬¢¬".$item_col, $discador_modelo, $repre);
    } else {
      if ($tipo_data_classe) {
        $tipo_data_classe = str_replace("__",$discador_modelo_rel,$tipo_data_classe);
        if ($tipo_data_campo == "seq_fone") {
          $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".retornaDescTelefone($item_col,$discador_modelo,retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
        }elseif (strpos("xxx".$tipo_data_campo, "cod_recusa") > 0 || $tipo_data_campo == "cod_recusa_ant") {
          //          var_dump($item_col, $tipo_data_campo);
          $arr_item_col = explode("¢", $item_col);
          if ($arr_item_col[1]) {
            $classebranco  = $arr_item_col[0];
            $classe_recusa = $arr_item_col[0];
            $item_col      = $arr_item_col[1];
            $item_col_aux  = $arr_item_col[1];
          }
          if(!$item_col_aux) {
            $item_col_aux = $item_col;
          }
          if (substr($classe_recusa,0,2) != "PQ") {
            if (trim(ValorClassePrint($classe_recusa,$item_col,$repre)) == "*") {
              $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClasse($classebranco,$item_col_aux,$repre);
            } else {
              $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClassePrint($classe_recusa,$item_col_aux,$repre);
            }
          } else {
            if (ValorClassePesq($classe_recusa,$item_col,$repre) == " -- ") {
              $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClasse($classebranco,$item_col_aux,$repre);
            } else {
              $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClassePesq($classe_recusa,$item_col_aux,$repre);
            }
          }
        }else {
          $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClasse($tipo_data_classe,$item_col,$repre);
        }
      } else {
        if (substr($tipo_data_campo,0,4) == "data") {
          if ($item_col != "1111-11-11") {
            $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".BRDate($item_col);
          } else {
            $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".ValorClasse($classebranco,$tipo_data_campo,$repre);
          }
        } else {
          $titulo_det.= "<br><b>".$tipo_data_desc.": </b>".$item_col;
        }
      }
    }
  }
}

//print "<pre>";
//print_r($colunas);

//showvars();
$x=0;
while($colunas[$x]) {
  $cols_det     = explode("-", $colunas[$x]);
  $cols_det[1]  = str_replace("'", "\'", $cols_det[1]);
  $nome_var     = "parm_".$x;
  $arr_nome_var = explode("¢", $$nome_var);

  if(strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0) {
    $cols_det[0] = "oco.".$cols_det[0];
  }

  //  if ((strpos("aaa".$$nome_var,"¢") > 0) && (((strpos("aaa".$cols_det[$x],"classe_recusa") > 0) || (strpos("aaa".$cols_det[$x],"cod_recusa") > 0)))) {
  //    ${"parm_".$x} = $arr_nome_var[1];
  //  }

  //print $tipo_data_campo."***";
  if ($tipo_data_campo != "tot_anual") {
    if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {

      if ($x == 0) {
        if ((strpos("a".$cols_det[0],"abordagem") > 0) && ($$nome_var)) {
          $where_outros.= "  ".$cols_det[0]." like '%".$$nome_var."%'";
        } else {
          if (is_null($$nome_var) || $$nome_var == '') {
            $where_outros.= "  (".$cols_det[0]." = '".addslashes($$nome_var)."' or ".$cols_det[0]." is null)";
          } else {

            if(strpos("xxx".$colunas[$x], "(CAMPO)")) {
              $where_outros.= " ".$cols_det[0]." = '".addslashes($arr_nome_var[1])."' and ".str_replace("(CAMPO)", "", $cols_det[1])." = '".addslashes($arr_nome_var[0])."'";
            } else {
              $where_outros.= " ".$cols_det[0]." = '".addslashes($$nome_var)."'";
            }

          }
        }
      } else {
        if ((strpos("a".$cols_det[0],"abordagem") > 0) && ($$nome_var)) {
          $where_outros.= " and ".$cols_det[0]." like '%".$$nome_var."%'";
        } else {
          if(strpos("xxx".$colunas[$x], "(CAMPO)")) {
            $where_outros.= " and ".$cols_det[0]." = '".addslashes($arr_nome_var[1])."' and ".str_replace("(CAMPO)", "", $cols_det[1])." = '".addslashes($arr_nome_var[0])."'";
          } else {
            $where_outros.= " and ".$cols_det[0]." = '".addslashes($$nome_var)."'";
          }
        }
      }
    } else {

      if ((strpos("a".$cols_det[0],"abordagem") > 0) && ($$nome_var)) {
        $where_outros.= " and ".$cols_det[0]." like '%".$$nome_var."%'";
      } else {
        if ((strpos("a".$colunas[$x],"cod_recusa") > 0) && ($$nome_var)) {
          list($var_1, $var_2) = explode("¢", $$nome_var);

          if(!trim($var_2)) {
            $var_2 = $$nome_var;
          }

          if(strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0) {
            $cols_det[1] = "oco.".$cols_det[1];
          }

          //$where_outros.= " and ".$cols_det[0]." = '".$var_2."'"; // ADICIONANDO A LINHA ABAIXO PARA COLOCAR A CLASSE_RECUSA NO WHERE(VINICIUS RE006200)
          $where_outros.= " and ".str_replace("(CAMPO)", "", $cols_det[1])." = '".$var_1."' and ".$cols_det[0]." = '".$var_2."' ";

          if(strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0) {
            $cols_det[1] = str_replace("oco.", "", $cols_det[1]);
          }

        } else {
          if ($$nome_var != "") {
            $where_outros.= " and ".$cols_det[0]." = '".addslashes($$nome_var)."'";
          } else {
            $where_outros.= " and (".$cols_det[0]." = '".addslashes($$nome_var)."' OR ".$cols_det[0]." IS NULL)";
          }
        }

      }
    }

  }

  if(strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0) {
    $cols_det[0] = str_replace("oco.", "", $cols_det[0]);
  }

  //  if ($session["operador"] == "re006200") {
  //    print "<li>".$where_outros;
  //  }
  //  print ($nome_var)."<br>";

  if ($$nome_var) {
    //    print "<pre>";
    //    print $cols_det[0];
    if (substr($rel_vars[3],0,8) != "(arvore)") {
      if ($cols_det[0] == "st_venda_cartao") {
        $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse(str_replace("__", $discador_modelo_rel, $cols_det[1]),$$nome_var,$repre);
      } elseif ($cols_det[0] == "login_operador") {

        $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>"."(".$$nome_var.") - ".NomeResumido($$nome_var);
      } else {
        if (strpos("a".$cols_det[0],"cod_recusa") > 0) {
          list($var_1, $var_2) = explode("¢", $$nome_var);
          if($var_2) {
            $$classe_recusa2 = $var_1;
            $$nome_var       = $var_2;
          }
          if (substr($classe_recusa2,0,2) != "PQ") {
            if (trim(ValorClasse($classe_recusa2,$$nome_var,$repre)) == " -- ") {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse($classebranco,$$nome_var,$repre);
            } else {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClassePrint($classe_recusa2,$$nome_var,$repre);
            }
          } else {
            if (ValorClassePesq($classe_recusa2,$$nome_var,$repre) == " -- ") {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse($classebranco,$$nome_var,$repre);
            } else {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClassePesq($classe_recusa2,$$nome_var,$repre);
            }
          }
        } else {

          if ($cols_det[1]) {
            if (substr($cols_det[1], 0, 3 ) == "___") {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse(str_replace("___", $session["tp_user"], $cols_det[1]), $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
            } else if (substr($cols_det[1], 2, 2) == "__") {
              if ((substr($tipo_data_classe, 0, 2) == "NC") && (empty($nro_nc_param) === false) && (trim($nro_nc_param) != "--")) { //verifa se usa um NC de outro dk/md se sim usa o numero do nc do discador ou modelo do parametro
                $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse(str_replace("__", $nro_nc_param, $cols_det[1]), $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              } else {
                $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse(str_replace("__", $discador_modelo_rel, $cols_det[1]), $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              }
            } else {
              //print $cols_det[1];
              //              print $cols_det[1]."<BR>";
              //              print $$nome_var."<BR>";
              //              print retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."<BR>";
              //        if (substr($classe_recusa,0,2) != "PQ") {
              //                $titulo_det.= "<br><b>3 ".$tit_cols[$x].": </b>".ValorClasse($cols_det[1], $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              //        } else {
              //                $titulo_det.= "<br><b>4 ".$tit_cols[$x].": </b>".ValorClassePesq($cols_det[1], $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              //        }
              if (ValorClasse($cols_det[1], $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)) == " -- ") {
                $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse($classebranco, $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              } else {
                $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".ValorClasse($cols_det[1], $$nome_var, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
              }

            }
          } else {
            $aux_permissao = explode("-",$$nome_var);
            if (count($aux_permissao) > 0) {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".$aux_permissao[0];
            } else {
              $titulo_det.= "<br><b> ".$tit_cols[$x].": </b>".$$nome_var;
            }
          }
        }
      }
    }
  }
  $x++;
}


if (($busca_dia != "data_pagto") && (!$campo_cons)) {
  if ($param_tot_anual == "tot_anual" && substr($rel_vars[3],0,8) == "(arvore)") {
    $where_ano_mes = " ".$where_data." ".$where_detalhe;
  } else if ($param_tot_anual == "tot_anual") {
    $where_ano_mes = " ".$where_data." ".$where_detalhe;
  } else {
    if ($busca_dia == "sa_data" && $discador_modelo == "MDR2") {
      $where_ano_mes  = " AND sa_ano_mes = '".$ano.$mes."' ";
    } else {
      if ($busca_dia != "SEMDATA" && $busca_dia != "SEMDATASTATUS" && strpos("A".$busca_dia,"sa")==0 && strpos("A".$busca_dia,"robo")>0 && ($com_ano_mes== "S" || $com_ano_mes=="")) {
        $where_ano_mes  = " AND ano_mes = '".$ano.$mes."' ";
      }
    }
  }
}


if (substr(strtoupper($tipo_classe_discador),0,2) != "DX") {
  if (((strpos("xx".$tipo_classe_discador, "mailing") <= 0)) && ((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0)) && ((strpos("xx".$tipo_classe_discador, "agrupado_repre") <= 0))) {
    if (!(strpos("xx".$tipo_classe_discador, "empresa_bradpromo") > 0)) {
      $where_emp  = " AND empresa = '".addslashes($empresa)."' ";
      $where_emp2  = " empresa = '".addslashes($empresa)."' ";
    } else {
      $where_emp = " AND (empresa = '".addslashes($empresa)."' OR empresa LIKE 'CALL___".substr($empresa,-5)."')";
      $where_emp2 = " (empresa = '".addslashes($empresa)."' OR empresa LIKE 'CALL___".substr($empresa,-5)."')";
    }
  }
} else {
  $where_emp  = " AND 1=1 ";
  $where_emp2 = " 1=1 ";
}

if (((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data != "tot_mes§Mensal"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads" || $param_sem_ano_mes == "sem_ano_mes") {
  $where_ano_mes = "";
}

if ($busca_dia == "bo_data") {
  if ((strpos("xx".$tipo_classe_discador, "empresa") <= 0)) {
    if ((strpos("xx".$tipo_classe_discador, "repre_vendedor") > 0)) {
      $repre_vendedor = $arrParamTemp["repre_vendedor"];

      if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
        $where = " WHERE  classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
      } else {
        $where = " WHERE representante = '".retornaDefineRepre($repre_vendedor, $var_nao_usar_define_repre,$param_repre_vendedor)."' ".$where_emp." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
      }
    } else {
      if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
        $where = " WHERE  classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
      } else {
        $where = " WHERE representante = '".retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."' ".$where_emp." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
      }
    }
  } else {
    if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
      $where = " WHERE  classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod." ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
    } else {
      $where = " WHERE ".$where_emp2." ".$where_prod." ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
    }
  }
} else {
  if ($busca_dia == "data_atualiza_robo") {
    $where_ano_mes = "";
  }

  if ((strpos("xx".$tipo_classe_discador, "empresa") <= 0)) {
    if ((strpos("xx".$tipo_classe_discador, "repre_vendedor") > 0)) {
      $repre_vendedor = $arrParamTemp["repre_vendedor"];
      /*GAMBI ATENDEBEM*/
      if  (((((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_red_reformas") && ($tipo_data != "tot_mes"))) || (strpos("A".$parm_busca_dia,"sa") > 0)) || $parm_busca_dia == "data_leads" || $parm_busca_dia == "data_confirma" || $parm_busca_dia == "data_agenda") ) {
        if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
          $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
        } else {
          $where = " WHERE ".str_replace("AND","",$where_emp)." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
        }
      } else {
        if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
          $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_ano_mes." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
        } else {
          $where = " WHERE representante = '".retornaDefineRepre($repre_vendedor, $var_nao_usar_define_repre,$param_repre_vendedor)."' ".$where_emp." ".$where_ano_mes." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
        }
      }
    } else {
      if ((strpos("xx".$tipo_classe_discador, "ano_mes") <= 0)) {
        if ($busca_dia == "SEMDATA" || $busca_dia == "SEMDATASTATUS") {
          $where_ano_mes = "";
        }
        /*GAMBI ATENDEBEM*/
        if  ((((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_red_reformas") && ($tipo_data != "tot_mes"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads" || $parm_busca_dia == "data_confirma" || $parm_busca_dia == "data_agenda") ) {
          if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
            $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
          } else {
            $where = " WHERE  ".str_replace("AND","",$where_emp)." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
          }
        } else {
          if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
            if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
              $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
            } else {

              $where = " WHERE ".$where_emp." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
            }
          } elseif (strpos("xx".$tipo_classe_discador, "dx") > 0) {
            if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
              $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
            } else {
              $where = " WHERE ".str_replace("AND", "", $where_emp)." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
            }
          } else {
            if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
              $where = " WHERE classe_mkpro IN ('".strtoupper(str_replace("|", "", str_replace("|,|", "','", $arrAgrupa_operacao[1])))."') ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
            } else {
              if($discador_modelo == "MD8A"){
                $where = " WHERE 1 = 1 ".$where_emp." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;
              }else{
                $where = " WHERE representante = '".retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."' ".$where_emp." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ".$where_detalhe." ".$where_data;

              }
            }
          }
        }

      } else{
        $where = " WHERE ".$where_status_t." ".$where_ano_mes." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
      }
    }
  } else {
    $where = " WHERE ".$where_emp2." ".$where_ano_mes." ".$where_prod."   ".$where_outros." ".$where_sta." ".$where_cpf." ".$where_classe_mkpro." ";
  }
}

if ($where_cpf == "" || substr($discador_modelo, 2, 4) == 'K0') {
  if ($tipo_data_campo == "diario" || $tipo_data_campo == "diario_2_meses") {
    if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
      if ($campo_cons != "") {
        $where.=     formatDataWhereGV($busca_dia, $data_cri, "", "AND");
        $where_dia.= formatDataWhereGV($busca_dia, $data_cri, "", "AND");
      } else {
        $where.= "";
        $where_dia.= "";
      }
    } else {
      if (($com_ano_mes == "N") && $usa_calendario_novo) {
        $where.=     formatDataWhereGV($busca_dia, $data_cri, $data_fim, "AND");
        $where_dia.= formatDataWhereGV($busca_dia, $data_cri, $data_fim, "AND");
        $where.=     formatDataWhereGV($busca_dia, substr($item_col,0,4)."-".substr($item_col,4,2)."-".substr($item_col,6,2), "", "AND");
      } else {
        $where.=     formatDataWhereGV($busca_dia, $data_cri, "", "AND");
        $where_dia.= formatDataWhereGV($busca_dia, $data_cri, "", "AND");
      }
    }
  } elseif ($tipo_data_campo == "quinzenal" ) {
    if ($item_col == "01" && (substr($data_fim,8) > 15)) {
      $where.=     formatDataWhereGV($busca_dia, $data_ini, $data_fim_aux, "AND");
      $where_dia.= formatDataWhereGV($busca_dia, $data_ini, $data_fim_aux, "AND");
    } elseif ($item_col == "02" && (substr($data_ini,8) < 16)) {
      $where.=     formatDataWhereGV($busca_dia, $data_ini_aux, $data_fim, "AND");
      $where_dia.= formatDataWhereGV($busca_dia, $data_ini_aux, $data_fim, "AND");
    } else {
      $where.=     formatDataWhereGV($busca_dia, $data_ini, $data_fim, "AND");
      $where_dia.= formatDataWhereGV($busca_dia, $data_ini, $data_fim, "AND");
    }
  }elseif ($tipo_data_campo == "semanal") {
    $where.=     formatDataWhereGV($busca_dia, $data_ini_aux, $data_fim_aux, "AND");
    $where_dia.= formatDataWhereGV($busca_dia, $data_ini_aux, $data_fim_aux, "AND");
  } else {
    if ($tipo_data_campo != "tot_anual") {
      if ($tipo_data_campo == "pg_npg") {
        if ($item_col == "1111-11-11") {
          if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
            $where.= "";
            $where_dia.= "";
          } else {
            $where.=     formatDataWhereGV($busca_dia, $data_ini, $data_fim, "AND")."  and data_pagto = '".addslashes($item_col)."'    ";
          }
        } else {
          if ($busca_dia != "SEMDATA" && $busca_dia != "SEMDATASTATUS") {
            if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
              $where.= "";
              $where_dia.= "";
            } else {
              $where.=     formatDataWhereGV($busca_dia, $data_ini, $data_fim, "AND")."  and data_pagto <> '1111-11-11' ";
            }
          } else {
            if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
              $where.= "";
              $where_dia.= "";
            } else {
              $where.= " ";
            }
          }
        }

      } else {
        if ($tipo_data_campo == "calc_prazo") {
          $campos_calc_prazo = " ,flw_data_previsao,flw_hora_previsao,flw_tempo_previsao,flw_duracao,flw_status";
          if ($busca_dia != "SEMDATA" && $busca_dia != "SEMDATASTATUS") {
            if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
              $where.= "";
              $where_dia.= "";
            } else {
              $where.=     formatDataWhereGV($busca_dia, $data_ini, $data_fim, "AND");
            }
          } else {
            $where.= " ";
          }
        } else {

          if ($tipo_data_campo == "try" || $tipo_data_campo == "tre" || $tipo_data_campo == "trc") {
            for ($i=0;$i<10;$i++) {
              if ($item_col == str_pad($i,2,0,STR_PAD_LEFT)) {
                $j = i+1;
                $tipo_data_campo = $tipo_data_campo."_".intval($item_col);
                if ($busca_dia != "SEMDATA" && $busca_dia != "SEMDATASTATUS") {
                  if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
                    $where.= " ";
                    $where_dia.= "";
                  } else {
                    $where.= " and ".$busca_dia."    between '".$data_ini."'  and '".$data_fim."' and ".$tipo_data_campo." = '".str_pad(($item_col+1),2,0,STR_PAD_LEFT)."'    ";
                  }
                } else {
                  $where.= " and ".$tipo_data_campo." = '".addslashes($item_col)."' ";
                }
              }
            }
          } else {
            if ($busca_dia != "SEMDATA" && $busca_dia != "SEMDATASTATUS") {
              if ((($campo_consulta) && ($campo_cons != "")) || ($cpf_cnpj)) {
                $where.= " and ".$tipo_data_campo." = '".$item_col."' ";
                $where_dia.= "";
              } else {

                if (($tipo_data_campo == "ranking"|| $tipo_data_campo == "coluna_fixa") && $param_anual != "anual") {

                  if (substr($busca_dia,0,7) == "DATADIA") {
                    $array_dia = explode("(",$busca_dia);
                    $where.= " and ".substr($array_dia[1],0,-1)."    = '".$data_ini."' ";
                  } else {
                    $where.= " and ".$busca_dia." between '".$data_ini."'  and '".$data_fim."'";
                  }

                } else {
                  if ($item_col == "" || is_null($item_col)) {
                    $where.= " and ".$busca_dia."    between '".$data_ini."'  and '".$data_fim."' and (".$tipo_data_campo." = '".$item_col."' or  ".$tipo_data_campo." IS NULL)   ";
                  } else {
                    if ($tipo_data_campo == "intervalo") {
                      $where.= " and ".$busca_dia."    BETWEEN '".$data_ini."'  and '".$data_fim."'  ";
                    } else {
                      if (substr($busca_dia,0,7) == "DATADIA") {
                        $array_dia = explode("(",$busca_dia);
                        $where.= " and ".substr($array_dia[1],0,-1)."    = '".$data_ini."'  and ".$tipo_data_campo." = '".$item_col."'    ";

                      } else {
                        if ($param_anual == "anual") {

                          $anoini = substr($data_ini,0,4);
                          $mesini = substr($data_ini,5,2);
                          $diaini = substr($data_ini,8,2);

                          $anofim = substr($data_fim,0,4);
                          $mesfim = substr($data_fim,5,2);
                          $diafim = substr($data_fim,8,2);

                          $where .= "  AND ano_mes in(";
                          $mesger_aux = $mesini;
                          while(intval($mesger_aux) <= intval($mesfim)) {
                            $where .= "'".$anofim.$mesger_aux."',";
                            if ($mesger_aux == "12") {
                              break;
                            } else {
                              $mesger_aux = Date("m",mktime(0,0,0,($mesger_aux+1),1,$anofim));
                            }
                          }
                          $where = substr($where,0,-1).") ";
                        } elseif(strpos("xxx".$tipo_data_classe,"(CAMPO)") > 0) {
                          list($var_1, $var_2) = $arr_item_col;
                          $where.= " and ".$busca_dia." between '".$data_ini."'  and '".$data_fim."' and ".str_replace("(CAMPO)", "", $tipo_data_classe)." = '".$var_1."' and ".$tipo_data_campo." = '".$var_2."' ";
                        } elseif(strpos("xxx".$tipo_data_classe,"GET_PACOTE") > 0) {
                           $litaPacotes = getListTbProdPacote($item_col);
                          $where.= " and ".$busca_dia." between '".$data_ini."'  and '".$data_fim."' and ".$tipo_data_campo." IN (".$litaPacotes.")    ";
                        } else {
                          $where.= " and ".$busca_dia." between '".$data_ini."'  and '".$data_fim."' and ".$tipo_data_campo." = '".$item_col."'    ";
                        }
                      }
                    }

                  }
                }

              }
            } else {
              if ($item_col == "" || is_null($item_col)) {
                $where.= " and (".$tipo_data_campo." = '".addslashes($item_col)."' OR ".$tipo_data_campo." IS NULL) ";
              } else {
                $where.= " and ".$tipo_data_campo." = '".addslashes($item_col)."' ";
              }
            }
          }
        }
      }
    }

  }
}

if ($com_ano_mes == "N" && ($tipo_data_campo == "diario" || $tipo_data_campo == "diario_2_meses") && 1==2) {
  $where.=  formatDataWhereGV($busca_dia, substr($item_col,0,4)."-".substr($item_col,4,2)."-".substr($item_col,6,2), "", "AND");
}


if ($cod_recusa) {
  $where_rec = " and cod_recusa = '".addslashes($cod_recusa)."' ";
}

if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  if (strpos("xxx".$tipo_data_campo, "cod_recusa") > 0) {
    $where = $where." and ".$tipo_data_campo." = '".addslashes($item_col)."' ";
  }

  if ($tipo_data_campo == "data_atualiza") {
    $where = $where." and data_atualiza = '".addslashes($item_col)."' ";
  }

  if ($tipo_data_campo == "data_agenda") {
    $where = $where." and data_agenda = '".addslashes($item_col)."' ";
  }

  if (strpos($tipo_data_campo,"hora_atualiza") > 0) {
    $where = $where." and left(hora_atualiza,2) = '".addslashes($item_col)."' ";
  }

  if ($tipo_data_campo == "ddd_1") {
    $where = $where." and ddd_1 = '".addslashes($item_col)."' ";
  }
  if ($tipo_data_campo == "login_operador") {
    $where = $where." and login_operador = '".addslashes($item_col)."' ";
  }
}

/*
if (strtoupper($empresa) == "TELEF_ATCAR" || $repre == "PORTOSEGURO"  || substr($repre,0,10) == "TELEFRESID" || substr($repre,0,8) == "TELEPOST" || substr($repre,0,9) == "URACENTER" || substr($repre,0,11) == "NSAPARECIDA") {
if ($status != "TODOS") {
$where.= " AND status = '".$status."'";
}
$titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
} else {
if ($status == "A" || $status == "B") {
$mostra_hist="N";
$where.= " AND status = '".$status."'";
$titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}

if ($status == "C" || $status == "E") {
$where.= " AND status = '".$status."'";
$titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}

if ($status == "P") {
$mostra_hist="N";
$where.= " AND status = 'B' and cod_recusa = '' ";
$titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}

if ($status == "U") {
if (strtoUPPER($empresa) == "TELEF_ATBLC" || strtoUPPER($empresa) == "TELEF_RCBLC"  || strtoUPPER($empresa) == "TELEF_ATATR"   || strtoUPPER($empresa) == "TELEF_RCATR" ) {
$where.= " AND status = 'U' and cod_recusa = '47' ";
} else {
$where.= " AND status = 'U' and cod_recusa = '31' ";
}

//$titulo_det.= "<br><b> Status: </b>OS Emitida";
$titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}
if ($status == "TODOS") {
//  $where.= " AND st_venda_cartao = '1' ";
}
}
*/

$campo_id_lig   = "id_lig";
$campo_campanha = "campanha";
$campo_st_venda_cartao = "st_venda_cartao";

if ((substr($repre,0,5) == "TELEF" && substr($repre,0,10) != "TELEFRESID") && (!strtoUPPER($empresa) == "TELEF_ATVHF") && (!strtoUPPER($empresa) == "TELEF_ATVIF") && (!strtoUPPER($empresa) == "TELEF_ATVGF")) {
  if ($status == "A" || $status == "B") {
    $mostra_hist="N";
    $where.= " AND ".$campo_status_bd." = '".$status."'";
    $titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
  }

  if ($status == "C" || $status == "E" || $status == "F" || $status == "R" || $status == "G") {
    $where.= " AND ".$campo_status_bd." = '".$status."'";
    $titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
  }

  if ($status == "P") {
    $mostra_hist="N";
    $where.= " AND ".$campo_status_bd." = 'B' and cod_recusa = '' ";
    $titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
  }

  if ($status == "U") {
    if (strtoUPPER($empresa) == "TELEF_ATBLC" || strtoUPPER($empresa) == "TELEF_RCBLC"  || strtoUPPER($empresa) == "TELEF_ATATR"   || strtoUPPER($empresa) == "TELEF_RCATR" ) {
      $where.= " AND ".$campo_status_bd." = 'U' and cod_recusa = '47' ";
    } else {
      $where.= " AND ".$campo_status_bd." = 'U' and cod_recusa = '31' ";
    }

    //$titulo_det.= "<br><b> Status: </b>OS Emitida";
    $titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
  }
  if (($status == "TODOS") && ($deonde != "pesqhist")) {

    //  $where.= " AND st_venda_cartao = '1' ";
  }
} else {
  if ($deonde != "MK_HIST_CLIENTE") {



    //***********if para funcionamento pela tabela evento ****** ****
    if ($classe_sigla == "GN") {
      $tb_prop = "tb_prop_evento";
      $tb_hist = "tb_prop_evento";
      $seq_tabela = "seq";
      $mostra_hist  = "N";

    }

    //*************************************************

    //***********if representante bradesc_agildade ****
    if (substr($discador_modelo,2,2) == "AG" && $classe_sigla == "GA") {
      $tb_prop = "tb_agilidade_dia";
      $tb_hist = "tb_agilidade_dia";
    }
    if (substr($discador_modelo,2,2) == "AG" && $classe_sigla == "GR") {
      $tb_prop = "tb_agilidade_mes";
      $tb_hist = "tb_agilidade_mes";
      $param_anual = "anual";
    }
    if (substr($discador_modelo,2,2) == "Z4" && $classe_sigla == "GR") {
      $tb_prop = "tb_ativo_bmcpr_cert_cobranca";
      $tb_hist = "tb_ativo_bmcpr_cert_cobranca";
      $seq_tabela = "seq";
    }
    if (substr($discador_modelo,2,2) == "Z5" && $classe_sigla == "GR") {
      $tb_prop = "tb_proposta_fidrj_cartao";
      $tb_hist = "tb_proposta_fidrj_cartao";
    }
    if (substr($discador_modelo,2,2) == "SA" && $classe_sigla == "GV") {
      $tb_prop = "tb_prop_tsac_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
      $tb_hist = "tb_prop_tsac_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
    }
    if(strtoupper(substr($tipo_classe_discador,0,2)) == "DX") {
      if(trim(ValorClasse($classe_TLREB,$flag_dx."_TABELA",$repre)) != "--") {
        $tb_prop = $dx_tabela_TLREB;
        $tb_hist = $dx_tabela_TLREB;
      }
      $mostra_hist = "N";
      $param_sem_ano_mes = "sem_ano_mes";
      $seq_tabela        = $dx_chave_TLREB;
      $campo_id_lig      = $seq_tabela;
      $campo_campanha    = $campo_id_lig;
      $campo_st_venda_cartao = $campo_id_lig;
      $campo_nome_razao = $campo_id_lig;
    }

    //*************************************************

    //TODOS MENOS 1
    $aux_status = explode("-",$status);

    if ($aux_status[0] != "TODOS")  {

      if (((strpos("xx".$tipo_classe_discador, "mailing") > 0)) || ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0))) {
        if ($aux_status[0] != "TODOS") {
          if (strpos($status,",") > 0) {
            $aux_status = explode("-",$status);
            $aux_status_2 = explode(",",$aux_status[1]);

            foreach ($aux_status_2 as $key => $value) {
              $str_status_multiplos .= "'".$value."',";
            }
            $str_status_multiplos = substr($str_status_multiplos,0,-1);

            $where_sta = " AND st_venda_cartao IN (".$str_status_multiplos.") ";
          } else {
            $where_sta = " AND st_venda_cartao = '".addslashes($status)."'";
          }
        }

        if ($campanha != "TODOS") {
          $where_campanha = " campanha = '".addslashes($campanha)."' ";
        }

      } else {

        if (strpos($status,",") > 0) {
          $aux_status = explode("-",$status);
          $aux_status_2 = explode(",",$aux_status[1]);

          foreach ($aux_status_2 as $key => $value) {
            $str_status_multiplos .= "'".$value."',";
          }
          $str_status_multiplos = substr($str_status_multiplos,0,-1);
          $where_sta = " AND ".$campo_status_bd." IN (".$str_status_multiplos.") ";

        } else {
          $where_sta = " AND ".$campo_status_bd." = '".addslashes($status)."'";

        }

      }
    } else {

      if ($aux_status[1]) {
        if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
          if (strpos("A".$aux_status[1],",") > 0) {
            $status_multiplos = explode(",",$aux_status[1]);
            foreach ($status_multiplos as $key => $value) {
              $str_st_mul .= "'".$value."',";
            }
            $str_st_mul = substr($str_st_mul,0,-1);
            $where_sta .= " AND st_venda_cartao NOT IN (".$str_st_mul.") ";
          } elseif (strpos("A".$aux_status[1],"¬") > 0) {
            $status_multiplos = explode("¬",$aux_status[1]);
            foreach ($status_multiplos as $key => $value) {
              $str_st_mul .= "'".$value."',";
            }
            $str_st_mul = substr($str_st_mul,0,-1);
            $where_sta .= " AND st_venda_cartao IN (".$str_st_mul.") ";
          } else {
            $where_sta .= " AND st_venda_cartao <> '".addslashes($aux_status[1])."' ";
          }

        } else {

          if (strpos("A".$aux_status[1],",") > 0) {
            $status_multiplos = explode(",",$aux_status[1]);
            foreach ($status_multiplos as $key => $value) {
              $str_st_mul .= "'".$value."',";
            }
            $str_st_mul = substr($str_st_mul,0,-1);
            $where_sta .= " AND status NOT IN (".$str_st_mul.") ";
          } elseif (strpos("A".$aux_status[1],"¬") > 0) {
            $status_multiplos = explode("¬",$aux_status[1]);
            foreach ($status_multiplos as $key => $value) {
              $str_st_mul .= "'".$value."',";
            }
            $str_st_mul = substr($str_st_mul,0,-1);
            $where_sta .= " AND status IN (".$str_st_mul.") ";
          } else {
            $where_sta .= " AND status <> '".addslashes($aux_status[1])."' ";
          }

        }
      } else {
        $where_sta = " ";
      }
    }
  }



  $titulo_det.= "<br><b> Status: </b>".ValorClasse($classe_TLRE3, $status, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
}

if (substr($discador_modelo,2,2) == "SA" && $classe_sigla == "GA") {
  $tb_prop = "tb_cd_chmd_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
  $tb_hist = "tb_cd_chmd_".substr($data_fim, 0, 4).substr($data_fim, 5, 2);
  $seq_tabela = "seq";
}

if (substr($rel_vars[3],0,8) == "(arvore)") {
  $titulo_det.= $titulo_princ_arvore;
  $titulo_det.= "<table><tr><td><font class='txt5'><strong>".$ultimo_titulo.": </strong>".$valor_coluna."</font></td></tr></table><br>";
}

if ($val_ano_mes) {
  $busca_dia.= "¬".$val_ano_mes;
}

//if ($busca_dia || $busca_hora) {
//  if ($busca_dia && $busca_hora) {
//    if ($busca_dia && $busca_hora && $param_sem_ano_mes) {
//      $parm_busca_dia= $busca_dia."¢".$busca_hora."¢".$param_sem_ano_mes;
//    } else {
//      $parm_busca_dia= $busca_dia."¢".$busca_hora;
//    }
//  } else {
//    if ($busca_dia) {
//      $parm_busca_dia= $busca_dia;
//      //print $parm_busca_dia;
//    } else {
//      $parm_busca_dia= "¢".$busca_hora;
//      //print $parm_busca_dia;
//    }
//  }
//}

//showvars();

//if ((($campo_consulta == "cpf_cnpj£££CPF/CNPJ£££") && ($campo_cons != "")) || ($cpf_cnpj)) {
////  print "<li>".$relatorio;
//  //por §
//  $aux_relato_reparte_1 = explode("§",$relatorio);
//  //por ¢
//  $aux_relato_reparte_2 = explode("¢",$aux_relato_reparte_1[0]);
//  //por -
//  $aux_relato_reparte_3 = explode("-",$aux_relato_reparte_1[2]);
////  print "<pre>";
////  print_r($aux_relato_reparte_3);
//  for ($i=1;$i<count($aux_relato_reparte_2);$i++) {
////    print "i =".$i." 2= ".$aux_relato_reparte_2[$i]." 3=".$aux_relato_reparte_3[$i]."<br>";
//    $str_campos .= $aux_relato_reparte_2[$i]."¢";
//    $str_descr .=  $aux_relato_reparte_3[$i]."-";
//  }
//  $str_campos = substr($str_campos,0,-1);
//  $str_descr =  substr($str_descr,0,-1);
//
////  print "<li>---".$str_descr;
//  $relatorio_aux = $str_campos."§".$aux_relato_reparte_1[1]."§".$str_descr;
//
//}
//showvars();
//if (!valor_filtro) {
//  if ($combo_cond[0]) {
//    print_r($combo_cond);
//  }
//}
//showvars();
//print_r($valor_filtro);
if ($valor_filtro) {
  if (strpos($filtro,"combo") > 0) {
    if (is_array($valor_filtro)) {
      $str_condi_filtro = "&combo_cond[0]=".$valor_filtro[0];
      if ($valor_filtro[1]) {
        $str_condi_filtro .= "&combo_cond[1]=".$valor_filtro[1];
      }
      if ($valor_filtro[2]) {
        $str_condi_filtro .= "&combo_cond[2]=".$valor_filtro[2];
      }
    } else {
      $str_condi_filtro = "&combo_cond[0]=".$valor_filtro;
    }

  } else {
    $str_condi_filtro = "&text_condicao=".$valor_filtro;
  }
}
//print $str_condi_filtro;

if ($filtro) {
  //encadeado
  if (strpos("a".$filtro,",") > 0) {


    $str_filtro = explode("§",$filtro);
    //          print $str_filtro[0]."<br>";
    $str_filtro_campo = explode(",",$str_filtro[0]);
    $str_filtro_comparacao = explode(",",$str_filtro[1]);
    $str_filtro_valor = explode(",",$str_filtro[2]);
    $str_filtro = "";
    //          print "aaaaaaa".count($str_filtro_aux);

    for ($indice_campos = 0;$indice_campos < count($str_filtro_aux);$indice_campos++) {

      if ($str_filtro_comparacao[$indice_campos] == "IGUAL") {
        $str_filtro_comparacao[$indice_campos] = "=";
        $str_filtro .= " AND ".$str_filtro_campo[$indice_campos]." ".$str_filtro_comparacao[$indice_campos]." '".$valor_filtro[$indice_campos]."' ";

      } else {
        $str_filtro .= " AND ".$str_filtro_campo[$indice_campos]." ".$str_filtro_comparacao[$indice_campos]." '".$valor_filtro[$indice_campos]."' ";
      }
    }
  } else {
    if (is_array($valor_filtro)) {
      $valor_filtro = implode("³£³",$valor_filtro);
    }
    //          print "<li>".$filtro."<br>";
    //          print $valor_filtro;
    if ($valor_filtro) {
      $str_filtro = explode("§",$filtro);
      if ($str_filtro[2] == "IGUAL") {
        $str_filtro[2] = "=";
        $str_filtro = " AND ".$str_filtro[0]." ".$str_filtro[2]." '".$valor_filtro."' ";
      } else {
        $str_filtro = " AND ".$str_filtro[0]." ".$str_filtro[2]." '%".$valor_filtro."%' ";
      }
    }
  }
}

if (strpos("a".$str_filtro,"³£³") > 0) {
  $filtro_campo_consulta_AUX = explode("=",str_replace("'","",$str_filtro));
  $filtro_campo_consulta_AUX[1] = MontaIN_Where(trim($filtro_campo_consulta_AUX[1]),"³£³");
  $str_filtro = implode(" IN ",$filtro_campo_consulta_AUX);
}

if ($tp_relatorio_menu) {
  $prgma = "gestao_operacional.php";
  $voltar_vars = "tipo_popup=AJ2&&tp_relatorio_menu=".$tp_relatorio_menu."&";
} elseif ($tp_relatorio) {
  $prgma = "gestao_operacional.php";
  $voltar_vars = "tipo_popup=AJ2&&tp_relatorio_menu=".$tp_relatorio."&";
} else {
  $prgma = "cc_gestao_vendas.php";
  $voltar_vars = "tipo_popup=AJ2&";
}

if($deonde == "ABA") {
  $tipo_popup = "AJB";
}


$arrCpoIndice = getArrayClasse("tb_classe", $connectCallCenter, "descricao", $classe_TLREB, $repre, "A", " AND vlr_classe LIKE 'GC_CPO_INDICE%' ");

if(is_array($arrCpoIndice["itens"]) === true) {
  foreach ($arrCpoIndice["itens"] as $key => $value) {
    list($cpoDesc, $cpoCampo, $cpoClasse) = explode("¢", $value["descricao"]);

    if ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0)) {
      $cpoCampo = "oco.".$cpoCampo;
    }

    if(${$value["valor"]} != "TODOS") {
      //      $str_filtro .= " AND ".$cpoCampo." = '".${$value["valor"]}."'";
      $where_filtro_add .= " AND ".$cpoCampo." = '".${$value["valor"]}."'";
    }

    $string_passa_get .= " &".$value["valor"]."=".${$value["valor"]}."&";

  }
}

if(is_array($_GET) === true) {
  foreach ($_GET as $key => $value) {
    if(substr($key, 0, 3) == "GC_") {
      $string_passa_get .= " &".$key."=".$value."&";
    }
  }
}

if (substr($rel_vars[3],0,8) == "(arvore)") {
  $arr_rel_vars_ant = explode(",", $rel_vars_ant);
  if (is_array($arr_rel_vars_ant)) {
    foreach ($arr_rel_vars_ant as $i => $desc) {
      if ($desc) {
        $voltar_rel_vars = $desc;
      }
    }
  }
  $str_ant_tipo_data .= $ant_tipo_data_where.",";
  $str_valor_arvore .= $valor_coluna.",";

  //print $str_ant_tipo_data."<br>";
  //print $str_valor_arvore."<br>";

  //print $ordem_arvore;

  $ordem_arvore--;



  //$voltar = $prgma."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campo_ordena=".$campo_ordena."&mesini=".$mesini."&mesfim=".$mesfim."&anofim=".$anofim."&prox_arvore=".$prox_arvore."&prox_tipo_data=".$prox_tipo_data."&ant_tipo_data_where=".$ant_tipo_data_where."&str_valor_arvore=".$str_valor_arvore."&str_ant_tipo_data=".$str_ant_tipo_data."&str_valor_coluna=".$str_valor_coluna."&desc_valor_coluna=".$desc_valor_coluna."&desc_titulo_arvore=".$desc_titulo_arvore."&rel_vars_ant=".$rel_vars_ant."&ordem_arvore=".$ordem_arvore."&voltar_rel_vars=".$voltar_rel_vars."&value_where_arvore=".$value_where_arvore."&valor_coluna=".$valor_coluna."&existe_arvore_ant=".$existe_arvore_ant."&campanha=".$campanha."&direcao=retorna&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
  $voltar_vars=$voltar_vars."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campo_ordena=".$campo_ordena."&mesini=".$mesini."&mesfim=".$mesfim."&anofim=".$anofim."&prox_arvore=".$prox_arvore."&prox_tipo_data=".$prox_tipo_data."&ant_tipo_data_where=".$ant_tipo_data_where."&str_valor_arvore=".$str_valor_arvore."&str_ant_tipo_data=".$str_ant_tipo_data."&str_valor_coluna=".$str_valor_coluna."&desc_valor_coluna=".$desc_valor_coluna."&desc_titulo_arvore=".$desc_titulo_arvore."&rel_vars_ant=".$rel_vars_ant."&ordem_arvore=".$ordem_arvore."&voltar_rel_vars=".$voltar_rel_vars."&value_where_arvore=".$value_where_arvore."&valor_coluna=".$valor_coluna."&existe_arvore_ant=".$existe_arvore_ant."&campanha=".$campanha."&direcao=retorna&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
}else
if ($param_tot_anual == "tot_anual") {
  $tipo_data = $param_tot_anual."§".$tipo_data."§".$tipo_data_desc;
  //$voltar = $prgma."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campo_ordena=".$campo_ordena."&mesini=".$mesini."&mesfim=".$mesfim."&anofim=".$anofim."&prox_arvore=".$prox_arvore."&prox_tipo_data=".$prox_tipo_data."&ant_tipo_data_where=".$ant_tipo_data_where."&str_valor_arvore=".$str_valor_arvore."&str_ant_tipo_data=".$str_ant_tipo_data."&str_valor_coluna=".$str_valor_coluna."&desc_valor_coluna=".$desc_valor_coluna."&desc_titulo_arvore=".$desc_titulo_arvore."&rel_vars_ant=".$rel_vars_ant."&ordem_arvore=".$ordem_arvore."&voltar_rel_vars=".$voltar_rel_vars."&value_where_arvore=".$value_where_arvore."&valor_coluna=".$valor_coluna."&existe_arvore_ant=".$existe_arvore_ant."&direcao=retorna&mesini=".$mesini."&campanha=".$campanha."&mesfim=".$mesfim."&anofim=".$anofim."&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
  $voltar_vars=$voltar_vars."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campo_ordena=".$campo_ordena."&mesini=".$mesini."&mesfim=".$mesfim."&anofim=".$anofim."&prox_arvore=".$prox_arvore."&prox_tipo_data=".$prox_tipo_data."&ant_tipo_data_where=".$ant_tipo_data_where."&str_valor_arvore=".$str_valor_arvore."&str_ant_tipo_data=".$str_ant_tipo_data."&str_valor_coluna=".$str_valor_coluna."&desc_valor_coluna=".$desc_valor_coluna."&desc_titulo_arvore=".$desc_titulo_arvore."&rel_vars_ant=".$rel_vars_ant."&ordem_arvore=".$ordem_arvore."&voltar_rel_vars=".$voltar_rel_vars."&value_where_arvore=".$value_where_arvore."&valor_coluna=".$valor_coluna."&existe_arvore_ant=".$existe_arvore_ant."&direcao=retorna&mesini=".$mesini."&campanha=".$campanha."&mesfim=".$mesfim."&anofim=".$anofim."&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
} else {
  //$voltar = $prgma."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campanha=".$campanha."&campo_ordena=".$campo_ordena."&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
  $voltar_vars=$voltar_vars."repre=".$repre.$str_passa_filtro_fixo."&titulo=".$titulo."&voltou=S&deonde=".$deonde."&filtro_mkprg=".$filtro_mkprg."&campo_consulta=".$campo_consulta."&campo_cons=".$campo_cons."&busca_dia=".$busca_dia."&cmb_responsavel=".$cmb_responsavel."&parm_busca_dia=".$parm_busca_dia."&status=".$status."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&empresa=".$empresa."&data_ini=".$data_ini."&data_fim=".$data_fim."&tipo_produto=".$tipo_produto."&cod_produto=".$cod_produto."&relatorio=".$relatorio."&tipo_data=".$tipo_data."&tipo_info=".$tipo_info."&tit_visao=".$tit_visao."&tp_con_data=".$tp_con_data."&cpf_cnpj=".$cpf_cnpj."&tipo_campo_sum=".urlencode($tipo_campo_sum)."&rel_where=".urlencode($rel_where)."&rel_vend_regional=".urlencode($rel_vend_regional)."&rel_vend_eps=".urlencode($rel_vend_eps)."&rel_vend_depto=".urlencode($rel_vend_depto)."&procurar=OK&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&ordena_tot=".$ordena_tot."&ordena=".$ordena."&campanha=".$campanha."&campo_ordena=".$campo_ordena."&tipo_campo_combo=".urlencode($tipo_campo_combo)."&refaz_param_campo=ok&combo_equipe=".$equipe."&relatorio_aux=".$relatorio_aux."&combo_condicao=".$filtro.$str_condi_filtro."&tipo_agrupamento_combo=".$tipo_agrupamento_combo."&qtd_agrupamento=".$qtd_agrupamento."&nivel=".$_GET["nivel"]."&campo_deonde=".$campo_deonde."&".$arr_campo_deonde[0]."=".${$arr_campo_deonde[0]}."&faz_monitoria=".$faz_monitoria."&form=".$form."&dia_pesq=".$dia_pesq."&tipo_visao_combo=".$tipo_visao_combo."&tipo_popup=".$tipo_popup."&agrupa_operacao=".$agrupa_operacao;
}

if (strpos("xxx".$busca_dia, "¬") > 0) {
  $arr_busca_dia = explode("¬", $busca_dia);
  $busca_dia = $arr_busca_dia[0];
  $val_ano_mes = $arr_busca_dia[1];
}

if ($string_passa_get) {
  $voltar_vars=$voltar_vars.$string_passa_get;
}

// print $string_passa_get;
// exit();
if(!$deonde_dac) {
  //require_once("funcoes/montaDivFlutuante.php");
}
?>
<!doctype html>
<html>
<head>
<title><?print $session["sistema"];?></title>
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<!-- *************** CSS *************** -->
<!-- bootstrap -->
<?print IntergrAllHeader();?>

<script type="text/javascript" src="consistencia.js"></script>
<script type="text/javascript" src="/js/montaDivPopUp.js"></script>
<script type="text/javascript" src="/js/montaMascara.js"      ></script>

<script language="javascript" type="text/javascript">
function AbreProtocolos(protocolos){
  montaDivPopUp(1, 'rtv_lista_protocolos.php?repre=<?print $repre?>&protocolos='+protocolos, 'JanelaHist', '60%', '60%', 'Protocolos Gerados no Atendimento', 'CC', '<?print $session["td_destaque"]?>', '', '', 'S', '');
}

function abreJanelaHist(discador_modelo,id_lig,campanha,repre,seq,n_ocorrencia) {
   // alert('xxxx');
  abrePopUpModal('Detalhe',"tlfn_tvda_con_bko_det_hist.php?tipo_popup=AJ2&classe_pesquisa=" + discador_modelo + "&id_lig_oco=" + id_lig + "&campanha_oco=" + campanha + "&repre=" + repre + "&seq=" + seq + "&n_ocorrencia=" + n_ocorrencia, 'Ocorrencias', '900', '520', 'Histórico - Ocorrências Telefônicas');
}

function getprintInteligente(repre, agrupamento, valor, programa, n_pedido) {
  AbreJanela(programa + "?sa_tipo=sa&classe_pesquisa=" + valor + "&repre=" + repre + "&dados_geral=1111-11-11¢¢"+n_pedido, 'imprimeFicha', '90%', '520');
}

function mudaPagina(pagina) {
  //  alert(pagina);
  //  alert(document.getElementById("pag_frmPagina").value);
  document.fi_frmPagina.pag.value = pagina;
  document.fi_frmPagina.submit();
}

function mudaPaginaProxima() {
  //  alert(document.getElementById("pag_frmPagina").value);
  //  alert(document.fi_frmPagina.pag.value);
  document.fi_frmPagina.pag.value = parseInt(document.fi_frmPagina.pag.value) + 1;
  document.fi_frmPagina.submit();
}

function mudaPaginaAnterior() {
  //  alert(document.getElementById("pag_frmPagina").value);
  //  alert(document.fi_frmPagina.pag.value);
  document.fi_frmPagina.pag.value = parseInt(document.fi_frmPagina.pag.value) - 1;
  document.fi_frmPagina.submit();
}

function utf8_decode(str_data) {
  var tmp_arr = [], i = ac = c = c1 = c2 = 0;
  while (i < str_data.length) {
    c = str_data.charCodeAt(i);
    if (c < 128) {
      tmp_arr[ac++] = String.fromCharCode(c);
      i++;
    }else if ((c > 191) && (c < 224)) {
      c2 = str_data.charCodeAt(i + 1);
      tmp_arr[ac++] = String.fromCharCode(((c & 31) << 6) | (c2 & 63));
      i += 2;
    } else {
      c2 = str_data.charCodeAt(i + 1);
      c3 = str_data.charCodeAt(i + 2);
      tmp_arr[ac++] = String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
      i += 3;
    }
  }
  return tmp_arr.join('');
}

function mostraTitle(titulo, mensagem) {

  $("#spanDescricao").html();
  tabela = "";

  tabela += "<table  width='200' border='1' class='borderwrap' cellpadding='0' cellspacing='0' style='border-collapse:collapse;'>";
  tabela += "<tr bgcolor='<?print $session["td_destaque"]?>'><td><font class='txt6'><strong>"+titulo+"</strong></font></td></tr>";
  tabela += "<tr bgcolor='<?print $session["td_dado3"]?>'><td><font class='txt5'>"+mensagem+"</font></td></tr>";
  tabela +="</table>";
  montaTitle(tabela);
}

function imprimeRelatorio(tipo) {
  if($('#div_relatorio')[0]) {
    $('#div_relatorio').attr("href", "");
    $('#div_relatorio').attr("gi", "");

    document.simula.tabelao_rel.value = $("#div_relatorio").html().replace(/href/gi,"");
  }

  if($('#tab_aux1')[0]) {
    $('#tab_aux1').attr("href", "");
    $('#tab_aux1').attr("gi", "");

    document.simula.tabelao_rel.value = $("#tab_aux1").html().replace(/href/gi,"");
  }

  document.simula.tabelao_titulo.value = document.getElementById("tudo").innerHTML;
  document.simula.tipo.value=tipo;
  strHelpOptions =  "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=yes";
  strHelpOptions += ",top=1";
  strHelpOptions += ",left=1";
  strHelpOptions += ",width=720";
  strHelpOptions += ",height=520";
  Janela = window.open('blank.html', 'Janela', strHelpOptions);
  Janela.focus();
  document.simula.submit();
}

// Lucas Genari 04/12/2019 NOVO MÉTODO PARA IMPRESSÃO DA TABELA
function imprimir_div(elem) {
  var mywindow = window.open('', 'PRINT', 'height=800,width=600');

  mywindow.document.write("<html><head><title>" + document.title  + "</title>");
  mywindow.document.write("<style>table.blueTable{border: 1px solid #1C6EA4;background-color: #EEEEEE;width: 100%;text-align: left;border-collapse: collapse;}table.blueTable td, table.blueTable th {border: 1px solid #AAAAAA;padding: 3px 2px;}table.blueTable tbody td {font-size: 13px;}table.blueTable tr:nth-child(even) {background: #D0E4F5;}table.blueTable thead {background: #1C6EA4;background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);border-bottom: 2px solid #444444;}table.blueTable thead th {font-size: 15px;font-weight: bold;color: #FFFFFF;border-left: 2px solid #D0E4F5;}table.blueTable thead th:first-child {border-left: none;}table.blueTable tfoot {font-size: 14px;font-weight: bold;color: #FFFFFF;background: #D0E4F5;background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);border-top: 2px solid #444444;}table.blueTable tfoot td {font-size: 14px;}table.blueTable tfoot .links {text-align: right;}table.blueTable tfoot .links a{display: inline-block;background: #1C6EA4;color: #FFFFFF;padding: 2px 8px;border-radius: 5px;}</style>");
  mywindow.document.write("</head><body>");
  mywindow.document.write("<h1>" + document.title  + "</h1>");
  mywindow.document.write("<table class='blueTable'>");
  mywindow.document.write(document.getElementById(elem).innerHTML);
  mywindow.document.write("</table>");
  mywindow.document.write("</body></html>");

  mywindow.document.close(); // necessary for IE >= 10
  mywindow.focus(); // necessary for IE >= 10*/

  mywindow.print();
  mywindow.close();

  return true;
}

function get_browser() {
  var ua = navigator.userAgent, tem, M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

  if(/trident/i.test(M[1])) {
    tem = /\brv[ :]+(\d+)/g.exec(ua) || [];

    // return {
      // name:'IE',
      // version:(tem[1] || '')
    // };

    return 'IE';
  }

  if(M[1] === 'Chrome') {
    tem = ua.match(/\bOPR\/(\d+)/);

    if(tem != null) {
      // return {
        // name: 'Opera',
        // version: tem[1]
      // };

      return 'OPERA';
    }
  }

  M = M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];

  if((tem = ua.match(/version\/(\d+)/i)) != null) {
    M.splice(1, 1, tem[1]);
  }

  // return {
    // name: M[0],
    // version: M[1]
  // };

  return M[0];
}

function exportarParaExcel(lista) {
  if(get_browser() != "IE") {
    //e.preventDefault();
    var table_div = document.getElementById(lista);
    // esse "\ufeff" é importante para manter os acentos
    var blobData = new Blob(['\ufeff'+table_div.outerHTML], { type: 'application/vnd.ms-excel' });
    var url = window.URL.createObjectURL(blobData);
    var a = document.createElement('a');

    a.href = url;
    a.download = 'excel_relatorio.xls';
    a.click();

    return false;
  }

  imprimeRelatorio("excel");
}
</script>
</head>
<body>
<div class="container-fluid">

<?
if($flag_empresa == "remove") {
  $titulo_det = "";
}

if($deondeDacBoard) {
  $voltar = "";
}else{
  $voltar = $prgma."?mku=".MKUEncode($voltar_vars);
  if ($voltar_especifico) {
    $voltar = $voltar_especifico;
  }
}





if (substr($deonde,0,19) == "visao_personalizada") {
  // print $titulo_det ;
  $tipo_popup = "AJB";
  print GerarCabecalho($voltar,"","","");
} else {
  print GerarCabecalho($voltar,"<h6>".$titulo_det."</h6>","","");
}

$connectCallCenter->query("SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".addslashes($classe_TLRE7)."' AND representante = '".retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."' AND tipo_reg = 'I'  AND status = 'A' ".$where_cond_classe." ORDER BY vlr_classe");
if($session["print_sql"] != "N") {
  print "<li>1".$connectCallCenter->query_str."<br>";
}
if($connectCallCenter->count < 1) {
  $connectCallCenter->query("SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".addslashes($classe_TLRE7)."' AND representante = 'URANET' AND tipo_reg = 'I'  AND status = 'A' ".$where_cond_classe." ORDER BY vlr_classe");
  if($session["print_sql"] != "N") {
    print "<li>2".$connectCallCenter->query_str."<br>";
  }
  if($connectCallCenter->count < 1) {
    $connectCallCenter->query("SELECT vlr_classe, desc_classe, filtro_classe FROM tb_classe WHERE cod_classe = '".addslashes($classe_TLRE7)."' AND representante = '".addslashes($repre)."' AND tipo_reg = 'I'  AND status = 'A' ".$where_cond_classe." ORDER BY vlr_classe");
    if($session["print_sql"] != "N") {
        print "<li>3".$connectCallCenter->query_str."<br>";
      }
  }
}
$total_loop=0;
if($connectCallCenter->count > 0){
  do{
    $total_loop++;
    $matriz_titulo_det[$connectCallCenter->result["vlr_classe"]][$connectCallCenter->result["filtro_classe"]] = $connectCallCenter->result["desc_classe"];
  } while($connectCallCenter->getFetchAssoc());
} else {
  print "<br><center><font class='txtvermelho'><strong>PARAMETRO DA CLASSE ".$classe_TLRE7." NÃO ENCONTRADO FAVOR CONTATAR O SAC DA URANET</strong></font></center>";
  exit;
}

/*TABELA PRINCIPAL*/


$tabela_cabecalho .= "<div class='panel plain' >";
$tabela_cabecalho .= "<div class='panel-heading'>";
$tabela_cabecalho .= "  <div class='col-xs-12 text-right'>";
$tabela_cabecalho .= "    <i class='icon20 i-print cursor-pointer' title='Clique para Imprimir o Relatório'              onClick=\"javascript: imprimir_div('tbListaCabecalho');\"></i>";

// Lucas Genari - Botão antigo de impressão: $tabela_cabecalho .= "              <i class='icon20 i-print       dark cursor-pointer' title='Clique para Imprimir o Relatório' onClick=\"javascript: imprimeRelatorio('imprime');\"></i>";
//SU 101318
if(strpos(mb_strtoupper($session["representante"]), "BMG") === false || (strpos(mb_strtoupper($session["representante"]), "BMG") !== false && mb_strtoupper($session["tp_user"]) != 'VDA' && mb_strtoupper($session["tp_user"]) != 'SUP')){
  $tabela_cabecalho .= "    <i class='icon20  i-file-excel dark cursor-pointer' title='Clique para Exportar o Relatório para o Excel' onClick=\"javascript: exportarParaExcel('tbListaCabecalho');\"  ></i>";
}

$tabela_cabecalho .= "    <div class='fright'>";
$tabela_cabecalho .= "      <label>";
$tabela_cabecalho .= "        <i class='icon16 i-search-3' title='Buscar'></i>";
$tabela_cabecalho .= "        <input type='text' name='filtro_1' class='input_quicksearch' data-table='tbListaCabecalho' value=''>";
$tabela_cabecalho .= "      </label>";
$tabela_cabecalho .= "    </div>";
$tabela_cabecalho .= "  </div>";
$tabela_cabecalho .= "</div>";
$tabela_cabecalho .= "<div class='panel-body'>";
$tabela_cabecalho .= "      <div class=''>";
$tabela_cabecalho .= "<table class='table table-bordered table-small table-responsive' border='1' style='font-size:11px;' id='tbListaCabecalho'>";
$tabela_cabecalho .= "<thead>";
$tabela_cabecalho .=  "<tr>";

$colspan_total = 0;

if ($isPermiteAlterar) {
  $tabela_cabecalho.="<th>Alterar</th>";
  $colspan_total++;
}

if (is_array($matriz_titulo_det)) {
  foreach($matriz_titulo_det as $indice => $valores) {
    if(is_array($valores)) {
      foreach($valores as $filtro_classe => $valor) {

        if($detect->isMobile() === true) {
          if($filtro_classe != '71'){
            continue;
          }
        }

        $arr_titulo_det = explode("¢",$valor);

        if($arr_titulo_det[3] == 'abreFichaPMO' && $deonde != 'MK_HIST_CLIENTE') {
          continue;
        }

        if ($arr_titulo_det[4]) {
          if ((strpos("xxx".$arr_titulo_det[4], "cod_recusa") > 0) || (strpos($arr_titulo_det[5], "lead_nb") !== false)) {
            $campos_banco_dados .= $arr_titulo_det[4].",".$arr_titulo_det[5].",";
          } else {
            if ($arr_titulo_det[4] == "cod_recusa_ant") {
              $campos_banco_dados .= $arr_titulo_det[4].",classe_recusa_ant,";
            } else {
              $campos_banco_dados .= $arr_titulo_det[4].",";
            }
          }
        }

        if (strtoupper($arr_titulo_det[3]) == "MONTAFLUXOSAGESTAO") {
          $tabela_cabecalho.= montaFluxoSAGestao("", substr($discador_modelo,2,2), $repre, "TITULO", $valor, "");
          continue;
        }

        $tabela_cabecalho.= "<th estilo='background: ".$session["td_destaque"]."'><span estilo='color: white'>".$arr_titulo_det[0]."</span></th>";
        $colspan_total++;
      }
    }
  }
}


if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  if ($param_disk_power_ficha == "S" || $param_disk_power_lista == "S" || $arrParamTemp["tipo_discador"] == "PREDICTIVE") {
    $tabela_cabecalho.= "<th>Oco. Telefônicas</th>";
  }
}


$tabela_cabecalho.=  "</tr>";
$tabela_cabecalho.=  "</thead>";

if ($session["print_sql"] != "N") {
    ?>
    <font class="txt5"><?print MontaDescTitulo($classe_TLRE7,$repre);?>:</font>
    <img align="absmiddle" vspace="0" src="imagens/ico_classe.gif" width="15px" style="cursor:pointer;cursor:pointer" onClick="abrePopUpModal('Detalhe','cc_classe_pesquisa_altera_inclui.php?tipo_popup=AJ2&consistencia2_inclui=simples&botao=recusa&classe=<?print $classe_TLRE7;?>&repre=<?print $repre;?>&acesso=A&desc_classe_titulo=<?print MontaDescTitulo($classe_TLRE7,$repre);?>', 'janelaLupa', 650, 350,'Mostra Classe')">
    <?
}

if (($equipe) && ($equipe != "TODAS")) {
  if(mb_strtoupper($tb_prop) == "TB_CF_CTR_FUNC") {
    $str_equipe = " AND responsavel = '".addslashes($equipe)."' ";
  } else {
    $str_equipe = " AND equipe = '".addslashes($equipe)."' ";
  }
}

if (substr($repre,0,5) == "TELEF" && !strpos($repre,"INB") && !strpos("***".$tb_prop,"tb_protocolo_unico")) {
  require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/Virla_G_Funcoes_v2.php");

  $ano_envia = $anofim;

  if(!$anofim) {
    $ano_envia = $ano;
  }

  $arrayDadosTabela = explode("_",$tb_hist);
  $arrayTabelas = getTabelasCONS($arrayDadosTabela[2],"N",$ano_envia,$arrParamTemp);

  if(is_array($arrayTabelas)){

    $tb_prop  = $arrayTabelas["proposta"];
    $tb_hist  = $arrayTabelas["historico"];
  }
}

if($session['operador'] == "re015863") {
  print "TB_PROP :$tb_prop: ";
}

//if a ser extinto

if (strtoUPPER($empresa) != "TELEF_ATBLC" || strtoUPPER($empresa) == "TELEF_RCBLC"  || strtoUPPER($empresa) == "TELEF_ATATR"   || strtoUPPER($empresa) == "TELEF_RCATR" ) {
  $x=0;

  if (substr($busca_dia,0,7) == "DATADIA") {
    $array_dia_aux = explode("(",$busca_dia);
    $data_filtro = substr($array_dia_aux[1],0,-1);
  } else {
    $data_filtro = $busca_dia;
  }
  //$hora_filtro = str_replace("data","hora",$busca_dia);
  if (((strpos("xx".$tipo_classe_discador, "mailing") > 0)) || ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0))) {
    if (substr($include_dados,0,3) != "nc_" ) {
      $tit_tb   = "AGENTE";
      $campo_bd = "login_operador";
      $funcao   = "NomeResumido";
    } else {
      include_once "funcoes/NCFuncoes.php";
      $tit_tb   = "VENDEDOR";
      $campo_bd = "vend_login";
      $funcao   = "NomeVendedor";
    }
    if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
      if ($bd_atv != $bd && substr($repre,0,3) != "BMG") {
        $connectTel = $connectAtv;
      }
      if ($tipo_data_campo == "try" || $tipo_data_campo == "tre" || $tipo_data_campo == "trc") {
        //print "------------".$tipo_data_campo;
      }       if ($data_filtro == "SEMDATA" || $data_filtro == "SEMDATASTATUS") {
        $data_filtro = " ";
      } else {
        $data_filtro = $data_filtro." , ";
      }

      if (($tipo_data_campo != "st_venda_cartao") && ($cols_det[0] != "st_venda_cartao")) {
      } else {
        if ($cols_det[0] == "st_venda_cartao") {
          $where_st_venda_mailing = "AND st_venda_cartao = '".addslashes($$nome_var)."'";
        }
        if ($tipo_data_campo == "st_venda_cartao")
        {
          $where_st_venda_mailing = "AND st_venda_cartao = '".addslashes($item_col)."'";
        }
      }

      if (($tb_atv != $tb_prop) || ($tipo_classe_discador == "mailing")) {
        $str_try = ", (try_1 + try_2 + try_3 + try_4 + try_5 + try_6 + try_7 + try_8 + try_9) as try_geral";
      }

      if($tipo_data_campo == "try" || $tipo_data_campo == "tre" || $tipo_data_campo == "trc") {
        $str_try = ", (".$tipo_data_campo."_1 + ".$tipo_data_campo."_2 + ".$tipo_data_campo."_3 + ".$tipo_data_campo."_4 + ".$tipo_data_campo."_5 + ".$tipo_data_campo."_6 + ".$tipo_data_campo."_7 + ".$tipo_data_campo."_8 + ".$tipo_data_campo."_9) as ".$tipo_data_campo."_geral";
      }

      if (!is_array($array_dia)) {
        if ($campanha != "TODOS") {
          $where_campanha_aux = " AND campanha = '".addslashes($campanha)."' ";
        }
      } else {
        $where_campanha_aux = "";
      }

      if($where_campanha) {
        $where_campanha_data = $where_campanha." ".str_replace("AND","",$where_data);
      } else {
        $where_campanha_data = substr(trim($where_data),3);
      }

//      $where_virgem = " OR (st_venda_cartao = '0' AND login_operador = '0' AND hora_agenda = '00:00:00' AND data_atualiza = '1111-11-11' )";

      if ($busca_dia != "SEMDATA" && $param_sem_ano_mes != "sem_ano_mes" && $busca_dia != "SEMDATASTATUS" && strpos("A".$busca_dia,"sa") == 0 && strpos("A".$busca_dia,"robo") == 0 && ($com_ano_mes== "S" || $com_ano_mes=="")) {
        $where_ano_mes  = " AND ano_mes = '".$ano.$mes."' ";
      }

      if (strpos("a".$rel_where_aux,"'") > 0) {

        if (substr($discador_modelo, 2, 4) == 'K0' && $campo_cons != "") {
          $rel_where_aux = "";
        }

        $q = "SELECT  ".$seq_tabela." as num_prop, ".$campo_campanha.",".$campo_st_venda_cartao.",".$campo_id_lig.",".$campo_bd.",".$data_filtro." ".$hora_filtro." ".substr(trim($campos_banco_dados),0,-1)." ".$str_try.$campos_select_envia.",grupo,campo_chave FROM ".$tb_atv." ".str_replace("WHERE", "WHERE (", $where)." ".$rel_where_aux." ".$where_sta." ".$where_ano_mes." ".$where_hora." ".$where_campanha_aux." ".$where_var_sum_count." ".$where_st_venda_mailing.$where_operador_performance.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1." {$str_equipe})".$where_virgem;

        $q_para_count_prop = "SELECT COUNT(*) AS qtd FROM ".$tb_atv." ".str_replace("WHERE", "WHERE (", $where)." ".$rel_where_aux." ".$where_ano_mes." ".$where_hora." ".$where_campanha_aux." ".$where_var_sum_count." ".$where_st_venda_mailing.$where_operador_performance.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1." {$str_equipe})".$where_virgem;
        $q_paginador_prop  = $q;
      } else {
        $q = "SELECT ".$seq_tabela." as num_prop, ".$campo_campanha.",".$campo_st_venda_cartao.",".$campo_id_lig.",".$campo_bd.",".$data_filtro." ".$hora_filtro." ".substr(trim($campos_banco_dados),0,-1)." ".$str_try.$campos_select_envia.",grupo,campo_chave FROM ".$tb_atv." ".str_replace("WHERE", "WHERE (", $where)." ".$where_hora." ".$where_sta." ".$where_ano_mes." ".$where_campanha_aux." ".$where_var_sum_count." ".$where_st_venda_mailing.$where_operador_performance.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1." {$str_equipe})".$where_virgem;

        $q_para_count_prop = "SELECT COUNT(*) AS qtd FROM ".$tb_atv." ".str_replace("WHERE", "WHERE (", $where)." ".$where_ano_mes." ".$where_hora." ".$where_campanha_aux." ".$where_var_sum_count." ".$where_st_venda_mailing.$where_operador_performance.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1." {$str_equipe})".$where_virgem;
        $q_paginador_prop  = $q;
      }
    }



    /*********************************************************************************************/
    /* INICIALIZANDO VARIAVEIS PARA SELECT COM JOIN
    /*********************************************************************************************/
    elseif ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0)) {

      $mtr_tipdata_aux = explode("¢",$relatorio);

      if (is_array($mtr_tipdata_aux)) {
        foreach ($mtr_tipdata_aux as $key => $value) {
          $aux = explode("-",$value);
          $mtr_tipdata[$key] = $aux[0];
        }
      }
      $mtr_coluna_aux = explode("§",$tipo_data);
      $mtr_coluna = explode("-",$mtr_coluna_aux[0]);

      if (strpos($tipo_data_spl[0],"hora") > 0) {
        //      print "hora";
        $where_hora = " AND ".$tipo_data_spl[0]." = ".$item_col;
      }
      /***************************************************************************************************/
      /* Essa parte é a onde concatenamos o 'oco' no join que será feito (evitar problema de ambiguidade)
      /* Esta dentro de um if porque nem sempre vai ter esse problema
      /***************************************************************************************************/
      $tabela        = ValorClasse("DK".$discador_modelo_rel."A", "tabela", $repre);

      $where_dicador  = " oco.nro_discador = '".addslashes($discador_modelo_rel)."' ".$where_outros;
      if($campanha == "TODOS") {
//        $where_campanha = " AND oco.campanha = tab.campanha ";
      } else {
        $where_campanha = " AND oco.campanha = '".addslashes($campanha)."' ";
      }

      if (($mtr_coluna[0] != "diario") && ($mtr_coluna[0] != "diario_2_meses") && ($mtr_coluna[0] != "mensal")) {

        if ($mtr_coluna[0] == "campanha") {
          $where_coluna   = " AND tab.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "login_operador") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "equipe") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "st_venda_cartao") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "cod_recusa") {
          $mtr_coluna[0] = "classe_recusa";
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "vend_regional") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "vend_eps") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }elseif ($mtr_coluna[0] == "campo_chave") {
          $where_coluna   = " AND oco.".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }else {
          $where_coluna   = " AND ".$mtr_coluna[0]." = '".addslashes($item_col)."' ";
        }
      }

      if ($busca_dia == "SEMDATA" || $busca_dia == "SEMDATASTATUS") {
        $where_datas    = "";
      } else {
        $where_datas    = " AND oco.ano_mes = '".$ano.$mes."' AND oco.data BETWEEN '".$data_ini."' AND '".$data_fim."' ";
      }

      $where_tipodata = "";

      //VERIFICA SE O PARAMETRO VEIO COM '-', SE VIER, REPRESENTA QUE ELE VEIO NO FORMATO DESCRIÇÃO-VALOR
      if (
      ($mtr_tipdata[0] != "equipe" && strpos("xxx".$mtr_tipdata[0], "data") <=0 && strpos("xxx".$mtr_tipdata[0], "representante") <=0) &&
      ($mtr_tipdata[1] != "equipe" && strpos("xxx".$mtr_tipdata[1], "data") <=0 && strpos("xxx".$mtr_tipdata[1], "representante") <=0) &&
      ($mtr_tipdata[2] != "equipe" && strpos("xxx".$mtr_tipdata[2], "data") <=0 && strpos("xxx".$mtr_tipdata[2], "representante") <=0)
      ) {
        $aux_parm1 = explode("-",$parm_0);
        $aux_parm2 = explode("-",$parm_1);
        if ($aux_parm1[1]) {
          $parm_0 = $aux_parm1[1];
        }
        if ($aux_parm2[1]) {
          $parm_1 = $aux_parm2[1];
        }
      }

      /***************************************************************************************************/
      /* Essa parte é a onde concatenamos o 'oco' no join que será feito (evitar problema de ambiguidade)
      /* Esta dentro de um if porque nem sempre vai ter esse problema
      /***************************************************************************************************/
      if (is_array($mtr_tipdata)) {
        foreach ($mtr_tipdata as $key => $value) {
          $aux = explode("§",$mtr_tipdata[$key]);
          $mtr_tipdata[$key] = $aux[0];
        }
      }

      if (($mtr_tipdata[0] == "login_operador") || ($mtr_tipdata[0] == "equipe") || ($mtr_tipdata[0] == "st_venda_cartao") || ($mtr_tipdata[0] == "cod_recusa") || ($mtr_tipdata[0] == "vend_regional") || ($mtr_tipdata[0] == "vend_eps") || ($mtr_tipdata[0] == "campo_chave")) {
        $mtr_tipdata[0] = "oco.".$mtr_tipdata[0];
      }
      if (($mtr_tipdata[1] == "login_operador") || ($mtr_tipdata[0] == "equipe") || ($mtr_tipdata[1] == "st_venda_cartao") || ($mtr_tipdata[1] == "cod_recusa") || ($mtr_tipdata[1] == "vend_regional") || ($mtr_tipdata[1] == "vend_eps") || ($mtr_tipdata[0] == "campo_chave")) {
        $mtr_tipdata[1] = "oco.".$mtr_tipdata[1];
      }

      if($mtr_tipdata[0] == "oco.cod_recusa") {
        list($classe_recusa_where, $cod_recusa_where) = explode("¢", $parm_0);
        //$where_tipdata = " AND oco.classe_recusa = '".$classe_recusa_where."' AND ".$mtr_tipdata[0]." = '".$cod_recusa_where."' ";
        $where_tipdata = " AND oco.classe_recusa = '".addslashes($classe_recusa2)."' AND ".$mtr_tipdata[0]." = '".addslashes($parm_0)."' ";
      } else {
        $where_tipdata = " AND ".$mtr_tipdata[0]." = '".addslashes($parm_0)."' ";
      }

      if ($parm_1) {
        if($mtr_tipdata[1] == "oco.cod_recusa") {
          list($classe_recusa_where, $cod_recusa_where) = explode("¢", $parm_1);
          //$where_tipdata .= " AND oco.classe_recusa = '".$classe_recusa_where."' AND ".$mtr_tipdata[1]." = '".$cod_recusa_where."' ";
          $where_tipdata = " AND oco.classe_recusa = '".addslashes($classe_recusa2)."' AND ".$mtr_tipdata[1]." = '".addslashes($parm_1)."' ";
        } else {
          $where_tipdata .= " AND ".$mtr_tipdata[1]." = '".addslashes($parm_1)."' ";
        }
      }

      if (!$where_campanha2) {
        $where_campanha2 = $where_campanha;
      }

      /***************************************************************************************/
      /* concatenação de string a ser executada
      /***************************************************************************************/
      $where = $where_dicador.$where_campanha.$where_operador.$where_tipdata.$where_dia.$where_coluna.$where_datas.$where_hora;
      $where.= str_replace("and ", " and oco.", $where_cpf);

      /***************************************************************************************/
      $q = "SELECT oco.id_lig".$campo_tempo.", oco.bina, oco.login_operador AS login, oco.tempo_tot_lig AS tempo_tot_lig, tab.nome_razao, tab.cpf_cnpj, tab.campo_chave, oco.data, oco.hora, oco.classe_recusa, oco.cod_recusa FROM ".$tb_oco." oco LEFT JOIN ".$tabela." tab ON oco.seq = tab.seq WHERE ".$where.$where_operador_performance." ".$w_add1." ORDER BY oco.data, oco.hora";
      $q_para_count_prop = "SELECT  count(*) as qtd FROM ".$tb_oco." as oco LEFT JOIN ".$tabela." tab ON oco.seq = tab.seq WHERE ".$where.$where_operador_performance." ".$w_add1." ORDER BY oco.data, oco.hora";
      $q_paginador_prop  = $q;
    }
  } else {

    if (($busca_dia != "data_atualiza_robo") &&($busca_dia != "bo_data") && (!$campo_cons) && ($com_ano_mes == "S" || $com_ano_mes == "")) {

      if ($val_ano_mes) {
        if ($val_ano_mes != "tirar") {
          $where_anomes = " AND ".$val_ano_mes." = '".$ano.$mes."'";
        } else {
          if ($tipo_data == "tot_mes") {
            $where_anomes = " AND ".$val_ano_mes." BETWEEN '".$ano."-".$mes."-01' AND '".$ano."-".$mes."-31'";
          }
        }
      } else {
        $where_anomes = " AND ano_mes =  '".$ano.$mes."'";
      }

    }

    if ($data_filtro == "SEMDATA" || $data_filtro == "SEMDATASTATUS") {
      $data_filtro  = " ";
      $where_anomes = " ";
    } else {
      $data_filtro = $data_filtro." , ";
    }
    if ($param_anual == "anual") {
      $data_filtro = " ";
    }

    if ($campo_cons != "") {
      $where_hora = "";
      $where_anomes = "";
    }
    /**********************************************************/
    /* rotina filtro ajax
    /**********************************************************/

    /*GAMBI ATENDEBEM*/
    if ((((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_porto_seguro") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_red_reformas") && ($tipo_data != "tot_mes"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads"  || $parm_busca_dia == "data_confirma" || $parm_busca_dia == "data_agenda") || $param_sem_ano_mes == "sem_ano_mes" ) {
      $where_anomes = "";
    }
    /**********************************************************************************************************/
    /**********************************************************************************************************/
    /*                           DEONDE MK_HIST_CLIENTE                                                       */
    /**********************************************************************************************************/
    /**********************************************************************************************************/
    $order_by_mk_hist_cliente = "";//colocado por marcelo 17/06/2009

    if ($deonde == "MK_HIST_CLIENTE") {
      $where = $where_envia;
      $order_by_mk_hist_cliente = $order_by_envia;
      $rel_where          = "";
      $where_hora         = "";
      $where_anomes       = "";
      $str_filtro         = "";
      $str_equipe         = "";
      $data_filtro        = "";
      $hora_filtro        = "";
      $campos_calc_prazo  = "";
    }

    /**********************************************************************************************************/
    /**********************************************************************************************************/
    /*                           DEONDE MK_HIST_CLIENTE                                                       */
    /**********************************************************************************************************/
    /**********************************************************************************************************/

    foreach ($matriz_titulo_det as $key => $value) {
      if(is_array($value)){
        foreach($value as $filtro_classe => $valor) {
          $aux_array = explode("¢",$valor);
          if (strlen($aux_array[5]) > 5) {
            $str_campo_classe = ",".$aux_array[5];
          }
        }
      }
    }

    if ($cmb_responsavel && $cmb_responsavel != "todos") {
      $where_responsavel = " AND responsavel = '".$cmb_responsavel."'";
    }

    if ($discador_modelo == "MDZ1") {
      $campos_imgPrazo = "status,data_ini_ativ,hora_ini_ativ,ativ_tempo_exec,ativ_tempo_max_exec,";
      $order_by_mk_hist_cliente = " ORDER BY data_cri DESC";
    }

    if ($discador_modelo == "MDZE") {
      $arr_classe_sa = getArrayClasse("tb_classe", ConnectDB(), "descricao", "SA".substr($discador_modelo,2,2)."T", $repre, "A", "ZZ");

      if (is_array($arr_classe_sa["itens"]) === true) {
        foreach ($arr_classe_sa["itens"] as $codigo => $valor) {
          $arr_sa[$valor["valor"]] = $valor["descricao"];
        }
      }
      $campos_banco_dados .= " atd_status, login_operador, data_cri, hora_cri, ";

      if (is_array($arr_sa) === true) {
        ksort($arr_sa);
        foreach ($arr_sa as $codigo => $valor) {

          if ($valor) {
            $campos_banco_dados .= $codigo."_status,".$codigo."_login,".$codigo."_data,".$codigo."_hora,";
          }
        }
      }
    }

    foreach($arrOperacoes as $kOpe => $vOpe) {

      if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO"){
        $tb_hist = $arrParamTemp["tabela_historico"];
        if((strpos("xx".$tipo_classe_discador, "reg_atd") > 0)) {
          $tb_prop = $arrParamTemp["tabela_reg_atd"];
        } else {
          $tb_prop = $arrParamTemp["tabela_proposta"];
        }
      }

      if(strtoupper(substr($tipo_classe_discador,0,2)) == "DX") {
        $tb_hist = $tb_prop;
      }

      if(substr($repre,0,5) == "TELEF") {
        //$tb_prop = $tb_hist;
      }

      if(strpos("***".$tb_prop_ant, "|".$tb_prop."|") < 1 || strpos("***".$tb_hist_ant, "|".$tb_hist."|") < 1) {
        $tb_hist_ant.= "|".$tb_hist."|";
        $tb_prop_ant.= "|".$tb_prop."|";

        $var_union = "";

        if($kOpe > 0) {
          $var_union = " UNION ";
        }

        if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
          $campo_classe_mkpro = ", classe_mkpro ";
        }

        if(strpos("a".$rel_where_aux,"'") > 0) {
          $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop, ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$campos_imgPrazo." ".$hora_filtro.$campos_banco_dados." ".$campo_st_venda_cartao."".$campo_status.$campos_calc_prazo.$str_campo_classe."".$status_mon.$campos_select_envia." ".$campo_classe_mkpro." FROM ".$tb_prop." ".$where." ".$rel_where_aux." ".$where_responsavel." and ".$where_status_t." ".$where_hora.$where_anomes.$where_sta.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$order_by_mk_hist_cliente.$order_by_pbc_vendas_publicos.$order_by_mk_hist_cliente." ".$w_add1;
          $q_para_count_prop = $q_para_count_prop.$var_union." SELECT COUNT(*) AS qtd FROM ".$tb_prop." ".$where." ".$rel_where_aux." ".$where_responsavel." and ".$where_status_t." ".$where_hora.$where_anomes.$where_sta.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$where_trava_permissao.$order_by_mk_hist_cliente." ".$w_add1;
          $q_paginador_prop  = $q;
        } else {
          $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop, ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$campos_imgPrazo." ".$hora_filtro.$campos_banco_dados." ".$campo_st_venda_cartao."".$campo_status.$campos_calc_prazo.$str_campo_classe."".$status_mon.$campos_select_envia." ".$campo_classe_mkpro." FROM ".$tb_prop." ".$where." ".$where_responsavel." and ".$where_status_t." ".$where_hora.$where_anomes.$where_sta.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$order_by_pbc_vendas_publicos.$order_by_mk_hist_cliente." ".$w_add1;
          $q_para_count_prop = $q_para_count_prop.$var_union." SELECT COUNT(*) AS qtd FROM ".$tb_prop." ".$where." ".$where_responsavel." and ".$where_status_t." ".$where_hora.$where_anomes.$where_sta.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_gambi_tracker.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$where_trava_permissao.$order_by_mk_hist_cliente." ".$w_add1;
          $q_paginador_prop  = $q;
        }
      }

    }

    if(trim(strtoupper(substr($q_paginador_prop,(strlen($q_paginador_prop)-6),6))) == "UNION") {
      $q_paginador_prop = substr($q_paginador_prop,0,(strlen($q_paginador_prop)-6));
    }

    if(trim(strtoupper(substr($q_para_count_prop,(strlen($q_para_count_prop)-6),6))) == "UNION") {
      $q_para_count_prop = substr($q_para_count_prop,0,(strlen($q_para_count_prop)-6));
    }

    $q           = "";
    $tb_hist_ant = "";
    $tb_prop_ant = "";
  }


  // /*************************************************************/
  /**GAMBI $parm_busca_dia = "his_data_env¢his_hora_env" **/
  /*************************************************************/
  if (substr($parm_busca_dia,0,12) != "his_data_env" || ($tb_hist == $tb_prop)) {
    if (strtoupper($session["print_sql"]) != "N") {
      print $q."<br>";
    }
  }

  /**********************************************************/
  //USA CLICK SIM OU NAO
  if (is_array($matriz_titulo_det)) {
    foreach ($matriz_titulo_det as $key => $value) {
      if(is_array($value)) {
        foreach($value as $filtro_classe => $valor){
          $aux = explode("§",$valor);

          if (($aux[1] == "N") || ((strpos("xxx".$_SERVER["PHP_SELF"], "mk_hist_cliente.php") > 0) && (substr($repre,0,8) == "DOCWORKS" || $repre == "XGMC-V") && ($session["tp_user"] == "OPE") )) {
            $aux_usaclick = $aux[1];
          }
        }
      }
    }
  }
  /*************************************************************/
  /**GAMBI $parm_busca_dia = "his_data_env¢his_hora_env" **/
  /*************************************************************/

  //*********************************************************************************************************/
  //FIM PROPOSTA
  //*********************************************************************************************************/


  //*********************************************************************************************************/
  //COMEÇO HISTÓRICO
  //*********************************************************************************************************/


  if (substr($busca_dia,0,7) == "DATADIA") {
    $array_dia_aux = explode("(",$busca_dia);
    $data_filtro = substr($array_dia_aux[1],0,-1);
  } else {
    $data_filtro = $busca_dia;
  }

  //$hora_filtro = str_replace("data","hora",$busca_dia);
  if ($data_filtro == "SEMDATA" || $data_filtro == "SEMDATASTATUS" ) {
    $data_filtro = " ";
  } else {
    $data_filtro = $data_filtro." , ";
  }

  if (strtoUPPER($empresa) == "TELEF_ATBLC" || strtoUPPER($empresa) == "TELEF_RCBLC"  ) {
    $q = "SELECT num_prop,".$campo_id_lig.",".$campo_campanha.",login_operador,bina_cliente, ".$data_filtro." ".$hora_filtro."solicitante_nome,ddd_tel,num_tel,".$campo_id_lig.",desc_produto,num_prop,nome_razao,cpf_cnpj FROM tb_blec_proposta ".$where." ".$where_hora.$where_operador_performance;
    $x=0;
  } else {
    if (strtoUPPER($empresa) == "TELEF_ATATR"   || strtoUPPER($empresa) == "TELEF_RCATR" ) {
      $q = "SELECT num_prop,".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)." FROM tb_atrium_proposta ".$where." ".$where_hora.$where_operador_performance;
      $x=0;
    } else {

      if ($bd_hist && $bd_hist == "bd_sbt_consorcio" && strpos(" ",$parm_busca_dia,"sa")==0 && ($com_ano_mes=="S" || $com_ano_mes == "")) {
        $where_anomes = " AND ano_mes =  '".$ano.$mes."'";

        if ($campo_cons != "") {
          $where_hora = "";
          $where_anomes = "";
        }

        $q = "SELECT num_prop,".$campo_id_lig.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)." FROM ".$tb_hist." ".$where." ".$rel_where_aux." ".$where_hora.$where_anomes.$where_operador_performance;
        $q = str_replace("data_venda"       ,"dtvenda"    , $q);
        $q = str_replace("data_criacao"     ,"datacriacao", $q);
        $q = str_replace("data_cri"         ,"datacriacao", $q);
        $q = str_replace("hora_cri"         ,"horacriacao", $q);
        $q = str_replace("desc_produto"     ,"descproduto", $q);
        $q = str_replace("cod_produto"      ,"codproduto" , $q);
        $q = str_replace("num_prop"         ,"nroproposta", $q);
        $q = str_replace("nome_razao"       ,"nome"       , $q);
        $q = str_replace("cpf_cnpj"         ,"cpfcnpj"    , $q);
        $q = str_replace("ddd_tel"          ,"r_ddd"      , $q);
        $q = str_replace("num_tel"          ,"r_telefone" , $q);
        $q = str_replace("solicitante_nome,",""           , $q);
        $q = str_replace("bairro"           ,"e_bairro"   , $q);
        $q = str_replace("cidade"           ,"e_cidade"   , $q);
        $q = str_replace("uf"               ,"e_uf"       , $q);
        $q = str_replace("desc_produto"     ,"descproduto", $q);
        $q = str_replace("data_1_pagto"     ,"dtpagto"    , $q);
        $q = str_replace("data_pagto"       ,"dtpagto"    , $q);
        $q = str_replace("rg_uf"            ,"rguf"       , $q);
        $q = str_replace("rg_e_uf"          ,"rguf"       , $q);
        $q = str_replace("hora_venda"       ,"hrvenda"    , $q);
        //$q = str_replace("uf_regiao","e_uf_regiao", $q);

      } else {
        //            print "<BR>***********************<BR>";
        //            print "WHERE".$where."<BR>";
        //            print "RELWHERE".$rel_where;
        //            print "<BR>***********************<BR>";


        //        if ($campo_cons != "") {
        //          $where_hora = "";
        //          $where_anomes = "";
        //        }
        //         print $campo_cons."******";
        //        print $session["operador"];

        if (
        ($busca_dia != "bo_data") &&
        ($campo_cons == "") &&
        ($cpf_cnpj == "") &&
        ($busca_dia != "SEMDATA") &&
        ($busca_dia != "SEMDATASTATUS") &&
        //               (strpos(" ",$parm_busca_dia,"sa")==0) && correção para o novo php estava apresentando Warning
        (strpos(" ".$parm_busca_dia,"sa")==0) &&
        (($com_ano_mes == "S" || $com_ano_mes = "" || $where_hora))
        ) {
          if ($val_ano_mes) {
            if ($val_ano_mes != "tirar") {
              $where_anomes = " AND ".$val_ano_mes." = '".$ano.$mes."'";
            } else {
              if ($tipo_data == "tot_mes") {
                $where_anomes = " AND ".$val_ano_mes." BETWEEN '".$ano."-".$mes."-01' AND '".$ano."-".$mes."-31'";
              }
            }
          } else {
            $where_anomes = " AND ano_mes =  '".$ano.$mes."'";
          }
        } else {
          $where_anomes = " ";
          $where_hora   = "";
        }

        //        showvars();

        /**********************************************************************************************************/
        /**********************************************************************************************************/
        /*                           DEONDE MK_HIST_CLIENTE                                                       */
        /**********************************************************************************************************/
        /**********************************************************************************************************/
        if ($deonde == "MK_HIST_CLIENTE") {
          $where = $where_envia;
          $rel_where          = "";
          $where_hora         = "";
          $where_anomes       = "";
          $str_filtro         = "";
          $str_equipe         = "";
          $data_filtro        = "";
          $hora_filtro        = "";
          $campos_calc_prazo  = "";
        }
        /**********************************************************************************************************/
        /**********************************************************************************************************/
        /*                           DEONDE MK_HIST_CLIENTE                                                       */
        /**********************************************************************************************************/
        /**********************************************************************************************************/

        // tem grupo de status para fazer in
        //            if (strpos($where_sta,",") == 0) {
        //              $where_sta = "";
        //            }
        /*GAMBI ATENDEBEM*/
        //            if ($session["print_sql"] != "N") {
        //              print $parm_busca_dia;
        //            }

        if ($discador_modelo == "MDZ1") {
          $order_by_envia_srh = " Order by data_cri DESC";
        }

        if ($discador_modelo == "MDSY") {
          $order_by_envia_srh = " Order by data_entrada DESC";
        }

        if ($param_sem_ano_mes == "sem_ano_mes") {
          $where_anomes = "";
        }

        // removendo o ano_mes quando não tiver data_cri no where
        if ((strpos("a".$where,"data_cri") <= 0) && (strpos("a".$where,"data_venda") <= 0)) {
          $where_anomes = "";
        }
        foreach($arrOperacoes as $kOpe => $vOpe) {

          if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO"){
            $tb_hist = ValorClasse($vOpe."A", "tabela_historico", $repre_backup_mk);
            if((strpos("xx".$tipo_classe_discador, "reg_atd") > 0)) {
              $tb_prop = ValorClasse($vOpe."A", "tabela_reg_atd",  $repre_backup_mk);
            } else {
              $tb_prop = ValorClasse($vOpe."A", "tabela_proposta",  $repre_backup_mk);
            }
          }

          if(strtoupper(substr($tipo_classe_discador,0,2)) == "DX") {
            $tb_hist = $tb_prop;
          }

          if(substr($repre,0,5) == "TELEF") {
            //$tb_prop = $tb_hist;
          }

          if(strpos("***".$tb_prop_ant, "|".$tb_prop."|") < 1 || strpos("***".$tb_hist_ant, "|".$tb_hist."|") < 1) {
            $tb_hist_ant.= "|".$tb_hist."|";
            $tb_prop_ant.= "|".$tb_prop."|";

            $var_union = "";

            if($kOpe > 0) {
              $var_union = " UNION ";
            }

            if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
              $campo_classe_mkpro = ", classe_mkpro ";
            }

            //var_dump(strpos("a".$rel_where,"'") > 0);
            if(strpos("a".$rel_where_aux,"'") > 0) {
              if(((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_red_reformas") && ($tipo_data != "tot_mes"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads") {
                $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop, ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)."".$campos_calc_prazo.",".$campo_st_venda_cartao."".$campo_status.$str_campo_classe."".$status_mon." ".$campo_classe_mkpro." FROM ".$tb_hist." ".$where." ".$rel_where_aux." ".$where_sta.$where_hora.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
                $q_para_count_hist = $q_para_count_hist.$var_union." SELECT count(*) as qtd FROM ".$tb_hist." ".$where." ".$rel_where_aux." ".$where_sta.$where_hora.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
              } else {
                $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop, ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)."".$campos_calc_prazo.",".$campo_st_venda_cartao."".$campo_status.$str_campo_classe."".$status_mon." ".$campo_classe_mkpro." FROM ".$tb_hist." ".$where." ".$rel_where_aux." ".$where_sta.$where_hora.$where_anomes.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
                $q_para_count_hist = $q_para_count_hist.$var_union." SELECT count(*) as qtd FROM ".$tb_hist." ".$where." ".$rel_where_aux." ".$where_sta.$where_hora.$where_anomes.$str_filtro.$str_equipe.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
              }
            } else {
              if(((($arrParamTemp["bd"] == "bd_atendebem") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_ace") && ($tipo_data != "tot_mes§Mensal")) || (($arrParamTemp["bd"] == "bd_pan_vd") && ($tipo_data != "tot_mes§Mensal"))) || (strpos("A".$parm_busca_dia,"sa") > 0) || $parm_busca_dia == "data_leads") {
                $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop, ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)."".$campos_calc_prazo.",".$campo_st_venda_cartao."".$campo_status.$str_campo_classe."".$status_mon." ".$campo_classe_mkpro." FROM ".$tb_hist." ".$where." ".$where_sta.$where_hora.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
                $q_para_count_hist = $q_para_count_hist.$var_union." SELECT count(*) as qtd FROM ".$tb_hist." ".$where." ".$where_sta.$where_hora.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao." ".$w_add1;
              } else {
                $q                 = $q.$var_union." SELECT ".$seq_tabela." AS num_prop,  ".$campo_id_lig.",".$campo_campanha.",".$data_filtro." ".$hora_filtro." ".substr($campos_banco_dados,0,-1)."".$campos_calc_prazo.",".$campo_st_venda_cartao."".$campo_status.$str_campo_classe."".$status_mon." ".$campo_classe_mkpro." FROM ".$tb_hist." ".$where." ".$where_sta.$where_hora.$where_anomes.$str_filtro.$str_equipe.$where_operador_performance.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$order_by_envia_srh." ".$w_add1;
                $q_para_count_hist = $q_para_count_hist.$var_union." SELECT count(*) as qtd FROM ".$tb_hist." ".$where." ".$where_sta.$where_hora.$where_anomes.$str_filtro.$str_equipe.$where_responsavel_SRH.$where_tp_user_SRH.$where_var_sum_count.$where_filtro_add.$where_adicional_TLREB.$where_trava_permissao.$where_trava_permissao." ".$w_add1;
              }
            }
          }
        }

        if(trim(strtoupper(substr($q_para_count_hist,(strlen($q_para_count_hist)-6),6))) == "UNION") {
          $q_para_count_hist = substr($q_para_count_hist,0,(strlen($q_para_count_hist)-6));
        }

        $tb_hist_ant = "";
        $tb_prop_ant = "";
      }
    }

  }


$replaceStVenda11 = getArrayClasse("tb_classe", $connectCallCenter, "descricao", $classe_TLREB, $repre, "A", " AND vlr_classe = 'ST_VENDA_AGENDA_MAILING' ");
if($replaceStVenda11["itens"]["0"]["descricao"] == "S"){

  $q                 = str_replace("st_venda_cartao = '0'", " st_venda_cartao = '0' and data_agenda = '1111-11-11' ", $q);
  $q_para_count_prop = str_replace("st_venda_cartao = '0'", " st_venda_cartao = '0' and data_agenda = '1111-11-11' ", $q_para_count_prop);
  $q_paginador_prop  = str_replace("st_venda_cartao = '0'", " st_venda_cartao = '0' and data_agenda = '1111-11-11' ", $q_paginador_prop);

  $q                 = str_replace("st_venda_cartao = '11'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl not like 'disc%' ", $q);
  $q_para_count_prop = str_replace("st_venda_cartao = '11'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl not like 'disc%' ", $q_para_count_prop);
  $q_paginador_prop  = str_replace("st_venda_cartao = '11'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl not like 'disc%' ", $q_paginador_prop);

  $q                 = str_replace("st_venda_cartao = '12'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl like 'disc%' ", $q);
  $q_para_count_prop = str_replace("st_venda_cartao = '12'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl like 'disc%' ", $q_para_count_prop);
  $q_paginador_prop  = str_replace("st_venda_cartao = '12'", " st_venda_cartao = '0' and data_agenda <> '1111-11-11' and operador_incompl like 'disc%' ", $q_paginador_prop);

}


  if (strtoupper($session["print_sql"]) != "N") {
    print $q."<br>";
  }


  $q_paginador_hist = $q;
  // print $q;
  //    $q     = DescExecQuery($q, $session["operador"], $PHP_SELF);




  if ($imprimiu_cabecalho != 1) {
    $mostra_select_historico = $session["print_sql"];
  } else {
    $mostra_select_historico = "N";
  }

  //*********************************************************************************************************/
  //FIM HISTÓRICO
  //*********************************************************************************************************/

  // print "-----------------".$q_paginador_prop."-------------";
  // print "-----------------".$q_paginador_hist."-------------";

  //*********************************************************************************************************/
  //*********************************************************************************************************/
  /** PARTE MUITO IMPORTANTE! GERA OS RESULT SETS
//*********************************************************************************************************/
  //*********************************************************************************************************/
  if (((strpos("xx".$tipo_classe_discador, "mailing") > 0)) || ((strpos("xx".$tipo_classe_discador, "oco_telefonica") > 0)) || ((strpos("xx".$tipo_classe_discador, "reg_atd") > 0))) {
    $mostra_hist == "N";
  }
  if ($mostra_hist == "N") {
    $q_paginador_hist  = "";
    $q_para_count_hist = "";
  }

  if($_REQUEST["discador_modelo"] == 'DKK0' && $_REQUEST["tipo_classe_discador"] == 'mailing' && $_REQUEST["repre"] == 'BMG-LOJA'){
    $where_camp_ativo = "AND relatorio = 'S'";

    // if(strpos($q, "st_venda_cartao = '0'")){
    //   $where_camp_ativo .= " AND data_agenda = '1111-11-11'";
    // }

    $q_para_count_prop .= $where_camp_ativo;

    $q = str_replace("SELECT seq", $where_camp_ativo." SELECT seq ", $q);
    // print $q;
  }

  // if($_REQUEST["discador_modelo"] == 'DKK0' && strpos($q, "st_venda_cartao = '0'")){
  //   $q_para_count_prop.= " AND data_agenda = '1111-11-11'";
  // }

  // print $q_para_count_prop."<----------";

  if($q_para_count_prop) {
    $q_para_count_prop_union = "SELECT sum(qtd) as qtd FROM(".$q_para_count_prop.") tb_union";//REMOVIDO ATRAVÉS DO PEDIDO DO CALDI SU 56154
    $q_para_count_prop_union = $q_para_count_prop;
  }


  if($q_para_count_hist) {
    $q_para_count_hist_union = "SELECT sum(qtd) as qtd FROM(".$q_para_count_hist.") tb_union";//REMOVIDO ATRAVÉS DO PEDIDO DO CALDI SU 56154
    $q_para_count_hist_union = $q_para_count_hist;
  }

  $array_aux = paginadorDuplo($q_paginador_prop, $q_para_count_prop_union, $q_paginador_hist, $q_para_count_hist_union);

   /*if(strtoupper($session["operador"]) == "RE000064" || strtoupper($session["operador"]) == "ADM"){
     print "<pre>";
     print_r($array_aux);
     print "</pre>";
   }*/

  if ($tipo_visao_combo) {
    $option_TLREK = MontaCombo($classe_TLREK, $tipo_visao_combo, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor),"A",$where_cond_classe);
    $titclasselista = $titClasse;

    /*************************************************************/
    $connectCallCenter->query("SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE '".$classe_TLREK."' AND representante = '".retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor)."' AND tipo_reg = 'I' ".$where_cond_classe);
    if($connectCallCenter->count > 0) {
      do{
        $arr_radios[$connectCallCenter->result["vlr_classe"]] = $connectCallCenter->result["desc_classe"];
      } while($connectCallCenter->getFetchAssoc());
    }
    /*************************************************************/
?>

<script language="javascript">
function mudaValorQueryString(querystring,campo,valor) {
  var retorno;
  retorno = '';
  array_querystring = querystring.split("&");
  for (var i in array_querystring) {
    aux_array_reparte = array_querystring[i].split("=");
    if (aux_array_reparte[0] == campo) {
      aux_array_reparte[1] = valor;
    }
    retorno += aux_array_reparte[0]+'='+aux_array_reparte[1]+'&';
  }
  retorno = retorno.substring(0,retorno.length - 1);
  return retorno;
}
</script>


<table class="table">
  <tr>
    <td class="txt5" align="center">
      <strong><?print $titclasselista;?>:</strong>
      <?
      if (is_array($arr_radios)) {
        foreach ($arr_radios as $key => $value) {
          ?>
            <input type="radio" value="<?print $key?>" name="tipo_visao_combo" <?if ($tipo_visao_combo == $key) {print "checked";}?> onclick="javascript: window.location = 'cc_gestao_vendas_lista.php?tipo_popup=AJ2&'+mudaValorQueryString('<?print addslashes($_SERVER['QUERY_STRING']);?>','tipo_visao_combo',this.value);"><?print $value;?>
          <?
        }
      }
      ?>
    </td>
  </tr>

</table>
<?
  }

  if ($tipo_visao_combo) {
    $option_TLREK = MontaCombo($classe_TLREK, $tipo_visao_combo, retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor),"A",$where_cond_classe);
    $titclasselista = $titClasse;
  }



  if ($deonde == "MK_HIST_CLIENTE") {
    if ($historico_usa_paginador_duplo == "sim") {
      if ($array_aux["query1"]) {
        $conAuxName1 = "connectTel";
        $queryAux1   = $array_aux["query1"];
      }
      if ($array_aux["query2"]) {
        if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
          $conAuxName1 = "connectHist";
          $queryAux1   = $array_aux["query2"];
        } else {
          $conAuxName1 = "connectTel";
          $queryAux1   = $array_aux["query2"];
        }
      }
      print $array_aux["string"];
    } else {
      $conAuxName1 = "connectTel";
      $queryAux1   = $q_paginador_prop;
      if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
        $conAuxName2 = "connectHist";
        $queryAux2   = $q_paginador_hist;
      } else {
        $conAuxName2 = "connectTel";
        $queryAux2   = $q_paginador_hist;
      }
    }
  } else {
    if ($array_aux["query1"]) {
      $conAuxName1 = "connectTel";
      $queryAux1   = $array_aux["query1"];
    }
    if ($array_aux["query2"]) {
      if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
        $conAuxName1 = "connectHist";
        $queryAux1   = $array_aux["query2"];
      } else {
        $conAuxName1 = "connectTel";
        $queryAux1   = $array_aux["query2"];
      }
    }
    print $array_aux["string"];
  }

?>
<div style=\"position:absolute;top:90%;left:90%;background-color: transparent;\" id="tudo"><br>
<?

$data_base = date("Y-m-d");
$qtd_dias_intervalo = 7;
$data_base_minima = strftime("%Y-%m-%d",mktime(0,0,0,date("m"),date("d")-$qtd_dias_intervalo,date("Y")));

if (substr($parm_busca_dia,0,12) != "his_data_env" || ($tb_hist == $tb_prop)) {

  $conta_linhas_over = 0;


  if ($conAuxName1 && $queryAux1) {
    $conexaoAux = ${$conAuxName1};
    $conexaoAux->query($queryAux1);
    print $tabela_cabecalho;
    $imprimiu_cabecalho = 1;
    if($conexaoAux->count > 0) {
      //******************************************************************//
      // COMEÇO DO WHILE PROPOSTA
      //******************************************************************//

      do{
        $rec_1 = $conexaoAux->result;

        $env_discador_modelo = $discador_modelo;

        if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
          $env_discador_modelo = $rec_1["classe_mkpro"];
        }
        // print "<pre>";print_r($rec_1);
        unset($bloq_clique);
        if($perfil_telefonica_movel == "S" && $rec_1["status"] == "G"){
          $bloq_clique = "S"; // FEITO POR FABIO PONTILHO
        }

        if ($tipo_data_campo == "intervalo") {
          if ($rec_1[str_replace(",","",$busca_dia)] <= $data_base && $rec_1[str_replace(",","",$busca_dia)] >= $data_base_minima) {
            $mes_index = "01";
          } elseif ($rec_1[str_replace(",","",$busca_dia)] <= $data_base && $rec_1[str_replace(",","",$busca_dia)] <= $data_base_minima) {
            $mes_index = "02";
          } elseif ($rec_1[str_replace(",","",$busca_dia)] > $data_base) {
            $mes_index = "01";
          }
          if ($mes_index != $item_col) {
            continue;
          }
        }

        if ($tipo_data_campo == "calc_prazo") {
          if ($item_col == "EXCED") {
            if ($rec_1["flw_status"] == "F") {
              if ($rec_1["flw_tempo_previsao"] > $rec_1["flw_duracao"]) {
                continue;
              }
            } else {
              if ($rec_1["flw_data_previsao"] >= date("Y-m-d")) {
                if ($rec_1["flw_data_previsao"] == date("Y-m-d")) {
                  if ($rec_1["flw_hora_previsao"] >= date("H:i:s")) {
                    continue;
                  }
                } else {
                  continue;
                }
              }
            }
          } else {
            if ($rec_1["flw_status"] == "F") {
              if ($rec_1["flw_tempo_previsao"] <= $rec_1["flw_duracao"]) {
                continue;
              }
            } else {
              if ($rec_1["flw_data_previsao"] >= date("Y-m-d")) {
                if ($rec_1["flw_data_previsao"] == date("Y-m-d")) {
                  if ($rec_1["flw_hora_previsao"] < date("H:i:s")) {
                    continue;
                  }
                }
              } else {
                continue;
              }
            }
          }
        }

        if (((strpos("xx".$tipo_classe_discador, "mailing") <= 0)) || ((strpos("xx".$tipo_classe_discador, "oco_telefonica") <= 0))) {

          if (((strpos("xx".$tipo_classe_discador, "reg_atd") <= 0))) {
            //var_dump(strtoUPPER($empresa) == "TELEF_ATCAR");
            if (strtoUPPER($empresa) == "TELEF_ATCAR") {
              $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&prp_seq=".$rec_1["num_prop"]."&repre=".$repre."&classe_TLRE6=".$classe_TLRE6."&titulo=".$titulo."&empresa=".$empresa."&classe_pesquisa=".$env_discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&sistema_nro=".substr($discador_modelo,-2)."&esconde_cab=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', 'Dados do Cliente')";
            } else {
              if ((strpos(strtolower(" ".$include_dados),"gera_mai") > 0 || strpos(strtolower(" ".$include_dados),"telef") > 0 || strtoUPPER(substr(" ".$empresa,0,4)) == "SOFT") && ($include_dados != "nc_telef_atpap")) {
                $abrejanela = "abrePopUpModal('Detalhe','tlfn_tvda_con_bko_det2.php?tipo_popup=AJ2&banco=".$banco."&num_prop=".$rec_1["num_prop"]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&empresa=".$empresa."&tipo_classe_discador=".$tipo_classe_discador."&discador_modelo=".$discador_modelo."&faz_monitoria=".$faz_monitoria."&form=".$form."&classe_pesquisa=".$env_discador_modelo."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
              } else {
                if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
                  $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&sistema_nro=".substr($env_discador_modelo,2,2)."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
                } else {
                  if ($env_discador_modelo == "MDZ1" || $env_discador_modelo == "MDSY") {
                    $width   = "850";
                    $height  = "520";
                  } else {
                    $width   = "90%";
                    $height  = "90%";
                  }
                  //var_dump($deonde_resumo == "RESUMO_TELEB");
                  if ($deonde_pbc == "VENDAS_PUBLICOS") {// Fixo para saber qual SA que está abrindo
                    $sa_click_vendas = "&sa_click=".$sa_click;

                    $mku_janela = MKUEncodeJS("&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&sistema_nro=".substr($env_discador_modelo,2,2)."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form.$sa_click_vendas, "");

                    $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&mku=' + ".$mku_janela.", 'JanNome_".substr($env_discador_modelo,-2)."', '$width', '$height', '')";

                  } elseif($deonde_resumo == "RESUMO_TELEB") {
                    $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&deonde_resumo=".$deonde_resumo."&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&sistema_nro=".substr($env_discador_modelo,2,2)."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '$width', '$height', '')";
                  } else {
                    $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&sistema_nro=".substr($env_discador_modelo,2,2)."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '$width', '$height', '')";
                  }
                }
              }
            }
          } else {
            if ($env_discador_modelo == "MDSA" && $deonde == "MK_HIST_CLIENTE" && empty($busca_dia) === true) {
              $busca_dia = "data_cri";
            }
            $abrejanela = "abrePopUpModal('Detalhe','mk_con_reg_atd_ficha.php?tipo_popup=AJ2&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&sistema_nro=".substr($env_discador_modelo,2,2)."&tipo_classe_discador=".$tipo_classe_discador."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
          }
        } else {

          if (substr($include_dados,0,3) != "nc_" ) {
            $mensagem = $tit_tb.": ".$funcao($rec_1[$campo_bd])." - ".$rec_1[$campo_bd];
          } else {
            if ($repre_vendedor) {
              $mensagem = $tit_tb.": ".$funcao($rec_1[$campo_bd], $env_discador_modelo, $repre_vendedor)." - ".$rec_1[$campo_bd];
            } else {
              $mensagem = $tit_tb.": ".$funcao($rec_1[$campo_bd], $env_discador_modelo, $repre)." - ".$rec_1[$campo_bd];
            }
          }
        }

        if((strtoupper(substr($tipo_classe_discador,0,2)) == "DX" && trim($dx_ficha_TLREB) != "--") || $dx_ficha_gvfor_TLREB == "S") {

          $varGet = "";

          $arrCampoGet = explode(",", $dx_chave_TLREB);
          if(is_array($arrCampoGet) === true) {
            foreach ($arrCampoGet as $key => $campo) {
              $varGet .= "&".$campo."=".$rec_1[$campo];
            }
          }

          $abrejanela = "abrePopUpModal('Detalhe','".$dx_ficha_TLREB.$varGet."&repre=".$repre."&titulo=".$titulo."&discador_modelo=".$env_discador_modelo."&sistema_nro=".substr($env_discador_modelo,2,2)."&operacao=".substr($env_discador_modelo,2,2)."&tipo_classe_discador=".$tipo_classe_discador."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."', 'JanNome_".substr($env_discador_modelo,-2)."', '90%', '520', '')";
          //          $abrejanela = "abrePopUpModal('Detalhe','tlfn_tvda_con_bko_ficha.php?tipo_popup=AJ2&agrupamento=DKFOR&".$varGet."&mostra_cab=nao&data=".$rec_1[$busca_dia]."&classe_TLRE6=".$classe_TLRE6."&repre=".$repre."&titulo=".$titulo."&atv_campanha=".$rec_1[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&sistema_nro=".substr($env_discador_modelo,2,2)."&discador_modelo=".$env_discador_modelo."&operacao=".substr($env_discador_modelo,2,2)."&tipo_classe_discador=".$tipo_classe_discador."&prp_seq=".$rec_1["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_1[$campo_id_lig]."&campanha_oco=".$rec_1[$campo_campanha]."', 'JanNome_".substr($env_discador_modelo,-2)."', '90%', '520', '')";
        }
       ?>
  </div>
  <!--  </td>
//****************************************************************//
//SEPARA REGISTROS PROPOSTA DOS REGISTROS HISTÓRICOS
//****************************************************************//
  </tr>-->

  <?
  if ($funcao_mouse_over) {
    ?>
    <input type="hidden" name="obs_mouse_over" id="id_obs_mouse_over<?print $conta_linhas_over;?>" value="<?print htmlspecialchars($rec_1["observacao"]);?>">
    <?
  }
    ?>
       <tr estilo='background: <?print $session["td_dado3"]?>' id='tr_conteudo_<?print $conta_linhas_over;?>' <?if ($funcao_mouse_over) {print "onmouseout=\"javascript:escondeTitle();\" onmouseover=\"if ($('#id_obs_mouse_over".$conta_linhas_over."').val() != '') {mostraTitle('Observação',$('#id_obs_mouse_over".$conta_linhas_over."').val())} else {mostraTitle('Observação','Não possui')}\" ";}?> >
       <?
       if ($isPermiteAlterar) {
         $servidor_deonde  = $_SERVER["SERVER_ADDR"];
         $ip_deonde        = $_SERVER["REMOTE_ADDR"];
         $diretorio_deonde = $_SERVER["SCRIPT_FILENAME"];
          ?>
            <td align="left" style="cursor:pointer;" title="Alterar(somente com printSQL)" onclick="JavaScript:AbreJanela('cc_mostra_tabela.php?tipo_popup=AJ2&num_seq=<?print $rec_1["num_prop"];?>&servidor_deonde=<?print $servidor_deonde;?>&ip_deonde=<?print $ip_deonde;?>&diretorio_deonde=<?print $diretorio_deonde;?>&param_tabela=tabela_proposta&nome_campo=<?print $seq_tabela;?>&bd=PARAMETRO&classe_mkpro=<?print $env_discador_modelo;?>&tipo_popup=AJ','Alteração da Propsta','800','600');"><font class="txt5"><strong><?print $rec_1["num_prop"];?></strong></font></td>
          <?
       }

       $conta_linhas_over++;
       if (is_array($matriz_titulo_det)) {
         foreach($matriz_titulo_det as $indice=>$valores) {

           if(is_array($valores)) {
             foreach($valores as $filtro_classe => $valor) {


               if($detect->isMobile() === true){
                 if($filtro_classe != '71'){
                   continue;
                 }
               }
               $arr_valor_aux = explode("§",$valor );
               $arr_valor = explode("¢",$arr_valor_aux[0] );
               $arr_tel = explode(",",$arr_valor[4]);

               if($arr_valor[3] == 'abreFichaPMO' && $deonde != 'MK_HIST_CLIENTE') {
                continue;
               }

               if ($aux_usaclick != "N" && $arr_valor[3] != "iaEFView" && strtoupper($arr_valor[3]) != "IAAJUDAPROPOSTA" && (strpos("xxx".$arr_valor[3],"getprintInteligente") <= 0)) {
                 $onclick_coluna = " style=\"cursor:pointer;\" onclick=\"JavaScript: ".$abrejanela."\" ";
               } else {
                 $onclick_coluna = "";
                 if($bloq_clique == "S"){
                 }
                 $onclick_coluna = "";
               }

                if($arr_valor[3] == 'abreFichaPMO') {
                  $onclick_coluna = "";
                }

               if (strtoupper($arr_valor[3]) == "OCORRENCIAMD" || strtoupper($arr_valor[3]) == "MOSTRAFICHAATD") {
                 $onclick_coluna = "";
               }

               if (strtoupper($arr_valor[3]) == "MONTAFLUXOSAGESTAO") {
                 print montaFluxoSAGestao($rec_1, substr($discador_modelo,2,2), $repre, "CONTEUDO", $valor, $onclick_coluna);
                 continue;
               }

               if($arr_valor[3] == "mostraTitulo") {
                 $onclick_coluna .= $arr_valor[3](utf8_encode($rec_1[$arr_valor[4]]), $arr_valor[0]);
               }

               print "<td nowrap id='td_conteudo_".$indice."' align='".$arr_valor[1]."' width='".$arr_valor[2]."' ".$onclick_coluna.">";

               if (((!$rec_1[$arr_valor[4]] || $rec_1[$arr_valor[4]] == "1111-11-11"|| $rec_1[$arr_valor[4]] == "0000-00-00") && !$arr_tel[1]  && strtoupper($arr_valor[3]) != "IAPGRAVACAO" && strtoupper($arr_valor[3]) != "GETDADOSBITCOM" && strtoupper($arr_valor[3]) != "IMGCHATPESQ") && $rec_1[$arr_valor[4]] != "0")  {
                 print ValorClasse($classe_TLRE6,$arr_valor[4],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor))."";
               } else {
                 if ($arr_valor[3] != "") {
                   if (strtoupper($arr_valor[3]) == "OCORRENCIAMD") {
                      if ($rec_1[$arr_valor[4]]) {?>
                        <input type="button" value="H" title="Histórico de Ocorrências Telefônicas" <?print $disabled_bto_hist?> onclick="javascript: abreJanelaHist('<?print $discador_modelo;?>','','','<?print $repre;?>','','<?print $rec_1[$arr_valor[4]]?>');" style="cursor:pointer;cursor:hand"><?
                      }
                   } elseif (strtoupper($arr_valor[3]) == "MOSTRAFICHAATD") {
                     print mostraFichaAtd("", $rec_1["id_lig"], $repre, $discador_modelo);
                   } else {
                     if ($arr_valor[3] == "getDadosBitCom") {
                       print $arr_valor[3]($rec_1[$arr_valor[4]],$rec_1["campo_chave"]);
                     } elseif ($arr_valor[3] == "MontaPesqUra") {
                       //CASO O 5º PARAMETRO NÃO TENHA SIDO PASSADO NA CLASSE G____, IREMOS DAR UM VALOR CLASSE DA CAMPANHA
                       if (empty($arr_valor[5]) === true) {
                         $arr_valor[5] = $campo_campanha;
                       }

                       print MontaPesqUra($rec_1[$arr_valor[5]], $rec_1[$arr_valor[4]], $repre);
                     } elseif (strtoupper($arr_valor[3]) == "IAAJUDAPROPOSTA") {
                       print $arr_valor[3]($discador_modelo, $rec_1["num_prop"],$arr_valor[4]);
                     } elseif (strtoupper($arr_valor[3]) == "CALCDIFDATAHORASEG") {
                       $arr_aux_data_hora = explode(",",$arr_valor[4]);

                       $data_1 = $rec_1[$arr_aux_data_hora[0]];
                       $hora_1 = $rec_1[$arr_aux_data_hora[1]];
                       $data_2 = $rec_1[$arr_aux_data_hora[2]];
                       $hora_2 = $rec_1[$arr_aux_data_hora[3]];
                       $meta_sla = $arr_valor[5];
                       print CalcDifDataHora($data_1, $hora_1, $data_2, $hora_2, "S",$meta_sla);
                     } elseif (strtoupper($arr_valor[3]) == "CALCDIFDATAHORASLA") {
                       $arr_aux_data_hora = explode(",",$arr_valor[4]);

                       $data_1 = $rec_1[$arr_aux_data_hora[0]];
                       $hora_1 = $rec_1[$arr_aux_data_hora[1]];
                       $data_2 = $rec_1[$arr_aux_data_hora[2]];
                       $hora_2 = $rec_1[$arr_aux_data_hora[3]];
                       $meta_sla = $arr_valor[5];

                       print CalcDifDataHora($data_1, $hora_1, $data_2, $hora_2, "SLA",$meta_sla);

                     } elseif (strtoupper($arr_valor[3]) == "CALCDIFDATAHORA" || strtoupper($arr_valor[3]) == "CALCDIFDATAHORAMAISUM") {

                       $arr_aux_data_hora = explode(",",$arr_valor[4]);
                       $data_1 = $rec_1[$arr_aux_data_hora[0]];
                       $hora_1 = $rec_1[$arr_aux_data_hora[1]];
                       $data_2 = $rec_1[$arr_aux_data_hora[2]];
                       $hora_2 = $rec_1[$arr_aux_data_hora[3]];
                       $meta_sla = $arr_valor[5];

                      if(strtoupper($arr_valor[3]) == "CALCDIFDATAHORA"){

                        print $arr_valor[3]($data_1, $hora_1, $data_2, $hora_2,'N',$meta_sla);
                      }else{
                        print $arr_valor[3]($data_1, $hora_1, $data_2, $hora_2);
                      }

                     } elseif ($arr_valor[3] == "mostraTitulo") {
                       if(strlen($rec_1[$arr_valor[4]]) > 30) {
                         print substr($rec_1[$arr_valor[4]],0,30)."...";
                       } else {
                         print substr($rec_1[$arr_valor[4]],0,30);
                       }
                     } elseif ($arr_valor[3] == "getDescItem") {
                       print $arr_valor[3]($rec_1["item_classe"],$rec_1["item_categoria"],$rec_1["item_codigo"], "S");
                     } else {
                       if ($arr_valor[3] == "FormataFone") {
                         $arr_aux_fone = explode(",",$arr_valor[4]);

                         $arr_aux_ddd .= $rec_1[$arr_aux_fone[0]];
                         $arr_aux_tel .= $rec_1[$arr_aux_fone[1]];

                         print FormataFone($arr_aux_ddd,$arr_aux_tel);
                         $arr_aux_ddd = "";
                         $arr_aux_tel = "";
                       } elseif ($arr_valor[3] == "imgChatPesq") {
                         list($claPesqChat, $resPesqChat) = explode(",", $arr_valor[4]);
                         print "<img src='imagens/".str_replace(".png", "_16px.png", ValorClasse($rec_1[$claPesqChat], str_replace("R", "I", $rec_1[$resPesqChat]), $repre))."' title='".ValorClassePrint($rec_1[$claPesqChat], $rec_1[$resPesqChat], $repre)."'>";
                       } else {
                         if ($arr_valor[3] == "getAnexos") {
                           print $arr_valor[3]($rec_1[$arr_valor[4]],$discador_modelo,"MD");
                         } else {
                           if ($arr_valor[3] == "exibeRiscoRel") {
                             print $arr_valor[3]($rec_1[$arr_valor[4]],$discador_modelo,"MD",$rec_1["ativ_num"], $rec_1["ouv_mk_numero"], $rec_1["ouv_ativ_num"], $rec_1["ouv_grupo_acesso"], $flw_user_nivel_acesso, $rec_1["risco_contato"], $rec_1["risco_imagem"]);
                           } else {
                             if (strpos("xxx".$arr_valor[3],"getprintInteligente") > 0) {
                               $array_valores = explode(",", $arr_valor[3]);
                               $array_valores2 = explode(",", $arr_valor[4]);
                               print "<img src=\"imagens/".$array_valores[2]."\" width=\"25px\" style=\"cursor:pointer;cursor:hand\" onclick=\"javascript: getprintInteligente('".$repre."', 'DKFOR', '".$rec_1[$array_valores2[0]]."', '".$array_valores[3]."', '".$rec_1[$array_valores2[1]]."');\">";
                             } else {
                             		if (strtoupper($arr_valor[3]) == "GETHTMLSUHAI") {
                             			print getHtmlSuhai($rec_1["data_cri"],$rec_1["n_pedido"]);
           											}elseif (strtoupper($arr_valor[3]) == "IMGPRAZO") {
                                 	print ImgPrazo($rec_1["status"],$rec_1["data_ini_ativ"],$rec_1["hora_ini_ativ"],$rec_1["ativ_tempo_exec"],$rec_1["ativ_tempo_max_exec"],"DI",$rec_1["status_anexo"],"SRH");
                               	}elseif (strtoupper($arr_valor[3]) != "IAPGRAVACAO") {
                                 if($arr_tel[3]){
                                   print $arr_valor[3]($rec_1[$arr_tel[0]],$rec_1[$arr_tel[1]],$rec_1[$arr_tel[2]],$rec_1[$arr_tel[3]]);

                                 }elseif($arr_tel[2]){
                                   print $arr_valor[3]($rec_1[$arr_tel[0]],$rec_1[$arr_tel[1]],$rec_1[$arr_tel[2]]);

                                 } elseif($arr_tel[1]) {
                                   print $arr_valor[3]($rec_1[$arr_tel[0]],$rec_1[$arr_tel[1]]);
                                 }else{
                                   print $arr_valor[3]($rec_1[$arr_valor[4]]);
                                 }
                                } elseif ($arr_valor[3] == "number_format") {
                                  print $arr_valor[3](str_replace(",",".",$rec_1[$arr_valor[4]]),"",$mensagem);
                                } elseif(strtoupper($arr_valor[3]) == "IAPGRAVACAO") {
                                  //Código feito por, Alan Fágner
                                  $campoQueryGA7   = $arr_valor[4];
                                  $arrEnvMonitoria = array();

                                  if(strpos($arr_valor[4], ",") !== false) {
                                    $arrGa7        = explode(",", $arr_valor[4]);
                                    $campoQueryGA7 = $arrGa7[0];

                                    if(strpos($arr_valor[4], "nome_monitoria") !== false) {
                                      $arrEnvMonitoria["tabela"] = "tabela_historico";

                                      if(mb_strtoupper($classe_sigla) == "GC") {
                                        $arrEnvMonitoria["tabela"] = "tabela_ativo";
                                      }

                                      $arrEnvMonitoria["classe_mkpro"]                = $discador_modelo;
                                      $arrEnvMonitoria["nome_monitoria"]              = $rec_1["nome_monitoria"] ? $rec_1["nome_monitoria"] : "";
                                      $arrEnvMonitoria["id_cliente"]["{$seq_tabela}"] = $rec_1["num_prop"];
                                    }
                                  }

                                  print str_replace("/callcenter/imagens/balaochat_18px.png", "imagens/balaochat_18px.png", $arr_valor[3]($rec_1[$campoQueryGA7], "", $mensagem, "", $arrEnvMonitoria));
                                } else {
                                  print $arr_valor[3]($rec_1[$arr_valor[4]]);
                                }
                             }
                           }
                         }
                       }
                     }
                   }
                 } else {
                   if ($arr_valor[5] != "") {
                     if (substr($arr_valor[5], 2, 2) == "__") {
                       if ((substr($arr_valor[5], 0, 2) == "NC") && (empty($nro_nc_param) === false) && (trim($nro_nc_param) != "--")) { //verifa se usa um NC de outro dk/md se sim usa o numero do nc do discador ou modelo do parametro
                         print ValorClasse(str_replace("__", $nro_nc_param, $arr_valor[5]), $rec_1[$arr_valor[4]], retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                       } else {
                         print ValorClasse(str_replace("__", $discador_modelo_rel, $arr_valor[5]), $rec_1[$arr_valor[4]], retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                       }
                     } else {
                       if ($str_campo_classe && strlen($arr_valor[5]) > 5) {
                         print ValorClassePrint($rec_1[$arr_valor[5]],$rec_1[$arr_valor[4]],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                       } else {
                         if (strpos("xx".$arr_valor[5], "classe_recusa") > 0) {
                           print ValorClassePrint($rec_1[$arr_valor[5]],$rec_1[$arr_valor[4]],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                         } else {
                           print ValorClassePrint($arr_valor[5],$rec_1[$arr_valor[4]],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                         }
                       }
                     }
                   } else {
                     print $rec_1[$arr_valor[4]];
                   }
                 }
               }
               print "</td>";
             }
           }
         }

         //---
         if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
           if ($param_disk_power_ficha == "S" || $param_disk_power_lista == "S" || $arrParamTemp["tipo_discador"] == "PREDICTIVE") {
             $campanha_oco = $rec_1[$campo_campanha];
             $id_lig_oco = $rec_1[$campo_id_lig];
             $try_geral = $rec_1["try_geral"];
             $seq_oco   = $rec_1["num_prop"];
             if ($campanha_oco != "9999" && $try_geral > 0) {
        ?>
        <!-- apenasTesta('<?print $discador_modelo;?>','<?print $id_lig_oco;?>','<?print $campanha_oco;?>','<?print $repre;?>','<?print $seq_oco;?>','');" (<?print str_pad($try_geral,2,0,STR_PAD_LEFT);?>)-->
        <td align="center" width="5%" class="txt5">
          <input type="button" value="H" title="Histórico de Ocorrências Telefônicas" onclick="javascript: abreJanelaHist('<?print $discador_modelo;?>','<?print $id_lig_oco;?>','<?print $campanha_oco;?>','<?print $repre;?>','<?print $seq_oco;?>','');"> (<?print str_pad($try_geral,2,0,STR_PAD_LEFT);?>)
        </td>
        <?
             } else {
        ?>
          <td align="center" width="5%" class="txt5">Não Possui</td>
        <?
             }

             //print "<li>".$rec_1["st_venda_cartao"];



           }
         }
       }
        ?>


       </tr>
       <?
       $x++;
      } while($conexaoAux->getFetchAssoc());
    } elseif ($discador_modelo == "MDSY") {
      print "<center><font class='txtvermelho'>NENHUM APONTAMENTO ENCONTRADO</font></center>";
    }
  }

}

}

if ($mostra_hist != "N") {

  //******************************************************************//
  // COMEÇO DO WHILE HISTÓRICO
  //******************************************************************//
  if ($conAuxName2 && $queryAux2) {
    $conexaoAux = ${$conAuxName2};
    $conexaoAux->query($queryAux2);
    if ($imprimiu_cabecalho != 1) {
      print $tabela_cabecalho;
    }
    if($conexaoAux->count > 0) {
      do{
        $rec_2 = $conexaoAux->result;

      $env_discador_modelo = $discador_modelo;

      if(strtoupper($tipo_classe_discador) == "AGRUPA_OPERACAO") {
        $env_discador_modelo = $rec_2["classe_mkpro"];
      }

      unset($bloq_clique);
      if($perfil_telefonica_movel == "S" && $rec_2["status"] == "G"){
        $bloq_clique = "S"; // FEITO POR FABIO PONTILHO
      }

      if ($tipo_data_campo == "calc_prazo") {
        if ($item_col == "EXCED") {
          if ($rec_2["flw_status"] == "F") {
            if ($rec_2["flw_tempo_previsao"] > $rec_2["flw_duracao"]) {
              continue;
            }
          } else {
            if ($rec_2["flw_data_previsao"] >= date("Y-m-d")) {
              if ($rec_2["flw_data_previsao"] == date("Y-m-d")) {
                if ($rec_2["flw_hora_previsao"] >= date("H:i:s")) {
                  continue;
                }
              } else {
                continue;
              }
            }
          }
        } else {
          if ($rec_2["flw_status"] == "F") {
            if ($rec_2["flw_tempo_previsao"] <= $rec_2["flw_duracao"]) {
              continue;
            }
          } else {
            if ($rec_2["flw_data_previsao"] >= date("Y-m-d")) {
              if ($rec_2["flw_data_previsao"] == date("Y-m-d")) {
                if ($rec_2["flw_hora_previsao"] < date("H:i:s")) {
                  continue;
                }
              }
            } else {
              continue;
            }
          }
        }
      }


      if (strtoUPPER($empresa) == "TELEF_ATCAR") {
        $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&prp_seq=".$rec_2["num_prop"]."&repre=".$repre."&titulo=".$titulo."&empresa=".$empresa."&tipo_classe_discador=".$tipo_classe_discador."&classe_pesquisa=".$env_discador_modelo."&sistema_nro=".substr($discador_modelo,-2)."&esconde_cab=S&id_lig_oco=".$rec_2[$campo_id_lig]."&campanha_oco=".$rec_2[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', 'Dados do Cliente')";
      } else {

        if ((strpos(strtolower(" ".$include_dados),"telef") > 0 || strtoUPPER(substr(" ".$empresa,0,4)) == "SOFT") && ($include_dados != "nc_telef_atpap")) {
          //if (strtoUPPER(substr($empresa,0,5)) == "TELEF" || strtoUPPER(substr($empresa,0,4)) == "SOFT") {

          $abrejanela = "abrePopUpModal('Detalhe','tlfn_tvda_con_bko_det2.php?tipo_popup=AJ2&banco=".$banco."&num_prop=".$rec_2["num_prop"]."&repre=".$repre."&titulo=".$titulo."&empresa=".$empresa."&discador_modelo=".$discador_modelo."&tipo_classe_discador=".$tipo_classe_discador."&faz_monitoria=".$faz_monitoria."&form=".$form."&classe_pesquisa=".$env_discador_modelo."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
        } else {
          if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
            $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&mostra_cab=nao&data=".$rec_2[$busca_dia]."&titulo=".$titulo."&repre=".$repre."&atv_campanha=".$rec_2[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&sistema_nro=".substr($env_discador_modelo,2,2)."&tipo_classe_discador=".$tipo_classe_discador."&prp_seq=".$rec_2["nroproposta"]."&voltar_fecha=S&id_lig_oco=".$rec_2[$campo_id_lig]."&campanha_oco=".$rec_2[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
          } else {
            $abrejanela = "abrePopUpModal('Detalhe','mk_con_producao_ficha.php?tipo_popup=AJ2&mostra_cab=nao&data=".$rec_2[$busca_dia]."&titulo=".$titulo."&repre=".$repre."&atv_campanha=".$rec_2[$campo_campanha]."&classe_pesquisa=".$env_discador_modelo."&sistema_nro=".substr($env_discador_modelo,2,2)."&tipo_classe_discador=".$tipo_classe_discador."&prp_seq=".$rec_2["num_prop"]."&voltar_fecha=S&id_lig_oco=".$rec_2[$campo_id_lig]."&campanha_oco=".$rec_2[$campo_campanha]."&faz_monitoria=".$faz_monitoria."&form=".$form."', 'JanNome_".substr($discador_modelo,-2)."', '90%', '520', '')";
          }
        }
      }
      ?>
       <tr id='tr_conteudo_<?print $x;?>'>
      <?
      if ($isPermiteAlterar) {
        $servidor_deonde  = $_SERVER["SERVER_ADDR"];
        $ip_deonde        = $_SERVER["REMOTE_ADDR"];
        $diretorio_deonde = $_SERVER["SCRIPT_FILENAME"];
        ?>
          <td id='td_conteudo_2_<?print $index;?>' nowrap style="cursor:pointer;" onclick="JavaScript:AbreJanela('cc_mostra_tabela.php?tipo_popup=AJ2&num_seq=<?print $rec_2["num_prop"];?>&servidor_deonde=<?print $servidor_deonde;?>&ip_deonde=<?print $ip_deonde;?>&diretorio_deonde=<?print $diretorio_deonde;?>&param_tabela=tabela_historico&nome_campo=<?print $seq_tabela;?>&bd=PARAMETRO&classe_mkpro=<?print $env_discador_modelo;?>&tipo_popup=AJ','Alteração da Propsta','800','600');"><?print $rec_2["num_prop"];?></td>
        <?
      }

      if (is_array($matriz_titulo_det)) {
        foreach($matriz_titulo_det as $indice=>$valores) {
          if(is_array($valores)){
            foreach($valores as $filtro_classe => $valor) {

              if($detect->isMobile() === true){
                if($filtro_classe != '71'){
                  continue;
                }
              }



              $arr_valor = explode("¢",$valor );
              $arr_tel   = explode(",",$arr_valor[4]);

               if($arr_valor[3] == 'abreFichaPMO' && $deonde != 'MK_HIST_CLIENTE') {
                continue;
               }
              if ($bd_hist && $bd_hist == "bd_sbt_consorcio") {
                $arr_valor[4] = str_replace("data_venda","dtvenda", $arr_valor[4]);
                $arr_valor[4] = str_replace("data_criacao","datacriacao", $arr_valor[4]);
                $arr_valor[4] = str_replace("data_cri","datacriacao", $arr_valor[4]);
                $arr_valor[4] = str_replace("hora_cri","horacriacao", $arr_valor[4]);
                $arr_valor[4] = str_replace("desc_produto","descproduto", $arr_valor[4]);
                $arr_valor[4] = str_replace("cod_produto","codproduto", $arr_valor[4]);
                $arr_valor[4] = str_replace("num_prop","nroproposta", $arr_valor[4]);
                $arr_valor[4] = str_replace("nome_razao","nome", $arr_valor[4]);
                $arr_valor[4] = str_replace("cpf_cnpj","cpfcnpj", $arr_valor[4]);
                $arr_valor[4] = str_replace("ddd_tel","r_ddd", $arr_valor[4]);
                $arr_valor[4] = str_replace("num_tel","r_telefone", $arr_valor[4]);
                $arr_valor[4] = str_replace("solicitante_nome,","", $arr_valor[4]);
                $arr_valor[4] = str_replace("bairro","e_bairro", $arr_valor[4]);
                $arr_valor[4] = str_replace("cidade","e_cidade", $arr_valor[4]);
                $arr_valor[4] = str_replace("uf","e_uf", $arr_valor[4]);
                $arr_valor[4] = str_replace("desc_produto","descproduto", $arr_valor[4]);
                $arr_valor[4] = str_replace("data_1_pagto","dtpagto", $arr_valor[4]);
                $arr_valor[4] = str_replace("data_pagto","dtpagto", $arr_valor[4]);
                $arr_valor[4] = str_replace("rg_uf","rguf", $arr_valor[4]);
                $arr_valor[4] = str_replace("rg_e_uf","rguf", $arr_valor[4]);
                $arr_valor[4] = str_replace("hora_venda","hrvenda", $arr_valor[4]);
              }

              if (strtoupper($arr_valor[3]) == "IAAJUDAPROPOSTA" || strtoupper($arr_valor[3]) == "OCORRENCIAMD" || strtoupper($arr_valor[3]) == "MOSTRAFICHAATD" || ((strpos("xxx".$_SERVER["PHP_SELF"], "mk_hist_cliente.php") > 0) && (substr($repre,0,8) == "DOCWORKS" || $repre == "XGMC-V") && ($session["tp_user"] == "OPE"))) {
                $var_click = "";
              } else {

                if($aux_usaclick == "N" || $bloq_clique == "S"){
                  $var_click = "";
                }else{
                  $var_click = " style=\"cursor:pointer;cursor:hand\" onclick=\"JavaScript:".$abrejanela.";\" ";
                }
              }
              if($arr_valor[3] == 'abreFichaPMO') {
                $var_click = '';
              }
              print "<td nowrap ".$var_click.">";

              if ((!$rec_2[$arr_valor[4]] || $rec_2[$arr_valor[4]] == "1111-11-11") && !$arr_tel[1] ) {
                print ValorClasse($classe_TLRE6,$arr_valor[4],retornaDefineRepre($repre,$var_nao_usar_define_repre,$param_repre_vendedor));
              } else {

              if ($arr_valor[3] != "") {
                if (strtoupper($arr_valor[3]) == "IAAJUDAPROPOSTA") {
                  print $arr_valor[3]($discador_modelo, $rec_2["num_prop"], $arr_valor[4]);
                } else {

                  if (strtoupper($arr_valor[3]) == "OCORRENCIAMD") {
                    if ($rec_2[$arr_valor[4]]) {?>
                      <input type="button" value="H" title="Histórico de Ocorrências Telefônicas" <?print $disabled_bto_hist?> onclick="javascript: abreJanelaHist('<?print $discador_modelo;?>','','','<?print $repre;?>','','<?print $rec_2[$arr_valor[4]]?>');" style="cursor:pointer;cursor:hand"><?
                    }
                  } elseif (strtoupper($arr_valor[3]) == "MOSTRAFICHAATD") {
                    print mostraFichaAtd("", $rec_2["id_lig"], $repre, $discador_modelo);
                  } elseif(strtoupper($arr_valor[3]) == "IAPGRAVACAO") {
                    //Código feito por, Alan Fágner
                    $campoQueryGA7   = $arr_valor[4];
                    $arrEnvMonitoria = "";

                    if(strpos($arr_valor[4], ",") !== false) {
                      $arrGa7        = explode(",", $arr_valor[4]);
                      $campoQueryGA7 = $arrGa7[0];

                      if(strpos($arr_valor[4], "nome_monitoria") !== false) {
                        $arrEnvMonitoria["tabela"] = "tabela_historico";

                        if(mb_strtoupper($classe_sigla) == "GC") {
                          $arrEnvMonitoria["tabela"] = "tabela_ativo";
                        }

                        $arrEnvMonitoria["classe_mkpro"]                = $discador_modelo;
                        $arrEnvMonitoria["nome_monitoria"]              = $rec_2["nome_monitoria"] ? $rec_2["nome_monitoria"] : "";
                        $arrEnvMonitoria["id_cliente"]["{$seq_tabela}"] = $rec_2["num_prop"];
                      }
                    }

                    print $arr_valor[3]($rec_2[$campoQueryGA7], "", "", "", $arrEnvMonitoria);
                  } else {
                    if ($arr_tel[1]) {
                      print $arr_valor[3]($rec_2[$arr_tel[0]],$rec_2[$arr_tel[1]]);
                    } else {
                      print $arr_valor[3]($rec_2[$arr_valor[4]]);
                    }
                  }
                }
              } else {

                  if ($arr_valor[5] != "") {
                    if (substr($arr_valor[5], 2, 2) == "__") {
                      if ((substr($arr_valor[5], 0, 2) == "NC") && (empty($nro_nc_param) === false) && (trim($nro_nc_param) != "--")) { //verifa se usa um NC de outro dk/md se sim usa o numero do nc do discador ou modelo do parametro
                        print ValorClasse(str_replace("__", $nro_nc_param, $arr_valor[5]), $rec_2[$arr_valor[4]], retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                      } else {
                        print ValorClasse(str_replace("__", $discador_modelo_rel, $arr_valor[5]), $rec_2[$arr_valor[4]], retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                      }
                    } else {

                      if ($arr_valor[5] == "classe_recusa") {
                        print ValorClassePrint($rec_2[$arr_valor[5]],$rec_2[$arr_valor[4]],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                      } else {
                        print ValorClasse($arr_valor[5],$rec_2[$arr_valor[4]],retornaDefineRepre($repre, $var_nao_usar_define_repre,$param_repre_vendedor));
                      }
                    }
                  } else {
                    print $rec_2[$arr_valor[4]];
                  }
                }
              }
            }
          }
        }
      }



      print "</td>";
      //}


      /*
      <td               ><font class="txt5"><?print $rec_2["nome_razao"];        ?></td>
      <td               ><font class="txt5"><?print $rec_2["cpf_cnpj"];          ?></td>
      <td               ><font class="txt5"><?print FormataFoneTelefonica($rec_2["ddd_tel"],$rec_2["num_tel"])?></td>
      <?if ($repre != "PORTOSEGURO" && substr($repre,0,8) != "TELLUVDA") {?>
      <td               ><font class="txt5"><?print $rec_2["solicitante_nome"];  ?></td>
      <?}?>
      <td align="center"><font class="txt5"><?print $rec_2["desc_produto"];      ?></td>
      <td align="center"><font class="txt5"><?print BRdate($rec_2[str_replace(" ","",$busca_dia)])."<BR>".$rec_2[str_replace(" ,","",str_replace("data","hora",$busca_dia))];?></td>
      <td align="center"><font class="txt5"><?print $rec_2["bina_cliente"];      ?></td>
      <td align="center"><font class="txt5"><?print $rec_2["login_operador"];    ?></td>
*/?>

      </tr>
      <?
      $x++;
    }while($conexaoAux->getFetchAssoc()); //FIM DO WHILE rec_2
   }
  }
}
if ((strpos("xx".$tipo_classe_discador, "mailing") > 0)) {
  if ($param_disk_power_ficha == "S" || $param_disk_power_lista == "S" || $arrParamTemp["tipo_discador"] == "PREDICTIVE") {
    $colspan_total = $colspan_total+1;
  }
}
?>
          <tfoot>
            <tr>
              <td estilo='background: <?print $session["td_destaque"];?>'><span estilo='color: white'>TOTAL</span></td>
              <td estilo='background: <?print $session["td_destaque"];?>' colspan="<?print ($colspan_total-2)?>">&nbsp;</td>
              <td estilo='background: <?print $session["td_destaque"];?>' class='text-center'><span estilo='color: white'><?print $x;?></span></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
<?
if ($deonde != "MK_HIST_CLIENTE") {
?>

  <form name="simula" method="post" action="tlfn_tvda_con_bko_impressao.php" target="Janela">
     <input type="hidden" name="tabelao_rel"    value="">
     <input type="hidden" name="tabelao_titulo" value="">
     <input type="hidden" name="tipo"           value="">
     <input type="hidden" name="titulo"         value="">
  </form>

<?
}
?>
<?print GerarRodape($voltar);?>
</div>
</body>
</html>