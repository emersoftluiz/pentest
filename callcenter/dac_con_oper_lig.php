<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
include "cores.php";
  if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}

function VerificaTime($time, $segundos) {
  if ($time == "seg") {
    return $segundos;
  } else {
    return CalcTime($segundos);
  }
}
// showvars();
// exit();
if ($StrDataInicio) {
  $dia_ini = Substr($StrDataInicio,"8","2");
  $mes_ini = Substr($StrDataInicio,"5","2");
  $ano_ini = Substr($StrDataInicio,"0","4");

  $dia_fim = Substr($StrDataFim,"8","2");
  $mes_fim = Substr($StrDataFim,"5","2");
  $ano_fim = Substr($StrDataFim,"0","4");

  $hora_ini = Substr($StrHoraInicio,"0","2");
  $min_ini  = Substr($StrHoraInicio,"3","5");

  $hora_fim = Substr($StrHoraFim,"0","2");
  $min_fim  = Substr($StrHoraFim,"3","5");
} else {
  $StrDataInicio = $ano_ini.'-'.$mes_ini.'-'.$dia_ini;
  $StrDataFim    = $ano_fim.'-'.$mes_fim.'-'.$dia_fim;

  $StrHoraInicio = $hora_ini.':'.$min_ini;
  $StrHoraFim    = $hora_fim.':'.$min_fim;
}

//Esta chamada à função ConnectLOGS tem que estar aqui devido às variáveis que ela utiliza
$connect2 = ConnectLOGS($repre, $ano_ini.$mes_ini);

//Verificando qual o programa que esta sendo executado e fazendo a suas arvores
switch($campo) {
  case "det":
  case "dettrab":
    $param_campo = $campo;
    $campo       = "num";
    $campo_prox  = "";
    $campo_prox1 = "";
    $prog_ant    = "dac_con_oper.php";
    $prog_prox   = "";
    $titulo      = "Gravacao";
    $titulo1     = "Grupo";
  break;
}

//*************************************************************************************************
//************************************ ---- Preparando os Wheres ------ ***************************
//*************************************************************************************************

if (!$where) {
  $where = "Where data_ligacao between '".$StrDataInicio."' and '".$StrDataFim."' and ";
  //*************Preparando o where dos servicos selecionados*********
  $x = 0;
  While($servico[$x]) {
    if ($x == "0") {
      $barra = "(";
    } else {
      $barra = "";
    }
    $where = $where.$barra." grupo = '".$servico[$x]."' or ";
    $x++;
  }
  $where = $where." grupo  = '9999999'  )";
  //******************************************************************
  if ($ramal) {
    $where = $where." and ramal = '".$ramal."'  ";
  }
  if ($login_operador) {
    $where = $where." and login_operador = '".$login_operador."'  ";
  }
  if ($hora_operador) {
    $where = $where." and hora_ligacao = '".$hora_ligacao."'  ";
  }
  if ($StrHoraInicio) {
    $where = $where." and hora_ligacao_ini between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
  }
  if ($ddd) {
    $where = $where." and ddd = '".$ddd."'  ";
  }
  if ($tel_prefixo) {
    $where = $where." and prefixo_telefone like '".$tel_prefixo."%'  ";
  }
  if ($tel_sufixo) {
    $where = $where." and sufixo_telefone like '".$tel_sufixo."%'  ";
  }
} else {
  if ($campo1 == "hora_ligacao_ini") {
    $var_campo1 =  "left(".$campo1.",2) as ".$campo1;
  } else {
    $var_campo1 = $campo1;
  }
  //modificado
  if($campo_ant == "hora_operador_ini" || $campo_ant == "hora_ligacao_ini"){
      $where = str_replace("\'" , "'" ,$where);
      $where = $where." AND ".$campo_ant." LIKE '".trim($vlr_campo)."%'";
      if (($campo_ant1) && ($campo_ant1 != $campo_ant)) {
        $where = $where." AND ".$campo_ant1." = '".trim($vlr_campo1)."'";
      }else if(!$campo_ant1){
        $where = $where;
      }
    }else{
      $where = str_replace("\'" , "'" ,$where);
			if($campo_ant){
				$where = $where."AND ".$campo_ant." = '".trim($vlr_campo)."'";
			}//aqui
      if (($campo_ant1 == "hora_operador_ini") || ($campo_ant1 == "hora_ligacao_ini")) {
        $where = $where." AND ".$campo_ant1." LIKE '".trim($vlr_campo1)."%'";
      }else if(!$campo_ant1){
        $where = $where;
      }else{
        $where = $where." AND ".$campo_ant1." = '".trim($vlr_campo1)."'";
      }
    }



}

//rotina de paginacao
//gera uma variavel para ser impressa logo a baixo
//é necessario q ela seja executada antes do select para gerar o limit do select abaixo
require_once("funcoes/Paginador.php");
$paginacao =  "<table width='700' align='center'><tr><td>";
$ano_mes_ini = substr($ano_ini, 2, 2).$mes_ini;
$ano_mes_fim = substr($ano_fim, 2, 2).$mes_fim;
$ano_mes = $ano_mes_ini;
while($ano_mes <= $ano_mes_fim) {
  $x = $x+0;
  $tabela_bd  = "logura".$ano_mes;
  $paginador[$ano_mes] = new Paginador($ano_mes,$tabela_bd,substr($where,5), $connect2, "200");
  $paginador[$ano_mes]->setTitulo("Ligações de ".NomeMes(substr($ano_mes,2)).":");
  $paginacao .= $paginador[$ano_mes]->tabelaPaginacao();
  if ((!$primeiro_paginador_com_registros) && ($paginador[$ano_mes]->total_registros > 0)) {
    $primeiro_paginador_com_registros = $ano_mes;
  }
  $ano_mes = inc_ano_mes($ano_mes);
}
$paginacao .= "</table>";
//fim da rotina de paginacao

$y = 0;

if (!$fi_id_atual) {
  if ($primeiro_paginador_com_registros) {
    $ano_mes = $primeiro_paginador_com_registros;
  } else {
    $ano_mes = substr($ano_ini, 2, 2).$mes_ini;
  }
} else {
  $ano_mes = $fi_id_atual;
}

$x = $x+0;
$tabela_bd  = "logura".$ano_mes;

$pag = ($vlr_campo1-1)*$tot_por_pagina;
$limite       = "LIMIT ".$pag.",".$tot_por_pagina;
$x = $x+0;
if ($x <= 9) {$x = "0".$x;}

if ($param_campo == "dettrab") {
  $order_by = " data_ligacao, hora_ligacao_ini";
} else {
  $order_by = " data_ligacao, hora_operador_ini";
}
//print "<pre>";
//print_r ($paginador)."----------";

$sql = "SELECT * FROM ".$tabela_bd." ".$where." order by ".$order_by." ".$paginador[$ano_mes]->limit;
$sql = DescQuery($sql, $session["operador"], $PHP_SELF);
if ($session["print_sql"] == "S") {
  print $sql."<br>";
}
if ($rec = mysql_query($sql, $connect2)) {
  if ($vlr = mysql_fetch_assoc($rec)) {
    do{
      $vlr[$campo]  = completa($vlr[$campo],"10"," ","D");
      $tabela       = completa($tabela,"10"," ","D");
      $indice       = $vlr[$campo].$tabela;
			//var_dump($vlr[$campo],$campo);
      if ((BuscaNaMatriz($matriz_aux["indice"] , $indice) == -1)) {
        $matriz_aux["indice"][$y]          = $indice;
        $matriz[$indice][$campo]         	 = $vlr[$campo];
        if ($y> $tot_matriz) {$tot_matriz  = $y;}
        $y++;
      }

      $matriz[$indice]["duracao_fila"]         = $vlr["duracao_fila"];
      $matriz[$indice]["posicao_fila"]         = $vlr["posicao_fila"];


      $matriz[$indice]["id_lig"]               = $vlr["id_lig"];
      $matriz[$indice]["num"]                  = $vlr["num"];
      $matriz[$indice]["grupo"]                = $vlr["grupo"];
      $matriz[$indice]["ramal"]                = $vlr["ramal"];
      $matriz[$indice]["desligou"]             = $vlr["desligou"];
      $matriz[$indice]["status_gravacao"]      = $vlr["status_gravacao"];
      $matriz[$indice]["midia_id"]             = $vlr["midia_id"];
      $matriz[$indice]["login_operador"]       = $vlr["login_operador"];
      $matriz[$indice]["data_ligacao"]         = $vlr["data_ligacao"];


    if ($param_campo == "dettrab") {
      $matriz[$indice]["hora_ligacao_ini"]     = $vlr["hora_ligacao_ini"];
      $matriz[$indice]["hora_ligacao_fim"]     = $vlr["hora_ligacao_fim"];
      $matriz[$indice]["duracao_ligacao"]      = $vlr["duracao_ligacao"] ;
    } else {
      $matriz[$indice]["hora_ligacao_ini"]     = $vlr["hora_operador_ini"];
      $matriz[$indice]["hora_ligacao_fim"]     = $vlr["hora_operador_fim"];
      $matriz[$indice]["duracao_ligacao"]      = $vlr["duracao_operador"] ;
    }

      $matriz[$indice]["ddd"]                  = $vlr["ddd"]             ;
      $matriz[$indice]["prefixo_telefone"]     = $vlr["prefixo_telefone"];
      $matriz[$indice]["sufixo_telefone"]      = $vlr["sufixo_telefone"] ;
      $matriz[$indice]["tipo_atendimento"]     = $vlr["tipo_atendimento"];
      $matriz[$indice]["tipo_ligacao"]         = $vlr["tipo_ligacao"];
      $matriz[$indice]["nome_gravacao"]        = $vlr["nome_gravacao"];
      $matriz[$indice]["midia_id"]             = $vlr["midia_id"];
      $matriz[$indice]["numero_gravacao"]      = $vlr["numero_gravacao"] ;
      $matriz[$indice]["ura_navegacao"]        = $vlr["ura_navegacao"] ;
      $matriz["TOTAL"]["qtd"]                   += 1;
    }while($vlr  = mysql_fetch_assoc($rec));

  } else {
    $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$x." não existe Ligações<br>";
  }
} else {
  if ($session["operador"] == "adm") {
    $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$x." não existe Tabela<br>";
  } else {
    $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$x." não existe Ligações<br>";
  }
}

$vez_volta = $vez+1;
$voltar = "javascript:window.location='dac_con_oper_det.php?carrega_dados=sim';";
$titulo = "Pesquisa Detalhada";
?>
<html>
<head>
   <title><?print $session[sistema]?></title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <?print $v1_style_css?>
<script type="text/javascript" src="consistencia.js"></script>
<script type="text/javascript">
function selecionaAction(relatorio) {
  relatorio = relatorio.split('§');
  programa = relatorio[0];
  document.consulta.action=programa;
}


function InfoMP3(url) {
  strHelpOptions = "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=no";
  strHelpOptions += ",top=";
  strHelpOptions += (screen.availHeight / 2)-(350/2);
  strHelpOptions += ",left=";
  strHelpOptions += ((screen.availWidth / 2)-(600/2));
  strHelpOptions += ",width=270";
  strHelpOptions += ",height=270";
  MP3 = window.open('<?print "http://www2.uranet.com.br/callcenter/";?>obj_getmp3.php?&nmp3='+url,'MP3',strHelpOptions);
  MP3.focus();
}

function imprimeRelatorio(querystring) {
  strHelpOptions =  "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=yes";
  strHelpOptions += ",top=";
  strHelpOptions += (1);
  strHelpOptions += ",left=";
  strHelpOptions += (1);
  strHelpOptions += ",width=800";
  strHelpOptions += ",height=420";
  HistoCliente = window.open('dac_con_oper_lig_impressao.php?'+querystring,'HistoCliente',strHelpOptions);
  HistoCliente.focus();
}

global  = ''
<?
$verde_claro = StrToLower($verde_claro);
?>

function bgColors(globals,obj) {

  if (globals == 'click' && obj.style.background != '<?print $verde_claro?>') {
    obj.style.background='<?print $verde_claro?>'
    global ='true'
  } else {
    if (globals == 'click' && obj.style.background =='<?print $verde_claro?>') {
      obj.style.background='<?print $session["td_dado3"]?>'
      global = false
    }
  }
  if (obj.style.background == '') {
    if (globals == 'over') {
      obj.style.background='<?print $session["td_dado1"]?>'
    }
    if (globals == 'out') {
      obj.style.background='<?print $session["td_dado3"]?>'
    }
  }
}

	function pesquisarTelefone(where){
		document.form.action = "<?print "dac_con_regiao_lig_navegacao.php?tabela=".$tabela_bd."&repre=".$repre."&time=".$time."&where_ant=".$where."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&desc_campo=<br>&nbsp;&nbsp;".$desc_campo."<b> -> Telefone:</b>".$ddd_tel."&titulo_ant=".$titulo."&campo=".$campo;?>&where="+where;
		//alert(document.frm.action);
		document.form.submit();

	}
</script>
</head>
<body>
<?print GerarCabecalho($voltar, $titulo, "", "");?>
<?//if($session["operador"] == "re017738"){echo $vlr;}?>
<?//if($session["operador"] == "re017738"){echo "<pre>"; print_r($vlr);}?>
<br>

<?if ($mes_ini) {?>
  <table border="2" align="center" width="520" bordercolor="<?print $session["td_destaque"]?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session["td_dado1"]?>">
      <?if ($campo     ) {?><td nowrap align="left"><font class="txt5">    <b>&nbsp;&nbsp;Relatório: </b><?print $titulo?></td><?}?>
      <?if ($StrHoraInicio ) {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Entre      </b><?print $StrHoraInicio?><b> e </b><?print $StrHoraFim?></td><?}?>
      <?if ($StrDataInicio ) {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Período de:</b><?print BrDate($StrDataInicio)?><b> até: </b><?print BrDate($StrDataFim)?></td><?}?>
    </tr>
  </table>
  <table border="2" align="center" width="520" bordercolor="<?print $session["td_destaque"]?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session["td_dado1"]?>">
       <?if ($login_operador) { $monta_titulo = $monta_titulo ."<b>Agente Pesquisado: </b> ".$login_operador." ->  ";}?>
       <?if ($ramal) { $monta_titulo = $monta_titulo ."<b>Ramal: </b> ".$ramal." ->  ";}?>
       <?if ($monta_titulo || $desc_campo) {?>
          <td nowrap align="left"><font class="txt5" >&nbsp;&nbsp;<?if ($vez == 0) {$monta_titulo = $monta_titulo.$desc_campo;print $monta_titulo;} else {print $monta_titulo.$desc_campo;}?></td>
       <?}?>
    </tr>
  </table>
  <br>
<?
$servico_passa = urlDecode($servico_passa);
if ($servico || $servico_passa) {
?>
      <table border="0" width="700" align="center">
        <tr>
           <td align="center">
              <table border="2" align="center"  bordercolor="<?print $session["td_destaque"]?>" cellpadding="2" cellspacing="0">
                <tr bgcolor="<?print $session["td_dado1"]?>">
                   <td align="left"><font class="txt5"><b>Serviço(s):</b><?$x=0;if ($servico[$x]) {while($servico[$x]) {$servico_passa  = $servico_passa.$servico[$x]." - ".ValorClasse("URANB",$servico[$x],$repre)." | "; $x++;}};print $servico_passa?></td>
                </tr>
              </table>
           </td>
        </tr>
      </table>
      <br>
<?
   }
}

print $carrega_dados;

  print $paginacao;


print $msg_nao_conectou;
if (($vez<>1)&&($y != "0")) {
?>
	<form name="form" id="form" method="POST" action="">
		<input type="hidden" id="servico_passa" name="servico_passa" value="<?print urlEncode($servico_passa);?>" />
		<input type="hidden" id="monta_titulo" name="monta_titulo" value="<?print $monta_titulo;?>" />
		<table width="500" border="1" cellpadding="0" cellspacing="0" align="center"  style='border-collapse: collapse;'>
			<tr bgcolor="<?print $session["td_destaque"]?>">
			 <td align="left"   colspan ="2"> <font class="txt6"><b>Total: <?print $num_reg;?> </a></font></td>
			 <td align="left"   colspan ="9"><font class="txt6"><b><?print "Pagina: ".$desc_campo1?></font></td>
			 <td align="center" colspan ="2"><font class="txt6"><b>Fila </font></td>
			 <td align="center" colspan ="3" rowspan ="2"><font class="txt6"><b>Gravação </font></td>
			</tr>
			<tr bgcolor="<?print $session["td_destaque1"]?>">
					<td nowrap align="center"><font class="peq"><b>Agente          </font></td>
					<td nowrap align="center"><font class="peq"><b>Ramal           </font></td>
					<td nowrap align="center"><font class="peq"><b>Grupo           </font></td>
					<td nowrap align="center"><font class="peq"><b>Dt.Ligação      </font></td>
	<?
			if ($param_campo == "dettrab") {
	?>
					<td nowrap align="center"><font class="peq"><b>Hr.Lig Ini      </font></td>
					<td nowrap align="center"><font class="peq"><b>Hr.Lig Fim         </font></td>
	<?
			} else {
	?>
					<td nowrap align="center"><font class="peq"><b>Hr. Inicio      </font></td>
					<td nowrap align="center"><font class="peq"><b>Hr. Fim         </font></td>
	<?
			}
	?>
					<td nowrap align="center"><font class="peq"><b>Duração         </font></td>
					<td nowrap align="center"><font class="peq"><b>Intervalo           </font></td>
					<td nowrap align="center"><font class="peq"><b>Telefone        </font></td>
					<td nowrap align="center"><font class="peq"><b>Tipo Ligação    </font></td>
					<td nowrap align="center"><font class="peq"><b>Desligou        </font></td>
					<td nowrap align="center"><font class="peq"><b>Duração         </font></td>
					<td nowrap align="center"><font class="peq"><b>Pos             </font></td>


			 </tr>

		<?
		$soma_duracao = 0;
		$soma_pausa = 0;

		for($x = 0; $x <= $tot_matriz; $x++) {
			$cor  = $session["td_dado3"];
			$cor1 = $session["td_dado1"];
			$fonte = "peq";
			$corclick = $session["td_destaque1"];

			$id_lig           = $matriz[$matriz_aux["indice"][$x]]["id_lig"];
			$duracao_fila     = $matriz[$matriz_aux["indice"][$x]]["duracao_fila"];
			$posicao_fila     = $matriz[$matriz_aux["indice"][$x]]["posicao_fila"];
			$num_seq          = $matriz[$matriz_aux["indice"][$x]]["num"];
			$grupo            = $matriz[$matriz_aux["indice"][$x]]["grupo"];
			$ramal            = $matriz[$matriz_aux["indice"][$x]]["ramal"];
			$desligou         = $matriz[$matriz_aux["indice"][$x]]["desligou"];
			$data_ligacao     = $matriz[$matriz_aux["indice"][$x]]["data_ligacao"];
			$login_operador   = $matriz[$matriz_aux["indice"][$x]]["login_operador"];
			$status_gravacao  = $matriz[$matriz_aux["indice"][$x]]["status_gravacao"];
			$midia_id         = $matriz[$matriz_aux["indice"][$x]]["midia_id"];
			$numero_gravacao  = $matriz[$matriz_aux["indice"][$x]]["numero_gravacao"];
			$hora_ligacao_fim = $matriz[$matriz_aux["indice"][$x]]["hora_ligacao_fim"];
			$hora_ligacao_ini = $matriz[$matriz_aux["indice"][$x]]["hora_ligacao_ini"];
			$duracao_ligacao  = $matriz[$matriz_aux["indice"][$x]]["duracao_ligacao"];
			$nome_gravacao    = $matriz[$matriz_aux["indice"][$x]]["nome_gravacao"];
			$ura_navegacao    = $matriz[$matriz_aux["indice"][$x]]["ura_navegacao"];
			$ddd_tel          = FormataFone($matriz[$matriz_aux["indice"][$x]]["ddd"],$matriz[$matriz_aux["indice"][$x]]["prefixo_telefone"].$matriz[$matriz_aux["indice"][$x]]["sufixo_telefone"]);

			if ($data_ligacao == $matriz[$matriz_aux["indice"][$x-1]]["data_ligacao"]) {
				$pausa = (CalculaSegundos($matriz[$matriz_aux["indice"][$x]]["hora_ligacao_ini"]) - CalculaSegundos($matriz[$matriz_aux["indice"][$x-1]]["hora_ligacao_ini"] )- $matriz[$matriz_aux["indice"][$x-1]]["duracao_ligacao"]);
			} else {
				$pausa = 0;
			}

			$soma_duracao += $duracao_ligacao;
			$soma_pausa += $pausa;


			if ($pausa > "360") {
				$cor_coluna = $vermelho;
			} else {
				$cor_coluna = $session["td_dadp3"];
			}


			//  print $matriz[$matriz_aux["indice"][$x]]["hora_ligacao_ini"]."-".$matriz[$matriz_aux["indice"][$x-1]]["hora_ligacao_ini"]."-".CalcTime($matriz[$matriz_aux["indice"][$x-1]]["duracao_ligacao"])." ==== ".calctime(CalculaSegundos($matriz[$matriz_aux["indice"][$x]]["hora_ligacao_ini"]) - CalculaSegundos($matriz[$matriz_aux["indice"][$x-1]]["hora_ligacao_ini"] )- $matriz[$matriz_aux["indice"][$x-1]]["duracao_ligacao"]);



			if (trim($matriz[$matriz_aux["indice"][$x]]["tipo_atendimento"]) == "A") {
				$tipo_ligacao  = "Ativo - ".ValorClasse("URALA",$matriz[$matriz_aux["indice"][$x]]["tipo_ligacao"],$repre);
			} else if (trim($matriz[$matriz_aux["indice"][$x]]["tipo_atendimento"]) == "H") {
				$tipo_ligacao  = "Chat - ".ValorClasse("URALH",$matriz[$matriz_aux["indice"][$x]]["tipo_ligacao"],$repre);
			} else {
				$tipo_ligacao  = "Receptivo - ".ValorClasse("URALR",$matriz[$matriz_aux["indice"][$x]]["tipo_ligacao"],$repre);
			}


			print  "<tr bgcolor='".$cor."' OnMouseOut=\"Javascript:if (this.style.background !='".$verde_claro."') {style.background='".$session["td_dado3"]."'};bgColors('out',this)\" onClick=\"bgColors('click',this)\" onMouseOver=\"Javascript:if (this.style.background !='".$verde_claro."') {style.background='".$session["td_dado1"]."'};bgColors('over',this)\"  >";

		?>
					<td  nowrap align="left" ><font class="<?print $fonte?>">&nbsp;
						 <?
						 if (strtoupper($session["operador"]) == "ADM") {
	?>
							 <a href="JavaScript:VisualizarTabela('<?print TRIM($num_seq)?>', '<?print $tabela_bd?>', 'num', 'LogUra')"><?print STRTOUPPER(NomeResumido($login_operador))."(".$login_operador.")";?>
	<?
						 } else {
							 print STRTOUPPER(NomeResumido($login_operador))."(".$login_operador.")";
						 }?>
						 &nbsp;</b></font>
					</td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?print $ramal           ;?>        &nbsp;</b></font></td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?print $grupo           ;?>        &nbsp;</b></font></td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?print BrDate($data_ligacao);?>    &nbsp;</b></font></td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?print $hora_ligacao_ini;?>        &nbsp;</b></font></td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?print $hora_ligacao_fim;?>        &nbsp;</b></font></td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp;<?print VerificaTime($time,$duracao_ligacao) ;?>&nbsp;</b></font></td>
					<td nowrap align="right" bgcolor="<?print $cor_coluna?>">
						<font class="<?print $fonte?>">
							&nbsp;
	<?
	//          if ($pausa < 0) {
	//            print "<font class='txtvermelho3'>- ".VerificaTime($time,($pausa * -1))."</font>";
	//          } else {
							 print VerificaTime($time,$pausa);
	//          }
	?>
							&nbsp;
							</b>
						</font>
					</td>
					<td nowrap align="right" ><font class="<?print $fonte?>">&nbsp; <?if ($ura_navegacao) {print   "<a style=\"cursor:pointer;text-decoration: none;color:#000000;font-size:10px;\" onclick=\"javascript:pesquisarTelefone('".urlEncode("WHERE num ='".$num_seq."'")."'); style.background='".$corclick."';\">";};print "<strong>".$ddd_tel."</strong>";?></a>&nbsp;</font></td>
					<td nowrap align="left"  ><font class="<?print $fonte?>">&nbsp; <?print $tipo_ligacao    ;?>        &nbsp;</b></font></td>
					<td nowrap align="left"  ><font class="<?print $fonte?>">&nbsp; <?print ValorClasse("URADL",$desligou,$repre);?>&nbsp;</b></font></td>
					<td nowrap align="center"><font class="<?print $fonte?>">&nbsp; <?print VerificaTime($time,$duracao_fila)?>&nbsp;</b></font></td>
					<td nowrap align="center"><font class="<?print $fonte?>">&nbsp; <?print $posicao_fila?>             &nbsp;</b></font></td>

					<!--<td  nowrap align="left"  ><font class="<?print $fonte?>">&nbsp; <?print $numero_gravacao;?>         &nbsp;</b></font></td>-->
					<td nowrap align="center" class="<?print $fonte?>">
						<?
						$mensagem = "Grupo: ".$grupo." - Agente: ".$login_operador." - ".NomeResumido($login_operador)." - Telefone: ".str_replace("&nbsp;", " ", $ddd_tel);
						print IAPGravacao($nome_gravacao, "", $mensagem, $connect2);
						?>
					</td>
			 </tr>
		 <?
		 $hora_ligacao_fim = 0 ;
		 $hora_ligacao_ini = 0 ;
		 $duracao_ligacao  = 0 ;
		 $ddd_tel          = 0 ;
		 $tipo_ligacao     = 0 ;
		 $total_reg       += 1 ;
		}

		 ?>
			 <tr  bgcolor="<?print $session["td_destaque"]?>">
					<?
					if ($param_campo == "dettrab") {
					?>
						<td colspan="6" align="left"><font class="txt6"><b>TOTAL</b></font></td>
						<td align="center"><font class="txt6"><b><?print VerificaTime($time,$soma_duracao);?></b></font></td>
						<td align="center"><font class="txt6"><b><?print VerificaTime($time,$soma_pausa);?></b></font></td>
						<td colspan="6" align="right"><font class="txt6"><b>&nbsp;   <?print $total_reg;?>    &nbsp;</b></font></td>
					<?
					} else {
					?>
						<td colspan="13" align="left"><font class="txt6"><b>TOTAL</b></font></td>
						<td align="right"><font class="txt6"><b>&nbsp;   <?print $total_reg;?>    &nbsp;</b></font></td>
					<?
					}
					?>

			 </tr>

		</table>
	</form>
  <BR>
<?}?>
<?print GerarRodape($voltar)?>
</body>
</html>
