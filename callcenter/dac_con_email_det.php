<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}

require_once ("carregando.php");
require_once ("funcoes/BDADOFuncoes.php");

//PEGANDO O ÚLTIMO ANO_MES EM QUE FORAM MOVIDOS OS REGISTROS DA TB_EMAIL_FAX
$ultimo_anomes_movido = ValorClasse("EFPAR", "UltAnoMes", "URANET");

?>
<script language="javascript">
<!--
ap_showWaitMessage('waitDiv', 1);
function CarregaAtend(obj) {
  document.consulta.atendimento.value = obj.value;
  document.consulta.st_atendimento.value = 'TODOS';
  document.consulta.submit();
}

-->
</script>
<?

if ($deonde == "DACNET") {
//  if (!$repre) {
//    $repre           = "CONTACTPAN";
//    $relatorio       = "dac_con_oper_det.php§login_operador§login_operador";
//    $time            = "min";//min ou seg";
//    $s[0]            = "4001";
//  }

  $pag = 1;
  $busca = "ok";
  $procura = "OK";
  $hora_ini = "00";
  $min_ini = "00";
  $hora_fim = "24";
  $min_fim =  "00";
  $dia_ini = date("d");
  $mes_ini = date("m");
  $ano_ini = date("Y");
  $dia_fim = date("d");
  $mes_fim = date("m");
  $ano_fim = date("Y");

  $classe_servico  = "GRATE";
  $ramal           =  "";
  $grupo           = "" ;
  $equipe          = "";
  $classe_tipo = "todos";
  $tipo_telefone = "ambos";

  $ddd = "" ;
  $tel_prefixo ="";
  $tel_sufixo = "";
}

if (!$repre) {
  $repre = $session["representante"];
}

$connect  = ConnectDB();
$connect2 = ConnectSISTEMA();


require_once("gambi_dac_grupo_switch.php");
require_once("/libs/ctr/DataManager.php");
if ($pag == 1) {
  $data_man_grava = new DataManager($session["operador"]);
  $data_man_grava->gravaDados("filtro_email_fax" ,$_REQUEST);
}

if ($_GET["carrega_dados"] == "sim") {
  $data_man_recupera = new DataManager($session["operador"]);
  $data_man_recupera->carrega("filtro_email_fax");
  $data_man_recupera->criaVars();
  /*print "<pre>";
  print_r ($data_man_recupera);
  exit;*/
  if ($relatorio) {
    $array_relatorio = split("§", $relatorio);
    $programa = $array_relatorio[0];
    if ($PHP_SELF != "/".DOCROOT.$programa) {
      header ("Location:".HTTPHOST.DOCROOT.$programa."?carrega_dados=sim");
      exit;
    }
  }
}

if (!$situacao) {
  $situacao = "todos";
}

if (!$selecao_data) {
  $selecao_data = "data_ligacao,hora_ligacao_ini";
}

if ($StrDataInicio) {
  $dia_ini = Substr($StrDataInicio,"8","2");
  $mes_ini = Substr($StrDataInicio,"5","2");
  $ano_ini = Substr($StrDataInicio,"0","4");

  $dia_fim = Substr($StrDataFim,"8","2");
  $mes_fim = Substr($StrDataFim,"5","2");
  $ano_fim = Substr($StrDataFim ,"0","4");


  $hora_ini = Substr($StrHoraInicio,"0","2");
  $min_ini  = Substr($StrHoraInicio,"3","5");


  $hora_fim = Substr($StrHoraFim,"0","2");
  $min_fim  = Substr($StrHoraFim,"3","5");
} else {
  $StrDataInicio = $ano_ini.'-'.$mes_ini.'-'.$dia_ini;
  $StrDataFim    = $ano_fim.'-'.$mes_fim.'-'.$dia_fim;

  $StrHoraInicio = $hora_ini.':'.$min_ini;
  $StrHoraFim    = $hora_fim.':'.$min_fim;

  $arr_selecao_data = explode(",", $selecao_data);
  $data_where = $arr_selecao_data[0];
  $hora_where = $arr_selecao_data[1];
}

if ($relatorio) {
  //Dividindo o VlrClasse da pesquisa em um array
  //com a posicao [0] o nome do programa
  //e a posicao [1] o campo do BD*************
  $array_relatorio = split("§", $relatorio);
  $programa = $array_relatorio[0];
  $campo    = $array_relatorio[1];
  if (Substr($campo,0,1) == "¢") {
    $tp_lig_especial = "sim";
    $campo = Substr($campo,1);
  } else {
    $tp_lig_especial = "";
  }

  if ($array_relatorio[2]) {
    $aux_campo1 = explode("¢", $array_relatorio[2]);
    if ($aux_campo1[1] == "") {
      $campo1        = $array_relatorio[2];
    } else {
      $campo1        = $aux_campo1[0];
      $classe_campo1 = $aux_campo1[1];
    }
  } else {
    $campo1        = "";
    $classe_campo1 = "";
  }

  if ($array_relatorio[3]) {
    $campo_extra = $array_relatorio[3];
  } else {
    $campo_extra = "";
  }
  //********************************************************
}

//Verificando qual o programa que esta sendo executado e fazendo a suas arvores

$tipo_registro = "L";
switch($campo) {
  default:
    $campo       = $campo;
    $campo1      = $campo1;
    $campo_extra = $campo_extra;
    $campo_prox  = "det";
    $campo_prox1 = "det";
    $prog_ant    = "dac_con_email_det.php";
    $prog_prox   = "dac_con_email_lig.php";
    break;
}

switch($campo1) {
  case "rede":
    $campo1 = "concat(ura_grupo,'¢',ura_maquina)";
    break;
  case "tlig":
    $campo1 = "tipo_ligacao";
    break;
}
$classe = "URAE1";
if ($tipo_email_fax == "M") {
  $classe = "URAE7";
}
$arr_tit_campo = explode("-", ValorClasse($classe, $relatorio, $repre));
if ($arr_tit_campo[0]) {
  $titulo  = $arr_tit_campo[0];
}
if ($arr_tit_campo[1]) {
  $titulo1 = $arr_tit_campo[1];
}


//**********************************CAMPOS QUE FAZ O RELATORIO IR PARA A RESUMO**********************
//***************************************************************************************************


$campos_tbresumo[0] = "nb";
$campos_tbresumo[1] = "data_ligacao";
$campos_tbresumo[2] = "tipo_ligacao";
$campos_tbresumo[3] = "hora_ligacao_ini";
$campos_tbresumo[4] = "grupo";
$campos_tbresumo[5] = "tipo_registro";
$campos_tbresumo[6] = "empresa";
$campos_tbresumo[7] = "dia_ligacao";
$campos_tbresumo[8] = "tipo_atendimento";
$campos_tbresumo[9] = "hora_ligacao";
$campos_tbresumo[10] = "duracao_ligacao";
$campos_tbresumo[11] = "duracao_fila";
$campos_tbresumo[12] = "duracao_abfila";
$campos_tbresumo[13] = "duracao_operador";
$campos_tbresumo[14] = "duracao_resposta";
$campos_tbresumo[15] = "qtd_ligacao";
$campos_tbresumo[16] = "qtd_ligacao_fila";
$campos_tbresumo[17] = "qtd_ligacao_operador";
$campos_tbresumo[18] = "qtd_ligacao_abfila";
$campos_tbresumo[19] = "qtd_operador_ideal";
$campos_tbresumo[20] = "qtd_abfila_ideal";
$campos_tbresumo[21] = "tempo_maior_chamada";
$campos_tbresumo[22] = "tempo_maior_fila";
$campos_tbresumo[23] = "tempo_maior_abfila";
$campos_tbresumo[24] = "tempo_maior_operador";
$campos_tbresumo[25] = "tempo_maior_resposta";
$campos_tbresumo[26] = "ideal_tma";
$campos_tbresumo[27] = "interv_tma";
$campos_tbresumo[28] = "qtd_tma_1";
$campos_tbresumo[29] = "qtd_tma_2";
$campos_tbresumo[30] = "qtd_tma_3";
$campos_tbresumo[31] = "qtd_tma_4";
$campos_tbresumo[32] = "qtd_tma_mais";
$campos_tbresumo[33] = "ideal_tempo_fila";
$campos_tbresumo[34] = "interv_fila";
$campos_tbresumo[35] = "qtd_atend_fila_0";
$campos_tbresumo[36] = "qtd_atend_fila_1";
$campos_tbresumo[37] = "qtd_atend_fila_2";
$campos_tbresumo[38] = "qtd_atend_fila_3";
$campos_tbresumo[39] = "qtd_atend_fila_4";
$campos_tbresumo[40] = "qtd_atend_fila_mais";
$campos_tbresumo[41] = "interv_aband";
$campos_tbresumo[42] = "qtd_abfila_1";
$campos_tbresumo[43] = "qtd_abfila_2";
$campos_tbresumo[44] = "qtd_abfila_3";
$campos_tbresumo[45] = "qtd_abfila_4";
$campos_tbresumo[46] = "qtd_abfila_mais";

$campos_tbresumo[47] = "hora_envio";
$campos_tbresumo[48] = "hora_agenda";

if ($campo) {
  if (BuscaNaMatriz($campos_tbresumo , $campo) != -1 ) {
    $resumo_campo = "S";
  } else {
    $resumo_campo = "N";
  }
} else {
  $resumo_campo = "S";
}
if ($resumo_campo == "S") {
  if ($campo1) {
    if (BuscaNaMatriz($campos_tbresumo , $campo1) != -1 ) {
      $resumo_campo1 = "S";
    } else {
      $resumo_campo1 = "N";
    }
  } else {
    $resumo_campo1 = "S";
  }
}
if ($resumo_campo1 == "S") {
  if ($campo_extra) {
    if (BuscaNaMatriz($campos_tbresumo , $campo_extra) != -1 ) {
      $resumo_campo_extra = "S";
    } else {
      $resumo_campo_extra = "N";
    }
  } else {
    $resumo_campo_extra = "S";
  }
}

//*************************************************************************************************
//************************************ ---- Preparando os Wheres ------ ***************************
//*************************************************************************************************

if ($tipo_arquivo != "TODOS" && $tipo_arquivo) {
  $where_tipo_arquivo = " AND tipo_arquivo='".$tipo_arquivo."' ";
}

if (!$where) {
  $where = "Where ";


  //*************Preparando o where dos servicos selecionados*********
  $x = 0;

  While($s[$x]) {
    if ($x == "0") {
      $where = $where." grupo in('".$s[$x]."'";
    } else {
      $where = $where.",'".$s[$x]."'";
    }
    $x++;
  }
  $where = $where.")";
  //******************************************************************

  if ($StrDataInicio == $StrDataFim) {
    $where = $where." and ".$data_where." = '".$StrDataInicio."'";
  } else {
    $where = $where." and  ".$data_where." between '".$StrDataInicio."' and '".$StrDataFim."'";
  }
  if ($StrHoraInicio != "00:00" || $StrHoraFim != "24:00") {
    $where = $where." and ".$hora_where." between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
  }

  if ($tp_lig_especial) {
    $where = $where." and tipo_ligacao in ('001','002') ";
  }

  if ($ramal) {
    $where = $where." and ramal = '".$ramal."'  ";
  }
  if ($grupo) {
    $where.= gambiDacGrupoWhere($grupo);
  }
  if ($tp_ligacao) {
    $where = $where." and tipo_ligacao ='".$tp_ligacao."' ";
  }
  if ($login_operador) {
    $where = $where." and login_operador = '".$login_operador."'  ";
  }
  if ($status) {
    if ($status != "T") {
      $where = $where." and resultado_ligacao = '".$status."'  ";
    }
  }
  if ($hora_operador) {
    $where = $where." and hora_ligacao = '".$hora_ligacao."'  ";
  }

  if ($campo_email) {
    $where = $where." and ".$campo_consulta." like '%".$campo_email."%'  ";
  }

  if ($campo_ddd) {
    $ddd = $campo_ddd;
  }
  if ($campo_fone) {
    $tel_prefixo = substr($campo_fone,0,-4);
    $tel_sufixo  = substr($campo_fone,-4);
  }

  if ($ddd) {
    $where = $where." and ddd = '".$ddd."'  ";
  } else {
    $arr_ddd = Split(",",ValorSelecaoDDD($session["operador"]));
    $x=0;
    if ($arr_ddd[0] != "----") {
      While($arr_ddd[$x]) {
        if ($x == "0") {
          $where = $where." and ddd in('".$arr_ddd[$x]."'";
        } else {
          $where = $where.",'".$arr_ddd[$x]."'";
        }
        $x++;
      }
      $where = $where." )  ";
    }
  }

  if ($tel_prefixo) {
    $where = $where." and prefixo_telefone like '".$tel_prefixo."%'  ";
  }
  if ($tel_sufixo) {
    $where = $where." and sufixo_telefone like '".$tel_sufixo."%'  ";
  }

  if ($tipo_telefone == "celular") {
    $where = $where." and prefixo_telefone >= '6000' AND ddi = '55' ";
  }
  if ($tipo_telefone == "fixo") {
    $where = $where." and prefixo_telefone < '6000' AND ddi = '55' ";
  }
  if ($tipo_telefone == "ddi") {
    $where = $where." AND ddi <> '55' ";
  }
  //****************************************************************
  //****************quebra galho************************************
  if ($qg_lote ) {
    $where = $where." and equipe = '".$qg_lote."'  ";
  }
  if ($qg_nrc ) {
    $where = $where." and login_operador = '".$qg_nrc."'  ";
  }
  if ($atendimento && $st_atendimento != "TODOS") {
    $where = $where." and tipo_atendimento = '".$atendimento."' ";
  }
  if ($st_atendimento && $st_atendimento != "TODOS") {
    $where = $where." and tipo_ligacao = '".$st_atendimento."' ";
  }

} else {
  $where = str_replace("\'" , "'" ,$where);
  if ($campo_ant == "ura_navegacao") {
    if (trim($vlr_campo) == "S") {
      $where = $where."and (".$campo_ant." = '' || isnull(".$campo_ant.")) ";
    } else {
      $where = $where."and (".$campo_ant." like '%;".trim($vlr_campo).";%' || ".$campo_ant." like '%;".trim($vlr_campo)."'  || ".$campo_ant." like '".trim($vlr_campo).";%'  || ".$campo_ant." = '".trim($vlr_campo)."')";
    }
  } else {
    switch($campo_ant) {
      case substr($campo_ant, 0, 4) == "data":
      case "nb":
      case "grupo":
      case "ddd":
      case "tipo_ligacao":
      case "tipo_atendimento":
      case "uf":
      case "estado":
      case "cidade":
      case "prefixo_telefone":
      case "sufixo_telefone":
        $where = $where."and ".$campo_ant." = '".trim($vlr_campo)."'";
        break;
      default:
        $where = $where."and ".$campo_ant." like '".trim($vlr_campo)."%'";
        break;
    }

  }

  if (($campo_ant1) && ($campo_ant1 != $campo_ant)) {
    if ($campo_ant1 == "ura_navegacao") {
      $where = $where."and ".$campo_ant1." like '%".trim($vlr_campo1)."%'";
    } else {
      $where = $where."and ".$campo_ant1." like '".trim($vlr_campo1)."%'";
    }

  }
}

if ($situacao && $situacao != "todos") {
  if ($tipo_email_fax == "M") {
    $where .= " AND status = '".$situacao."' ";
  } else {
    $where .= " AND status_envio = '".$situacao."' ";
  }
}

if ($maquinas && $maquinas != "T") {
  if (($campo1) && ($campo1 != $campo)) {
    if ($campo1 == "concat(ura_grupo,'¢',ura_maquina)") {
      $where = $where."and ".$campo1." = '".trim($maquinas)."'";
    } else {
      $where = $where."and ".$campo." = '".trim($maquinas)."'";
    }

  }
}

if ($tira_duplicidade == "sim") {
  $group_by_duplicidade = " , ddd , prefixo_telefone , sufixo_telefone";
}

$ano_mes_ini = substr($ano_ini, 2, 2).$mes_ini;
$ano_mes_fim = substr($ano_fim, 2, 2).$mes_fim;
$y = 0;
if ($ano_mes_ini <= $ano_mes_fim && $mes_ini != "" && $procura == "OK") {
  $ano_mes = $ano_mes_ini;
  while($ano_mes <= $ano_mes_fim) {
    if (substr($campo1, 0, 4) == "hora") {
      $var_campo1 =  "left(".$campo1.",2) as ".$campo1;
    } else {
      $var_campo1 = $campo1;
    }
    if ($classe_campo1 != "") {
      $var_classe_campo1 =  $classe_campo1.",";
    }
    if (substr($campo, 0, 4) == "hora") {
      $var_campo =  "left(".$campo.",2) as ".$campo;
    } else {
      $var_campo = $campo;
    }
    if (StrPos($where, "grupo in(")) {
      for($x=StrPos($where, "grupo in(");($char_where != ")" && $x < 4000)  ;$x++ ) {
        $char_where = Substr($where,$x,1);
        $string_nb .= $char_where;
      }

    }

		if ($define_equipe != "" || $define_equipe != NULL) {
      $where = $where." AND equipe = '".$define_equipe."' ";
		}

    if ($tipo_nv == "numerico") {
      $campo_tipo_nv = " ura_navegacao ";
    }

    $string_nb_arr = Str_Replace("'","",$string_nb);
    $string_nb_arr = Str_Replace("grupo in(","",$string_nb_arr);
    $string_nb_arr = Str_Replace(")","",$string_nb_arr);
    $arr_nb = Split(",",$string_nb_arr);
    for($x_nb=0;$arr_nb[$x_nb];$x_nb++) {

      if($arr_nb[$x_nb] == "E999" || $arr_nb[$x_nb] == "E994") {
        $where_repre = " AND representante = '".$repre."'";
        $where .= $where_repre;
      }
      $where_nb = Str_Replace($string_nb," grupo = '".$arr_nb[$x_nb]."'",$where);
      if ($imprime_duracao == "sim") {
        $sum_duracao = " SUM(duracao_ligacao) AS duracao_ligacao";
      }

      $campos_select = "";
      $campos_group  = "";
      if ($var_classe_campo1) {
        $campos_select .= $var_classe_campo1.", ";
        $campos_group  .= $var_classe_campo1.", ";
      }
      if ($campo_extra) {
        $campos_select .= $campo_extra      .", ";
        $campos_group  .= $campo_extra      .", ";
      }
      if ($var_campo) {
        $campos_select .= $var_campo        .", ";
        $campos_group  .= $campo            .", ";
      }
      if ($var_campo1) {
        $campos_select .= $var_campo1       .", ";
        $campos_group  .= $campo1           .", ";
      }
      if ($sum_duracao) {
        $campos_select .= $sum_duracao      .", ";
      }
      if ($campo_tipo_nv) {
        $campos_select .= $campo_tipo_nv    .", ";
      }

      $campos_group = trim($campos_group);
      if (substr($campos_group, -1) == ",") {
        $campos_group = substr($campos_group, 0, strlen($campos_group) -1);
      }

      if ($tipo_email_fax == "B" && $repre != "URANET") {
        $where_repre = " AND representante='".$repre."' ";
      }

      if ($tipo_email_fax != "M" && $tipo_email_fax != "B") {
        $where_tipo_reg = " AND tipo_registro = '".$tipo_email_fax."' ";
      }

      if ($tipo_email_fax == "R") {
	    $where_tipo_reg = " AND tipo_registro = 'S' ";
      }

			if($define_equipe != "" || $define_equipe != NULL){
				$where_define_equipe = " AND equipe = '".$define_equipe."' ";
			}


      if ($tipo_email_fax == "M") {
        $connect2 = connectBDADO("bd_email");
        $sql = "SELECT empresa,grupo,data_ligacao,email_origem,email_recebido,assunto,nome_gravacao,data_cri,hora_cri,data_agenda,hora_agenda,hora_ligacao_ini,status,email_destino,email_recebido,email_qtd_anexo, COUNT(*) AS total FROM tb_email_rec_".$ano_mes." ".$where_nb." ".$where_tipo_reg.$where_repre." GROUP BY ".$campos_group." ".$group_by_duplicidade." ".$order;
      } else {
        //Se a consulta for mais antiga que a última data de movimentação da EFPAR (URANET), busca os registros na tabela anual daquele ano desejado
        if ( $ano_ini.$mes_ini <= intval($ultimo_anomes_movido) ) {
          $tabela_email_fax = "tb_email_fax_20".substr($ano_mes, 0, 2);

        } else {
          $tabela_email_fax = "tb_email_fax";
        }

        $sql = "SELECT ".$campos_select." COUNT(*) AS total FROM ".$tabela_email_fax." ".$where_nb.$where_tipo_arquivo." ".$where_tipo_reg.$where_repre." ".$where_define_equipe." GROUP BY ".$campos_group." ".$group_by_duplicidade." ".$order;
        if ($mes_ini != $mes_fim) {
          if ($ano_mes == $ano_mes_fim) {
            break;
          }
        }
      }

      if ($rec = DescExecQuery($sql, $connect2)) {
        if ($vlr = mysql_fetch_assoc($rec)) {
          do{
            if ($tipo_nv == "numerico" && trim($vlr_campo) < 10) {
              $incluir = "";
              $arr_indice = Split(";",$vlr[str_replace(",","",$campo_tipo_nv)]);
              $x_tipo_nv = count($arr_indice);
              for($y_nv=0;$y_nv<$x_tipo_nv;$y_nv++) {
                if ($arr_indice[$y_nv] == trim($vlr_campo)) {
                  for($x_nv=$y_nv;$x_nv<$x_tipo_nv;$x_nv++) {
                    if (is_numeric($arr_indice[$x_nv])) {
                      if ((trim($vlr_campo) == substr($arr_indice[$x_nv],0,1)) && $x_nv != $y_nv) {
                        $incluir = "S";
                      }
                    }
                  }
                }
              }
              if ($incluir != "S") {
                continue;
              }
            }

            if ($tira_duplicidade == "sim") {
              $vlr['total'] =1;
            }
            if ($vlr['total'] >= $qtd_lig) {
              $var_aux_campo       = completa($vlr[$campo],"40"," ","D");
              if ($campo1 == "varchar1") {
                $var_aux_campo1      = $vlr[$campo1];
                if ($classe_campo1) {
                  $var_aux_classe_campo1 = $vlr[$classe_campo1];
                }
              } else {
                $var_aux_campo1      = completa($vlr[$campo1],"40"," ","D");
                if ($classe_campo1) {
                  $var_aux_classe_campo1 = $vlr[$classe_campo1];
                }
              }

              $var_aux_campo_extra = completa($vlr[$campo_extra],"10"," ","D");
              $indice              = $var_aux_classe_campo1.$var_aux_campo.$var_aux_campo1.$var_aux_campo_extra;
              if ((BuscaNaMatriz($matriz_aux['indice'] , $indice) == -1)) {
                $matriz_aux['indice'][$y] = $indice;

                $matriz[$indice][$campo        ] = $var_aux_campo;
                $matriz[$indice][$campo1       ] = $var_aux_campo1;
                $matriz[$indice][$classe_campo1] = $var_aux_classe_campo1;
                $matriz[$indice][$campo_extra  ] = $var_aux_campo_extra;

                if ($y > $tot_matriz) {$tot_matriz = $y;}
                $y++;
              }

              $matriz[$indice]['duracao']                 += $vlr['duracao_ligacao'];
              $matriz_sub[$vlr[$campo]]['SUBTOTAL_TEMPO'] += $vlr['duracao_ligacao'];
              $matriz['TOTAL_TEMPO']['qtd']                 += $vlr['duracao_ligacao'];

              $matriz[$indice]['qtd']               += $vlr['total'];
              $matriz_sub[$vlr[$campo]]['SUBTOTAL'] += $vlr['total'];
              $matriz['TOTAL']['qtd']                 += $vlr['total'];
            }
          }while($vlr = mysql_fetch_assoc($rec));
        } else {
          $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
        }
      } else {
        if ($session["operador"] == "adm") {
          $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Tabela<br>";
        } else {
          $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
        }
      }
    }
    $ano_mes = inc_ano_mes($ano_mes);
  }
}

//************Ordenando a matriz para impressao*************************

if (is_array($matriz_aux["indice"])) {
  sort($matriz_aux["indice"]);
}

//***********************************************************************

if ($pag) {
  $voltar = "cc_consulta.php?nivel=F";
} else {
  $voltar = "cc_consulta.php?nivel=F";
  //$voltar = "dac_con_relacionamento_v2.php";
}

if ($deonde != "DACNET") {
  if ($mes_ini) {
    $tabelao_titulo.="<table border=0 width=650 cellpadding=2 cellspacing=0>";
    $tabelao_titulo.="   <tr>";
    $tabelao_titulo.="      <td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;".ValorClasse("REPRE",$repre,"URANET")."</td>";
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="   <tr>";
    if ($campo) {
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Relatório:</b>".$titulo." - <b> Período: </b>".BrDate($StrDataInicio)." à ".BrDate($StrDataFim)." - ".$StrHoraInicio." à".$StrHoraFim."</td>";
    }
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="</table>";
    $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
    $tabelao_titulo.="   <tr>";
    if ($ddd                          ) {$monta_titulo1 .= "<b>DDD: </b> ".$ddd." ->  ";}
    if ($tipo_telefone                ) {$monta_titulo1 .= "<b>Tipo de Telefone: </b> ".Strtoupper($tipo_telefone)." ->  ";}
    $tabelao_titulo.="   </tr><tr>";
    if ($atendimento                  ) {$monta_titulo1  .= "<b>Tipo Atendimento: </b> ".Strtoupper($atendimento)."  ";}
    if ($grupo) {
      $monta_titulo.= gambiDacGrupoTit($grupo);
    }
    if ($tel_prefixo  || $tel_sufixo  ) {$monta_titulo1 .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}
    if ($ramal         ) {
      $tabelao_titulo1 .="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Ramal:</b>".$ramal."</td>";
    }
    if ($monta_titulo ||$monta_titulo1 || $desc_campo) {
      $monta_titulo1 =  $monta_titulo.$monta_titulo1.$desc_campo;
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'>&nbsp;".$monta_titulo1."</td>";
    }
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="</table>";
    if ($s || $s_passa) {
      $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
      $tabelao_titulo.="   <tr>";
      $tabelao_titulo.="      <td>";
      $tabelao_titulo.="         <table border=0 align='left' cellpadding='0' cellspacing='0'>";
      $tabelao_titulo.="           <tr>";
      $tabelao_titulo.="              <td align='left'><font class='txt5'><b>&nbsp;&nbsp; Serviço(s): </b>";
      $x=0;
      if ($tipo_email_fax == "M") {
        if ($s[$x]) {
          while($s[$x]) {
            $s_passa1  = $s_passa1.$s[$x]." - ".ValorClasse("URAFI",$s[$x].'M',$repre)."  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            $x++;
          }
        };
      } else {
        if ($s[$x]) {
          while($s[$x]) {
            $s_passa1  = $s_passa1.$s[$x]." - ".ValorClasse("GRATE",$s[$x],$repre)."  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            $x++;
          }
        };
      }
      $tabelao_titulo.=                $s_passa1."</td>";
      $tabelao_titulo.="           </tr>";
      $tabelao_titulo.="         </table>";
      $tabelao_titulo.="      </td>";
      $tabelao_titulo.="   </tr>";
      $tabelao_titulo.=" </table>";
      $tabelao_titulo.=" <BR><BR>";
    }
  }

}

if ($tipo_nv) {
  $titulo_cabecalho = "Pesquisa";
} else {
  if ($faz_manutencao == "S") {
    $titulo_cabecalho = "Manutenção Email/Fax";
  } else {
    $titulo_cabecalho = "Estatística Email/Fax";
  }
}

$titulo_grafico=$titulo_cabecalho;

if ($mes_ini) {
  $titulo_cabecalho .= " de - ".BRdate($StrDataInicio)." até ".BRdate($StrDataFim);
} else {
  $titulo_cabecalho .= " - Faça sua Pesquisa";
}

?>

<html>
<head>
   <title><?print $session['sistema']?></title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <?print $v1_style_css?>
<script language="javascript" type="text/javascript" src="consistencia.js"></script>
<script language="javascript">
<!--
function mudaRepre() {
  document.consulta.tipo_email_fax.value='';
  document.consulta.procura.value = '';
  document.consulta.submit();
}


function selecionaAction(relatorio) {
  relatorio = relatorio.split('§');
  programa = relatorio[0];
  //alert(relatorio[1])
  if (relatorio[1] == 'qtd_tel') {
    document.consulta.qtd_lig.disabled = false;
    document.consulta.qtd_lig.value = '5';
  } else {
    document.consulta.qtd_lig.value = '';
    document.consulta.qtd_lig.disabled = true;
  }
  if (relatorio[1] == 'gerencial_nb') {
    document.consulta.servico.disabled=true;
    document.consulta.servico.consistencia='';
  } else {
    document.consulta.servico.disabled=false;
    document.consulta.servico.consistencia='sempre';
  }
  document.consulta.action=programa;
}
function VerificaForm() {
  data_ini = document.consulta.ano_ini.value+'-'+document.consulta.mes_ini.value+'-'+document.consulta.dia_ini.value;
  data_fim = document.consulta.ano_fim.value+'-'+document.consulta.mes_fim.value+'-'+document.consulta.dia_fim.value;

  date_ini = new Date(document.consulta.ano_ini.value, (document.consulta.mes_ini.value - 1), document.consulta.dia_ini.value);
  date_fim = new Date(document.consulta.ano_fim.value, (document.consulta.mes_fim.value - 1), document.consulta.dia_fim.value);

  if ((document.consulta.data_inicio_nivel.value <= data_ini) && (document.consulta.data_inicio_oper.value <= data_ini)) {
    if (date_fim < date_ini) {
      alert('Data inicial da pesquisa deve ser menor do que a data final.');
      return false;
    }
    if ((date_fim - date_ini)/86400000 <= 60) {
      if (checa(document.consulta)) {
        document.consulta.procura.value = 'OK';
        document.consulta.submit();
      }
    } else {
      alert('O intervalo máximo para consulta é de 60 dias.');
    }
  } else {
    if (document.consulta.data_inicio_nivel.value >= data_ini) {
      ano_nivel = document.consulta.data_inicio_nivel.value.substring(0,4);
      mes_nivel = document.consulta.data_inicio_nivel.value.substring(5,7);
      dia_nivel = document.consulta.data_inicio_nivel.value.substring(8,10);
      alert('Consulta disponivel a partir de '+ dia_nivel+'/'+mes_nivel+'/'+ano_nivel);
    }
    if (document.consulta.data_inicio_oper.value >= data_ini) {
      ano_oper = document.consulta.data_inicio_oper.value.substring(0,4);
      mes_oper = document.consulta.data_inicio_oper.value.substring(5,7);
      dia_oper = document.consulta.data_inicio_oper.value.substring(8,10);
      alert('Consulta disponivel a partir de '+ dia_oper+'/'+mes_oper+'/'+ano_oper);
    }
  }
}

function imprimeRelatorio(tipo) {
  document.simula.tipo.value=tipo;
  strHelpOptions =  "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=yes";
  strHelpOptions += ",top=1";
  strHelpOptions += ",left=1";
  strHelpOptions += ",width=720";
  strHelpOptions += ",height=520";
  Janela = window.open('', 'Janela', strHelpOptions);
  Janela.focus();
  document.simula.submit();
}

-->
</script>
</head>
<body>

<?
print GerarCabecalho($voltar, $titulo_cabecalho, "", "");

if ($deonde != "DACNET") {

  if ($mes_ini && $procura == "OK") {?>
    <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
      <tr bgcolor="<?print $session['td_dado1']?>">
        <?if ($campo     ) {?><td nowrap align="left"><font class="txt5">    <b>&nbsp;&nbsp;Relatório: </b><?print $titulo;$titulo_grafico.=" - ".$titulo;?></td><?}?>
        <?if ($StrHoraInicio ) {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Entre:     </b><?print $StrHoraInicio?> e <?print $StrHoraFim?></td><?}?>
        <?if ($StrDataInicio ) {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Período:   </b><?print BrDate($StrDataInicio)?> a <?print BrDate($StrDataFim)?></td><?}?>
        <?if ($situacao && $situacao != "todos") {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Situação:   </b><?print ValorClasse("URAE3", $situacao, $repre)?></td><?}?>
      </tr>
    </table>
    <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
      <tr bgcolor="<?print $session['td_dado1']?>">
         <?if ($ddd                          ) { $monta_titulo = $monta_titulo ."<b>DDD: </b> ".$ddd." ->  ";}?>
         <?if ($tipo_telefone                ) { $monta_titulo .= "<b>Tipo de Telefone: </b> ".Strtoupper($tipo_telefone)." ->  ";}?>
         <?
         if ($grupo) {
          $monta_titulo.= gambiDacGrupoTit($grupo);
         }
         ?>

         <?if ($tel_prefixo  || $tel_sufixo  ) { $monta_titulo .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}?>
         <?if ($ramal                        ) {?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Ramal:      </b><?print $ramal;?></td><?}?>
         <?if ($monta_titulo || $desc_campo) {?>
            <td nowrap align="left"><font class="txt5" >&nbsp;&nbsp;<?print $monta_titulo =  $monta_titulo.$desc_campo;?></td>
         <?}?>
      </tr>
    </table>
    <br>
     <?if (($s || $s_passa) && $procura == "OK") {
      $x=0;
      if ($tipo_email_fax == "M") {
        if ($s[$x]) {
          while($s[$x]) {
            $s_passa  = $s_passa.$s[$x]." - ".ValorClasse("URAFI",$s[$x].'M',$repre)." | ";
            $x++;
          }
        }
      } else {
        if ($s[$x]) {
          while($s[$x]) {
            $s_passa  = $s_passa.$s[$x]." - ".ValorClasse("GRATE",$s[$x],$repre)." | ";
            $x++;
          }
        }

      }

      if ($x <= 10) {
     ?>
           <table border="0" width="700" align="center">
             <tr>
                <td align="center">
                   <table border="2" align="center"  bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
                     <tr bgcolor="<?print $session['td_dado1']?>">
                        <td align="left"><font class="txt5"><b>Serviço(s):</b><?print $s_passa?> </td>
                     </tr>
                   </table>
                </td>
             </tr>
           </table>
           <br>
      <?} else {
        $s_passa = '';
        }?>
     <?}?>
  <?
  }
}

if ($y != "0") {

 $tabelao_rel.="<table ";if ($imprime_duracao == "sim") {$tabelao_rel.= "width='700'";} else {$tabelao_rel.= "width='600'";}$tabelao_rel.="border='my_border_color' cellpadding=0 cellspacing=0 align='center' style='border-collapse:collapse'>";
  $tabelao_rel.="  <tr bgcolor=".$session['td_destaque'].">";
  $tabelao_rel.="     <td rowspan='2' align='center'><font class='txt6'><font color=#FFFFFF><b>".$titulo."</a></font></td>";
  if ($campo1) {
    $tabelao_rel.="     <td rowspan='2' align='center'><font class='txt6'><font color=#FFFFFF><b>".$titulo1."</a></font></td>";
  }
  $tabelao_rel.="     <td align='center'";if ($imprime_duracao == "sim") {$tabelao_rel.="colspan='6'";} else {$tabelao_rel.="colspan='3'";}$tabelao_rel.="<font class='txt6'><font color=#FFFFFF><b>EMAILS</font></td>";
  $tabelao_rel.="  </tr>";
  $tabelao_rel.="  <tr bgcolor=".$session['td_destaque1']." >";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>QTD</font></td>";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>%(".$titulo.")</font></td>";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>%(Total)</font></td>";
  if ($imprime_duracao == "sim") {
    $tabelao_rel.="  <td align='center'><font class='peq'><b>TEMPO    </font></td>";
    $tabelao_rel.="  <td align='center'><font class='peq'><b>%(".$titulo.")</font></td>";
    $tabelao_rel.="  <td align='center'><font class='peq'><b>%(Total) </font></td>";
  }
  $tabelao_rel.="  </tr>";
?>
  <table <?if ($imprime_duracao == "sim") {?> width="700" <?} else {?> width="600"<?}?>border="1" cellpadding="0" cellspacing="0" align="center"  style='border:0;border-collapse:collapse'>
    <tr bgcolor="<?print $session['td_destaque']?>">
     <td rowspan="2" align="center"><font class="txt6"><b><?print $titulo?></a></font></td>
<?
if ($campo1) {
?>
       <td rowspan="2" align="center"><font class="txt6"><b><?print $titulo1?></a></font></td>
<?
}
if ($tipo_email_fax == "E" || $tipo_email_fax == "M") {
  $tit_cabec = "Emails";
} else if ($tipo_email_fax == "F") {
  $tit_cabec = "Faxes";
} else if ($tipo_email_fax == "S") {
  $tit_cabec = "Sms Env";
} else if ($tipo_email_fax == "R") {
  $tit_cabec = "Sms Rec";
}
?>
     <td align="center" <?if ($imprime_duracao == "sim") {?>colspan="6"<?} else {?>colspan="3"<?}?>><font class="txt6"><b><?print $tit_cabec?></font></td>
    </tr>
    <tr bgcolor="<?print $session['td_destaque1']?>" >
       <td align="center"><font class="peq"><b>QTD    </font></td>
       <td align="center"><font class="peq"><b>%(<?print $titulo?>)    </font></td>
       <td align="center"><font class="peq"><b>%(Total)    </font></td>
       <?if ($imprime_duracao == "sim") {?>
          <td align="center"><font class="peq"><b>DURAÇÃO    </font></td>
          <td align="center"><font class="peq"><b>%(<?print $titulo?>)    </font></td>
          <td align="center"><font class="peq"><b>%(Total)    </font></td>
       <?}?>
    </tr>

<?

$dados_array="QTDª";

for($x = 0; $x <= $tot_matriz; $x++) {
  $cor  = $session['td_dado3'];
  $cor1 = $session['td_dado1'];
  $fonte = "peq";
  $corclick = $session['td_destaque1'];

  Switch($campo) {
    case "concat(ura_grupo,'¢',ura_maquina)":
      $campo_imprime = str_replace("¢",".",$matriz[$matriz_aux['indice'][$x]][$campo])." - ".valorclasse("URAMQ",trim($matriz[$matriz_aux['indice'][$x]][$campo]),$repre);
      $align= "center";
      break;
    case "empresa":
      $campo_imprime = ValorClasse("REPRE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "regiao":
      $campo_imprime = ValorClasse("URARG",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "uf":
      $campo_imprime = Substr(ValorClasse("URAUF",$matriz[$matriz_aux['indice'][$x]][$campo],$repre),2);
      $align= "Left";
      break;
    case "login_operador":
    case "login_atualiza":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".NomeResumido($matriz[$matriz_aux['indice'][$x]][$campo]);
      $align= "left";
      break;
    case "ddd":
      $sql_pes         = "SELECT regiao FROM tblgcddd where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo]."'";
      $query_pes       = mysql_query ($sql_pes, $connect3);
      $ddd_pes         = mysql_fetch_array ($query_pes);
      if ($campo1) {
        $campo_imprime  = $matriz[$matriz_aux['indice'][$x]][$campo];
      } else {
        $campo_imprime  = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".$ddd_pes['regiao'];
      }
      $align1= "left";
      $align= "center";
      break;
    case substr($campo, 0, 4) == "data":
      $campo_imprime = BRDATE($matriz[$matriz_aux['indice'][$x]][$campo]);
      $align= "center";

      break;
    case "prefixo_telefone":
      $matriz[$matriz_aux["indice"][$x]][$campo      ] = trim($matriz[$matriz_aux["indice"][$x]][$campo      ]);
      $matriz[$matriz_aux["indice"][$x]][$campo1     ] = trim($matriz[$matriz_aux["indice"][$x]][$campo1     ]);
      $matriz[$matriz_aux["indice"][$x]][$campo_extra] = trim($matriz[$matriz_aux["indice"][$x]][$campo_extra]);

      if ($matriz[$matriz_aux["indice"][$x]][$campo1] != "55" && $matriz[$matriz_aux["indice"][$x]][$campo1] != "") {
        $campo_imprime .= "+".$matriz[$matriz_aux["indice"][$x]][$campo1]." ";
        $campo_imprime1 = ValorClasse("URACI", $matriz[$matriz_aux["indice"][$x]][$campo1], "URANET");
      } else {
        $sql_pes        = "SELECT nomeprefixo FROM tblgtele where ddd = '".$matriz[$matriz_aux["indice"][$x]][$campo_extra]."' and prefixo = '".$matriz[$matriz_aux["indice"][$x]][$campo]."' ";
        $query_pes      = mysql_query ($sql_pes, $connect3);
        if ($ddd_pes = mysql_fetch_array ($query_pes)) {
          $campo_imprime1 = $ddd_pes["nomeprefixo"];
        } else {
          $campo_imprime1 = "Localidade não encontrada";
        }
        $align1= "left";
      }

      if ($matriz[$matriz_aux["indice"][$x]][$campo_extra] != "-") {
        $campo_imprime .= "(".$matriz[$matriz_aux["indice"][$x]][$campo_extra].") ";
      }

      $campo_imprime .= $matriz[$matriz_aux["indice"][$x]][$campo];
      $align= "center";

      break;
    case "nb":
      if (!$campo1) {
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo];
        $align= "center";
      } else {
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }

      break;
    case "grupo":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "opcura":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URAOP",trim($s[0]).trim($matriz[$matriz_aux['indice'][$x]][$campo]),$repre);
      $align= "left";
      break;
    case "tipo_atendimento":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A") {
        $campo_imprime = "Ativo";
      } else {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "R") {
          $campo_imprime = "Receptivo";
        } else {
          $campo_imprime = "Tipo de  Atendimento não Definido - ".$matriz[$matriz_aux['indice'][$x]][$campo];
        }
      }

      $align= "center";
      break;
    case "tipo_ligacao":


      if ($campo_extra) {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]) == "A") {
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        } else {
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }
      } else {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A") {
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        } else {
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }

      }
      $align1= "left";
      break;
    case "tipo_registro":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "L") {
        $campo_imprime = "Ligação";
      } else {
        $campo_imprime = "Transferência";
      }
      $align1= "left";
      break;
    case "transferencia":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "S") {
        $campo_imprime = "Sim";
      } else {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "N") {
          $campo_imprime = "Não";
        } else {
          $campo_imprime = " ";
        }
      }
      break;
    case "resultado_ligacao":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("PQSTA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;

    case "status_envio":
      $campo_imprime = ValorClasse("URAE3",$matriz[$matriz_aux['indice'][$x]][$campo], $repre);
      $align= "left";
      break;

    case "status":
      $campo_imprime = ValorClasse("URAE3",$matriz[$matriz_aux['indice'][$x]][$campo], $repre);
      $align= "left";
      break;

    case "status_processo":
      $campo_imprime = ValorClasse("URAEF",$matriz[$matriz_aux['indice'][$x]][$campo], $repre);
      $align= "left";
      break;

    case "tipo_arquivo":
       if ($tipo_email_fax == "E" || $tipo_email_fax == "M") {
        $campo_imprime = ValorClasse("TPMAI",$matriz[$matriz_aux['indice'][$x]][$campo], $repre);
        $align= "left";
      } else {
        $campo_imprime = ValorClasse("TPFAX",$matriz[$matriz_aux['indice'][$x]][$campo], $repre);
        $align= "left";
      }
      break;

    default:
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo];
      $align= "left";
      break;

  }

  if ((!$campo_imprime || trim($campo_imprime) == "") || trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "1111-11-11") {
    $campo_imprime = ValorClasse("URAE6", $campo, $repre);
  }

  switch($campo1) {
    case "ddi":
      $matriz[$matriz_aux["indice"][$x]][$campo1] = trim($matriz[$matriz_aux["indice"][$x]][$campo1]);
      if ($campo_imprime1 == "") {
        print "aa".$matriz[$matriz_aux["indice"][$x]][$campo1]."bb";
        $campo_imprime1 = ValorClasse("URACI", $matriz[$matriz_aux["indice"][$x]][$campo1], "URANET");
      }
      $align= "center";
      break;
    case "concat(ura_grupo,'¢',ura_maquina)":
      $campo_imprime1 = str_replace("¢",".",$matriz[$matriz_aux['indice'][$x]][$campo1])." - ".valorclasse("URAMQ",trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
      $align= "center";
      break;

    case "regiao":
      $campo_imprime1 = ValorClasse("URARG",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case "empresa":
      $campo_imprime1 = ValorClasse("REPRE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case substr($campo1, 0 , 4) == "data":
      $campo_imprime1 = BrDate($matriz[$matriz_aux['indice'][$x]][$campo1]);
      $align1= "center";
      break;
    case "opcura":
      if ($campo_extra) {
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("URAOP",trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]).trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
        $align1= "left";
      } else {
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("URAOP",trim($matriz[$matriz_aux['indice'][$x]][$campo]).trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
        $align1= "left";
      }
      break;
    case "uf":
      $campo_imprime1 = ValorClasse("URAUF", $matriz[$matriz_aux["indice"][$x]][$campo1], $repre);

      if (substr($campo_imprime1, 1, 1) == " ") {
        $campo_imprime1 = Substr($campo_imprime1, 2);
      }
      $align1= "left";
      break;
    case "nb":
      $campo_imprime1 = ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case "grupo":
      if ($campo1) {
        $campo_imprime1 = ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      } else {
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      }
      $align1= "left";
      break;
    case "login_operador":
    case "login_atualiza":
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".NomeResumido($matriz[$matriz_aux['indice'][$x]][$campo1]);
      $align1= "left";
      break;
    case substr($campo1, 0, 4) == "hora":
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."h";
      $align1= "center";
      break;
    case "tipo_ligacao":
      if ($campo_extra) {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]) == "A") {
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        } else {
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }
      } else {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A") {
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        } else {
          if ($tipo_email_fax == "S") {
            $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
          } else {
            $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
          }
        }

      }
      $align1= "left";
      break;
    case "prefixo_telefone":
      $sql_pes        = "SELECT nomeprefixo FROM tblgtele where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo_extra]."' and prefixo = '".$matriz[$matriz_aux['indice'][$x]][$campo1]."' ";
      $query_pes      = mysql_query ($sql_pes, $connect3);
      $ddd_pes        = mysql_fetch_array ($query_pes);
      $campo_imprime1 = $ddd_pes["nomeprefixo"];
      $align1= "left";
      break;
    case "ddd":
      $sql_pes         = "SELECT regiao FROM tblgcddd where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo1]."'";
      $query_pes       = mysql_query ($sql_pes, $connect3);
      $ddd_pes         = mysql_fetch_array ($query_pes);
      if ($campo1) {
        $campo_imprime1  = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".$ddd_pes['regiao'];
      } else {
        $campo_imprime1  = $ddd_pes["regiao"];
      }
      $align1= "left";
      break;
    case "tipo_registro":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "L") {
        $campo_imprime1 = "Ligação";
      } else {
        $campo_imprime1 = "Transferência";
      }
      $align1= "left";
      break;
    case "transferencia":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "S") {
        $campo_imprime1 = "Sim";
      } else {
        if (trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "N") {
          $campo_imprime1 = "Não";
        } else {
          $campo_imprime1 = " ";
        }
      }
      $align1= "left";
      break;
    case "motivo_ligacao":
      if (trim($matriz[$matriz_aux['indice'][$x]][$campo1]) != "") {
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse($matriz[$matriz_aux['indice'][$x]][$classe_campo1],$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      } else {
        $campo_imprime1 = "&nbsp";
      }
      $align1= "left";
      break;

    case "status_envio":
      $campo_imprime1 = ValorClasse("URAE3",$matriz[$matriz_aux['indice'][$x]][$campo1], $repre);
      $align= "left";
      break;

   case "status":
      $campo_imprime1 = ValorClasse("URAE3",$matriz[$matriz_aux['indice'][$x]][$campo1], $repre);
      $align= "left";
      break;

    case "status_processo":
      $campo_imprime1 = ValorClasse("URAEF",$matriz[$matriz_aux['indice'][$x]][$campo1], $repre);
      $align= "left";
      break;

    case "tipo_arquivo":
       if ($tipo_email_fax == "E" || $tipo_email_fax == "M") {
        $campo_imprime1 = ValorClasse("TPMAI",$matriz[$matriz_aux['indice'][$x]][$campo1], $repre);
        $align= "left";
      } else {
        $campo_imprime1 = ValorClasse("TPFAX",$matriz[$matriz_aux['indice'][$x]][$campo1], $repre);
        $align= "left";
      }
      break;

    default:
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1];
      $align1= "left";
      break;

  }

  if ((!$campo_imprime1 || trim($campo_imprime1) == "") || trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "1111-11-11") {
    $campo_imprime1 = ValorClasse("URAE6", $campo1, $repre);
  }

  //  print $campo_prox."aaaaaaa";

  if ($campo_extra) {
    $campo1_aux = $campo1;
  }

  $desc_campo = "";
  if ($titulo) {
    $desc_campo .= urlencode("<b> ".$titulo .": </b>".$campo_imprime)." -> ";
  }
  if ($titulo1) {
    $desc_campo .= urlencode("<b> ".$titulo1.": </b>".$campo_imprime1);
  }

  $tabelao_rel.="<tr  bgcolor=".$cor.">";
  $tabelao_rel.="   <td nowrap align=".$align; if ($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x+1]][$campo]) {$tabelao_rel.="style='border-bottom:none;'";}$tabelao_rel.=">";$tabelao_rel.="<font class=".$fonte.">;   ";if ($matriz[$matriz_aux['indice'][$x]][$campo] != $matriz[$matriz_aux['indice'][$x-1]][$campo]) {$tabelao_rel.=$campo_imprime;}$tabelao_rel.="</b></font></td>";
  if ($campo1) {
    $tabelao_rel.="   <td nowrap align=".$align1."><font class=".$fonte.">".$campo_imprime1."</b></font></td>";
  }
  $tabelao_rel.="   <td align='right'><font class=".$fonte.">".$matriz[$matriz_aux['indice'][$x]]['qtd']."</b></font></td>";
  $tabelao_rel.="   <td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL'])."</b></font></td>";
  $tabelao_rel.="   <td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd'])."</b></font></td>";
  if ($imprime_duracao == "sim") {
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".VerificaTime($time,$matriz[$matriz_aux['indice'][$x]]['duracao'])."</b></font></td>";
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO'])."</b></font></td>";
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd'])."</td>";
  }

  $tabelao_rel.="</tr>";

  $dados_array.=$matriz[$matriz_aux['indice'][$x]]['qtd']."ª";
  $legenda.=trim($campo_imprime)." - ".trim($campo_imprime1)."§";
  ?>
     <tr  bgcolor="<?print $cor?>"
     <?if ((($session['origem']!="LIGBOLADA") || ($session['origem'] == $session['representante']))  && ($deonde != "DACNET")) {?>
          onMouseDown="window.location='<?print $prog_prox.'?tipo_email_fax='.$tipo_email_fax.'&tira_duplicidade='.$tira_duplicidade.'&procura=OK&repre='.$repre.'&time='.$time.'&where='.urlencode($where)."&campo=".urlencode($campo_prox1)."&campo_ant=".urlencode($campo1)."&vlr_campo=".$matriz[$matriz_aux['indice'][$x]][$campo1]."&campo_ant1=".urlencode($campo)."&vlr_campo1=".$matriz[$matriz_aux['indice'][$x]][$campo]."&desc_campo=".$desc_campo."&titulo_ant=".$titulo1."&titulo_coluna=".$titulo."&monta_titulo=".urlEncode($monta_titulo)."&s_passa=".urlencode($s_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&tipo_nv=".$tipo_nv."&selecao_data=".$selecao_data."&faz_manutencao=".$faz_manutencao."&tipo_arquivo=".$tipo_arquivo?>';javascript:style.background='<?print $corclick?>'"  onMouseOver="javascript:style.background='<?print $cor1?>';style.cursor='pointer';style.cursor='hand'" OnMouseOut="javascript:style.background='<?print $cor?>'"
     <?}?>
     >
        <td nowrap align="<?print $align?>" <?if ($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x+1]][$campo]) {print "style='border-bottom:yes;'";}?> ><font class="<?print $fonte?>">&nbsp;   <?if ($matriz[$matriz_aux['indice'][$x]][$campo] != $matriz[$matriz_aux['indice'][$x-1]][$campo]) {print str_replace("¢"," / ",$campo_imprime);}?>&nbsp;</b></font></td>
        <?if ($campo1) {?>
        <td nowrap align="<?print $align1?>"><font class="<?print $fonte?>">  <?print str_replace("¢"," / ",$campo_imprime1);?>&nbsp;</b></font></td>
        <?}?>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print $matriz[$matriz_aux['indice'][$x]]['qtd'];?></b></font></td>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL']);?></b></font></td>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd']);?></b></font></td>
        <?if ($imprime_duracao == "sim") {?>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print VerificaTime($time,$matriz[$matriz_aux['indice'][$x]]['duracao']);?></b></font></td>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO']);?></b></font></td>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd']);?></b></font></td>
        <?}?>
     </tr>
     <?
     if ($campo_extra) {
      $campo1 = $campo1_aux;
     }
     $total_reg       += 1;
     $sub_total_reg   += 1;
     $sub_perc        += percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd']);
     $sub_perc_tempo  += percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd']);

     if ((($matriz[$matriz_aux['indice'][$x]][$campo]) != ($matriz[$matriz_aux['indice'][$x+1]][$campo])) && (($campo != "uf" && $campo != "concat(ddi,'¢',ddd)" && $campo != "prefixo_telefone" && $campo != "nb") || ($campo == "grupo" && $campo1 != $campo) || ($campo == "nb" && $campo1 != $campo) || ($campo == "uf" && $campo1 == "tipo_ligacao"))) {

        if ($campo1) {

        $desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";
        $tabelao_rel.="<tr  bgcolor=".$session['td_destaque1'].">";
        $tabelao_rel.="   <td nowrap align='left'  style='border-right:none;'><font class=".$fonte.">SUBTOTAL</b></font></td>";
        if ($campo1) {
          $tabelao_rel.="   <td nowrap align='left'  style='border-right:none;'><font class=".$fonte."></b></font></td>";
        }
        $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">".$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL']."</b></font></td>";
        $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">100.0 </b></font></td>";
        $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">".$sub_perc."</b></font></td>";
        $qtd_cols="5";
        if ($imprime_duracao == "sim") {
          $qtd_cols="8";
          $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">".VerificaTime($time,$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO'])."</b></font></td>";
          $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">100.0</b></font></td>";
          $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">".$sub_perc_tempo."</b></font></td>";
        }
        $tabelao_rel.="</tr>";
        $tabelao_rel.="<tr><td colspan=".$qtd_cols." >&nbsp;</td></tr>";
       ?>
         <tr bgcolor="<?print $session['td_destaque1']?>" <?if ((($session['origem']!="LIGBOLADA") || ($session['origem'] == $session['representante'])) && ($deonde != "DACNET") ) {?> onMouseDown="window.location='<?print $prog_prox.'?tipo_email_fax='.$tipo_email_fax.'&tira_duplicidade='.$tira_duplicidade.'&procura=OK&repre='.$repre.'&equipe='.$define_equipe.'&time='.$time.'&where='.urlencode($where)."&campo=".urlencode($campo_prox )."&campo_ant=".urlencode($campo )."&vlr_campo=".$matriz[$matriz_aux['indice'][$x]][$campo ]."&campo_ant1=".urlencode($campo)."&vlr_campo1=".$matriz[$matriz_aux['indice'][$x]][$campo]."&desc_campo=".$desc_campo."&titulo_ant=".$titulo ."&titulo_coluna=".$titulo."&monta_titulo=".urlEncode($monta_titulo)."&s_passa=".urlencode($s_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&tipo_nv=".$tipo_nv."&selecao_data=".$selecao_data."&faz_manutencao=".$faz_manutencao."&tipo_arquivo=".$tipo_arquivo?>';javascript:style.background='<?print $corclick?>'"  onMouseOver="javascript:style.background='<?print $cor1?>';style.cursor='pointer';style.cursor='hand'" OnMouseOut="javascript:style.background='<?print $session['td_destaque1']?>'"<?}?>>
            <td  align="left"  style='border-right:none;'><font class="<?print $fonte?>">SUBTOTAL&nbsp;</b></font></td>
            <?if ($campo1) {?>
            <td  align="left"  style='border-left:none;' ><font class="<?print $fonte?>">                                                                                            </b></font></td>
            <?}?>
            <td  align="right"                           ><font class="<?print $fonte?>">   <?print $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL'];?>         </b></font></td>
            <td  align="right"                           ><font class="<?print $fonte?>">   <?print "100.0"?>                                                                        </b></font></td>
            <td  align="right"                           ><font class="<?print $fonte?>">   <?print $sub_perc;?>                                                                     </b></font></td>
            <?if ($imprime_duracao == "sim") {?>
              <td align="right"                           ><font class="<?print $fonte?>">   <?print VerificaTime($time,$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO']);?>   </b></font></td>
              <td align="right"                           ><font class="<?print $fonte?>">   <?print "100.0"?>                                                                       </b></font></td>
              <td align="right"                           ><font class="<?print $fonte?>">   <?print $sub_perc_tempo;?>                                                              </b></font></td>
            <?}?>
          </tr>
          <tr><td colspan=13 ><font class="<?print $fonte?>">&nbsp;&nbsp;</td></tr>
        <?
        $sub_perc=0;
        $sub_perc_tempo=0;
        $sub_total_reg=0;
        }
     }
     $campo_imprime  = "";
     $campo_imprime1 = "";
}
$tabelao_rel.="<tr bgcolor=".$session['td_destaque'].">";
$tabelao_rel.="   <td nowrap align=".$align."><font class='txt6'><font color=#FFFFFF><b>&nbsp;TOTAL</b></font></td>";
if ($campo1) {
  $tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".$total_reg."</b></font></td>";
}
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".$matriz['TOTAL']['qtd']."</b></font></td>";
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>-</b></font></td>";
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>100.0</b></font></td>";
if ($imprime_duracao == "sim") {
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".VerificaTime($time,$matriz['TOTAL_TEMPO']['qtd'])."</b></font></td>";
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>-</b></font></td>";
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>100.0</b></font></td>";
}
$tabelao_rel.="</tr>";
   ?>
     <tr bgcolor="<?print $session['td_destaque']?>">
        <td nowrap align="<?print $align?>"><font class="txt6"><b>   TOTAL                               </b></font></td>
        <?if ($campo1) {?>
          <td nowrap align="right"           ><font class="txt6"><b>   <?print $total_reg;?>               </b></font></td>
        <?}?>
        <td nowrap align="right"           ><font class="txt6"><b>   <?print $matriz['TOTAL']['qtd'];?>      </b></font></td>

        <td nowrap align="right"           ><font class="txt6"><b>   <?print "-";?>                      </b></font></td>
        <td nowrap align="right"           ><font class="txt6"><b>   <?print "100.0";?>                  </b></font></td>
        <?if ($imprime_duracao == "sim") {?>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print VerificaTime($time,$matriz['TOTAL_TEMPO']['qtd']);?></b></font></td>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print "-";?>                      </b></font></td>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print "100.0";?>                  </b></font></td>
        <?}?>
     </tr>
  </table>

<?if ($deonde != "DACNET") {?>

  <BR>
  <form name="simula" method="post" action="dac_con_regiao_det_impressao.php" target="Janela">
     <input type="hidden" name="tabelao_rel"    value="<?print urlencode($tabelao_rel)?>">
     <input type="hidden" name="tabelao_titulo" value="<?print urlencode($tabelao_titulo)?>">
     <input type="hidden" name="tipo"           value="">
  </form>
<?/*********************************Tabela Com o Botão para impressão Funcao Imprime Relatório*************/?>
    <table align="center">
      <tr>
        <td align="center" nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Imprimir o Relatório" onClick="imprimeRelatorio('imprime')">
            <img src="imagens/print1.gif" width="20" align="botton" ><font class="txt5"><b>&nbsp;
        </td>
        <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório para o Excel" onClick="imprimeRelatorio('excel')">
          <center><img src="imagens/excel.gif" align="botton" ><font class="txt5"><b>&nbsp;</center>
        </td>
        <td>
        <?
        //$dados_array = substr($dados_array,1);
        $dados_array = substr($dados_array,0,StrLen($dados_array)-1);
        $legenda = substr($legenda,0,StrLen($legenda)-1);
        ?>
           <img  title="Grafico da Tabela"onmouseover="style.cursor='pointer';style.cursor='hand'" src="imagens/grafico_peq.gif" width="25" height="25" onClick="MostraGrafico(document.grafico)">
           <form name="grafico" method="POST"     target="JanelaGrafico" action="cc_graficos.php">
             <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
             <input type="hidden" name="legenda"         value="<?print $legenda?>">
             <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
          </form>
        </td>
        <!--<td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório em Formato PDF" onClick="imprimeRelatorio('pdf')">
          <center><img src="imagens/xx.gif" align="botton" ><font class="txt5"><b>&nbsp;</center>
        </td>-->
      </tr>
    </table>
<?
}

} else {
  if ($procura == "OK") {
    print "<center><font class='txtvermelho'><b>Nenhum Registro Encontrado";
  }
}

//*********************************************************************************************************
//***************************-------TABELA DE BUSCA TODAS IGUAIS-------************************************
//*********************************************************************************************************

if ($deonde != "DACNET") {
  if ($pag == "1" || (!$dia_ini)) {
  ?>


    <form name="consulta" method="get" action="<?print $programa?>" onSubmit="return checa(this)">
      <input type="hidden" name="pag"             value="1"                 >
      <input type="hidden" name="procura"         value="<?print $procura?>">
      <input type="hidden" name="faz_manutencao"  value="<?print $faz_manutencao?>">
			<input type="hidden" name="define_equipe"   value="<?print $define_equipe?>" />
      <?
      $comboRepre = montaCombo("REPRE",$repre,$session["representante"]);
      $titRepre = $titClasse;

      $sql_pes   = "SELECT data_inicio_nivel FROM tbniveis where nivel = 'F2' ";
      $query_pes = mysql_query($sql_pes, $connect);
      if ($data_pes = mysql_fetch_assoc ($query_pes)) {?>
        <input type="hidden" name="data_inicio_nivel" value="<?print $data_pes['data_inicio_nivel'];?>">
    <?} else {?>
        <input type="hidden" name="data_inicio_nivel" value="false">
    <?}

      $sql_pes   = "SELECT data_inclusao FROM tbadmin where login = '".$session['operador']."' ";
      $query_pes = mysql_query ($sql_pes, $connect);
      if ($data_pes        = mysql_fetch_array ($query_pes)) {?>
        <input type="hidden" name="data_inicio_oper" value="<?print $data_pes['data_inclusao'];?>">
    <?} else {?>
        <input type="hidden" name="data_inicio_oper" value="false">
    <?}?>
      <table width="300" border="1" cellpadding="0" cellspacing="0" align="center"  bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
        <tr bgcolor="<?print $session['td_destaque']?>">
          <td colspan= "2" align="center"><font class="titcol"><b>
            <?print $titRepre?>:
            <select name="repre" onchange="javascript:mudaRepre();">
              <?print $comboRepre?>
            </select>
          </td>
        </tr>
        <tr bgcolor="<?print $session['td_destaque1']?>">
          <td width="480">
            <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
              <tr>
              <?
                if ($session['representante'] == "URANET") {
                  $exclusivo_uranet = ",'U'";
                } else {
                  $exclusivo_uranet = "";
                }
//              print $tipo_email_fax;
                /*************************************************************/
                $q = "SELECT vlr_classe,desc_classe,filtro_classe,tipo_reg FROM tb_classe WHERE cod_classe LIKE 'URAE4' AND representante = '".$repre."' AND tipo_reg in ('I','T') AND status IN ('A'".$exclusivo_uranet.")";
                $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
                $query = mysql_query($q,$connect);
                if ($rec = mysql_fetch_assoc($query)) {
                  do {
                    if ($rec["tipo_reg"] != "T") {
                      $mtz_opcoes[$rec["vlr_classe"]] = $rec["desc_classe"];
                      $mtz_opcoes_filtro[$rec["vlr_classe"]] = $rec["filtro_classe"];
                      if ($rec["filtro_classe"] == "ZD") {
                        if (!$tipo_email_fax) {
                          $tipo_email_fax = $rec["vlr_classe"];
                        }
                      }
                    } else {
                      $titulo_email_fax = $rec["desc_classe"];
                    }
                  } while ($rec = mysql_fetch_assoc($query));
                }

                if (!is_array($mtz_opcoes)) {
                  /*************************************************************/
                  $q = "SELECT vlr_classe,desc_classe,filtro_classe,tipo_reg FROM tb_classe WHERE cod_classe LIKE 'URAE4' AND representante = 'URANET' AND tipo_reg IN ('I','T') AND status IN ('A'".$exclusivo_uranet.")";
                  $q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
                  $query = mysql_query($q,$connect);
                  if ($rec = mysql_fetch_assoc($query)) {
                    do {
                      if ($rec["tipo_reg"] != "T") {
                        $mtz_opcoes[$rec["vlr_classe"]] = $rec["desc_classe"];
                        $mtz_opcoes_filtro[$rec["vlr_classe"]] = $rec["filtro_classe"];
                        if ($rec["filtro_classe"] == "ZD") {
                          if (!$tipo_email_fax) {
                           $tipo_email_fax = $rec["vlr_classe"];
                          }
                        }
                      } else {
                        $titulo_email_fax = $rec["desc_classe"];
                      }
                    } while ($rec = mysql_fetch_assoc($query));
                  }
                  /*************************************************************/
                }
                /*************************************************************/

                if (!$tipo_email_fax) {
                  if ($mtz_opcoes["F"]) {
                    $tipo_email_fax = "F";
                  }
                }
                asort($mtz_opcoes);
                ?>
                <td colspan="2" nowrap align="center" class="txt5" width="50%">
                  <select name="tipo_email_fax" onchange="document.consulta.relatorio.value='';document.consulta.procura.value = '';document.consulta.submit();">
                  <?foreach ($mtz_opcoes as $key => $value) {?>
                    <option value="<?print $key;?>"<?if ($tipo_email_fax == $key || !$tipo_email_fax) {if (!$tipo_email_fax) {$tipo_email_fax = $key;};print "SELECTED";}?>><?print $value;?></option>
                    <?/*<input type="radio" name="tipo_email_fax" id="tipo_email_fax_<?print $key;?>" value="<?print $key;?>"<?if ($tipo_email_fax == $key || !$tipo_email_fax) {if (!$tipo_email_fax) {$tipo_email_fax = $key;};print "checked";}?> onclick="document.consulta.relatorio.value='';document.consulta.submit();"><b><label for="tipo_mail_fax_<?print $key;?>"><?print $value;?></label></b>*/?>
                  <?}?>
                  </select>
                  <?if ($session['print_sql'] != "N") {print "<font class='txt5' style='color:red;'><b>(URAE4)</b></font>";}?>
                </td>
                <td align="center" nowrap class="txt5" width="50%"><b>Relatório:
                  <select name="relatorio" onChange="selecionaAction(this.value)" consistencia="sempre" consistencia1="pre" msg="Selecione o Relatório!">
                      <?
                      if ($tipo_email_fax == "E" || $tipo_email_fax == "B") {
                        print MontaCombo("URAE1", $relatorio, $repre);
                      } else if ($tipo_email_fax == "M") {
                        print MontaCombo("URAE7", $relatorio, $repre);
                      } else {
                        print MontaCombo("URAE5", $relatorio, $repre);
                      }
                      ?>
                    </select>
                    <input maxlength="3" size="2" style="background:<?print $session['td_destaque1']?>;border:none;font=bold;text-align=right" type="text" name="qtd_lig" value="<?print $qtd_lig?>">
                </td>

              </tr>
            </table>
            <table width="100%" border="1" cellpadding="2" cellspacing="0" align="center"  bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>" >
              <tr bgcolor="<? $session['td_dado3']?>"><?
                $opt_urae2 = MontaCombo("URAE2", $selecao_data, $repre);
                $tit_urae2 = $titClasse;?>
                <td align="left" nowrap><font class="txt5"><b><?print $tit_urae2?>:
                  <select name="selecao_data" onChange="" consistencia="sempre" consistencia1="pre" msg="Selecione a <?print $tit_urae2?>!">
                    <?print $opt_urae2;?>
                  </select>
                  <input maxlength="3"  size="2"style="background:<?print $session['td_destaque1']?>;border:none;font=bold;text-align=right" type="text" name="qtd_lig" value="<?print $qtd_lig?>">
                </td><?
                $opt_urae3 = MontaCombo("URAE3", $situacao, $repre);
                $tit_urae3 = $titClasse;?>
                <td align="left" nowrap class="txt5">
                  <b><?print $tit_urae3?>:
                  <select name="situacao" onChange="" consistencia="sempre" consistencia1="pre" msg="Selecione a <?print $tit_urae2?>!">
                    <option value="todos"> Todos </option>
                    <?print $opt_urae3;?>
                  </select>
                  <input maxlength="3"  size="2" style="background:<?print $session['td_destaque1']?>;border:none;font=bold;text-align=right" type="text" name="qtd_lig" value="<?print $qtd_lig?>">
                </td>
              </tr>
              <?if ($session["print_sql"] != "N") {
                  if (!$tipo_arquivo) {
                    $tipo_arquivo = "TODOS";
                  }
                  ?>
                  <tr bgcolor="<? $session['td_dado3']?>"><?
                      if ($tipo_email_fax == "F") {
                      $classe_usa = "TPFAX";
                    } else {
                      $classe_usa = "TPMAI";
                    }
                    $opt_tp_arqui = MontaCombo($classe_usa, $tipo_arquivo, $repre);
                    $tit_tp_arqui = $titClasse;?>
                    <td align="left" nowrap colspan="2" class="txt5"><b><?print $tit_tp_arqui?>:
                      <select name="tipo_arquivo" style="width: 280px" consistencia="sempre" consistencia1="pre" msg="Selecione <?print $tit_tp_arqui?>!">
                        <?print $opt_tp_arqui;?>
                        <option value="TODOS" <?if ($tipo_arquivo == "TODOS") {print " SELECTED "; }?>> TODOS </option>
                      </select>
                    </td>
                  </tr>
              <?}?>
              <tr bgcolor="<? $session['td_dado3']?>">
                <td colspan= "2">
                  <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado2'];?>">
                    <tr bgcolor="<?print $session['td_dado2']?>">
                      <td width="50%" align="center">
                        <font class="txt5"><b>Hora Inicial:
                        <select name="hora_ini">
                          <?for ($i=0; $i<24; $i++) { ?><option value="<?if ($i < 10) {$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_ini, $i, "00");?>><?if ($i < 10) {$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                        </select><b>:</b>
                        <select name="min_ini" <?print $disabled?>>
                          <option value="00" <?if ($min_ini == "00" || $min_fim == "") { print "selected";}?>>00</option>
                          <option value="15" <?if ($min_ini == "15") { print "selected";}?>>15</option>
                          <option value="30" <?if ($min_ini == "30") { print "selected";}?>>30</option>
                          <option value="45" <?if ($min_ini == "45") { print "selected";}?>>45</option>
                        </select>
                      </td>
                      <td width="50%" align="center">
                        <font class="txt5"><b>Hora Final:
                        <select name="hora_fim">
                          <?for ($i=0; $i<=24; $i++) { ?><option value="<?if ($i < 10) {$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_fim, $i, "24");?>><?if ($i < 10) {$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                        </select><b>:</b>
                        <select name="min_fim" <?print $disabled?>>
                          <option value="00"<?if ($min_fim == "00" || $min_fim == "") { print "selected";}?> >00</option>
                          <option value="15"<?if ($min_fim == "15") { print "selected";}?> >15</option>
                          <option value="30"<?if ($min_fim == "30") { print "selected";}?> >30</option>
                          <option value="45"<?if ($min_fim == "45") { print "selected";}?> >45</option>
                        </select><b></b>
                      </td>
                    </tr>
                    <tr bgcolor="<?print $session['td_dado2']?>">
                      <td  align="center" colspan="2"><font class="txt5">
                        <?print dataCalendarioNovo("dia_ini","mes_ini","ano_ini","dia_fim","mes_fim","ano_fim","","","","consulta");?>
                      </td>
                    </tr>

                    <tr bgcolor="<?print $session['td_dado2']?>">
                      <td  align="center" colspan="2"><font class="txt5">
                        <select name="campo_consulta" id="campo_consulta">
                          <?if ($tipo_email_fax == "F") {?>
                              <option value="fax" <?if ($campo_consulta == "fax") {?> selected <?}?>>FAX</option>
                          <?} else {?>
                              <?if ($tipo_email_fax == "B") {?>
                                  <option value="assunto" <?if ($campo_consulta == "assunto") {?> selected <?}?>>Assunto</option>
                              <?}elseif ($tipo_email_fax == "E") {?>
                                  <option value="email_destino" <?if ($campo_consulta == "email_destino") {?> selected <?}?>>Email Destino</option>
                              <?}elseif ($tipo_email_fax == "M") {?>
                                  <option value="email_origem" <?if ($campo_consulta == "email_origem") {?> selected <?}?>>Email Origem</option>
                              <?}elseif ($tipo_email_fax == "S" || $tipo_email_fax == "R") {?>
                                  <option value="assunto" <?if ($campo_consulta == "assunto") {?> selected <?}?>>CELULAR</option>
                              <?}?>
                              <?
                                /*
                                <option value="email_cc"      <?if ($campo_consulta == "email_cc"     ) {?> selected <?}?>>Email Cópia</option>
                                */
                              ?>
                          <?}?>
                        </select><b>:</b>
                        <?if ($tipo_email_fax == "F") {?>
                            &nbsp;&nbsp;(
                            <input type="text" maxlength="2" size="3" id="campo_ddd" name="campo_ddd" value="<?print $campo_ddd?>" onKeyUp="pulaCampo(this,2,document.consulta.campo_fone);" consistencia="sopreenchido" consistencia1="pre" consistencia2="1" consistencia3="ddd" msg="Preencha corretamente o DDD">
                            )&nbsp;&nbsp;-
                            <input type="text" maxlength="8" size="10" id="campo_fone" name="campo_fone" value="<?print $campo_fone?>" consistencia="sopreenchido" consistencia1="pre" consistencia2="8" consistencia3="telefone" msg="Preencha corretamente o Número do FAX">
                        <?} else {?>
                            <?if ($tipo_email_fax == "B") {?>
                                <input type="text" maxlength="60" size="50" id="campo_email" name="campo_email" value="<?print $campo_email?>" consistencia="sopreenchido" consistencia1="pre" consistencia2="1" consistencia3="todos" msg="Preencha corretamente o Assunto">
                            <?}elseif ($tipo_email_fax == "E" || $tipo_email_fax == "M") {?>
                                <input type="text" maxlength="60" size="50" id="campo_email" name="campo_email" value="<?print $campo_email?>" consistencia="sopreenchido" consistencia1="pre" consistencia2="1" consistencia3="email" msg="Preencha corretamente o Email">
                            <?}elseif ($tipo_email_fax == "S" || $tipo_email_fax == "R") {?>
                                &nbsp;&nbsp;(
                                <input type="text" maxlength="2" size="3" id="campo_ddd" name="campo_ddd" value="<?print $campo_ddd?>" onKeyUp="pulaCampo(this,2,document.consulta.campo_fone);" consistencia="sopreenchido" consistencia1="pre" consistencia2="1" consistencia3="ddd" msg="Preencha corretamente o DDD">
                                )&nbsp;&nbsp;-
                                <input type="text" maxlength="9" size="10" id="campo_fone" name="campo_fone" value="<?print $campo_fone?>" consistencia="sopreenchido" consistencia1="pre" consistencia2="8" consistencia3="telefone" msg="Preencha corretamente o Número do Celular">
                            <?}?>
                        <?}?>
                      </td>
                    </tr>
										<tr bgcolor="<?print $session['td_dado2']?>">
											<td  align="left" colspan="2"><font class="txt5">
												&nbsp;&nbsp;<strong>Equipe :</strong>
												<select name="define_equipe" id="define_equipe">
													<?
														print MontaCombo("EQUIP", $define_equipe ,$repre);
													?>
												</select>
											</td>
										</tr>
                 </table>
              </td>
            </tr>
            <?
            if ($tipo_telefone == "celular") {
              $color_celular  =  $session['td_dado1'];
              $color_fixo     =  $session['td_destaque'];
              $color_ambos    =  $session['td_destaque'];
              $font_celular   =  $session['td_destaque'];
              $font_fixo      =  $session['td_dado3'];
              $font_ambos     =  $session['td_dado3'];
            } else {
              if ($tipo_telefone == "fixo") {
                $color_celular  = $session['td_destaque'];
                $color_fixo     = $session['td_dado1'];
                $color_ambos    = $session['td_destaque'];
                $font_celular   = $session['td_dado3'];
                $font_fixo      = $session['td_destaque'];
                $font_ambos     = $session['td_dado3'];
              } else {
                $color_celular  = $session['td_destaque'];
                $color_fixo     = $session['td_destaque'];
                $color_ambos    = $session['td_dado1'];
                $font_celular   = $session['td_dado3'];
                $font_fixo      = $session['td_dado3'];
                $font_ambos     = $session['td_destaque'];
              }
            }
            ?>
            <script language="javascript">
            <!--
            function VerificaTipoTel(obj_clica,outros1,outros2) {
              document.consulta.tipo_telefone.value = obj_clica.name;

              obj_clica.style.background ='<?print $session['td_dado1']?>';
              obj_clica.style.color      ='<?print $session['td_destaque']?>';

              outros1.style.background   ='<?print $session['td_destaque']?>';
              outros1.style.color        ='<?print $session['td_dado1']?>';

              outros2.style.background   ='<?print $session['td_destaque']?>';
              outros2.style.color        ='<?print $session['td_dado1']?>';

            }
            -->
            </script>
            <?
              /*
               <input type="hidden" name="tipo_telefone" <?if ($tipo_telefone == "") {print "value='ambos'";} else {print "value='".$tipo_telefone."'";}?>>
               <?//onclick="VerificaTipoTel(this,document.consulta.fixo,document.consulta.celular)"   style="width='15';height='15'; background='<?print $color_ambos?>';color='<?print $font_ambos?>'""><b>Ambos</b>
               <?//onclick="VerificaTipoTel(this,document.consulta.ambos,document.consulta.celular)"  style="width='15';height='15'; background='<?print $color_fixo?>';color='<?print $font_fixo?>'""><b>Fixos</b>
              */
            ?>
         </table>

       </td>
       <td align="center">
         <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
           <tr>
             <?if (!$order_servico) {$order_servico = "vlr_classe";}?>
             <td align="center" width="70%" class="txt5" nowrap>
               <b>Serviço: &nbsp;
               <b><label for="order_servico_Abc">Abc</label><input type="radio" name="order_servico" id="order_servico_Abc" value="desc_classe" <?if ($order_servico == "desc_classe") { print "checked";}?> onclick="document.consulta.submit()">
               <b><label for="order_servico_123">123</label><input type="radio" name="order_servico" id="order_servico_123" value="vlr_classe" <?if ($order_servico == "vlr_classe") { print "checked";}?> onclick="document.consulta.submit()">
             </td>
           </tr>
           <tr>
             <td align="center" colspan="2"><font class="txt1"><b>
               <select  multiple size="6" name="s[]" id='servico'  consistencia="sempre" consistencia1="pre" msg="Selecione o(s) Serviço(s)!">
                 <?
                   if ($tipo_email_fax == "F") {
                     print MontaListaEmailFax("GRATE", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }else if ($tipo_email_fax == "B") {
                     print MontaListaEmail("GRATE", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }else if ($tipo_email_fax == "E") {
                     print MontaListaEmail("URAFI", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }else if ($tipo_email_fax == "M") {
                     print MontaListaEmail("URAFI", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }else if ($tipo_email_fax == "S") {
                     print MontaListaEmailFax("GRATE", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }else if ($tipo_email_fax == "R") {
			               print MontaListaEmailFax("GRATE", $s, $repre, "", "", $order_servico, "", $tipo_email_fax);
                   }
                 ?>
               </select>
             </td>
           </tr>
         </table>
       </td>
     </tr>
   </table>
   <br>
   <div align="center"><input type="button" name="enviar" value="Enviar" onclick="VerificaForm()" class="but_proc_on"></div>
  </form><?
  }

}
?>
<?
//************************************************************
//**************************************************** FUNÇÕES
//************************************************************
function VerificaTime($time, $segundos) {
  if ($time == "seg") {
    return $segundos;
  } else {
    return CalcTime($segundos);
  }
}

function MontaListaEmail($classe, $array, $repres, $status, $parametro, $order, $uranet, $tipo_email_fax) {
  global $session;
  global $_SESSION;
  $connect = ConnectDB();

  $campo_valor = "vlr_classe";
  if ($tipo_email_fax == "E") {
    $where_email = " AND vlr_classe <> 'E999' ";
    $where_like1 = "AND vlr_classe LIKE '".$tipo_email_fax."___%'";
    $where_like2 = "AND vlr_classe LIKE '".$tipo_email_fax."%E'";
    $campo_valor = "SUBSTRING(vlr_classe, 1, 4) AS vlr_classe";
  }else if ($tipo_email_fax == "M") {
    $where_email = " AND vlr_classe LIKE 'E___M' ";
    $campo_valor = "SUBSTRING(vlr_classe, 1, 4) AS vlr_classe";
    $tipo_email_fax = "E";
  } else {
    $where_email = " AND vlr_classe = 'E999' ";
    $tipo_email_fax = "E";
    $where_like1 = "AND vlr_classe LIKE '".$tipo_email_fax."___'";
    $where_like2 = "AND vlr_classe LIKE '".$tipo_email_fax."%'";
  }

  //PERMISSÃO DE CONSULTA
  if (is_array($_SESSION["ssitgl_permissao_consulta"][$classe]) === false) {
    if ($_SESSION["ssitgl_permissao_consulta"][$classe] != "NAO_USA_CLASSE") {
      $where_filtro_cliente = "";
    } else {
      $where_filtro_cliente = $_SESSION["ssitgl_permissao_consulta"][$classe];
    }
  } else {
    if (count($_SESSION["ssitgl_permissao_consulta"][$classe]) > 0) {
      $where_filtro_cliente = " AND vlr_classe IN('".implode("','", $_SESSION["ssitgl_permissao_consulta"][$classe])."')";
    } else {
      if ($session["representante"] == "URANET") {
        $arr["info_selecione"] = "SESSION['ssitgl_permissao_consulta'] inválida para a classe: ".$classe.".";
      } else {
        $arr["info_selecione"] = "Sem Itens";
      }
      return $arr;
    }
  }

  if ($where_filtro_cliente != "NAO_USA_CLASSE") {
    if (($filtro_condicao == "ZD") || ($filtro_condicao == "ZZ")) {
      $where_condicao = "";
    } else {
      if (strlen($filtro_condicao) == 2) {
        $where_condicao = " AND filtro_classe = '".$filtro_condicao."'";
      } else {
        if (empty($filtro_condicao) === false) {
          $where_condicao = $filtro_condicao;
        } else {
          $where_condicao = "";
        }
      }
    }
  }


  if (!$order) {
    $sem_param_order = "sim";
    $order           = "desc_classe";
  }
  if (substr($order,0,2) == "so") {
    if ($order == "so_desc_classe") {
      $order_select = " ORDER BY desc_classe";
    } else {
      $order_select = " ";
    }
  } else {
    $order_select = " ORDER BY ".$order;
  }

  if (!$repres) {
    if ($uranet == "S") {
      $repres = "URANET";
    } else {
      $repres = "";
    }
  } else {
    $q = "SELECT COUNT(*) AS cont FROM tb_classe WHERE (cod_classe = '".$classe."') AND (representante = '".$repres."') AND  (tipo_reg='I') ".$where_like1." ".$where_status." ".$order_select;
    //    $q = "SELECT COUNT(*) AS cont FROM tb_classe WHERE (cod_classe = '".$classe."') AND (representante = '".$repres."') AND (tipo_reg='T') AND (status = 'A') ";
    $query = mysql_query ($q, $connect);
    $rec = mysql_fetch_assoc($query);
    if ($rec["cont"] == 0 ) {
      if ($uranet == "S") {
        $repres = "URANET";
      } else {
        $repres = "";
      }
    }
  }
  if (!$status) {
    $where_status = "and (status = 'A')";
  }
  $q = "SELECT ".$campo_valor.", desc_classe, status, cor_item, cor_utilizacao FROM tb_classe WHERE (cod_classe = '".$classe."') AND (representante = '".$repres."') AND  (tipo_reg='I')".$where_like2.$where_filtro_cliente.$where_condicao." ".$where_status." ".$where_email." ".$order_select;
  $query = mysql_query ($q, $connect);
  if ($session["print_sql"] != "N") {
    $combo = "<option value='' style='background-color:#FFAAAA'>".$classe."</option>";
  } else {
    $combo = "";
  }
  if ($rec = mysql_fetch_array ($query)) {
    $combo .= "<option value=''> -- Selecione -- </option>";

    do{
      if (!$parametro) {
        if ((BuscaNaMatriz($array,$rec['vlr_classe']) != -1) || (BuscaNaMatriz($array,$rec['desc_classe']) != -1) ) {
          $selecao = "selected";
        } else {
          $selecao = "";
        }
      } else {
        if ($rec['vlr_classe']==$parametro) {
          $selecao = "selected";
        } else {
          $selecao = "";
        }
      }
      if ($rec['status'] != "A") {
        $status_combo = "-(".$rec['status'].")";
        $cor = "#FF0000";
        $corbg = "#FFFFFF";
      } else {
        if (SubStr($rec['desc_classe'],0,1) == "*") {
          $status_combo = "";
          $cor = "#0000FF";
          $corbg = "#FFFFFF";
        } else {
          $status_combo = "";
          if ($rec["cor_utilizacao"] == "L") {
            $cor   = "#".$rec["cor_item"];
            $corbg = "#FFFFFF";
          } else {
            $cor = "#000000";
            if ($rec["cor_utilizacao"] == "F") {
              $corbg = "#".$rec["cor_item"];
            } else {
              $corbg = "#FFFFFF";
            }
          }
        }
      }


      if (!$sem_param_order) {
        if ($order == "desc_classe") {
          $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['desc_classe']." - ".$rec['vlr_classe'].$status_combo."</option>";
        } else {
          if ($order == "vlr_classe") {
            $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe']." - ".$rec['desc_classe'].$status_combo."</option>";
          } else {
            if ($order == "so_desc_classe") {
              $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['desc_classe'].$status_combo."</option>";
            } else {
              if ($order == "so_vlr_classe") {
                $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe'].$status_combo."</option>";
              }
            }
          }
        }
      } else {
        $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe']." - ".$rec['desc_classe'].$status_combo."</option>";
      }

    } while ($rec = mysql_fetch_array($query));
  } else{
    $combo .= "<option value=''>Sem Ítens</option>";
  }

  return $combo;
}


function MontaListaEmailFax($classe, $array, $repres, $status, $parametro, $order, $uranet, $tipo_email_fax) {
  $connect = ConnectDB();
  global $session;

  $q_tp = "SELECT SUBSTRING(SUBSTRING_INDEX(desc_classe, '§', 1), 7)  AS vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = 'TPLIG' AND representante = '".$repres."' AND vlr_classe LIKE ";

  if ($tipo_email_fax == "S" || $tipo_email_fax == "R") {
    $q_tp .=  "'INTERGRALL-SMS%'";
  } else if ($tipo_email_fax == "F") {
    $q_tp .= "'INTERGRALL-FAX%'";
  }else if ($tipo_email_fax == "E" || $tipo_email_fax == "M") {
    $q_tp .= "'INTERGRALL-MAIL%'";
  }

  $query = mysql_query($q_tp, $connect);
  if ($rec = mysql_fetch_assoc($query)) {
    do {
      $grupo = $rec["vlr_classe"];
      $where_grupos .= "'".$grupo."',";
    } while($rec = mysql_fetch_assoc($query));
    $where_grupos = substr($where_grupos,0,-1);
  } else {
    return false;
  }

    //PERMISSÃO DE CONSULTA
  if (is_array($_SESSION["ssitgl_permissao_consulta"][$classe]) === false) {
    if ($_SESSION["ssitgl_permissao_consulta"][$classe] != "NAO_USA_CLASSE") {
      $where_filtro_cliente = "";
    } else {
      $where_filtro_cliente = $_SESSION["ssitgl_permissao_consulta"][$classe];
    }
  } else {
    if (count($_SESSION["ssitgl_permissao_consulta"][$classe]) > 0) {
      $where_filtro_cliente = " AND vlr_classe IN('".implode("','", $_SESSION["ssitgl_permissao_consulta"][$classe])."')";
    } else {
      if ($session["representante"] == "URANET") {
        $arr["info_selecione"] = "SESSION['ssitgl_permissao_consulta'] inválida para a classe: ".$classe.".";
      } else {
        $arr["info_selecione"] = "Sem Itens";
      }
      return $arr;
    }
  }

  if ($where_filtro_cliente != "NAO_USA_CLASSE") {
    if (($filtro_condicao == "ZD") || ($filtro_condicao == "ZZ")) {
      $where_condicao = "";
    } else {
      if (strlen($filtro_condicao) == 2) {
        $where_condicao = " AND filtro_classe = '".$filtro_condicao."'";
      } else {
        if (empty($filtro_condicao) === false) {
          $where_condicao = $filtro_condicao;
        } else {
          $where_condicao = "";
        }
      }
    }
  }


  if (!$order) {
    $sem_param_order = "sim";
    $order           = "desc_classe";
  }
  if (substr($order,0,2) == "so") {
    if ($order == "so_desc_classe") {
      $order_select = " ORDER BY desc_classe";
    } else {
      $order_select = " ";
    }
  } else {
    $order_select = " ORDER BY ".$order;
  }

  if (!$repres) {
    if ($uranet=="S") {
      $repres = "URANET";
    }else {
      $repres = "";
    }

  } else {
    $q = "SELECT COUNT(*) AS cont FROM tb_classe WHERE (cod_classe = '".$classe."') AND (representante = '".$repres."') AND  (tipo_reg='I') AND vlr_classe in (".$where_grupos.") ".$where_filtro_cliente.$where_condicao.$where_status." ".$order_select;
    $query = mysql_query ($q, $connect);
    $rec = mysql_fetch_array($query);
    If ($rec['cont'] == 0 ) {
      if ($uranet=="S") {
        $repres = "URANET";
      }else {
        $repres = "";
      }
    }
  }
  if (!$status) {
    $where_status = "and (status = 'A')";
  }
  $q = "SELECT vlr_classe, desc_classe, status, cor_item, cor_utilizacao FROM tb_classe WHERE (cod_classe = '".$classe."') AND (representante = '".$repres."') AND  (tipo_reg='I') AND vlr_classe in (".$where_grupos.") ".$where_filtro_cliente.$where_condicao.$where_status." ".$order_select;
  $query = mysql_query ($q, $connect);
  if ($session["print_sql"] != "N") {
    $combo = "<option value='' style='background-color:#FFAAAA'>".$classe."/TPLIG </option>";
  } else {
    $combo = "";
  }
  if ($rec = mysql_fetch_array ($query)) {
    $combo .= "<option value=''> -- Selecione -- </option>";

    do{
      if (!$parametro) {
        if ((BuscaNaMatriz($array,$rec['vlr_classe']) != -1) || (BuscaNaMatriz($array,$rec['desc_classe']) != -1) ) {
          $selecao = "selected";
        } else {
          $selecao = "";
        }
      } else {
        if ($rec['vlr_classe']==$parametro) {
          $selecao = "selected";
        } else {
          $selecao = "";
        }
      }
      if ($rec['status'] != "A") {
        $status_combo = "-(".$rec['status'].")";
        $cor = "#FF0000";
        $corbg = "#FFFFFF";
      } else {
        if (SubStr($rec['desc_classe'],0,1) == "*") {
          $status_combo = "";
          $cor = "#0000FF";
          $corbg = "#FFFFFF";
        } else {
          $status_combo = "";
          if ($rec["cor_utilizacao"] == "L") {
            $cor   = "#".$rec["cor_item"];
            $corbg = "#FFFFFF";
          } else {
            $cor = "#000000";
            if ($rec["cor_utilizacao"] == "F") {
              $corbg = "#".$rec["cor_item"];
            } else {
              $corbg = "#FFFFFF";
            }
          }
        }
      }


      if (!$sem_param_order) {
        if ($order == "desc_classe") {
          $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['desc_classe']." - ".$rec['vlr_classe'].$status_combo."</option>";
        } else {
          if ($order == "vlr_classe") {
            $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe']." - ".$rec['desc_classe'].$status_combo."</option>";
          } else {
            if ($order == "so_desc_classe") {
              $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['desc_classe'].$status_combo."</option>";
            } else {
              if ($order == "so_vlr_classe") {
                $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe'].$status_combo."</option>";
              }
            }
          }
        }
      } else {
        $combo .= "<option style=\"color: ".$cor."; background-color: ".$corbg.";\" value='".$rec['vlr_classe']."' ".$selecao.">".$rec['vlr_classe']." - ".$rec['desc_classe'].$status_combo."</option>";
      }

    } while ($rec = mysql_fetch_array($query));
  } else{
    $combo .= "<option value=''>Sem Ítens</option>";
  }

  return $combo;
}
?>
<?print GerarRodape($voltar);?>
</body>
<script language="javascript">ap_showWaitMessage('waitDiv', 0);</script>
</html>