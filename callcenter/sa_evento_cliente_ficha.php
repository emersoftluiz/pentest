<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}
require_once("mk_funcoes.php");
require_once("sa_funcoes.php");
require_once("cores.php");
require_once("funcoes/iaEFView.php");

$arrSistema = carregaParamSA("_", "SA".substr($classe_mkpro,2,4)."B" , $repre);
$mkParam    = carregaArrParam($classe_mkpro."A",$repre);
$mkParam    = carregaArrParam($classe_mkpro."B",$repre);

$tipo_abre_historico = $mkParam["tipo_abre_historico"];
$param_param_empresa = $mkParam["param_empresa"];
$param_repre_vendedor = $mkParam["repre_vendedor"];

$connect_sistema = ConnectSISTEMA();
$tabela_proposta = " tb_prop_evento ";
require_once("funcoes/NCFuncoes.php");


require_once $_SERVER["DOCUMENT_ROOT"]."/libs/lang/tradutor.php";
$objTradutor = new Tradutor($session["idioma"]);

//*****************VARIAVEIS Q DEVEM VIR VIA POST********************

//**************************************************
//Conecta ao BD do Parametro***********************
//**************************************************
if($mkParam["host_proposta"] == "") {
  $connectHOST = ConnectDB();
}else{
  $connectHOST = Conecta($mkParam["host_proposta"], $mkParam["user_proposta"], $mkParam["senha_proposta"], $mkParam["bd_proposta"]);
}
//*****************************************************
if ($deonde  != "ficha_hist") {
  if($chave1) {

    $from       = "FROM ".$tabela_proposta;
    if (substr($param_repre_vendedor,0,5) == "TELEF") {
    $where    = "WHERE representante = '".addslashes($param_repre_vendedor)."' and empresa ='".addslashes($param_param_empresa)."' AND (chave1 = '".addslashes($chave1)."' AND chave2 = '".addslashes($chave2)."' AND chave3 = '".addslashes($chave3)."')  ";
    } else {
      $w_evento_add = mkuDecode($w_evento);
    $where    = "WHERE chave1 = '".addslashes($chave1)."' AND chave2 = '".addslashes($chave2)."' AND chave3 = '".addslashes($chave3)."' AND representante = '".addslashes($param_repre_vendedor)."' and empresa ='".addslashes($param_param_empresa)."' " .$w_evento_add;
    }

    $order_by = "ORDER BY data DESC, hora DESC";

  }else{

    //acho que essa rotina não utiliza mais
    if($sa_usar_evento > 0){
      $where_chave .= "  (chave1 = '".addslashes($sa_chave1)."' AND chave2 = '".addslashes($sa_chave2)."' AND chave3 = '".addslashes($sa_chave3)."')  or ";
    }
    if($sa1_usar_evento > 0){
      $where_chave .= " (chave1 = '".addslashes($sa1_chave1)."' AND chave2 = '".addslashes($sa1_chave2)."' AND chave3 = '".addslashes($sa1_chave3)."') or ";
    }
    if($sa2_usar_evento > 0){
      $where_chave .= " (chave1 = '".addslashes($sa2_chave1)."' AND chave2 = '".addslashes($sa2_chave2)."' AND chave3 = '".addslashes($sa2_chave3)."') or ";
    }
    if($sa3_usar_evento > 0){
      $where_chave .= " (chave1 = '".addslashes($sa3_chave1)."' AND chave2 = '".addslashes($sa3_chave2)."' AND chave3 = '".addslashes($sa3_chave3)."') or ";
    }
    $where_chave = substr($where_chave,0,-3);
    //***********************************************


    $from     = "FROM ".$tabela_proposta;
    $where    = "WHERE  (".$where_chave.") AND representante = '".addslashes($param_repre_vendedor)."' and empresa ='".addslashes($param_param_empresa)."'  ";
    $order_by = "ORDER BY data DESC, hora DESC";
  }
} else {
  for ($x_sa = 0; $x_sa <30; $x_sa++) {
    if ($x_sa === 0) {
      $var_aux_chaves_sa = "sa_chaves";
    } else {
      $var_aux_chaves_sa = "sa".$x_sa."_chaves";
    }

    if(${$var_aux_chaves_sa} != "") {
      $arr_temp   = explode("|",${$var_aux_chaves_sa});
      $arr_chave1 = explode("¢",$arr_temp[0]);
      $arr_chave2 = explode("¢",$arr_temp[1]);
      $arr_chave3 = explode("¢",$arr_temp[2]);
      $where_chave .= " (";
      $where_chave .= "chave1 = '".addslashes($arr_chave1[1])."' ";
      if($arr_chave2[1]){
        $where_chave .= " AND chave2 = '".addslashes($arr_chave2[1])."' ";
      }
      if($arr_chave3[1]){
        $where_chave .= " AND chave3 = '".addslashes($arr_chave3[1])."' ";
      }
      $where_chave .= ") or ";
    }
  }
  $where_chave = substr($where_chave,0,-3);


  $from     = "FROM ".$tabela_proposta;
  if (substr($param_repre_vendedor,0,5) == "TELEF") {
  	$where    = "WHERE  representante = '".addslashes($param_repre_vendedor)."' and empresa ='".addslashes($param_param_empresa)."' and (".$where_chave.") ";

  } else {
    $where    = "WHERE  (".$where_chave.") AND representante = '".addslashes($param_repre_vendedor)."' and empresa ='".addslashes($param_param_empresa)."'  ";
  }


  //  $order_by = "ORDER BY data, hora";
  $order_by = "ORDER BY data DESC, hora DESC";
}


//********************************************************************



//***************************PARAMETROS*******************
//total de paginas a exibir
$arr_tipo_abre_historico = explode("¢",$tipo_abre_historico);
$total_limit = $arr_tipo_abre_historico[2];
//********************************************************



if($IntergrAllHeader){
?>
<!doctype html>
<html>
<head>
<title><?print $session["sistema"];?></title>
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<!-- *************** CSS *************** -->
<!-- bootstrap -->
<?print IntergrAllHeader();?>
<script type="text/javascript" src="consistencia.js"></script>
</head>
<body style="background:#FFFFFF">
<?
}else{
//***********************cabecalho do sistema*******************
?>
  <html>
  <head>
    <title><?print $session['sistema']?></title>
    <?print $v1_style_css?>
    <script language="javascript" type="text/javascript" src="consistencia.js"></script>
    <script language="javascript" >
    function confereCabecalho(form){
      return true;
    }
    </script>
  </head>
  <body>
<?
}

//**************************************************************







//*****************************************************************************
//*****************************************************************************
//**************************** ROTINA DE PAGINAÇÂO ****************************
//*****************************************************************************
//*****************************************************************************


if($classe_mkpro == "MDYL" && $deonde_vpg == "CO"){//if para o correspondente soh ver os eventos que ele pode ver
  $where .= " AND status in('U0','U8','UB') ";
}

//**********************************Monta o total de paginas*******************
if(!$pag){
  $pag = 0;
}

if(!$total_limit){$total_limit=30;}

if(!$falta_evento || $falta_evento == 0) {
  $sql_proposta_total   = "SELECT count(*) as total ".$from." ".$where;
  if ($dados_proposta_total = DescExecQuery($sql_proposta_total, $connectHOST)) {
    if ($rec_proposta_total = mysql_fetch_assoc ($dados_proposta_total)) {
      if ($rec_proposta_total["total"] > 0) {
        $tot_pag = (floor(($rec_proposta_total["total"])/$total_limit));
        if($rec_proposta_total["total"]%$total_limit > 0) {
          $tot_pag = $tot_pag+1;
        }
        $tot_registros = $rec_proposta_total["total"];
      } else {
        $tot_registros = 0;
        $tot_pag = 0;
      }
    }
  } else {
    if ($IntergrAllHeader) {
      ?>
      <div class="alert alert-error">
        <i class="icon16 i-close-4"></i>
        <strong>ERRO AO TENTAR BUSCAR OS EVENTOS. CONTATE O SAC - URANET E INFORME O OCORRIDO!<br><?=mysql_error($connectHOST);?></strong>
      </div>
      <?
    } else {
      print "<center><font class='txtvermelho'><strong>ERRO AO TENTAR BUSCAR OS EVENTOS. CONTATE O SAC - URANET E INFORME O OCORRIDO!<br>".mysql_error($connectHOST)."</strong></font>";
    }
  }
  // $sql_proposta_total   = "SELECT count(*) as total ".$from." ".$where;
  // $dados_proposta_total = mysql_query ($sql_proposta_total, $connectHOST);
  // $rec_proposta_total   = mysql_fetch_assoc ($dados_proposta_total);
  // $tot_pag = (floor(($rec_proposta_total["total"])/$total_limit));
  // if($rec_proposta_total["total"]%$total_limit > 0) {
  //   $tot_pag = $tot_pag+1;
  // }
  // $tot_registros = $rec_proposta_total["total"];
} else {
  $tot_pag = (floor(($tot_evento)/$total_limit));
  if($tot_evento%$total_limit > 0) {
    $tot_pag = $tot_pag+1;
  }
  $tot_registros = $tot_evento;
}

if($classe_mkpro == "MDSR" || $classe_mkpro == "MD6J"){
  $sql_aux = "SELECT seq ".$from." ".$where.$order_by;
  if ($dados_aux = DescExecQuery($sql_aux, $connectHOST)) {
    $x = $tot_registros;
    if ($rec_aux= mysql_fetch_assoc ($dados_aux)) {
      do {
        $mtr_seq[$rec_aux["seq"]] = $x;
        $x--;
      } while ($rec_aux= mysql_fetch_assoc ($dados_aux));
    }
  } else {
    if ($IntergrAllHeader) {
      ?>
      <div class="alert alert-error">
        <i class="icon16 i-close-4"></i>
        <strong>ERRO AO TENTAR BUSCAR OS EVENTOS. CONTATE O SAC - URANET E INFORME O OCORRIDO!<br><?=mysql_error($connectHOST);?></strong>
      </div>
      <?
    } else {
      print "<center><font class='txtvermelho'><strong>ERRO AO TENTAR BUSCAR OS EVENTOS. CONTATE O SAC - URANET E INFORME O OCORRIDO!<br>".mysql_error($connectHOST)."</strong></font>";
    }
  }
}

//*************************************************************************************************************

//**********************************TABELA DE PAGINAÇÃO MONTADA DO PROGRAMA*********************************
if($tot_pag>0){
  ?>
  <form name="paginas" method="post">
    <input type="hidden" name="tot_pag"          value="<?print $tot_pag?>">
    <input type="hidden" name="tot_registros"    value="<?print $tot_registros?>">
    <input type="hidden" name="pag"              value="<?print $pag?>">
    <input type="hidden" name="nro_modelo"       value="<?print $nro_modelo?>">
    <input type="hidden" name="nivel_atual"      value="<?print $nivel_atual?>">
    <input type="hidden" name="tipo_abertura"    value="<?print $tipo_abertura?>">
    <input type="hidden" name="id_receptivo"     value="<?print $id_receptivo?>">
    <input type="hidden" name="w_evento"         value="<?print $w_evento?>">
  </form>





<?
if($IntergrAllHeader){
  ?>

 <div class="simple-panel" style="margin-bottom:20px;" id="div_eventos">
  <div class="simple-panel-heading">

     <div class="row  gap0 pad0">
     <div class="col-xs-5  gap0 pad0">
                <h4 class="simple-panel-title"> <strong><? print $objTradutor->traduzir("Página"); ?>:</strong>  </h4>

            <?
            print "<select name='seleciona_pagina' onchange='document.paginas.pag.value=this.value;document.paginas.submit()'>";
            for($x_print=0 ;$x_print<$tot_pag;$x_print++){
              if($x_print == $pag){
                $cor = $session["td_destaque1"];
                $select_pag = " selected ";
              }else{
                $cor = $session["td_destaque"];
                $select_pag = "";
              }
              print "<option value='".$x_print."' ".$select_pag." >".($x_print+1)."/".($tot_pag)."</option>";
              //print "<input type='button'   style=\" background:'".$cor."';height:'18';color:'#ffffff';cursor:pointer;cursor:hand; \" value='".$x_print."' onclick='document.paginas.pag.value=".($x_print-1).";document.paginas.submit()';'>";
            }
            print "</select>";
            print "<input type='text'name='pag_procura' value='".($pag+1)."' size='2' maxlength='2' onFocus='this.select()' onkeyup='if((!isNaN(this.value-1)) && this.value <= ".$tot_pag."){document.paginas.pag.value=(this.value-1);document.paginas.submit();}else{alert(\"Digite Números apenas ou Números menor que ".($tot_pag+1)."\");}'>";
            ?>
      </div>
      <div class="col-xs-4  gap0 pad0">
               <?
               print "<h4 class='simple-panel-title'><strong>".$tot_registros." ".$objTradutor->traduzir('Ocorrências') ."</strong></h4>";

               ?>
      </div>
     <div class="col-xs-2  gap0 pad0">

               <?
               if($pag){
                 print "<h4><a href='Javascript:document.paginas.pag.value=parseFloat(document.paginas.pag.value)-1;document.paginas.submit()'><font color=".$vermelho_escuro.">  <<d><<d>".$objTradutor->traduzir("Anterior")." </font> </a></h4>";
               }
               ?>
     </div>
      <div class="col-xs-2 gap0 pad0">
           <?

               if($pag < ($tot_pag-1)){
                 print "<h4>&nbsp;&nbsp;&nbsp;<a href='Javascript:document.paginas.pag.value=parseFloat(document.paginas.pag.value)+1;document.paginas.submit()'><font color=".$verde_escuro.">".$objTradutor->traduzir("Próximo").">> </font></a></h4>";
               }
               ?>
            </div>
    </div>
    </h4>

  </div>
  <div class="simple-panel-body">
  <?
}else{
  ?>


  <table border="1" align="center" style="border-collapse:collapse" width="100%">
      <tr bgcolor="<?print $session['td_dado1']?>">
        <td    width="40%" align="left"  nowrap><font class="txt5">Página
        <?
        print "<select name='seleciona_pagina' onchange='document.paginas.pag.value=this.value;document.paginas.submit()'>";
        for($x_print=0 ;$x_print<$tot_pag;$x_print++){
          if($x_print == $pag){
            $cor = $session["td_destaque1"];
            $select_pag = " selected ";
          }else{
            $cor = $session["td_destaque"];
            $select_pag = "";
          }
          print "<option value='".$x_print."' ".$select_pag." >".($x_print+1)."/".($tot_pag)."</option>";
          //print "<input type='button'   style=\" background:'".$cor."';height:'18';color:'#ffffff';cursor:pointer;cursor:hand; \" value='".$x_print."' onclick='document.paginas.pag.value=".($x_print-1).";document.paginas.submit()';'>";
        }
        print "</select>";
        print "<input type='text'name='pag_procura' value='".($pag+1)."' size='2' maxlength='2' onFocus='this.select()' onkeyup='if((!isNaN(this.value-1)) && this.value <= ".$tot_pag."){document.paginas.pag.value=(this.value-1);document.paginas.submit();}else{alert(\"Digite Números apenas ou Números menor que ".($tot_pag+1)."\");}'>";

        ?>
        <td align="left" width="30%" nowrap><font class="txt5">
           <?
           print "<b>".$tot_registros." ".$objTradutor->traduzir("Ocorrências")."</b>";

           ?>
        <?
        if($falta_evento) {
          print "</font><font class='txtvermelho3'><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$objTradutor->traduzir("Faltam")." ".$falta_evento."</b>";
        }
        ?>
        <td align="left" width="15%" ><font class="txt5">
           <?
           if($pag){
             print "<a href='Javascript:document.paginas.pag.value=parseFloat(document.paginas.pag.value)-1;document.paginas.submit()'><font color=".$vermelho_escuro."><<d><<d>".$objTradutor->traduzir("Anterior")."</a>";
           }
           ?>
        <td  width="15%"  align="left"><font class="txt5">
           <?

           if($pag < ($tot_pag-1)){
             print "&nbsp;&nbsp;&nbsp;<a href='Javascript:document.paginas.pag.value=parseFloat(document.paginas.pag.value)+1;document.paginas.submit()'><font color=".$verde_escuro.">".$objTradutor->traduzir("Próximo").">></a>";
           }
           ?>
      </tr>
  </table>
  <?
}
}
//*****************************************************************************************



//*****************************************************************************************
//*****************************************************************************************
//***********************FIM DA ROTINA DE PAGINAÇÂO ***************************************
//*****************************************************************************************
//*****************************************************************************************







//*****************************************************************************************
//*****************************************************************************************
//***********************ROTINA DE IMPRESSAO DAS FICHAS PAGINADAS *************************
//*****************************************************************************************
//*****************************************************************************************


//***********************************SELECIONA TODOS OS REGISTROS INCLUI ESPECIFICO********

print "
  <div style='background: #FFFFFF;padding:0px; width:100%; overflow-x:hidden;'>";


 $sql_proposta = "SELECT * ".$from." ".$where." ".$order_by."  LIMIT ".($pag* $total_limit).",".$total_limit."";


if ($dados_proposta = DescExecQuery($sql_proposta, $connectHOST)) {
  if($rec_proposta= mysql_fetch_assoc($dados_proposta)) {
    if($rec_proposta["sa_tipo"] == ""){
      $rec_proposta["sa_tipo"] = $rec_proposta["sistema_aux_status_ant"];
    }
    if($IntergrAllHeader){
      ?>

        <div class="evento-lista">
           <ul class="list-unstyled">
      <?
    }else{
        ?>
          <table border='0' width="100%"><tr><td>
        <?
    }


    ?>



    <?


  do{
    /*
    if(file_exists("md_hist_cliente_ficha_".$include_dados.".php")){
    include "md_hist_cliente_ficha_".$include_dados.".php";
    }else{
    print "<font class='txtvermelho'><b><br><br><br><br><br><br><br><center>Arquivo </b><i>md_hist_cliente_ficha_".$include_dados.".php</i><b> não encontrado!<br>Por favor, contate o administrador.</center></b></font>";
    }
    */

          $param_status_classe = $arrSistema[$rec_proposta["sa_tipo"]."_status_classe"];

          if(!$param_status_classe){
            $param_status_classe = "GV".substr($classe_mkpro,2,2)."3";
          }

          if($IntergrAllHeader) {  ?>

          <li class="active">
            <div class="row">
              <div class="col-xs-6 etapa">
                <? print $objTradutor->traduzir("Etapa"); ?>:<?
                if($rec_proposta["sa_tipo"] && $rec_proposta["sa_tipo"] != "ATD" ){
                  print $objTradutor->traduzir($arrSistema[$rec_proposta["sa_tipo"]."_titulo"]);
                  print '</b>';
                }else{
                  if(substr($classe_mkpro,2,4) == "7C"){
                    print $objTradutor->traduzir("Cadastro da Ficha");
                  }else{
                    $desc_etapa = $objTradutor->traduzir(ValorClassePrint("SA".substr($classe_mkpro,2,4)."T",'ATD',$param_repre_vendedor,true));

                    if($desc_etapa == " -- "){
                      print $objTradutor->traduzir("Atendimento");
                    }else{
                      print $objTradutor->traduzir($desc_etapa);
                    }
                  }

				  if($rec_proposta["sa_tipo"] == "ATD" && ($mkParam["conclusao_receptivo"] == "S" || substr($classe_mkpro,0,2)== "DK")){
					  if(substr($rec_proposta["status"],0,1) == "2" || substr($rec_proposta["status"],0,1) == "3" || substr($rec_proposta["status"],0,1) == "4" ||  substr($rec_proposta["status"],0,1) == "0" ){
						print "&nbsp;-&nbsp;".$objTradutor->traduzir(ValorClassePrint("GC".substr($classe_mkpro,2,4)."3",substr($rec_proposta["status"],0,1),$param_repre_vendedor,true));;
					  }else{
  					     print "&nbsp;-&nbsp;".$objTradutor->traduzir(ValorClassePrint("GC".substr($classe_mkpro,2,4)."3",'1',$param_repre_vendedor,true));;
					  }
				  }

                  print "</b>";
                }?>
              </div>

              <div class="col-xs-6 quem" >
                    <?print NomeResumido($rec_proposta["login"]);
                    if(strpos($rec_proposta["login"], "bmg") !== false){
                      print " ";
                    }else{
                      print " (".$rec_proposta["login"].") ";
                    }

                    print " em ".BRDate($rec_proposta["data"])." às ".$rec_proposta["hora"];
                    if($arrSistema[$rec_proposta["sistema_aux_status"]."_flw_utiliza"] == "S"){
                      print "&nbsp;".$objTradutor->traduzir("Duração").": ".CalcTime($rec_proposta["flw_duracao"]);
                    }

                    if($mkParam["sla_atd_padrao"] == 'S' && $rec_proposta['sla_etapa_duracao'] != 0){
                      require_once($root."flw_funcoes.php");
                      print "<label>&nbsp SLA: &nbsp</label>";
                      print ImgPrazo('F', substr($rec_proposta['sla_etapa_data_hora_ini'], 0,10), substr($rec_proposta['sla_etapa_data_hora_ini'], 11,8), $rec_proposta['sla_etapa_duracao'], $rec_proposta['sla_etapa_tempo_previsao'], 'DI', '');
                    }
?>



                </span></div>
             </div>

             <div class="row">
                    <div class="col-sm-8">
                       <div class="row">








  <?if($rec_proposta["status_ant"]) {

    $cor_fonte_ant = $arrSistema[ $rec_proposta["sa_tipo"]."_cor_".retornaStatusSa($arrSistema,$rec_proposta["sa_tipo"],$rec_proposta["status_ant"]) ];
    ?>
            <div class="col-sm-6 status_de" style="color: <?print $cor_fonte_ant?>" ><strong>De: </strong>
              <?
              $colspan_1 = "1";
              $colspan_2 = "1";
              $desc_print = "";
               $desc_print = ValorClasse($param_status_classe, $rec_proposta["status_ant"], $rec_proposta["representante"], true);
               if($desc_print == " -- "){
                 $desc_print = $rec_proposta["status_ant"]." - ".$arrSistema[$rec_proposta["sa_tipo"]."_nome_".retornaStatusSa($arrSistema,$rec_proposta["sa_tipo"],$rec_proposta["status_ant"])];
               }else{
                 $desc_print." (".ValorClasse("SA".substr($classe_mkpro,2,4)."T", $rec_proposta["sistema_aux_status_ant"], $rec_proposta["representante"], true).")";
               }


              print $desc_print;
              /*comentado pelo david nao faz sentido... quem quizer me procure para falar a respeito
              $desc_tipo_sa = ValorClasse("SA".substr($classe_mkpro,2,4)."T",$rec_proposta["sistema_aux_status_ant"],$rec_proposta["representante"], true);
              if(trim($desc_tipo_sa) != "--"){
                print " (".$desc_tipo_sa.")";
              }*/


              if($rec_proposta["cod_recusa_ant"]) {
                $motivo_ant = ValorClasse($rec_proposta["classe_recusa_ant"], $rec_proposta["cod_recusa_ant"], $rec_proposta["representante"]);
                if(substr($classe_mkpro,2,4) == "9V"){
				  print "&nbsp;&nbsp;".$motivo_ant;
				} else {
				  print "&nbsp;&nbsp;".$motivo_ant." (".$rec_proposta["cod_recusa_ant"].") ";
				}
              }
              ?>

               </span></div>
              <?
  }
              ?>















           <?$cor_fonte = $arrSistema[$rec_proposta["sistema_aux_status"]."_cor_".retornaStatusSa($arrSistema,$rec_proposta["sistema_aux_status"],$rec_proposta["status"]) ];?>
            <div class="col-sm-6 status_para"  style="color: <?print $cor_fonte?>" >
                     <?if($rec_proposta["status_ant"]){?>
                        <strong><?print $objTradutor->traduzir("Para")?>: </strong>
                      <?}else{?>
                        <strong><?print $objTradutor->traduzir("Status")?>: </strong>
                      <?}?>
                    <?
                     $desc_print = "";
                      $desc_print = ValorClasse($param_status_classe, $rec_proposta["status"], $rec_proposta["representante"] , true);
                     if($desc_print == " -- "){
                       $desc_print = $rec_proposta["status"]." - ".$arrSistema[$rec_proposta["sistema_aux_status"]."_nome_".retornaStatusSa($arrSistema,$rec_proposta["sistema_aux_status"],$rec_proposta["status"])];
                     }else{
                       $desc_print." (".ValorClasse("SA".substr($classe_mkpro,2,4)."T", $rec_proposta["sistema_aux_status"], $rec_proposta["representante"], true).")";
                     }





                      print $desc_print;
                      /*comentado pelo david nao faz sentido... quem quizer me procure para falar a respeito
                      if($rec_proposta["sistema_aux_status"] == ""){
                         print " (Atendimento)";
                      }else{
                        $desc_tipo_sa = ValorClasse("SA".substr($classe_mkpro,2,4)."T",$rec_proposta["sistema_aux_status"],$rec_proposta["representante"], true);
                        if(trim($desc_tipo_sa) != "--"){
                          print " (".$desc_tipo_sa.")";
                        }
                      }
                      */

                      if($rec_proposta["cod_recusa"]) {
                        $motivo = ValorClasse($rec_proposta["classe_recusa"], $rec_proposta["cod_recusa"], $rec_proposta["representante"]);
                        if(substr($classe_mkpro,2,4) == "9V"){
						  print "&nbsp;&nbsp;".$motivo;
						} else {
						  print "&nbsp;&nbsp;".$motivo." (".$rec_proposta["cod_recusa"].") ";
						}
                      }

                      //Incluir data/hora no evento de Visita Agenda (Porto Seguro PMO)
                      if(substr($classe_mkpro, 2, 2) == "OM" && $rec_proposta["cod_recusa"] == "AV01" && $rec_proposta["data_hora"] != "1111-11-11 00:00:00") {
                        print "-&nbsp;".BRDate(substr($rec_proposta["data_hora"], 0, 10)) . substr($rec_proposta["data_hora"], 10, 6);
                      }
            ?>

                          </div>
                         </div>
                         <div class="row">
                            <div class="col-xs-12 observacao">
                              <?
                                if($rec_proposta["observacao"]) {
                                ?>

                                  <strong><? print $objTradutor->traduzir("Observação"); ?>: </strong><span style="background-color:#EFEFEF;"><?print str_replace('|br|',"<br>",$rec_proposta["observacao"]);?></span>

                                <?
                                }
                              ?>

                            </div>
                         </div>
                    </div>
                    <div class="col-sm-4 alert-info">


                        <div class="row">
                        <?if($rec_proposta["nome_gravacao"] != "" || $rec_proposta["email_id"] != "" || $rec_proposta["sms_id"] != ""){?>
                                        <div class="col-xs-8 nowrap"><strong></strong></div>
                        <?}?>
                                      <?if ($rec_proposta["anexos"] || (substr($rec_proposta["representante"], 0, 5) == "SUHAI" && (substr($classe_mkpro, 2, 2) == "SR" || substr($classe_mkpro, 2, 2) == "6J") && ($rec_proposta["status"] == "B" || $rec_proposta["status"] == "I"))) {?>
                                          <div class="col-xs-4  nowrap"><strong></strong></div>
                                      <?}?>
                        </div>
                        <div class="row">

                        <?if($rec_proposta["nome_gravacao"] != "" || $rec_proposta["email_id"] != "" || $rec_proposta["sms_id"] != ""){?>
                                      <div class="col-xs-8  nowrap" style='display:flex' > <?print IAPGravacao($rec_proposta["nome_gravacao"].",".$rec_proposta["email_id"].",".$rec_proposta["sms_id"], "", $mensagem);?> </div>
                        <?}?>
                                      <?if($rec_proposta["anexos"]) {?>
                                         <div class="col-xs-2 nowrap"><?
                                          if(substr($rec_proposta["anexos"], 0, 5) != 'DocMK') {
                                            $arr_arqs = explode(":", $rec_proposta["anexos"]);
                                            $x_arq = 0;
                                            foreach ($arr_arqs as $str_arq) {
                                              if($x_arq > 0){print " - ";}
                                              $arr_arq = explode("|", $str_arq);
                                              $adext = ValorClasse("SUEXT", strtolower($arr_arq[1]), "URANET");?>
                                              <?if($adext == "imagem"){?>
                                                <img src="includes/richcompose_files/icon_view_img.gif" alt="Vizualizar Imagem"  OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=VISUALIZAR&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '700', '500', 'TL');" onmouseover="style.cursor='pointer';style.cursor='hand';">
                                              <?}?>
                                                <img alt='Download' OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=DOWNLOAD&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '400', '400');" border="0" width='15' src='imagens/download.gif' onmouseover="style.cursor='pointer';style.cursor='hand';">
                                              <?
                                                $x_arq++;
                                              }
                                          } else {
                                             $arr_arqs = explode("§", $rec_proposta["anexos"]);
                                            $x_arq = 0;
                                            foreach ($arr_arqs as $str_arq) {
                                              if($x_arq > 0){print " - ";}
                                              $arr_arq = explode("|", $str_arq);
                                              $adext = ValorClasse("SUEXT", strtolower($arr_arq[1]), "URANET");?>
                                              <?if($adext == "imagem"){?>
                                                <img src="includes/richcompose_files/icon_view_img.gif" alt="Vizualizar Imagem"  OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=VISUALIZAR&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '700', '500', 'TL');" onmouseover="style.cursor='pointer';style.cursor='hand';">
                                              <?}?>
                                                <img alt='Download' OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=DOWNLOAD&nome_anexo=".$str_arq."&tipo_popup=AJ");?>', 'JanExcDoc', '400', '400');" border="0" width='15' src='imagens/download.gif' onmouseover="style.cursor='pointer';style.cursor='hand';" title="<? print substr($arr_arq[0], 6) . "." . $arr_arq[1]; ?>">
                                              <?
                                                $x_arq++;
                                              }
                                          }
                                                    ?>
                                         </div>
                                       <?}?>
                         </div>
                    </div>
             </div>




  <?
 } else{
  ?>




  <table border="1" style="border-collapse: collapse" width="99%" cellpadding="1" cellspacing="0" align="center">
      <tr bgcolor="<?print $session['td_destaque']?>">
        <td colspan="3"><font class="txt6">
          <?/*print $rec_proposta["sistema_aux_status_ant"];*/?>
          <b><? print $objTradutor->traduzir("Etapa"); ?>:
          <?if($rec_proposta["sa_tipo"] && $rec_proposta["sa_tipo"] != "ATD" ){?>
          <?print $objTradutor->traduzir($arrSistema[$rec_proposta["sa_tipo"]."_titulo"]);?> </b>
          <?}else{?>
          <?
          if(substr($classe_mkpro,2,4) == "7C"){
             print $objTradutor->traduzir("Cadastro da Ficha");
          }else{


          	$desc_etapa = ValorClasse("SA".substr($classe_mkpro,2,4)."T",'ATD',$param_repre_vendedor);
          	if($desc_etapa == " -- "){
               print $objTradutor->traduzir($objTradutor->traduzir("Atendimento"));
          	}else{
          		print $objTradutor->traduzir($desc_etapa);
          	}

          }
          ?> </b>
          <?}?>
        </td>
        <td colspan="2"><font class="txt6">
          <b>
          <?print NomeResumido($rec_proposta["login"])." (".$rec_proposta["login"].") "?>
          <?print " em ".BRDate($rec_proposta["data"])." às ".$rec_proposta["hora"]?>
          <?
          if($arrSistema[$rec_proposta["sistema_aux_status"]."_flw_utiliza"] == "S"){
            print "&nbsp;".$objTradutor->traduzir("Duração").": ".CalcTime($rec_proposta["flw_duracao"]);
          }
          ?>

          </b>
        </td>
      </tr>
      <tr>
        <td colspan="6">
          <table width="100%" border="0" cellpadding="1" cellspacing="0">
            <tr bgcolor="<?print $session['td_dado1']?>">
          <?



          if($rec_proposta["status_ant"]) {?>
            <td width="5%"><font class="txt5"><strong><?print $objTradutor->traduzir("De")?>: </strong></td>
              <?
              $colspan_1 = "1";
              $colspan_2 = "1";
              $desc_print = "";
               $desc_print = ValorClasse($param_status_classe, $rec_proposta["status_ant"], $rec_proposta["representante"]);
               if($desc_print == " -- "){
                 $desc_print = $rec_proposta["status_ant"]." - ".$arrSistema[$rec_proposta["sa_tipo"]."_nome_".retornaStatusSa($arrSistema,$rec_proposta["sa_tipo"],$rec_proposta["status_ant"])];
               }else{
                 $desc_print." (".ValorClasse("SA".substr($classe_mkpro,2,4)."T", $rec_proposta["sistema_aux_status_ant"], $rec_proposta["representante"]).")";
               }

              $cor_fonte_ant = $arrSistema[ $rec_proposta["sa_tipo"]."_cor_".retornaStatusSa($arrSistema,$rec_proposta["sa_tipo"],$rec_proposta["status_ant"]) ];
              if((!$rec_proposta["cod_recusa_ant"])) {
                $colspan_1 = "3";
              }
?>
              <td width="25%" colspan="<?print $colspan_1?>" align="left" nowrap><font class="txt5" style="color: <?print $cor_fonte_ant?>">
                <?

                print $desc_print;
                $desc_tipo_sa = ValorClasse("SA".substr($classe_mkpro,2,4)."T",$rec_proposta["sistema_aux_status_ant"],$rec_proposta["representante"]);
                if(trim($desc_tipo_sa) != "--"){
                  print " (".$desc_tipo_sa.")";
                }
          ?>
              </td>
<?

              if($rec_proposta["cod_recusa_ant"]) {
              ?>
                <td width="5%"><font class="txt5"><strong><? print $objTradutor->traduzir("Motivo"); ?>: </strong></td>
                <td width="25%" align="left" nowrap><font class="txt5">
                  <?
                  $motivo_ant = ValorClasse($rec_proposta["classe_recusa_ant"], $rec_proposta["cod_recusa_ant"], $rec_proposta["representante"]);
                  if(substr($classe_mkpro,2,4) == "9V"){
				    print $motivo_ant;
				  } else {
				    print $motivo_ant." (".$rec_proposta["cod_recusa_ant"].") ";
				  }
                  ?>
                </td>
              <?
              }
              ?>
      <?}else{
        print "<td colspan=4>";
      }?>
              <td width="30%" rowspan="3"><font class="txt5">
                <table width="100%" border="0" cellpadding="1" cellspacing="0">
                  <tr>
                    <?if($rec_proposta["nome_gravacao"]){?>
                      <td align="center" width="50%"><font class="txt5"><strong><? print $objTradutor->traduzir("Gravação"); ?></strong></td>
                    <?}?>
                    <?if($rec_proposta["email_id"]){?>
                        <td align="center" width="50%"><font class="txt5"><strong>Email </strong></td>
                    <?}?>
                    <?if($rec_proposta["sms_id"]){?>
                        <td align="center" width="50%"><font class="txt5"><strong>SMS </strong></td>
                    <?}?>
                    <?if ($rec_proposta["anexos"] || (substr($rec_proposta["representante"], 0, 5) == "SUHAI" && (substr($classe_mkpro, 2, 2) == "SR" || substr($classe_mkpro, 2, 2) == "6J") && ($rec_proposta["status"] == "B" || $rec_proposta["status"] == "I"))) {?>
                        <td align="center" width="50%"><font class="txt5"><strong><? print $objTradutor->traduzir("Anexos"); ?> </strong></td>
                    <?}?>
                  </tr>
                  <tr bgcolor="#ffffff">
                   <?if($rec_proposta["nome_gravacao"]){?>
                      <td align="center"><font class="txt5"><?print IAPGravacao($rec_proposta["nome_gravacao"], "", $mensagem);?> </td>
                    <?}
                    //print " WWWWW ".$arrSistema[$rec_proposta["sistema_aux_status_ant"]."_uso_email_".retornaStatusSa($arrSistema,$rec_proposta["sistema_aux_status_ant"],$rec_proposta["status"])];
                    $ano_mes_email = str_replace("-","",substr($rec_proposta["data"],0,7));
                    ?>
                    <?if($rec_proposta["email_id"] != "") {
                      $q_email = "SELECT status_envio, num FROM tb_email_fax WHERE arquivo_body = '".addslashes($rec_proposta["email_id"])."'";
                      $query_email = DescExecQuery($q_email, $connect_sistema, "N");
                      $rec_email = mysql_fetch_assoc($query_email);

                      $situacao_email = $rec_email['status_envio'];
                    ?>
                        <td align="center"><font class="txt5"><?print iaEFView($rec_proposta["email_id"])."  ".ValorClasse("URAE3", $situacao_email, $repre);?> <img src='imagens/interroga.gif' onclick="AbreJanela('cc_mostra_obs.php?ano_mes=<?print $ano_mes_email?>&num=<?print $rec_email['num']?>&bd=Sistema&tabela=tb_email_fax', 'JanObs','600', '500')" onMouseOver="javascript:style.cursor='hand';" OnMouseOut="javascript:style.cursor='default'" title="<? print $objTradutor->traduzir("Observação"); ?>"> </td>
                    <?}?>
                    <?if($rec_proposta["sms_id"] != "") {
                      $ano_mes_sms = str_replace("-","",substr($rec_proposta["data"],0,7));
                      $q_sms = "SELECT status_envio, num FROM tb_email_fax WHERE arquivo_body = '".addslashes($rec_proposta["sms_id"])."'";
                      $query_sms = DescExecQuery($q_sms, $connect_sistema, "N");
                      $rec_sms = mysql_fetch_assoc($query_sms);

                      $situacao_sms = $rec_sms['status_envio'];
                    ?>
                        <td align="center"><font class="txt5"><?print iaEFView($rec_proposta["sms_id"])."  ".ValorClasse("URAE3", $situacao_sms, $repre);?> <img src='imagens/interroga.gif' onclick="AbreJanela('cc_mostra_obs.php?ano_mes=<?print $ano_mes_sms?>&num=<?print $rec_sms['num']?>&bd=Sistema&tabela=tb_email_fax', 'JanObs','600', '500')" onMouseOver="javascript:style.cursor='hand';" OnMouseOut="javascript:style.cursor='default'" title="Observação"> </td>
                    <?}?>
                     <?
                     if (substr($rec_proposta["representante"], 0, 5) == "SUHAI" && (substr($classe_mkpro, 2, 2) == "SR" || substr($classe_mkpro, 2, 2) == "6J") && ($rec_proposta["status"] == "B" || $rec_proposta["status"] == "I" || $rec_proposta["status"] == "X")) {
                      (!$seq) ? $seq = $tot_registros : "";
                     	?>
                     	<td align="center"><font class="txt5">
                     		<img alt='Download' OnClick="AbreJanela('vda_suhai_padrao_v2_imprime_cotacao.php?n_pedido=<?print $rec_proposta["chave1"]?>&status=<?print $rec_proposta["status"]?>&data=<?print $rec_proposta["data"];?>&seq=<?print $mtr_seq[$rec_proposta["seq"]];?>', 'JanExcDoc', '400', '400');" border="0" width='15' src='imagens/download.gif' onmouseover="style.cursor='pointer';style.cursor='hand';"></a>
                     	</td>
                     	<?
                      $seq--;
                     } else  if ($rec_proposta["anexos"]) {?>
                     <td align="center"><font class="txt5"><?

                                $arr_arqs = explode(":", $rec_proposta["anexos"]);
                                $x_arq = 0;
                                foreach ($arr_arqs as $str_arq) {
                                  if($x_arq > 0){print " - ";}
                                  $arr_arq = explode("|", $str_arq);
                                  $adext = ValorClasse("SUEXT", strtolower($arr_arq[1]), "URANET");?>
                                  <?if($adext == "imagem"){?>
                                    <img src="includes/richcompose_files/icon_view_img.gif" alt="Vizualizar Imagem"  OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=VISUALIZAR&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '700', '500', 'TL');" onmouseover="style.cursor='pointer';style.cursor='hand';">
                                  <?}?>
                                    <img alt='Download' OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=DOWNLOAD&num=".$arr_arq[5]."&mk_flag=".$arr_arq[3]."&mk_numero=".$arr_arq[4]);?>', 'JanExcDoc', '400', '400');" border="0" width='15' src='imagens/download.gif' onmouseover="style.cursor='pointer';style.cursor='hand';"></a>
                                  <?
                                    $x_arq++;
                                  }
                     }
                     ?>

                  </tr>
                </table>
              </td>
            </tr>








            <tr bgcolor="<?print $session['td_dado1']?>">
             <?if($rec_proposta["status_ant"]){?>
              <td><font class="txt5"><strong><? print $objTradutor->traduzir("Para"); ?>: </strong></td>
              <?}else{?>
              <td><font class="txt5"><strong><? print $objTradutor->traduzir("Status"); ?>: </strong></td>
              <?}?>
              <?
              $cor_fonte = $arrSistema[$rec_proposta["sistema_aux_status"]."_cor_".retornaStatusSa($arrSistema,$rec_proposta["sistema_aux_status"],$rec_proposta["status"]) ];
              if((!$rec_proposta["cod_recusa"])) {
                $colspan_2 = "3";
              }
              ?>
              <td colspan="<?print $colspan_2?>" nowrap><font class="txt5" style="color: <?print $cor_fonte?>">
<?


               $desc_print = "";
                $desc_print = ValorClasse($param_status_classe, $rec_proposta["status"], $rec_proposta["representante"]);
               if($desc_print == " -- "){
                 $desc_print = $rec_proposta["status"]." - ".$arrSistema[$rec_proposta["sistema_aux_status"]."_nome_".retornaStatusSa($arrSistema,$rec_proposta["sistema_aux_status"],$rec_proposta["status"])];
               }else{
                 $desc_print." (".ValorClasse("SA".substr($classe_mkpro,2,4)."T", $rec_proposta["sistema_aux_status"], $rec_proposta["representante"]).")";
               }



                print $desc_print;
                if($rec_proposta["sistema_aux_status"] == ""){
                   print " (Atendimento)";
                }else{
                  $desc_tipo_sa = ValorClasse("SA".substr($classe_mkpro,2,4)."T",$rec_proposta["sistema_aux_status"],$rec_proposta["representante"]);
                  if(trim($desc_tipo_sa) != "--"){
                    print " (".$desc_tipo_sa.")";
                  }
                }

?>
              </td>
              <?
              if($rec_proposta["cod_recusa"]) {
                ?>
                  <td><font class="txt5"><strong>Motivo: </strong></td>
                  <td width="25%" nowrap><font class="txt5">
                    <?
                    $motivo = ValorClasse($rec_proposta["classe_recusa"], $rec_proposta["cod_recusa"], $rec_proposta["representante"]);
                    if(substr($classe_mkpro,2,4) == "9V"){
					  print $motivo;
					} else {
					  print $motivo." (".$rec_proposta["cod_recusa"].") ";
					}
                    ?>
                  </td>
                <?
              }
            ?>


            </tr>
          </table>
        </td>
      </tr>
<?
 }


if($rec_proposta["sa_tipo"] && $rec_proposta["sa_tipo"] != "ATD"){
   $arr_campos_evento = explode("¢", $arrSistema[$rec_proposta["sa_tipo"]."_evento_campos"]);
}else{
  if($rec_proposta["sistema_aux_status"]){
    $arr_campos_evento = explode("¢", $arrSistema[$rec_proposta["sistema_aux_status"]."_evento_campos"]);
  }else{
    $arr_campos_evento = explode("¢", $arrSistema["sa_evento_campos"]);
  }

}


// print_r($arr_campos_evento);
foreach ($arr_campos_evento as $key => $valor) {
  //$colspan++;
  $aux = explode("£",$valor);
  $arr_campos_evento_titulo[$key] = $aux[0];
  $arr_campos_evento_select[$key] = $aux[1];
  if(!$aux[2])  {
    $arr_campos_evento_align[$key]  = "left";
  }
  //$arr_campos_evento_width[$key]  = $aux[3];
  if (strpos("**".$aux[4], "(CAMPO)") > 0) {//caso seja valor classe pegando do campo
    $aux_campo_classe = str_replace("(CAMPO)", "", $aux[4]);
    $arr_campos_evento_classe[$key] = $rec_proposta[$aux_campo_classe];
    $arr_campos_evento_funcao[$key] = "";
  } else {
    $arr_campos_evento_classe[$key] = $aux[3];
    $arr_campos_evento_funcao[$key] = $aux[4];
  }
}


if($IntergrAllHeader){
  print "<div class='row'><div class='col-xs-12 gap-left25 gap-right25'><table class='table table-small font-small'>";
}


$monta_tabela = false;
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/CEFuncoes.php");
foreach ($arr_campos_evento_titulo as $i => $tit_campo) {
  if($arr_campos_evento_titulo[$i] != "") {
    if ($monta_tabela === false) {
      ?>
                  <tr>
                    <td colspan="6">
                      <table border="0" width="100%" cellpadding="1" cellspacing="0">
                        <tr bgcolor="<?print $session['td_dado3']?>">
          <?
          $monta_tabela = true;
    }
          ?>
                          <td align="<?print $arr_campos_evento_align[$i]?>"><font class="txt5"><strong><?print $tit_campo?></strong></td>
          <?
  }
}

          $mostra_tr = false;
          foreach ($arr_campos_evento_titulo as $i => $tit_campo) {
            if($arr_campos_evento_titulo[$i] != "") {
              if ($mostra_tr === false) {
          ?>
                        </tr>
                        <tr>
          <?
                $mostra_tr = true;
              }
          ?>
                          <td align="<?print $arr_campos_evento_align[$i]?>"><font class="txt5">
                            <?
                            if($arr_campos_evento_classe[$i] != "") {
                              print ValorClasse($arr_campos_evento_classe[$i], $rec_proposta["campo".($i+1)], $rec_proposta["representante"]);
                            }else
                              if ($arr_campos_evento_funcao[$i] == "getDescItem") {
                               print $arr_campos_evento_funcao[$i]($rec_proposta["campo1"],$rec_proposta["campo2"],$rec_proposta["campo3"], "S");
                              } else
                              if($arr_campos_evento_funcao[$i] != "") {
                                if(function_exists($arr_campos_evento_funcao[$i])){
                                  print $arr_campos_evento_funcao[$i]($rec_proposta["campo".($i+1)]);
                                }else{
                                  print "FNE(".$arr_campos_evento_funcao[$i].")";
                                }
                              }else{
                                if(substr($rec_proposta["campo".($i+1)],0,5) != "DocMK") {
                                  print $rec_proposta["campo".($i+1)];
                                }else {
                                $arr_arqs = explode(":", $rec_proposta["campo".($i+1)]);
                                $x_arq = 0;
                                foreach ($arr_arqs as $str_arq) {
                                  if($x_arq > 0){print " - ";}
                                  $arr_arq = explode("|", $str_arq);
                                  $adext = ValorClasse("SUEXT", strtolower($arr_arq[1]), "URANET");?>
                                  <?if($adext == "imagem"){?>
                                    <img src="includes/richcompose_files/icon_view_img.gif" alt="Vizualizar Imagem"  OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=VISUALIZAR&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '700', '500', 'TL');" onmouseover="style.cursor='pointer';style.cursor='hand';">
                                  <?}?>
                                    <img alt='Download' OnClick="AbreJanela('docs.php?mku=<?print MKUEncode("acao=DOWNLOAD&num=".base64_encode($arr_arq[5])."&mk_flag=".base64_encode($arr_arq[3])."&mk_numero=".base64_encode($arr_arq[4]));?>', 'JanExcDoc', '400', '400');" border="0" width='15' src='imagens/download.gif' onmouseover="style.cursor='pointer';style.cursor='hand';"></a>
                                  <?
                                    $x_arq++;
                                  }
                              }
                            }
                            ?>
                          </td>
          <?
            }
          }

          if ($monta_tabela === true) {
          ?>
                        </tr>
                      </table>
                    </td>
                  </tr>
      <?
          }



          if(!$IntergrAllHeader) {
                  if($rec_proposta["observacao"]) {
              ?>
                    <tr bgcolor="<?print $session['td_dado3']?>">
                      <td colspan="5"><font class="txt5"><b>Observação: </b>
                        <?print str_replace('|br|',"<br>",$rec_proposta["observacao"]);?>
                      </td>
                    </tr>
              <?
                  }

                  if(trim($rec_proposta["alteracoes"])!== "") {
		              ?>
		                    <tr bgcolor="<?print $session['td_dado3']?>">
		                      <td colspan="5"><font class="txt5"><b>Ultimas Atualizações: </b>
		                        <?print montaTabelaUltimaAtualizacao($rec_proposta["alteracoes"]);?>
		                      </td>
		                    </tr>
		              <?
                  }
              ?>
            </table>
            <font style="font-size:25%"><br></font>
          <?
          }else{

                  if(trim($rec_proposta["alteracoes"])!== "" && trim($rec_proposta["alteracoes"])!== $objTradutor->traduzir("Nenhuma modificação foi efetuada.")) {
              ?>
                    <tr >
                      <td colspan="5"><h5>Ultimas Atualizações: </h5>
                        <?print montaTabelaUltimaAtualizacao($rec_proposta["alteracoes"]);?>
                      </td>
                    </tr>
              <?
                  }

            print"</table>";


          print "</div></div>";
          ?>

          </a>
      </li>
          <?

          }



  }while($rec_proposta = mysql_fetch_assoc($dados_proposta));
  ?>
  </table>
  <?

  }else{
    if($classe_mkpro == 'MDM3'){
      ?><center><font class="txt5"></font></center><?
    }else{
      ?><center><font class="txtvermelho"><? print $objTradutor->traduzir("Nenhuma Ocorrência encontrada"); ?></font></center><?
    }

  }
} else {
    if($classe_mkpro == 'MDM3'){
      ?><center><font class="txt5"></font></center><?
    }  else{
      ?><center><font class="txtvermelho"><? print $objTradutor->traduzir("Nenhuma Ocorrência encontrada"); ?></font></center><?

    }
}
//********************************************************************************

//********************************************************************************
//********************************************************************************
//**********************FIM DA ROTINA DE IMPRESSAO DAS FICHAS PAGINADAS***********
//********************************************************************************
//********************************************************************************

print "</div>";
?>