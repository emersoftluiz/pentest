<?
ini_set('max_execution_time', 300);
if ($deonde != "email_batch") {
  session_start();
  session_register("session");
  include "cc_libcallcenter.php";
  if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}
} else {
    require_once("cc_libcallcenter.php");
    require_once("cores.php");
    if ($_SERVER['REMOTE_ADDR'] != "192.168.2.23" && $_SERVER['REMOTE_ADDR'] != "200.192.43.50" && $sistema_identificacao != "teste") {
      print "NO Acesso indevido. Local não permitido";
      exit();
    }
    $tipo_popup = "AJ2";
    if($padrao_design == ""){$padrao_design = "1";}

    print "<style type='text/css'>";
    require_once("design/style_".$padrao_design.".css");
    print "</style>";
    require_once("design/design_sessao_".$padrao_design.".php");
}



if (strrpos($_GET["where"], '&lt;&gt;')) {
  # code...
  $where = str_replace("&lt;&gt;", "<>", $_GET["where"]);
}

//showvars();

//******************************************************************************
//******************************************************************************
///LOGICA PARA UTILIZAÇÃO DO DATA MANAGER
//******************************************************************************
//******************************************************************************

require_once("gambi_dac_grupo_switch.php");
require_once("/libs/ctr/DataManager.php");
if($pag == 1){
  $data_man_grava = new DataManager($session["operador"]);
  $data_man_grava->gravaDados("filtro_ligacao" ,$_REQUEST);
}
if($_GET["carrega_dados"] == "sim"){

  $data_man_recupera = new DataManager($session["operador"]);
  $data_man_recupera->carrega("filtro_ligacao");
  $data_man_recupera->criaVars();
  if($relatorio) {
    $array_relatorio = split("§", $relatorio);
    $programa = $array_relatorio[0];
    if(substr($programa,-1) == "?"){
       $programa = substr($programa,0,-1);
    }
    if($PHP_SELF != "/".DOCROOT.$programa){
      header ("Location:".HTTPHOST.DOCROOT.$programa."?carrega_dados=sim");
      exit;
    }
  }
}
//******************************************************************************
//******************************************************************************





//******************************************************************************
//******************************************************************************
//------------------------------------------------------------------------------
//         *********ATENÇÂO PROGRAMADOR(Não mexa sem ler isto)  ****************
//                          DESCRIÇÂO DOS DEONDES
//------------------------------------------------------------------------------

//********DEONDE == DACNET
  //Este deonde é utilizado no Painel Operacional quando o TIPO for igual a DACNET
  //Cuidado para não confundir este deonde com o VISÂO_PERSONALIZADA_DAC que também abre
  //no dacnet
//************************


//********DEONDE == VISAO_PERSONALIZADA
  //Este deonde é utilizado no Visão Personalizada que também aparece no DACNET
  //Cuidado para não confundir este deonde DACNET que também abre no dacnet
//************************

//********DEONDE == VISÂO_PERSONALIZADA_DAC
  //Este deonde é utilizado no Visão Personalizada que também aparece no DACNET
  //Cuidado para não confundir este deonde DACNET que também abre no dacnet
//************************


//********DEONDE == EMAIL_BATCH
  //Este deonde é utilizado para o batch enviar emails automatico para o cliente
  //Cuidado pois este relatório não utiliza sessão portanto testar muito bem testado
//************************

//******************************************************************************
//******************************************************************************
//******************************************************************************
// if($session["operador"] == "alexandre"){
//   var_dump($ingles);
// }
switch ($deonde) {
  case "DACNET":
    if(!$repre){
      $repre           = "CONTACTPAN";
      $relatorio       = "dac_con_oper_det.php§login_operador§login_operador";
      $time            = "min";//min ou seg";
      $s[0]            = "4001";
    }


    $pag = 1;
    $busca = "ok";
    $hora_ini = "00";
    $min_ini = "00";
    $hora_fim = "24";
    $min_fim =  "00";
    $dia_ini = date("d");
    $mes_ini = date("m");
    $ano_ini = date("Y");
    $dia_fim = date("d");
    $mes_fim = date("m");
    $ano_fim = date("Y");

    $classe_servico  = "GRATE";
    $ramal           =  "";
    $grupo           = "" ;
    $equipe          = "";
    $classe_tipo = "todos";
    $tipo_telefone = "ambos";

    $ddd = "" ;
    $tel_prefixo ="";
    $tel_sufixo = "";
    break;
   case "visao_personalizada_dac":
?>

    <STYLE type="text/css">
    body {
      scrollbar-face-color: #FFFFFF;
      scrollbar-highlight-color: #CCCCCC;
      scrollbar-shadow-color: #FFFFFF;
      color: #FFFFFF;
      scrollbar-3dlight-color: #FFFFFF;
      scrollbar-arrow-color: #000000;
      scrollbar-track-color: #FFFFFF;
      scrollbar-darkshadow-color: #CCCCCC;
      font-family: Verdana, Arial, Helvetica, sans-serif;
      text-decoration: none;


    }
     input   {border-color: <?print $session['td_destaque1']?>; border-style: solid; border-width:1;}
    </STYLE>
    <?
   break;
   case "email_batch":
   case "visao_personalizada":
?>

    <STYLE type="text/css">
     input   {border-color: <?print $session['td_destaque1']?>; border-style: solid; border-width:1;}
    </STYLE>
    <?
    break;
}


if($diaini){
    $dia_ini = $diaini;
    $mes_ini = $mesini;
    $ano_ini = $anoini;
    $dia_fim = $diafim;
    $mes_fim = $mesfim;
    $ano_fim = $anofim;

    $StrDataInicio = "";
    $StrDataFim    = "";
}

function retornaIntervaloHora($hora) {
  $hora_aux = explode(":",$hora);
  return $hora_aux[0].":".$hora_aux[1]." - ".$hora_aux[0].":".str_pad((intval($hora_aux[1]) + 29),2,0,STR_PAD_LEFT);
}



$connect  = ConnectDB();
//$connect2 = ConnectLOGURA();
$connect3 = ConnectAPOIO();



include ('carregando.php')?>
<script language="javascript">ap_showWaitMessage('waitDiv', 1);
<!--
function CarregaAtend(obj){
  document.consulta.atendimento.value = obj.value;
  document.consulta.st_atendimento.value = 'TODOS';
  document.consulta.submit();

}

-->
</script>
<?
function VerificaTime($time, $segundos){
  if($time == "seg"){
    return $segundos;
  }else{
    return CalcTime($segundos);
  }
}

function FormataDDD() {
  GLOBAL $matriz, $matriz_aux, $x, $campo, $campo1, $connect3, $campo_imprime, $campo_imprime1, $align1;

  //print $matriz[$matriz_aux["indice"][$x]][$campo1]."<br>";
  $aux = explode("¢", $matriz[$matriz_aux["indice"][$x]][$campo1]);

  $aux[0] = trim($aux[0]);
  $aux[1] = trim($aux[1]);
  if($aux[0] == "55" || $aux[0] == "") {

    $sql_pes   = "SELECT regiao FROM tblgcddd WHERE ddd = '".$aux[1]."'";
    $query_pes = mysql_query($sql_pes, $connect3);
    $ddd_pes   = mysql_fetch_array($query_pes);

    if(!$campo_imprime) {
      $campo_imprime = $aux[1]." - ".$ddd_pes["regiao"];
    }
    if($campo != $campo1){
      $campo_imprime1 = $aux[1]." - ".$ddd_pes["regiao"];
    }else{
      $campo_imprime1 = $ddd_pes["regiao"];
    }
  }else{
    print "222 <br>";

    if($aux[1] == "-"){
      $aux_print = "";
    }else{
      $aux_print = " (".$aux[1].")";
    }

    if(!$campo_imprime){
      $campo_imprime = " +".$aux[0].$aux_print;
    }
    $campo_imprime1 = ValorClasse("URACI", $aux[0], "URANET").$aux_print;
    //        $ddd_pes["regiao"] = "DDI-".ValorClasse("URACI", $aux[0], "URANET");
  }
  $align1= "left";
}


if(!$repre){
  $repre = $session["representante"];
}
If ($StrDataInicio){
  $dia_ini = Substr($StrDataInicio,"8","2");
  $mes_ini = Substr($StrDataInicio,"5","2");
  $ano_ini = Substr($StrDataInicio,"0","4");

  $dia_fim = Substr($StrDataFim,"8","2");
  $mes_fim = Substr($StrDataFim,"5","2");
  $ano_fim = Substr($StrDataFim ,"0","4");


  $hora_ini = Substr($StrHoraInicio,"0","2");
  $min_ini  = Substr($StrHoraInicio,"3","5");


  $hora_fim = Substr($StrHoraFim,"0","2");
  $min_fim  = Substr($StrHoraFim,"3","5");
} else {
  $StrDataInicio = $ano_ini.'-'.$mes_ini.'-'.$dia_ini;
  $StrDataFim    = $ano_fim.'-'.$mes_fim.'-'.$dia_fim;

  $StrHoraInicio = $hora_ini.':'.$min_ini;
  $StrHoraFim    = $hora_fim.':'.$min_fim;
}

//Esta chamada à função ConnectLOGS tem que estar aqui devido às variáveis que ela utiliza
$connect2 = ConnectLOGS($repre, $ano_ini.$mes_ini);

if($relatorio){
  //Dividindo o VlrClasse da pesquisa em um array
  //com a posicao [0] o nome do programa
  //e a posicao [1] o campo do BD*************
  $array_relatorio = split("§", $relatorio);
  $programa = $array_relatorio[0];
  $campo    = $array_relatorio[1];
  if(Substr($campo,0,1) == "¢"){
    $tp_lig_especial = "sim";
    $campo = Substr($campo,1);
  }else{
    $tp_lig_especial = "";
  }
  $aux_campo1=explode("¢",$array_relatorio[2]);
  if($aux_campo1[1]=="") {
    $campo1        = $array_relatorio[2];
  }else {
    $campo1        = $aux_campo1[0];
    $classe_campo1 = $aux_campo1[1];
  }

  $campo_extra   = $array_relatorio[3];
  //********************************************************
}
//print "*****".$campo;
//Verificando qual o programa que esta sendo executado e fazendo a suas arvores

$tipo_registro = "L";
$campo1_15 = "N";

switch($campo) {
  case "data":
    $campo      = "data_ligacao";
    $campo1     = "hora_ligacao_ini";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Data";
    $titulo1    = "Hora";
    $imprime_duracao = "sim";
    break;
  case "parm_regiao":
    $campo      = "regiao";
    $campo_ant  = "regiao";
    $campo_prox = "parm_uf";
    $campo_prox1= "parm_uf";
    $campo1     = "regiao";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Região";
    $titulo1    = "Região";
    $imprime_duracao = "sim";
    break;
  case "tlig":
    $campo      = "tipo_atendimento";
    $campo1     = "tipo_ligacao";
    $campo_prox = "grupo1";
    $campo_prox1= "grupo1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Ligação";
    $titulo1    = "Atendimento";
    break;
  case "tlig1":
    $campo      = "tipo_atendimento";
    $campo1     = "tipo_ligacao";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Ligação";
    $titulo1    = "Atendimento";
    break;
  case "parm_uf":
    $campo      = "uf";
    $campo1     = "uf";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "UF";
    $titulo1    = "Estado";
    break;
  case "nb_opcura":
    $campo      = "nb";
    $campo1     = "opcura";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Nb";
    $titulo1    = "1ª Opção";
    $imprime_duracao = "sim";
    break;
  case "tp_reg_tipo":
    $campo      = "tipo_registro";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Atendidas";
    $titulo1    = "Tipo de Ligação";
    $tipo_registro    = "todos";
    $imprime_duracao = "sim";
    break;
  case "id_opcura":
    $campo      = "id";
    $campo1     = "opcura";
    $campo_extra= "grupo";
    $virg       = ",";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Usuário";
    $titulo1    = "Opção";
    $tipo_registro    = "todos";
    $imprime_duracao = "sim";
    break;
  case "prefixo_sufixo":
    $campo      = "prefixo_telefone";
    $campo1     = "sufixo_telefone";
    $campo_extra= "ddd";
    $virg       = ",";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "DDD - Prefixo";
    $titulo1    = "Sufixo";
    $tipo_registro = "todos";
    $imprime_duracao = "sim";
    break;
  case "tipo_transf":
    $campo      = "tipo_ligacao";
    $campo1     = "grupo_transferencia";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "det";
    $campo_prox = "det";
    $titulo     = "Tipo Ligação";
    $titulo1    = "Grupo Transferência";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $imprime_duracao = "sim";
    break;

   case "rede_tlig_transf":
      $campo_extra= "tipo_atendimento";
      $virg = " , ";
      $campo      = "concat(ura_grupo,'¢',ura_maquina)";
      $campo1     = "tipo_ligacao";
      $campo_prox = "det";
      $campo_prox1= "det";
      $prog_ant   = "dac_con_regiao_lig.php";
      $prog_prox  = "dac_con_regiao_lig.php";
      $titulo     = "Máquina";
      $titulo1    = "Tipo Ligação";
      $tipo_registro = "todos";
      break;

  case "reg_tipo_transf":
    $campo      = "tipo_registro";
    $campo1     = "concat(tipo_ligacao,'¢',grupo_transferencia)";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $imprime_duracao = "sim";
    $tipo_registro = "todos";
    break;
  case "tipo_tp_reg":
    $campo      = "tipo_ligacao";
    $campo1     = "tipo_registro";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Tipo de Ligação";
    $titulo1    = "Atendidas";
    $tipo_registro    = "todos";
    $imprime_duracao = "sim";
    break;
  case "tp_reg_grupo":
    $campo      = "tipo_registro";
    $campo1     = "grupo";
    $campo_prox1= "tlig1";
    $campo_prox = "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Atendidas";
    $titulo1    = "Grupo de Atendimento";
    $tipo_registro    = "todos";
    $imprime_duracao = "sim";
    break;

  case "grupo_tp_reg":
    $campo      = "grupo";
    $campo1     = "tipo_registro";
    $campo_prox1= "tlig1";
    $campo_prox = "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Grupo de Atendimento";
    $titulo1    = "Atendidas";
    $tipo_registro = "todos";
    $imprime_duracao = "sim";
    break;
  case "transf_grupo":
    $campo      = "transferencia";
    $campo1     = "grupo";
    $campo_prox1= "parm_ddd";
    $campo_prox = "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Transferência";
    $titulo1    = "Grupo de Atendimento";
    $imprime_duracao = "sim";
    break;
  case "grupo_transf":
    $campo      = "grupo";
    $campo1     = "transferencia";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Grupo";
    $titulo1     = "Transferência";
    $imprime_duracao = "sim";
    break;
  case "gerot":
    $campo      = "opcura";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "1ª Opção";
    $titulo1    = "Tipo de Ligacao";
    $imprime_duracao = "sim";
    break;
  case "gerotDDD":
    $campo      = "ddd";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "1ª Opção";
    $titulo1    = "Tipo de Ligacao";
    $imprime_duracao = "sim";
    break;
  case "gerotUF":
    $campo      = "uf";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "1ª Opção";
    $titulo1    = "Tipo de Ligacao";
    $imprime_duracao = "sim";
    break;
  case "parm_ddd":
    $campo      = "concat(ddi,'¢',ddd)";
    $campo1     = "concat(ddi,'¢',ddd)";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "DDD";
    $titulo1    = "Localidade";
    break;
  case "ddd_prefixo":
    $campo      = "ddd";
    $campo1     = "prefixo_telefone";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "DDD";
    $titulo1    = "Prefixo";
    break;
  case "ddd_sufixo":
    $campo      = "ddd";
    $campo1     = "sufixo_telefone";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "DDD";
    $titulo1    = "Sufixo";
    break;
  case "servico":
    $campo      = "nb";
    $campo1     = "nb";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Nro";
    $titulo1    = "Serviço";
    break;
  case "grupo_tipo":
    $campo      = "grupo";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "tlig1";
    $campo_prox = "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Grupo de Atendimento";
    $titulo1    = "Tipo de Ligação";
    break;

  case "grupo_uf":
    $campo      = "grupo";
    $campo1     = "uf";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "tlig1";
    $campo_prox = "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Grupo de Atendimento";
    $titulo1    = "Estado";
    break;
  case "nb_tipo":
    $campo      = "nb";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "tlig1";
    $campo_prox = "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Serviço";
    $titulo1    = "Tipo de Ligação";
    break;
  case "equipe_tipo":
    $campo      = "equipe";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "det";
    $campo_prox = "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Equipe";
    $titulo1    = "Tipo de Ligação";
    break;
  case "lote_maq_tipo":
    $campo      = "concat(equipe,'/',ura_grupo,'¢',ura_maquina)";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox1= "det";
    $campo_prox = "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Lote/Maquina";
    $titulo1    = "Tipo de Ligação";
    break;

  case "grupo1":
    $campo      = "grupo";
    $campo1     = "grupo";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Grupo Atendimento";
    $titulo1    = "Grupo Atendimento";
    break;
 case "santos_categoria":
    $campo      = "nome_sms";
    $campo1     = "nome_sms";
    $campo_prox = "tlig1";
    $campo_prox1= "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Categoria";
    $titulo1    = "Categoria";
    break;
  case "grupo2":
    $campo      = "grupo";
    $campo1     = "grupo";
    $campo_prox = "tlig1";
    $campo_prox1= "tlig1";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Grupo Atendimento";
    $titulo1    = "Grupo Atendimento";
    break;
  case "prefixo":
    $campo      = "prefixo_telefone";
    $campo1     = "ddi";
    $campo_extra= "ddd";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Prefixo";
    $titulo1    = "Cidade";
    break;
  case "qtd_tel":
    $campo      = "prefixo_telefone";
    $campo1     = "sufixo_telefone";
    $campo_extra= "ddd";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Prefixo";
    $titulo1    = "Sufixo";
    $order      = "order by total desc";
    break;
  case "tipo_ddd":
    $campo      = "tipo_ligacao";
    $campo1     = "concat(ddi,'¢',ddd)";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Tipo Ligação";
    $titulo1    = "DDD";
    $imprime_duracao = "sim";
    break;
  case "tipo_data":
    $campo      = "tipo_ligacao";
    $campo1     = "data_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Tipo Ligação";
    $titulo1    = "Data";
    break;
  case "tipo_hora_dupl":
    $campo      = "tipo_ligacao";
    $campo1     = "hora_ligacao_ini";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Tipo Ligação";
    $titulo1    = "Hora";
    break;
  case "tipo_hora_15":
    $campo      = "tipo_ligacao";
    $campo1     = "hora_ligacao_ini";
    $campo1_15  = "S";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Tipo Ligação";
    $titulo1    = "Hora";
    break;
  case "hora_tipo_ligacao":
    $campo      = "hora_ligacao_ini";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Hora";
    $titulo1    = "Tipo Ligação";
    break;

  case "hora_minuto_tipo_ligacao":
    $campo      = "hora_ligacao_ini";
    $campo1     = "tipo_ligacao";
    $campo_aux  = "hora_minuto";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Hora";
    $titulo1    = "Tipo Ligação";
    break;

  case "hora_lig":
    $campo      = "hora_ligacao_ini";
    $campo1     = "hora_ligacao_ini";
    //$campo_extra= "tipo_atendimento";
    //$virg       = ",";
    $campo_prox = "hora_tipo_ligacao";
    $campo_prox1= "hora_tipo_ligacao";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Hora";
    $titulo1    = "Hora";
    break;
  case "data_tipo":
    $campo      = "data_ligacao";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    $titulo     = "Data";
    $titulo1    = "Tipo Ligação";
    break;
  case "uf_tipo":
    $campo      = "uf";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Estado";
    $titulo1    = "Tipo de Ligação";
    break;
  case "tipo_uf":
    $campo      = "tipo_ligacao";
    $campo1     = "uf";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Tipo de Ligação";
    $titulo1    = "Estado";
    break;
  case "id_tipo":
    $campo      = "id";
    $campo1     = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Usuário";
    $titulo1    = "Tipo de Ligação";
    break;
  case "tipo_id":
    $campo      = "tipo_ligacao";
    $campo1     = "id";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Tipo de Ligação";
    $titulo1    = "Usuário";
    break;
  case "parm_tipo_id":
    $campo      = "tipo_ligacao";
    $campo1     = "right(id,8)";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Tipo de Ligação";
    $titulo1    = "Usuário";
    break;

  case "rede":
    //$campoInicial="rede";
    $campo      = "concat(ura_grupo,'¢',ura_maquina)";
    $campo1     = $campo1;
    $campo_prox = "det";
    $campo_prox1= "det";
    $prog_ant   = "dac_con_regiao.php";
    $prog_prox  = "dac_con_regiao_lig.php";
    break;
    /*
    case "regiao":
    $campo = "regiao";
    $campo1 = "regiao";
    $campo_prox = "parm_uf";
    $campo_prox1 = "parm_uf";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Região";
    break;
    */
  case "parm_data":
    $campo      = "data_ligacao";
    $campo1     = "data_ligacao";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Data Ligação";
    $titulo1    = "Data Ligação";
    break;

    case "parm_tipo_id_votoran":
    $campo      = "tipo_ligacao";
    //$campo1     = "right(id,8)";
    //$campo1     = "if(CHAR_LENGTH(id) - CHAR_LENGTH(REPLACE(id, '¢', '')) <= 2,'SEM PROTOCOLO', SUBSTRING_INDEX(id,'¢',-1))";
    $campo1     = "SUBSTRING_INDEX(id,'¢',1)";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo     = "Tipo de Ligação";
    $titulo1    = "Usuário";
    break;

  case "operadoraTipolig":
    $campo       = "operadora";
    $campo1      = "operadora";
    $campo_prox  = "tlig";
    $campo_prox1 = "tlig";
    $prog_ant    = "dac_con_regiao_det.php";
    $prog_prox   = "dac_con_regiao_det.php";

  break;

  default:
    $campo       = $campo;
    $campo1      = $campo1;
    $campo_extra = $campo_extra;
    $campo_prox  = "det";
    $campo_prox1 = "det";
    $prog_ant    = "dac_con_regiao.php";
    $prog_prox   = "dac_con_regiao_lig.php";
    if($campo_extra){
      $virg = ",";
    }
    break;
}


switch($campo1) {
  case "rede":
    $campo1 = "concat(ura_grupo,'¢',ura_maquina)";
    break;
  case "tlig":
    $campo1 = "tipo_ligacao";
    $campo_extra= "tipo_atendimento";
    $virg       = ",";
    break;

  case "uf":
    //  $campo      = "uf";
    $campo1     = "uf";
    //  $campo_prox = "parm_ddd";
    $campo_prox1= "parm_ddd";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    //  $titulo     = "UF";
    $titulo1    = "Estado";
    break;

  case "if_transferencia":
    $campo1     = "IF(grupo_transferencia > '','1','0')";
    $campo_prox = "tipo_transf";
    $campo_prox1= "tipo_transf";
    $prog_ant   = "dac_con_regiao_det.php";
    $prog_prox  = "dac_con_regiao_det.php";
    $titulo1    = "Transferência";
    break;

}


$arr_tit_campo = explode("-",ValorClasse("URARE",$relatorio,$repre));
//print_r($arr_tit_campo);

if($arr_tit_campo[0] && trim($arr_tit_campo[0]) != "") {
  $titulo  = $arr_tit_campo[0];
}
if($arr_tit_campo[1] && trim($arr_tit_campo[1]) != "") {
  $titulo1 = $arr_tit_campo[1];
}
if($titulo != $titulo1){
$titulo_grafico = $titulo."-".$titulo1;
}else{
  $titulo_grafico = $titulo;
}

//**********************************CAMPOS QUE FAZ O RELATORIO IR PARA A RESUMO**********************
//***************************************************************************************************



$campos_tbresumo[0] = "nb";
$campos_tbresumo[1] = "data_ligacao";
$campos_tbresumo[2] = "tipo_ligacao";
$campos_tbresumo[3] = "hora_ligacao_ini";
$campos_tbresumo[4] = "grupo";
$campos_tbresumo[5] = "tipo_registro";
$campos_tbresumo[6] = "empresa";
$campos_tbresumo[7] = "dia_ligacao";
$campos_tbresumo[8] = "tipo_atendimento";
$campos_tbresumo[9] = "hora_ligacao";
$campos_tbresumo[10] = "duracao_ligacao";
$campos_tbresumo[11] = "duracao_fila";
$campos_tbresumo[12] = "duracao_abfila";
$campos_tbresumo[13] = "duracao_operador";
$campos_tbresumo[14] = "duracao_resposta";
$campos_tbresumo[15] = "qtd_ligacao";
$campos_tbresumo[16] = "qtd_ligacao_fila";
$campos_tbresumo[17] = "qtd_ligacao_operador";
$campos_tbresumo[18] = "qtd_ligacao_abfila";
$campos_tbresumo[19] = "qtd_operador_ideal";
$campos_tbresumo[20] = "qtd_abfila_ideal";
$campos_tbresumo[21] = "tempo_maior_chamada";
$campos_tbresumo[22] = "tempo_maior_fila";
$campos_tbresumo[23] = "tempo_maior_abfila";
$campos_tbresumo[24] = "tempo_maior_operador";
$campos_tbresumo[25] = "tempo_maior_resposta";
$campos_tbresumo[26] = "ideal_tma";
$campos_tbresumo[27] = "interv_tma";
$campos_tbresumo[28] = "qtd_tma_1";
$campos_tbresumo[29] = "qtd_tma_2";
$campos_tbresumo[30] = "qtd_tma_3";
$campos_tbresumo[31] = "qtd_tma_4";
$campos_tbresumo[32] = "qtd_tma_mais";
$campos_tbresumo[33] = "ideal_tempo_fila";
$campos_tbresumo[34] = "interv_fila";
$campos_tbresumo[35] = "qtd_atend_fila_0";
$campos_tbresumo[36] = "qtd_atend_fila_1";
$campos_tbresumo[37] = "qtd_atend_fila_2";
$campos_tbresumo[38] = "qtd_atend_fila_3";
$campos_tbresumo[39] = "qtd_atend_fila_4";
$campos_tbresumo[40] = "qtd_atend_fila_mais";
$campos_tbresumo[41] = "interv_aband";
$campos_tbresumo[42] = "qtd_abfila_1";
$campos_tbresumo[43] = "qtd_abfila_2";
$campos_tbresumo[44] = "qtd_abfila_3";
$campos_tbresumo[45] = "qtd_abfila_4";
$campos_tbresumo[46] = "qtd_abfila_mais";



if($campo){
  if(BuscaNaMatriz($campos_tbresumo , $campo) != -1 ){
    $resumo_campo = "S";
  }else{
    $resumo_campo = "N";
  }
}else{
  $resumo_campo = "S";
}
if($resumo_campo == "S"){
  if($campo1){
    if(BuscaNaMatriz($campos_tbresumo , $campo1) != -1 ){
      $resumo_campo1 = "S";
    }else{
      $resumo_campo1 = "N";
    }
  }else{
    $resumo_campo1 = "S";
  }
}
if($resumo_campo1 == "S"){
  if($campo_extra){
    if(BuscaNaMatriz($campos_tbresumo , $campo_extra) != -1 ){
      $resumo_campo_extra = "S";
    }else{
      $resumo_campo_extra = "N";
    }
  }else{
    $resumo_campo_extra = "S";
  }
}


if(
($resumo_campo == "S"        ) &&
((!$status) || $status == "T") &&
($resumo_campo1 == "S"       ) &&
($resumo_campo_extra== "S"   ) &&
($tira_duplicidade != "sim"  ) &&
(!$ddd)                        &&
(!$tel_prefixo)                &&
(!$tel_sufixo)                 &&
($tipo_telefone == "ambos")
){
  $tabela_resumo = "S";
}else{
  $tabela_resumo = "N";
}


//*************************************************************************************************
//**********************************CAMPOS QUE FAZ O RELATORIO IR PARA A RESUMO**********************

//*************************************************************************************************
//************************************ ---- Preparando os Wheres ------ ***************************
//*************************************************************************************************

if(!$grupo && substr($repre,0,5) == "LIBRA"){
  $where_grupo.= ",'0000'";
  $arrGrupos = getArrayClasse("tb_classe", $connect, "descricao", "GRATE", $repre, "A", "ZZ");
  if(is_array($arrGrupos["itens"]) === true) {
    foreach ($arrGrupos["itens"] as $key => $value) {
      if($value["valor"]) {
        $qtdGrupo++;
        $where_grupo.= ",'".$value["valor"]."'";
      }
    }
  }
  $where_grupo = " AND grupo IN (".substr($where_grupo,1).")";
}

if(!$where) {
  $where = "Where ";

  //*************Preparando o where dos servicos selecionados*********
  $x = 0;

  if($order_servico == "agrup_servicos"){
    $nbs = ValorClasse("NBAP2", $s[0], $repre);
    $aux = explode("¢", $nbs);
    $arr_grup = explode(",", $aux[1]);

    if(is_array($arr_grup)){
      $s = str_replace(" ", "", $arr_grup);
    }
  }

  While($s[$x]){
    if($x == "0"){
      $where = $where." nb in('".$s[$x]."'";
    }else{
      $where = $where.",'".$s[$x]."'";
    }
    $x++;
  }
  $where = $where.")";

  //******************************************************************

  if($StrDataInicio == $StrDataFim){
    $where = $where." and  data_ligacao = '".$StrDataInicio."'";
  }else{
    $where = $where." and  data_ligacao between '".$StrDataInicio."' and '".$StrDataFim."'";
  }
  if($StrHoraInicio != "00:00" || $StrHoraFim != "24:00"){
    $where = $where." and hora_ligacao_ini between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
  }

  if($tipo_registro_filtro) {
    if (strpos("a".$tipo_registro_filtro,"³£³") > 0) {
      $in_multiplos = "";
      $array_filtro_todos = explode("³£³",$tipo_registro_filtro);
      foreach($array_filtro_todos as $chave_fil => $valor_fil){
        if($valor_fil){
          $in_multiplos .= "'".$valor_fil."',";
        }
      }

      $in_multiplos = substr($in_multiplos,0,-1);
      if($in_multiplos){
        $where = $where." AND tipo_registro IN (".$in_multiplos.") ";
      }
    } else {
      $where = $where." and tipo_registro = '".$tipo_registro_filtro."'  ";
    }
  } elseif($tipo_registro != "todos"){
    $where = $where." and tipo_registro = '".$tipo_registro."'  ";
  }
  if($tp_lig_especial){
    $where = $where." and tipo_ligacao in ('001','002') ";
  }

  if($ramal){
    $where = $where." and ramal = '".$ramal."'  ";
  }

  if($grupo){
    $where.= gambiDacGrupoWhere($grupo);
  }

  if($tp_ligacao){
    $where = $where." and tipo_ligacao ='".$tp_ligacao."' ";
  }
  $where .= " and tipo_ligacao <> '401' ";//retirando as conexoes com o agente

  if($login_operador){
    $where = $where." and login_operador = '".$login_operador."'  ";
  }
  if($status){
    if($status != "T"){
      $where = $where." and resultado_ligacao = '".$status."'  ";
    }
  }
  if($hora_operador){
    $where = $where." and hora_ligacao = '".$hora_ligacao."'  ";
  }
  if($ddd){
    $where = $where." and ddd = '".$ddd."'  ";
  }else{
    $arr_ddd = Split(",",ValorSelecaoDDD($session["operador"]));
    $x=0;
    if($arr_ddd[0] != "----"){
      While($arr_ddd[$x]){
        if($x == "0"){
          $where = $where." and ddd in('".$arr_ddd[$x]."'";
        }else{
          $where = $where.",'".$arr_ddd[$x]."'";
        }
        $x++;
      }
      $where = $where." )  ";
    }
  }

  if($tel_prefixo){
    $where = $where." and prefixo_telefone = '".$tel_prefixo."'  ";
  }
  if($tel_sufixo){
    $where = $where." and sufixo_telefone = '".$tel_sufixo."'  ";
  }
  /*if($tipo_telefone == "celular"){
    $where = $where." and prefixo_telefone >= '7000'  ";
  }
  if($tipo_telefone == "fixo"){
    $where = $where." and prefixo_telefone < '7000'  ";
  }*/

  if($tipo_telefone == "celular"){
    $where = $where." and (prefixo_telefone >= '6000' OR (SUBSTRING(prefixo_telefone,1,2) IN ('53','54','57') AND ddd IN ('11','12', '13','14','15', '16', '17', '18', '19'))) AND ddi = '55' ";
  }
  if($tipo_telefone == "fixo"){
    $where = $where." and (prefixo_telefone < '6000' AND ((ddd NOT IN ('11','12', '13','14','15', '16', '17', '18', '19')) OR (ddd IN ('11','12', '13','14','15', '16', '17', '18', '19') AND SUBSTRING(prefixo_telefone,1,2) NOT IN ('53','54','57')))) AND ddi = '55'  ";
  }
  if($tipo_telefone == "ddi"){
    $where = $where." AND ddi <> '55' ";
  }
  //****************************************************************
  //****************quebra galho************************************
  if($qg_lote ){
    $where = $where." and equipe = '".$qg_lote."'  ";
  }
  if($qg_nrc ){
    $where = $where." and login_operador = '".$qg_nrc."'  ";
  }
  if($atendimento && $st_atendimento != "TODOS"){
    $where = $where." and tipo_atendimento = '".$atendimento."' ";
  }
  if($st_atendimento && $st_atendimento != "TODOS"){
    $where = $where." and tipo_ligacao = '".$st_atendimento."' ";
  }

} else{
  $where = str_replace("\'" , "'" ,$where);
  if($campo_ant == "ura_navegacao") {
    if(trim($vlr_campo) == "S"){
      $where = $where."and (".$campo_ant." = '' || isnull(".$campo_ant.")) ";
    }else{
      $where = $where."and (".$campo_ant." like '%;".trim($vlr_campo).";%' || ".$campo_ant." like '%;".trim($vlr_campo)."'  || ".$campo_ant." like '".trim($vlr_campo).";%'  || ".$campo_ant." = '".trim($vlr_campo)."')";
    }
  }else{
    switch($campo_ant){
      case "data_ligacao":
      case "nb":
      case "grupo":
      case "ddd":
      case "tipo_ligacao":
      case "tipo_atendimento":
      case "grupo_transferencia":
      case "uf":
      case "estado":
      case "cidade":
      case "prefixo_telefone":
      case "sufixo_telefone":
      case "empresa":
        $where = $where."and ".$campo_ant." = '".trim($vlr_campo)."'";
        break;
      default:
        $where = $where."and ".$campo_ant." like '".trim($vlr_campo)."%'";
        break;
    }


  }

  if(($campo_ant1) && ($campo_ant1 != $campo_ant)){
    if($campo_ant1 == "ura_navegacao"){
      $where = $where."and ".$campo_ant1." like '%".trim($vlr_campo1)."%'";
    }else{
      switch($campo_ant1){
        case "data_ligacao":
        case "nb":
        case "grupo":
        case "ddd":
        case "tipo_ligacao":
        case "tipo_atendimento":
        case "grupo_transferencia":
        case "uf":
        case "estado":
        case "cidade":
        case "prefixo_telefone":
        case "sufixo_telefone":
        case "empresa":
          $where = $where."and ".$campo_ant1." = '".trim($vlr_campo1)."'";
          break;
        default:
          $where = $where."and ".$campo_ant1." like '".trim($vlr_campo1)."%'";
          break;
      }





    }

  }
}

if($tira_duplicidade == "dup" && ($tabela_resumo == "N" || $tabela_resumo == "")){
  $where = $where." and reg_duplicado = 'N' ";
}


if($maquinas && $maquinas != "T"){
  if(($campo1) && ($campo1 != $campo)){
    if($campo1 == "concat(ura_grupo,'¢',ura_maquina)"){
      $where = $where."and ".$campo1." = '".trim($maquinas)."'";
    }else{
      $where = $where."and ".$campo." = '".trim($maquinas)."'";
    }

  }
}


if($tira_duplicidade == "sim"){
  //$group_by_duplicidade = " , ddd , prefixo_telefone , sufixo_telefone";
  //$campos_duplicidade = " , ddd , prefixo_telefone , sufixo_telefone";
}


$ano_mes_ini = substr($ano_ini, 2, 2).$mes_ini;
$ano_mes_fim = substr($ano_fim, 2, 2).$mes_fim;
$y = 0;


if($filtro_adicional) {
  $array_filtros    = explode("¢A¢",$filtro_adicional);
  $where_filtro_add = " ";
  $string_passa_get = "&filtro_adicional=".$filtro_adicional;

  foreach($array_filtros as $chave => $valor){
    if($valor){
      $consulta_parametros = explode("§",$valor);

      //$consulta_parametros[0] = campo banco de dados
      //$consulta_parametros[1] = tipo de campo text,combo(classe)
      //$consulta_parametros[2] = tipo de comparação like, igual
      //$consulta_parametros[3] = tipo de dado email, cpfcnpj,munero,etc
      //$consulta_parametros[4] = consistir sempre, sopreenchido
      //$consulta_parametros[5] = status para monta combo A = ativo S = Todos
      //$consulta_parametros[6] = where adicional " AND campo = (A)XXX(A) ";

      $ajax_parametros_aux_cp = explode(",",$consulta_parametros[0]);
      $consulta_parametros[0] = $ajax_parametros_aux_cp[0];
      $ajax_parametros_aux_cp = $ajax_parametros_aux_cp[1];

      $ajax_parametros_aux_tp = explode(",",$consulta_parametros[1]);
      $consulta_parametros[1]     = $ajax_parametros_aux_tp[0];
      $ajax_parametros_aux_tp = $ajax_parametros_aux_tp[1];

      $ajax_parametros_aux_cd = explode(",",$consulta_parametros[2]);
      $consulta_parametros[2]     = $ajax_parametros_aux_cd[0];
      $ajax_parametros_aux_cd = $ajax_parametros_aux_cd[1];

      $ajax_parametros_aux_td = explode(",",$consulta_parametros[3]);
      $consulta_parametros[3]     = $ajax_parametros_aux_td[0];
      $ajax_parametros_aux_td = $ajax_parametros_aux_td[1];

      $ajax_parametros_aux_cs = explode(",",$consulta_parametros[4]);
      $consulta_parametros[4]     = $ajax_parametros_aux_cs[0];
      $ajax_parametros_aux_cs = $ajax_parametros_aux_cs[1];

      $ajax_parametros_aux_st = explode(",",$consulta_parametros[5]);
      $consulta_parametros[5]     = $ajax_parametros_aux_st[0];
      $ajax_parametros_aux_st = $ajax_parametros_aux_st[1];

      $ajax_parametros_aux_wh = explode(",",$consulta_parametros[6]);
      $consulta_parametros[6]     = $ajax_parametros_aux_wh[0];
      $ajax_parametros_aux_wh = $ajax_parametros_aux_wh[1];

      if($consulta_parametros[6]){
        $consulta_parametros[6] = str_replace("(A)","'",$consulta_parametros[6]);
      }

      if(is_array(${$consulta_parametros[0]."_filtro"})) {
        $in_multiplos = "";
        foreach(${$consulta_parametros[0]."_filtro"} as $chave_fil => $valor_fil){
          $string_passa_get .= "&".$consulta_parametros[0]."_filtro[".$chave_fil."]=".$valor_fil;
          if($valor_fil){
            $in_multiplos .= "'".$valor_fil."',";
          }
        }
        $in_multiplos = substr($in_multiplos,0,-1);
        if($in_multiplos){
          $where_filtro_add .= " AND ".$consulta_parametros[0]." IN (".$in_multiplos.") ".$consulta_parametros[6];
        }
      }else{
        if(strtoupper($consulta_parametros[2]) == "IGUAL") {
          $string_passa_get .= "&".$consulta_parametros[0]."_filtro=".${$consulta_parametros[0]."_filtro"};
          if (strpos("a".${$consulta_parametros[0]."_filtro"},"³£³") > 0) {
            $in_multiplos = "";
            $array_filtro_todos = explode("³£³",${$consulta_parametros[0]."_filtro"});
            foreach($array_filtro_todos as $chave_fil => $valor_fil){
              if($valor_fil){
                $in_multiplos .= "'".$valor_fil."',";
              }
            }

            $in_multiplos = substr($in_multiplos,0,-1);
            if($in_multiplos){
              $where_filtro_add .= " AND ".$consulta_parametros[0]." IN (".$in_multiplos.") ".$consulta_parametros[6];
            }
          }else{
            $where_filtro_add .= " AND ".$consulta_parametros[0]." = '".${$consulta_parametros[0]."_filtro"}."' ".$consulta_parametros[6];
          }
        }elseif(strtoupper($consulta_parametros[2]) != "LIKE") {
          switch ($consulta_parametros[2]) {
            case "MAIOR":
              $campo_compara = ">";
              break;
            case "MENOR":
              $campo_compara = "<";
              break;
          }
          $string_passa_get .= "&".$consulta_parametros[0]."_filtro=".${$consulta_parametros[0]."_filtro"};
          $where_filtro_add .= " AND ".$consulta_parametros[0]." ".$campo_compara." '".${$consulta_parametros[0]."_filtro"}."' ".$consulta_parametros[6];
        }else{
          $string_passa_get .= "&".$consulta_parametros[0]."_filtro=".${$consulta_parametros[0]."_filtro"};
          $where_filtro_add .= " AND ".$consulta_parametros[0]." LIKE '%".${$consulta_parametros[0]."_filtro"}."%' ".$consulta_parametros[6];
        }
      }

      if($ajax_parametros_aux_cp) {
        if($ajax_parametros_aux_wh){
          $ajax_parametros_aux_wh = str_replace("(A)","'",$ajax_parametros_aux_wh);
        }

        if(is_array(${$ajax_parametros_aux_cp."_filtro"})) {
          $in_multiplos = "";
          foreach(${$ajax_parametros_aux_cp."_filtro"} as $chave_fil => $valor_fil){
            $string_passa_get .= "&".$ajax_parametros_aux_cp."_filtro[".$chave_fil."]=".$valor_fil;
            if($valor_fil){
              $in_multiplos .= "'".$valor_fil."',";
            }
          }
          $in_multiplos = substr($in_multiplos,0,-1);
          if($in_multiplos){
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." IN (".$in_multiplos.") ".$ajax_parametros_aux_wh;
          }
        }else{
          if(strtoupper($ajax_parametros_aux_cd) == "IGUAL") {
            $string_passa_get .= "&".$ajax_parametros_aux_cp."_filtro=".${$ajax_parametros_aux_cp."_filtro"};
            if (strpos("a".${$ajax_parametros_aux_cp."_filtro"},"³£³") > 0) {
              $in_multiplos = "";
              $array_filtro_todos = explode("³£³",${$ajax_parametros_aux_cp."_filtro"});
              foreach($array_filtro_todos as $chave_fil => $valor_fil){
                if($valor_fil){
                  $in_multiplos .= "'".$valor_fil."',";
                }
              }

              $in_multiplos = substr($in_multiplos,0,-1);
              if($in_multiplos){
                $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." IN (".$in_multiplos.") ".$ajax_parametros_aux_wh;
              }
            }else{
              $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." = '".${$ajax_parametros_aux_cp."_filtro"}."' ".$ajax_parametros_aux_wh;
            }
          }elseif(strtoupper($ajax_parametros_aux_cd) != "LIKE") {
            switch ($ajax_parametros_aux_cd) {
              case "MAIOR":
                $campo_compara = ">";
                break;
              case "MENOR":
                $campo_compara = "<";
                break;
            }
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." ".$campo_compara." '".${$ajax_parametros_aux_cp."_filtro"}."' ".$ajax_parametros_aux_wh;
          }else{
            $where_filtro_add .= " AND ".$ajax_parametros_aux_cp." LIKE '%".${$ajax_parametros_aux_cp."_filtro"}."%' ".$ajax_parametros_aux_wh;
          }
        }
      }
    }
  }
  $string_passa_get .= "&";

  //print "<li>***".$where_filtro_add;
  //print "<li>***".$string_passa_get;
}

//if($ano_mes_ini <= $ano_mes_fim && $mes_ini != "" && $procura == "OK"){
if($ano_mes_ini <= $ano_mes_fim && $mes_ini != ""){
  $ano_mes = $ano_mes_ini;
  while($ano_mes <= $ano_mes_fim) {


    if($campo1 == "hora_ligacao_ini"){
      if ($campo1_15 == "S") {
        $var_campo1 =  "left(".$campo1.",5) as ".$campo1;
        $var_campo1_group =  "left(".$campo1.",5)";
      } else {
        $var_campo1 =  "left(".$campo1.",2) as ".$campo1;
        $var_campo1_group =  "left(".$campo1.",2)";
      }
    }else{
      $var_campo1 = $campo1;
      $var_campo1_group = $campo1;
    }



    if($classe_campo1 != ""){
      $var_classe_campo1 =  $classe_campo1.",";
    }
    if($campo == "hora_ligacao_ini"){
      $var_campo =  "left(".$campo.",2) as ".$campo;
      $var_campo_group =  "left(".$campo.",2)";
      //      $var_campo = $campo;
    }else{
      $var_campo = $campo;
      $var_campo_group =  $campo;
    }

    if ($campo_aux == "hora_minuto") {
      if($campo == "hora_ligacao_ini"){
        $var_campo = $campo;
      }
    }


    if(StrPos($where, "nb in(")){
      for($x=StrPos($where, "nb in(");($char_where != ")" && $x < 4000)  ;$x++ ){
        $char_where = Substr($where,$x,1);
        $string_nb .= $char_where;
      }
    }




    if (strpos($where, "data_ligacao between") && $pag == 1) {


        $dacConRegiao_qtd_dias = date_diff2($StrDataInicio, $StrDataFim);

        $str_data_ligacao = substr($where, strpos($where, "and  data_ligacao between"), 55);

        $arr_data_ini = explode("-", $StrDataInicio);

        for ($i = 0; $i <= $dacConRegiao_qtd_dias; $i++) {

          $valor_data_ligacao = date("Y-m-d", mktime(0, 0, 0, $arr_data_ini[1], (intval($arr_data_ini[2]) + $i), $arr_data_ini[0]));

          $arr_data_ligacao[$valor_data_ligacao] = $valor_data_ligacao;

        }


    } else {

      if ($campo_ant1 == "data_ligacao") {

        $arr_data_ligacao[$vlr_campo1] = $vlr_campo1;

      } else {

        if($StrDataInicio == $StrDataFim){

          $arr_data_ligacao[$StrDataFim] = $StrDataFim;

        } else {

          $dacConRegiao_qtd_dias = date_diff2($StrDataInicio, $StrDataFim);

          $arr_data_ini = explode("-", $StrDataInicio);

          for ($i = 0; $i <= $dacConRegiao_qtd_dias; $i++) {

            $valor_data_ligacao = date("Y-m-d", mktime(0, 0, 0, $arr_data_ini[1], (intval($arr_data_ini[2]) + $i), $arr_data_ini[0]));

            $arr_data_ligacao[$valor_data_ligacao] = $valor_data_ligacao;

          }

        }

      }

    }


//    print "<pre>";
//    print_r($_GET);
//    print_r($_POST);
//    print "<li>".$where;
//    print_r($arr_data_ligacao);
//    print "</pre>";


    if($tipo_nv == "numerico"){
      $campo_tipo_nv = ",ura_navegacao";
    }


    foreach ($arr_data_ligacao as $indice_data_ligacao => $value_data_ligacao) {


      if ($campo_ant1 != "data_ligacao") {

        $where_data_ligacao = " AND data_ligacao = '" . $indice_data_ligacao . "'";

      }


      //***********************************
      //INICIO ALTERAÇÃO ALESSANDRO CAC 100913
      //RETIREI OS MULTIPLOS SELECT'S POR CAD NB E DEIXEI TODOS NA CONDIÇÃO (IN) PARA MOSTRAR O RESULTADO CORRETO IGUAL AO DETALHE
      //***********************************
      // print $string_nb_arr = Str_Replace("'","",$string_nb);
      // print $string_nb_arr = Str_Replace("nb in(","",$string_nb_arr);
      // print $string_nb_arr = Str_Replace(")","",$string_nb_arr);
      // print $arr_nb = Split(",",$string_nb_arr);
      // for($x_nb=0;$arr_nb[$x_nb];$x_nb++) {

        //$where_nb = Str_Replace($string_nb, " nb = '".$arr_nb[$x_nb] . "'", $where);
        $where_nb = $where;
      //***********************************
      //FIM ALTERAÇÃO ALESSANDRO CAC 100913
      //***********************************
        $where_nb = str_replace($str_data_ligacao, "", $where_nb);

        $where_nb .= $where_data_ligacao;


        if($imprime_duracao == "sim"){
          $sum_duracao = ",sum(duracao_ligacao) as duracao_ligacao";
        }
        if($tabela_resumo == "S"){
          if($tira_duplicidade == "dup"){
            $sql = "SELECT  ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo." ,".$var_campo1." ".$sum_duracao." , sum(qtd_dup) as total ".$campos_duplicidade." from logura".$ano_mes."R ".$where_nb.$where_grupo.$where_filtro_add." GROUP BY ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo_group.",".$var_campo1_group."  ".$order."";
          }else{
            $sql = "SELECT  ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo." ,".$var_campo1." ".$sum_duracao." , sum(qtd_ligacao) as total ".$campos_duplicidade." from logura".$ano_mes."R ".$where_nb.$where_grupo.$where_filtro_add." GROUP BY ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo_group.",".$var_campo1_group."  ".$order."";
          }
        }else{
          if($tira_duplicidade == "sim"){
            $sql = "SELECT ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo." ,".$var_campo1." ".$sum_duracao.$campo_tipo_nv." , count(distinct concat(ddd , prefixo_telefone , sufixo_telefone)) as total ".$campos_duplicidade."  from logura".$ano_mes." ".$where_nb.$where_grupo.$where_filtro_add." GROUP BY ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo_group.",".$var_campo1_group." ".$group_by_duplicidade.$campo_tipo_nv." ".$order."";
          }else{
            $sql = "SELECT ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo." ,".$var_campo1." ".$sum_duracao.$campo_tipo_nv." , count(*) as total ".$campos_duplicidade."  from logura".$ano_mes." ".$where_nb.$where_grupo.$where_filtro_add." GROUP BY ".$var_classe_campo1.$campo_extra."".$virg."".$var_campo_group.",".$var_campo1_group." ".$group_by_duplicidade.$campo_tipo_nv." ".$order."";
          }
        }

        $sql = DescQuery($sql, $session["operador"], $PHP_SELF);
        if($session["print_sql"] == "S"){
          print $sql."<br><br>";
        }
        if($rec = mysql_query($sql, $connect2)){
          if($vlr = mysql_fetch_array($rec)){
            do{
              if($tipo_nv == "numerico" && trim($vlr_campo) < 10){
                $incluir = "";
                $arr_indice = Split(";",$vlr[str_replace(",","",$campo_tipo_nv)]);
                $x_tipo_nv = count((array)$arr_indice);
                for($y_nv=0;$y_nv<$x_tipo_nv;$y_nv++){
                  if($arr_indice[$y_nv] == trim($vlr_campo)){
                    for($x_nv=$y_nv;$x_nv<$x_tipo_nv;$x_nv++){
                      if(is_numeric($arr_indice[$x_nv])){
                        if((trim($vlr_campo) == substr($arr_indice[$x_nv],0,1)) && $x_nv != $y_nv){
                          $incluir = "S";
                        }
                      }
                    }
                  }
                }
                if($incluir != "S"){
                  continue;
                }
              }


              if($tira_duplicidade == "xsim") {
                if($array_relatorio[1] == "tipo_hora_dupl") {
                  //                  if($session["operador"] == "re000161"){
                  //                      print "<li><pre>";
                  //                      print_r($mtr_duplicidade);
                  //                  }
                  //
                  if(!is_array($mtr_duplicidade)){
                    $mtr_duplicidade = array();
                    $mtr_duplicidade[0] = '123456';
                  }
                  ///print "<li>SEARCH = ".$vlr[$campo].$vlr["ddd"].$vlr["prefixo_telefone"].$vlr["sufixo_telefone"];
                  if(array_search($vlr[$campo].$vlr["ddd"].$vlr["prefixo_telefone"].$vlr["sufixo_telefone"],$mtr_duplicidade)){
                    ///print "<li>ENCONTROU";
                    $vlr["total"] = 0;
                  }else{
                    //print "<li>N ENCONTROU";
                    array_push($mtr_duplicidade,$vlr[$campo].$vlr["ddd"].$vlr["prefixo_telefone"].$vlr["sufixo_telefone"]);
                    $vlr["total"] = 1;
                  }
                }else{
                  if(!is_array($mtr_duplicidade)){
                    $mtr_duplicidade = array();
                    $mtr_duplicidade[0] = '123456';
                  }
                  if(array_search($vlr[$campo].$vlr[$campo1].$vlr["ddd"].$vlr["prefixo_telefone"].$vlr["sufixo_telefone"],$mtr_duplicidade)){
                    $vlr["total"] = 0;
                    continue;
                  }else{
                    array_push($mtr_duplicidade,$vlr[$campo].$vlr[$campo1].$vlr["ddd"].$vlr["prefixo_telefone"].$vlr["sufixo_telefone"]);
                    $vlr["total"] = 1;
                  }
                }

              }


              if($vlr['total'] >= $qtd_lig){
                $var_aux_campo       = completa($vlr[$campo],"40"," ","D");
                if($campo1 == "varchar1"){
                  $var_aux_campo1      = $vlr[$campo1];
                  if($classe_campo1){
                    $var_aux_classe_campo1 = $vlr[$classe_campo1];
                  }
                }else{
                  $var_aux_campo1      = completa($vlr[$campo1],"40"," ","D");
                  if($classe_campo1){
                    $var_aux_classe_campo1 = $vlr[$classe_campo1];
                  }
                }

                if ($campo_aux == "hora_minuto") {
                  $aux_array_hora_minuto = explode(":",$var_aux_campo);
                  if (intval($aux_array_hora_minuto[1]) >= 1 && intval($aux_array_hora_minuto[1]) <= 29) {
                    $aux_array_hora_minuto[1] = "00";
                  } elseif (intval($aux_array_hora_minuto[1]) >= 31 && intval($aux_array_hora_minuto[1]) <= 59) {
                    $aux_array_hora_minuto[1] = "30";
                  }
                  $var_aux_campo = implode(":",$aux_array_hora_minuto);
                }
                //              print "<li>".$var_aux_classe_campo1.$var_aux_campo."   |    ".$var_aux_campo1."   |    ".$vlr['total'];
                $var_aux_campo_extra = completa($vlr[$campo_extra],"10"," ","D");
                $indice              = $var_aux_classe_campo1.$var_aux_campo.$var_aux_campo1.$var_aux_campo_extra;
                //              print "<li>".$var_aux_campo;
                if((BuscaNaMatriz($matriz_aux['indice'] , $indice) == -1)){
                  $matriz_aux['indice'][$y] = $indice;

                  $matriz[$indice][$campo]   = $var_aux_campo;
                  $matriz[$indice][$campo1]  = $var_aux_campo1;
                  $matriz[$indice][$classe_campo1]  = $var_aux_classe_campo1;
                  $matriz[$indice][$campo_extra]  = $var_aux_campo_extra;


                  if($y > $tot_matriz){
                    $tot_matriz = $y;
                  }
                  $y++;
                }
                $matriz[$indice]['duracao']           += $vlr['duracao_ligacao'];
                $matriz['TOTAL_TEMPO']['qtd']                 += $vlr['duracao_ligacao'];
                $matriz[$indice]['qtd']               += $vlr['total'];

                if ($campo_aux == "hora_minuto") {
                  $matriz_sub[trim($var_aux_campo)]['SUBTOTAL'] += $vlr['total'];
                  $matriz_sub[trim($var_aux_campo)]['SUBTOTAL_TEMPO'] += $vlr['duracao_ligacao'];
                } else {
                  $matriz_sub[$vlr[$campo]]['SUBTOTAL'] += $vlr['total'];
                  $matriz_sub[$vlr[$campo]]['SUBTOTAL_TEMPO'] += $vlr['duracao_ligacao'];
                }

                $matriz['TOTAL']['qtd']                 += $vlr['total'];
              }
            }while($vlr  = mysql_fetch_array($rec));

          }else{
            $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
          }
        }else{
          if($session["operador"] == "adm"){
            $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Tabela<br>";
          }else{
            $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
          }
        }
      // }
    }
    $ano_mes = inc_ano_mes($ano_mes);
  }
}

//print "<pre>";
//print_r($matriz_sub);
//exit();

//************Ordenando a matriz para impressao*************************
if (is_array($matriz_aux["indice"])){
  sort($matriz_aux["indice"]);
}
//***********************************************************************

if($pag){
  $voltar = "cc_consulta.php?nivel=F";
}else{
  $voltar = "Javascript:history.back();";
}


if($deonde != "DACNET" && $deonde != "visao_personalizada_dac") {
  if($mes_ini) {
    $tabelao_titulo.="<table border=0 width=650 cellpadding=2 cellspacing=0>";
    $tabelao_titulo.="   <tr>";
    $tabelao_titulo.="      <td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;".ValorClasse("REPRE",$repre,"URANET")."</td>";
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="   <tr>";
    if($campo){
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Relatório:</b>".$titulo;
      if($StrHoraInicio){
      $tabelao_titulo.=" - <b> Período: </b>".BrDate($StrDataInicio)." à ".BrDate($StrDataFim)." - ".$StrHoraInicio." à".$StrHoraFim."</td>";
      }
    }
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="</table>";
    $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
    $tabelao_titulo.="   <tr>";
    if($ddd                          ){$monta_titulo1 .= "<b>DDD: </b> ".$ddd." ->  ";}
    if($tipo_telefone                ){$monta_titulo1 .= "<b>Tipo de Telefone: </b> ".Strtoupper($tipo_telefone)." ->  ";}
    $tabelao_titulo.="   </tr><tr>";
    if($atendimento                  ){$monta_titulo1  .= "<b>Tipo Atendimento: </b> ".Strtoupper($atendimento)."  ";}
    if($grupo){
      $monta_titulo.= gambiDacGrupoTit($grupo);
    }
    if($tel_prefixo  || $tel_sufixo  ){$monta_titulo1 .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}
    if($ramal         ){
      $tabelao_titulo1 .="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Ramal:</b>".$ramal."</td>";
    }
    if($monta_titulo ||$monta_titulo1 || $desc_campo){
      $monta_titulo1 =  $monta_titulo.$monta_titulo1.$desc_campo;
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'>&nbsp;".$monta_titulo1."</td>";
    }
    $tabelao_titulo.="   </tr>";
    $tabelao_titulo.="</table>";
    if(count((array)$s) < 10){
      if($s || $s_passa) {
        $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
        $tabelao_titulo.="   <tr>";
        $tabelao_titulo.="      <td>";
        $tabelao_titulo.="         <table border=0 align='left' cellpadding='0' cellspacing='0'>";
        $tabelao_titulo.="           <tr>";
        $tabelao_titulo.="              <td align='left'><font class='txt5'><b>&nbsp;&nbsp;Serviço(s): </b>";
        $x=0;
        if($s[$x]){
          while($s[$x]){
            $s_passa1  = $s_passa1.$s[$x]." - ".ValorClasse("URANB",$s[$x],$repre)."  /  ";
            $x++;
          }
        };
        $tabelao_titulo.=                $s_passa1."</td>";
        $tabelao_titulo.="           </tr>";
        $tabelao_titulo.="         </table>";
        $tabelao_titulo.="      </td>";
        $tabelao_titulo.="   </tr>";
        $tabelao_titulo.=" </table>";
        $tabelao_titulo.=" <BR><BR>";
      }
    }
  }
}


if($tipo_nv){
  $titulo_cabecalho = "Pesquisa";
}else{
  $titulo_cabecalho = "Estatística por Ligação";
}

if($mes_ini){
  $titulo_cabecalho .= " de - ".BRdate($StrDataInicio)." até ".BRdate($StrDataFim);
}else{
  $titulo_cabecalho .= " - Faça sua Pesquisa";
}

if($deonde == "visao_personalizada" || $deonde == "email_batch"){
  print $tabelao_titulo;
  if($pag != 1){
  $tipo_popup = "AJB";
  $titulo_cabecalho ="";

  }
}

if($deonde == "visao_personalizada_dac"){
      print "<form name='form_visao_personalizada' action='' method='POST' >";
      ?>
       <?if($ctritgl_vp){?>
        <input type="hidden" name="ctritgl_vp" value="<?print $ctritgl_vp?>">
        <?}else{
           foreach ($_REQUEST as $key_vp=>$vlr_vp){
             print "<input type='hidden' name='".$key_vp."' value='".$vlr_vp."'>";
           }
        }?>
        <input type="hidden" name="deonde" value="<?print $deonde?>">
        <input type="hidden" name="titulo" value="<?print $titulo?>">
        <input type="hidden" name="tipo_popup" value="<?print $tipo_popup?>">
        <input type="hidden" name="busca_form_vp" value="ok">

      <?
      print "<input type='hidden' name='carrega_dados' value=''>";
      print" <table border=0 width=650 cellpadding=2 cellspacing=0>";
      print"   <tr>";
      print"      <td nowrap align='left' colspan='3'><font class='txt5'><b>&nbsp;&nbsp;".ValorClasse("REPRE",$repre,"URANET")." - ".$titulo_dac."</b> <font color='".$session["td_destaque"]."'> (Atualização 5 Minutos)</td>";
      print"   </tr>";
      print"   <tr>";
      print"      <td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Período:";
      print"      <td nowrap align='left'><font class='txt5'>";
                    require_once("funcoes/DataCalendario.php");
                    print dataCalendarioDuplaV4("diaini","mesini","anoini","diafim","mesfim","anofim","","","","","S","","URANET",false);
      print"      <td nowrap align='left' width='100%'>";
      print "        <font class='txt5'  onclick='Javascript:enviaFormVisao();' style='cursor: pointer;'><strong>Click para Atualizar<img src='imagens/ico_pesquisa.gif'  title='Click para Atualizar'></strong></font>";
      print"   </tr>";
      if($grupo){
      print"   <tr>";
      print"      <td nowrap align='left' class='txt5' colspan=3>&nbsp;&nbsp;";
       print    gambiDacGrupoTit($grupo);
      }
      print"   </table>";
      print "</form>";
}






?>

<html>
<head>
   <title><?print $session['sistema']?></title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <?print $v1_style_css?>

<script language="javascript" type="text/javascript" src="consistencia.js"></script>
<script language="javascript" type="text/javascript" src="/js/jquery.js"></script>
<script language="javascript">
/////////FILTRO ADICIONAL NOVO ALFREDO /////////
function AddFiltroAdicional() {
  combo_filtro     = $("select[name='combo_condicao']").val();

  filtro_adicional = $("#id_filtro_adicional").val();
  arr_combo_filtro = combo_filtro.split("§");

  if (filtro_adicional.indexOf(combo_filtro) == -1){
    $("#id_filtro_adicional").val(filtro_adicional+combo_filtro+"¢A¢");
    AtuFiltroAdicional();
  }
}

function RemoveTodos() {
  combo_filtro = $("select[name='combo_condicao']").val();
  if (combo_filtro == ""){
    if (confirm('Deseja Limpar Todos os Filtros Adicionais?')) {
      $("#id_filtro_adicional").val('');
      AtuFiltroAdicional();
    }
  } else {
    $("#id_filtro_adicional").val(replaceString(combo_filtro+"¢A¢","", $("#id_filtro_adicional").val()));
    AtuFiltroAdicional();
  }
}

function RemoveUnico(valor) {
  combo_filtro = valor;
  if (combo_filtro != ""){
    $("#id_filtro_adicional").val(replaceString(combo_filtro+"¢A¢","", $("#id_filtro_adicional").val()));
    AtuFiltroAdicional();
  }
}

function AtuFiltroAdicional() {
  $.ajax({
    url: "tlfn_con_ret_gerencial_ajax_v2.php?deonde=AJAX",
    type: "POST",
    data: $("form[name=consulta]").serialize(),
    dataType: "text",
    timeout: 1000,
    error: function () {
      //
    },
    success: function (data, textStatus) {
      $("#id_filtros_add").html(data);
    }
  });
}
/////////FIM FILTRO ADICIONAL NOVO ALFREDO /////////

function selecionaAction(relatorio) {
  relatorio = relatorio.split('§');
  programa = relatorio[0];
  //alert(relatorio[1])
  if(relatorio[1] == 'qtd_tel'){
    document.consulta.qtd_lig.disabled = false;
    document.consulta.qtd_lig.value = '5';
  }else{
    document.consulta.qtd_lig.value = '';
    document.consulta.qtd_lig.disabled = true;
  }
  if(relatorio[1] == 'gerencial_nb'){
    document.consulta.servico.disabled=true;
    document.consulta.servico.setAttribute('consistir', '');
  }else{
    document.consulta.servico.disabled=false;
    document.consulta.servico.setAttribute('consistir', 'sempre');
  }

  <?if(($repre == "BMC1")|| ($repre == "IMBRA")|| $sistema_identificacao =="teste" ){?>
    if(relatorio[1] == "parm_data" || relatorio[1] == "tlig"||relatorio[1] == "grupo2"  ||relatorio[1] == "grupo_tipo"){
      document.getElementById("div_duplicidade").style.visibility = "visible";
      document.getElementById("tira_duplicidade_imbra").checked = true;
    }else{
      document.getElementById("div_duplicidade").style.visibility = "hidden";
      document.getElementById("tira_duplicidade_imbra").checked = false;
    }
  <?}?>

  document.consulta.action=programa;
}

function VerificaForm() {

  document.getElementById('bt_procurar').disabled = true;
  document.consulta.tel_consulta.value = document.consulta.tel_prefixo.value + document.consulta.tel_sufixo.value;

  if(document.consulta.tel_prefixo.value != "") {
    var prefixo = document.consulta.tel_prefixo.value;
    var sufixo = document.consulta.tel_sufixo.value;
    var ddd = document.consulta.ddd.value

    if (ddd && getExpReg('ddd').test(ddd) == false) {
      $(document.consulta.tel_consulta).attr('tipodado', 'numeros');
    } else {
      $(document.consulta.tel_consulta).attr('tipodado', 'telefone');
    }

    if(prefixo.length < 3) {
      alert('Preencha Corretamente o Prefixo!');
      document.consulta.tel_prefixo.focus();
      document.consulta.tel_prefixo.select();
      document.getElementById('bt_procurar').disabled = false;
      return false;
    }else{
      if(sufixo.length < 4) {
        alert('Preencha Corretamente o Sufixo!');
        document.consulta.tel_sufixo.focus();
        document.consulta.tel_sufixo.select();
        document.getElementById('bt_procurar').disabled = false;
        return false;
      }else{
        if(!ddd){
          alert('Selecione o DDD do Telefone Consultado!');
          document.consulta.ddd.focus();
          document.getElementById('bt_procurar').disabled = false;
          return false;
        }
      }
    }
  }else if(document.consulta.tel_sufixo.value) {
    alert("Preencha Corretamente o Prefixo!");
    document.consulta.tel_prefixo.focus();
    document.getElementById('bt_procurar').disabled = false;
    return false;
  }

  data_ini = document.consulta.ano_ini.value+'-'+document.consulta.mes_ini.value+'-'+document.consulta.dia_ini.value;
  data_fim = document.consulta.ano_fim.value+'-'+document.consulta.mes_fim.value+'-'+document.consulta.dia_fim.value;

  date_ini = new Date(document.consulta.ano_ini.value, (document.consulta.mes_ini.value - 1), document.consulta.dia_ini.value);
  date_fim = new Date(document.consulta.ano_fim.value, (document.consulta.mes_fim.value - 1), document.consulta.dia_fim.value);

  if((document.consulta.data_inicio_nivel.value <= data_ini) && (document.consulta.data_inicio_oper.value <= data_ini)){
    if(date_fim < date_ini){
      alert('Data inicial da pesquisa deve ser menor do que a data final.');
      document.getElementById('bt_procurar').disabled = false;
      return false;
    }

    var intervaloDias = 60;
    <?if(substr($repre,0,8) == "BMG-CALL" && $repre != "BMG-CALLURA" && substr($session["representante"], 0, 6) != "URANET") {?>
      intervaloDias = 1;
    <?}?>
    if((date_fim - date_ini)/86400000 <= intervaloDias){

      if(checa(document.consulta)){
        document.consulta.procura.value = 'OK';
        document.consulta.submit();
      }else{
        document.getElementById('bt_procurar').disabled = false;
      }
    }else{
      alert('O intervalo máximo para consulta é de '+intervaloDias+' dias.');
      document.getElementById('bt_procurar').disabled = false;
    }
  }else{
    if(document.consulta.data_inicio_nivel.value >= data_ini){
      ano_nivel = document.consulta.data_inicio_nivel.value.substring(0,4);
      mes_nivel = document.consulta.data_inicio_nivel.value.substring(5,7);
      dia_nivel = document.consulta.data_inicio_nivel.value.substring(8,10);
      alert('Consulta disponivel a partir de '+ dia_nivel+'/'+mes_nivel+'/'+ano_nivel);
      document.getElementById('bt_procurar').disabled = false;
    }
    if(document.consulta.data_inicio_oper.value >= data_ini){
      ano_oper = document.consulta.data_inicio_oper.value.substring(0,4);
      mes_oper = document.consulta.data_inicio_oper.value.substring(5,7);
      dia_oper = document.consulta.data_inicio_oper.value.substring(8,10);
      alert('Consulta disponivel a partir de '+ dia_oper+'/'+mes_oper+'/'+ano_oper);
      document.getElementById('bt_procurar').disabled = false;
    }
  }
}
function enviaFormVisao(){
  data_ini = new Date(document.getElementById("anoini").value, document.getElementById("mesini").value-1,document.getElementById("diaini").value);
  data_fim = new Date(document.getElementById("anofim").value, document.getElementById("mesfim").value-1,document.getElementById("diafim").value);

  if(data_fim < data_ini) {
      alert('Data inicial da pesquisa deve ser menor do que a data final.');
      return false;
    }
    if((data_fim - data_ini)/86400000 <= 31) {
      document.form_visao_personalizada.submit();
    }else{
      alert('O intervalo máximo para consulta é de 31 dias.');
      return false;
    }

}

function imprimeRelatorio(tipo){
  document.simula.tipo.value=tipo;
  strHelpOptions =  "location=no";
  strHelpOptions += ",toolbar=no";
  strHelpOptions += ",titlebar=no";
  strHelpOptions += ",menubar=no";
  strHelpOptions += ",status=no";
  strHelpOptions += ",scrollbars=yes";
  strHelpOptions += ",top=1";
  strHelpOptions += ",left=1";
  strHelpOptions += ",width=720";
  strHelpOptions += ",height=520";
  Janela = window.open('', 'Janela', strHelpOptions);
  Janela.focus();
  document.simula.submit();
}

function VerificaFone() {
  //alert(document.consulta.tel_prefixo.value + document.consulta.tel_sufixo.value);
  document.consulta.tel_consulta.value = document.consulta.tel_prefixo.value + document.consulta.tel_sufixo.value;
}

function mantemAgrup(agrup){
  $("#agrup_selecionado").val(agrup);
}

function incluiNBAP2(repre, existe, desc_repre){
  if(existe == "S"){
    AbreJanela2('manut_perfil_atendimento.php?tipo_popup=AJ2&repre='+repre+'&selec_agpr=NBAPK&classe_perfil=NBAP2&busca=OK&deonde=sem_menu', 'janelaLupa', 1100, 450, 'Agrupar Serviços ' + desc_repre + ' ');
  } else {
    AbreJanela2('manut_perfil_atendimento.php?tipo_popup=AJ2&repre='+repre, 'janelaLupa', 1100, 450, 'Agrupar Serviços ' + desc_repre + ' ');
  }
}
</script>
</head>
<body>

<?
print GerarCabecalho($voltar, $titulo_cabecalho, "", "")?>
<?if($deonde != "DACNET" && $deonde != "visao_personalizada"  && $deonde != "visao_personalizada_dac" && $deonde != "email_batch") {?>
<?if($mes_ini && $procura == "OK"){?>
  <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session['td_dado1']?>">
      <?if($campo     ){?><td nowrap align="left"><font class="txt5">    <b>&nbsp;&nbsp;Relatório:  </b><?print $titulo;$titulo_grafico.=" - ".$titulo;?></td><?}?>
      <?if($StrHoraInicio ){?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Entre       </b><?print $StrHoraInicio?><b> e </b><?print $StrHoraFim?></td><?}?>
      <?if($StrDataInicio ){?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Período de: </b><?print BrDate($StrDataInicio)?><b> até: </b><?print BrDate($StrDataFim)?></td><?}?>
    </tr>
  </table>
  <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session['td_dado1']?>">
       <?if($ddd                          ){ $monta_titulo = $monta_titulo ."<b>DDD: </b> ".$ddd." ->  ";}?>
       <?if($tipo_telefone                ){ $monta_titulo .= "<b>Tipo de Telefone: </b> ".Strtoupper($tipo_telefone)." ->  ";}?>
       <?
       if($grupo){
         $monta_titulo.= gambiDacGrupoTit($grupo);
       }
       ?>

       <?if($tel_prefixo  || $tel_sufixo  ){ $monta_titulo .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}?>
       <?if($ramal                        ){?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Ramal:      </b><?print $ramal;?></td><?}?>
       <?if($monta_titulo || $desc_campo){?>
          <td nowrap align="left"><font class="txt5" >&nbsp;&nbsp;<?print $monta_titulo =  $monta_titulo.$desc_campo;?></td>
       <?}?>
    </tr>
  </table>
  <br>
   <?if(($s || $s_passa) && $procura == "OK"){
     $x=0;
     if($s[$x]){
       while($s[$x]){
         $s_passa  = $s_passa.$s[$x]." - ".ValorClasse("URANB",$s[$x],$repre)." | ";
         $x++;
       }
     }
     if($x <= 10){
   ?>
         <table border="0" width="700" align="center">
           <tr>
              <td align="center">
                 <table border="2" align="center"  bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
                   <tr bgcolor="<?print $session['td_dado1']?>">
                      <td align="left"><font class="txt5"><b>Serviço(s):</b><?print $s_passa?> </td>
                   </tr>
                 </table>
              </td>
           </tr>
         </table>
         <br>
    <?}else{
      $s_passa = '';
      }?>
   <?}?>
<?}

}

//print $msg_nao_conectou;
if($y != "0") {

  $tabelao_rel.="<table ";if($imprime_duracao == "sim"){$tabelao_rel.= "width='700'";}else{$tabelao_rel.= "width='600'";}$tabelao_rel.="border='my_border_color' cellpadding=0 cellspacing=0 align='center' style='border-collapse:collapse'>";
  $tabelao_rel.="  <tr bgcolor=".$session['td_destaque'].">";
  $tabelao_rel.="     <td rowspan='2' align='center'><font class='txt6'><font color=#FFFFFF><b>".$titulo."</a></font></td>";
  if($campo != $campo1){
    $tabelao_rel.="     <td rowspan='2' align='center'><font class='txt6'><font color=#FFFFFF><b>".$titulo1."</a></font></td>";
  }
  $tabelao_rel.="     <td align='center'";if($imprime_duracao == "sim"){$tabelao_rel.="colspan='6'";}else{$tabelao_rel.="colspan='3'";}$tabelao_rel.="<font class='txt6'><font color=#FFFFFF><b>LIGAÇÕES</font></td>";
  $tabelao_rel.="  </tr>";
  $tabelao_rel.="  <tr bgcolor=".$session['td_destaque1']." >";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>QTD</font></td>";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>%(".$titulo.")</font></td>";
  $tabelao_rel.="     <td align='center'><font class='peq'><b>%(Total)</font></td>";
  if($imprime_duracao == "sim"){
    $tabelao_rel.="  <td align='center'><font class='peq'><b>TEMPO    </font></td>";
    $tabelao_rel.="  <td align='center'><font class='peq'><b>%(".$titulo.")</font></td>";
    $tabelao_rel.="  <td align='center'><font class='peq'><b>%(Total) </font></td>";
  }
  $tabelao_rel.="  </tr>";

  if($deonde == "visao_personalizada" || $deonde == "visao_personalizada_dac" ||  $deonde == "email_batch"){
    ?>
    <table border="0">
    <tr>
      <td id="div_grafico"  valign="top">

      </td>
      <td valign="top">
    <table <?if($imprime_duracao == "sim"){?> width="500" <?}else{?> width="400"<?}?>border="1" cellpadding="0" cellspacing="0" align="left"  style='border:0;border-collapse:collapse'><?
  }else{
    ?><table <?if($imprime_duracao == "sim"){?> width="700" <?}else{?> width="600"<?}?>border="1" cellpadding="0" cellspacing="0" align="center"  style='border:0;border-collapse:collapse'><?
  }

?>

    <tr bgcolor="<?print $session['td_destaque']?>">
     <td rowspan="2" align="center"><font class="txt6"><b><?print $titulo?></a></font></td>
     <?if($campo != $campo1){?>
     <td rowspan="2" align="center"><font class="txt6"><b><?print $titulo1?></a></font></td>
     <?}?>
     <td align="center" <?if($imprime_duracao == "sim"){?>colspan="6"<?}else{?>colspan="3"<?}?>><font class="txt6"><b>LIGAÇÕES</font></td>
    </tr>
    <tr bgcolor="<?print $session['td_destaque1']?>" >
       <td align="center"><font class="peq"><b>QTD    </font></td>
       <td align="center"><font class="peq"><b>%(<?print $titulo?>)    </font></td>
       <td align="center"><font class="peq"><b>%(Total)    </font></td>
       <?if($imprime_duracao == "sim"){?>
          <td align="center"><font class="peq"><b>DURAÇÃO    </font></td>
          <td align="center"><font class="peq"><b>%(<?print $titulo?>)    </font></td>
          <td align="center"><font class="peq"><b>%(Total)    </font></td>
       <?}?>
    </tr>

<?
if($campo == "data_ligacaox" && $campo1 == "data_ligacaox"){//nao utiliza
   $dados_array="";
   $tipo_grafico = "area";
}else{
  $dados_array="QTDª";
  $tipo_grafico = "bars";
}


for($x = 0; $x <= $tot_matriz; $x++){
  $cor  = $session['td_dado3'];
  $cor1 = $session['td_dado1'];
  $fonte = "peq";
  $corclick = $session['td_destaque1'];
  Switch($campo) {



    case "concat(equipe,'/',ura_grupo,'¢',ura_maquina)":

      $arr_valor_explode = explode("/",$matriz[$matriz_aux['indice'][$x]][$campo]);
      $campo_imprime = $arr_valor_explode[0]."/".valorclasse("URAMQ",trim($arr_valor_explode[1]),$repre);
      $align= "center";
      break;
    case "concat(ura_grupo,'¢',ura_maquina)":
      $campo_imprime = str_replace("¢",".",$matriz[$matriz_aux['indice'][$x]][$campo])." - ".valorclasse("URAMQ",trim($matriz[$matriz_aux['indice'][$x]][$campo]),$repre);
      $align= "center";
      break;
    case "empresa":
      if($campo1 != "IF(grupo_transferencia > '','1','0')"){
        $campo_imprime = ValorClasse("REPRE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == ""){
          $campo_imprime = "Não Atendidas";
        }else{
          $campo_imprime = "Atendidas";
        }
      }
      break;
    case "regiao":
      $campo_imprime = ValorClasse("URARG",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "equipe":
      $campo_imprime = ValorClasse("EQUIP",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "uf":
      $campo_imprime = Substr(ValorClasse("URAUF",$matriz[$matriz_aux['indice'][$x]][$campo],$repre),2);
      $align= "Left";
      break;
    case "login_operador":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".NomeResumido($matriz[$matriz_aux['indice'][$x]][$campo]);
      $align= "left";
      break;
    case "concat(ddi,'¢',ddd)":
      FormataDDD();
      break;
    case "ddd":
      $sql_pes         = "SELECT regiao FROM tblgcddd where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo]."'";
      $query_pes       = mysql_query ($sql_pes, $connect3);
      $ddd_pes         = mysql_fetch_array ($query_pes);
      if($campo == $campo1){
        $campo_imprime  = $matriz[$matriz_aux['indice'][$x]][$campo];
      }else{
        $campo_imprime  = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".$ddd_pes['regiao'];
      }
      $align1= "left";
      $align= "left";
      break;
    case "data_ligacao":
      $campo_imprime = BRDATE($matriz[$matriz_aux['indice'][$x]][$campo]);
      $align= "center";
      break;
    case "prefixo_telefone":



      if($campo1  != "sufixo_telefone") {
        $matriz[$matriz_aux["indice"][$x]][$campo      ] = trim($matriz[$matriz_aux["indice"][$x]][$campo      ]);
        $matriz[$matriz_aux["indice"][$x]][$campo1     ] = trim($matriz[$matriz_aux["indice"][$x]][$campo1     ]);
        $matriz[$matriz_aux["indice"][$x]][$campo_extra] = trim($matriz[$matriz_aux["indice"][$x]][$campo_extra]);

        if($matriz[$matriz_aux["indice"][$x]][$campo1] != "55" && $matriz[$matriz_aux["indice"][$x]][$campo1] != ""){
          $campo_imprime .= "+".$matriz[$matriz_aux["indice"][$x]][$campo1]." ";
          $campo_imprime1 = ValorClasse("URACI", $matriz[$matriz_aux["indice"][$x]][$campo1], "URANET");
        }else{
          $sql_pes        = "SELECT nomeprefixo FROM tblgtele where ddd = '".$matriz[$matriz_aux["indice"][$x]][$campo_extra]."' and prefixo = '".$matriz[$matriz_aux["indice"][$x]][$campo]."' ";
          $query_pes      = mysql_query ($sql_pes, $connect3);
          if($ddd_pes = mysql_fetch_array ($query_pes)){
            $campo_imprime1 = $ddd_pes["nomeprefixo"];
          }else{
            $campo_imprime1 = "Localidade não encontrada";
          }
          $align1= "left";
        }


      }
    //  if($matriz[$matriz_aux["indice"][$x]][$campo_extra] != "-"){
        $campo_imprime .= "(".$matriz[$matriz_aux["indice"][$x]][$campo_extra].") ";
      //}
      $campo_imprime .= $matriz[$matriz_aux["indice"][$x]][$campo];
      $align= "center";

      break;
    case "nb":
      if($campo == $campo1){
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo];
        $align= "center";
      }else{
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URANB",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }

      break;

    case "grupo":
      if($campo == $campo1){
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }else{
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }
      break;
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URAOP",trim($s[0]).trim($matriz[$matriz_aux['indice'][$x]][$campo]),$repre);
      $align= "left";
      break;
    case "tipo_atendimento":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A"){
        $campo_imprime = "Ativo";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "R"){
          $campo_imprime = "Receptivo";
        }else{
          $campo_imprime = "Tipo de  Atendimento não Definido - ".$matriz[$matriz_aux['indice'][$x]][$campo];
        }
      }

      $align= "center";
      break;
    case "nome_sms":
      if($repre != "SFC"){
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo];
        $align= "center";
      }else{
        $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("EKSG4",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        $align= "left";
      }
      break;
    case "tipo_ligacao":
      if($campo_extra){
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]) == "A"){
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }else{
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A"){
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }else{
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }

      }
      $align1= "left";
      break;
    case "tipo_registro":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "L"){
        $campo_imprime = "Ligação";
      }else{
        $campo_imprime = "Transferência";
      }
      $align1= "left";
      break;
    case "transferencia":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "S"){
        $campo_imprime = "Sim";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "N"){
          $campo_imprime = "Não";
        }else{
          $campo_imprime = " ";
        }
      }
      break;
    case "resultado_ligacao":
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("PQSTA",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
      $align= "left";
      break;
    case "grupo_transferencia":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "URA" && $campo == "grupo_transferencia"){
        $campo_imprime = "URA";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "" && $campo == "grupo_transferencia"){
          $campo_imprime = "Não Transferiu";
        }else{
          $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo],$repre);
        }
      }
      $align= "left";
      break;

    default:
      $campo_imprime = $matriz[$matriz_aux['indice'][$x]][$campo];
      $align= "left";
      break;

  }

  switch($campo1) {




    case "concat(tipo_ligacao,'¢',grupo_transferencia)":
      $arr_aux = explode("¢",trim($matriz[$matriz_aux['indice'][$x]][$campo1]));



      if(trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]) == "A") {
        $campo_imprime_aux0 = $arr_aux[0]." - ".ValorClasse("URALA",$arr_aux[0],$repre);
      } else {
        $campo_imprime_aux0 = $arr_aux[0]." - ".ValorClasse("URALR",$arr_aux[0],$repre);
      }

      if($arr_aux[1] == "URA"){
        $campo_imprime_aux1 = "";
      }else{
        if($arr_aux[1] == ""){
          if($arr_aux[0] > "003"){
            $campo_imprime_aux1 = "";
          }else{
            $campo_imprime_aux1 = "Não Transferiu";
          }



        }else{
          $campo_imprime_aux1 = $arr_aux[1]." - ".ValorClasse("GRATE",$arr_aux[1],$repre);
        }
      }
      if($campo_imprime_aux1){
        $campo_imprime1 = $campo_imprime_aux0." - ".$campo_imprime_aux1;
      }else{
        $campo_imprime1 = $campo_imprime_aux0;
      }




      $align1= "left";
      break;
    case "IF(grupo_transferencia > '','1','0')":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "1"){
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == ""){
          $campo_imprime1 = "Rediscagem";
        }else{
          $campo_imprime1 = "Improdutivas";
        }
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "0"){
          if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) != ""){
            $campo_imprime1 = "Produtivas";
          }else{
            $campo_imprime1 = "Somente Ura";
          }
        }
      }
      break;

    case "grupo_transferencia":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "URA" && $campo1 == "grupo_transferencia"){
        $campo_imprime1 = "URA";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "" && $campo1 == "grupo_transferencia"){
          $campo_imprime1 = "Não Transferiu";
        }else{
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }
      }
      $align1= "left";
      break;

    case "ddi":
      $matriz[$matriz_aux["indice"][$x]][$campo1] = trim($matriz[$matriz_aux["indice"][$x]][$campo1]);
      if($campo_imprime1 == ""){
        print "aa".$matriz[$matriz_aux["indice"][$x]][$campo1]."bb";
        $campo_imprime1 = ValorClasse("URACI", $matriz[$matriz_aux["indice"][$x]][$campo1], "URANET");
      }
      $align= "center";
      break;

    case "concat(ura_grupo,'¢',ura_maquina)":
      $campo_imprime1 = str_replace("¢",".",$matriz[$matriz_aux['indice'][$x]][$campo1])." - ".valorclasse("URAMQ",trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
      $align= "center";
      break;

    case "regiao":
      $campo_imprime1 = ValorClasse("URARG",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case "empresa":
      $campo_imprime1 = ValorClasse("REPRE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case "equipe":
      $campo_imprime1 = ValorClasse("EQUIP",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;


    case "data_ligacao":
      $campo_imprime1 = BrDate($matriz[$matriz_aux['indice'][$x]][$campo1]);
      $align1= "center";
      break;
    case "opcura":
      if($campo_extra){
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("URAOP",trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]).trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
        $align1= "left";
      }else{
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("URAOP",trim($matriz[$matriz_aux['indice'][$x]][$campo]).trim($matriz[$matriz_aux['indice'][$x]][$campo1]),$repre);
        $align1= "left";
      }
      break;
    case "uf":
      $campo_imprime1 = ValorClasse("URAUF", $matriz[$matriz_aux["indice"][$x]][$campo1], $repre);

      if(substr($campo_imprime1, 1, 1) == " "){
        $campo_imprime1 = Substr($campo_imprime1, 2);
      }
      $align1= "left";
      break;
    case "nb":
      $campo_imprime1 = ValorClasse("URANB",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      $align1= "left";
      break;
    case "grupo":
      if($campo == $campo1){
        $campo_imprime1 = ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      }else{
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse("GRATE",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      }
      $align1= "left";
      break;
    case "login_operador":
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".NomeResumido($matriz[$matriz_aux['indice'][$x]][$campo1]);
      $align1= "left";
      break;
    case "hora_ligacao_ini":
    case "left(hora_ligacao_ini, 2)":
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."h";
      $align1= "center";
      break;
    case "tipo_ligacao":
      //print trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]);
      if($campo_extra){
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo_extra]) == "A"){
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }else{
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo]) == "A"){
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }else{
          $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]."-".ValorClasse("URALR",$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
        }

      }
      $align1= "left";
      break;
    case "prefixo_telefone":
      $sql_pes        = "SELECT nomeprefixo FROM tblgtele where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo_extra]."' and prefixo = '".$matriz[$matriz_aux['indice'][$x]][$campo1]."' ";
      $query_pes      = mysql_query ($sql_pes, $connect3);
      $ddd_pes        = mysql_fetch_array ($query_pes);
      $campo_imprime1 = $ddd_pes["nomeprefixo"];
      $align1= "left";
      break;
    case "concat(ddi,'¢',ddd)":
      FormataDDD();
      break;
    case "ddd":
      $sql_pes         = "SELECT regiao FROM tblgcddd where ddd = '".$matriz[$matriz_aux['indice'][$x]][$campo1]."'";
      $query_pes       = mysql_query ($sql_pes, $connect3);
      $ddd_pes         = mysql_fetch_array ($query_pes);
      if($campo != $campo1){
        $campo_imprime1  = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".$ddd_pes['regiao'];
      }else{
        $campo_imprime1  = $ddd_pes['regiao'];
      }
      $align1= "left";
      break;
    case "tipo_registro":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "L"){
        $campo_imprime1 = "Ligação";
      }else{
        $campo_imprime1 = "Transferência";
      }
      $align1= "left";
      break;
    case "transferencia":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "S"){
        $campo_imprime1 = "Sim";
      }else{
        if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) == "N"){
          $campo_imprime1 = "Não";
        }else{
          $campo_imprime1 = " ";
        }
      }
      $align1= "left";
      break;
    case "motivo_ligacao":
      if(trim($matriz[$matriz_aux['indice'][$x]][$campo1]) != "") {
        $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1]." - ".ValorClasse($matriz[$matriz_aux['indice'][$x]][$classe_campo1],$matriz[$matriz_aux['indice'][$x]][$campo1],$repre);
      }else{
        $campo_imprime1 = "&nbsp";
      }
      $align1= "left";
      break;

    default:
      $campo_imprime1 = $matriz[$matriz_aux['indice'][$x]][$campo1];
      $align1= "left";
      break;


  }
  //print $campo_prox."aaaaaaa";

  if($campo_extra){
    $campo1_aux = $campo1;
    //        $campo1 = $campo_extra;
  }
  //  print $desc_campo;
  if(StrPos($monta_titulo,$titulo)){
    $desc_campo= urlEncode("<b> ".$titulo1.": </b>".$campo_imprime1)." -> ";
  }else{
    if(StrPos($monta_titulo,$titulo1)){
      $desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";
    }else{
      if ($campo_aux == "hora_minuto") {
        $desc_campo= urlEncode("<b>".$titulo1.": </b>".$campo_imprime1."<b> -> ".$titulo.": </b>".retornaIntervaloHora($campo_imprime))." -> ";
      } else {
        $desc_campo= urlEncode("<b>".$titulo1.": </b>".$campo_imprime1."<b> -> ".$titulo.": </b>".$campo_imprime)." -> ";
      }
    }
  }

  $tabelao_rel.="<tr  bgcolor=".$cor.">";
  $tabelao_rel.="   <td nowrap align=".$align; if($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x+1]][$campo]){$tabelao_rel.="style='border-bottom:none;'";}$tabelao_rel.=">";$tabelao_rel.="<font class=".$fonte.">   ";if($matriz[$matriz_aux['indice'][$x]][$campo] != $matriz[$matriz_aux['indice'][$x-1]][$campo]){$tabelao_rel.=$campo_imprime;}$tabelao_rel.="</b></font></td>";
  if($campo != $campo1) {
    $tabelao_rel.="   <td nowrap align=".$align1."><font class=".$fonte.">".$campo_imprime1."</b></font></td>";
  }
  $tabelao_rel.="   <td align='right'           ><font class=".$fonte.">".$matriz[$matriz_aux['indice'][$x]]['qtd']."</b></font></td>";
  $tabelao_rel.="   <td align='right'           ><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL'])."</b></font></td>";
  $tabelao_rel.="   <td align='right'           ><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd'])."</b></font></td>";
  if($imprime_duracao == "sim"){
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".VerificaTime($time,$matriz[$matriz_aux['indice'][$x]]['duracao'])."</b></font></td>";
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO'])."</b></font></td>";
    $tabelao_rel.="<td align='right'><font class=".$fonte.">".percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd'])."</td>";
  }

  $tabelao_rel.="</tr>";



  if($campo == "data_ligacaox" && $campo1 == "data_ligacaox"){
    $dados_array.= $campo_imprime."ª".percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd'])."§";
  }else{
    $dados_array.= percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd'])."ª";
  }





  if($campo == $campo1 ){
  $legenda.=trim($campo_imprime1)."§";
  }else{
    $legenda.=trim($campo_imprime)." - ".trim($campo_imprime1)."§";
  }

  if ($campoInicial == 'rede') {
    $deondeCorretivo = '&deondecorretivo=rede';
  } else {
    $deondeCorretivo = '';
  }
  ?>

     <tr  bgcolor="<?print $cor?>"
     <?if((($session['origem']!="LIGBOLADA") || ($session['origem'] == $session['representante']))  && ($deonde != "DACNET" && $deonde!= "visao_personalizada_dac" && $deonde != "email_batch")) {?>
          onMouseDown="window.location='<?print $prog_prox.'?deonde='.$deonde.'&anoini='.$anoini.'&mesini='.$mesini.'&diaini='.$diaini.'&anofim='.$anofim.'&mesfim='.$mesfim.'&diafim='.$diafim.'&tipo_popup='.$tipo_popup.'&tira_duplicidade='.$tira_duplicidade.'&procura=OK&repre='.$repre.'&time='.$time.'&where='.urlencode($where)."&campo=".urlencode($campo_prox1)."&campo_ant=".urlencode($campo1)."&vlr_campo=".trim($matriz[$matriz_aux['indice'][$x]][$campo1])."&campo_ant1=".urlencode($campo)."&vlr_campo1=".trim($matriz[$matriz_aux['indice'][$x]][$campo])."&desc_campo=".$desc_campo."&titulo_ant=".$titulo1."&monta_titulo=".urlEncode($monta_titulo)."&s_passa=".urlencode($s_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&tipo_nv=".$tipo_nv?>&campo_aux=<?print $campo_aux.$string_passa_get;?><?=$deondeCorretivo?>';javascript:style.background='<?print $corclick?>'"  onMouseOver="javascript:style.background='<?print $cor1?>';style.cursor='pointer';style.cursor='hand'" OnMouseOut="javascript:style.background='<?print $cor?>'"
     <?}?>
     >
     <?
     if ($campo_aux == "hora_minuto") {
     ?>
        <td nowrap align="<?print $align?>" <?if($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x+1]][$campo]){print "style='border-bottom:yes;'";}?> ><font class="<?print $fonte?>">&nbsp;   <? if (($matriz[$matriz_aux['indice'][$x]][$campo] != $matriz[$matriz_aux['indice'][$x-1]][$campo]) || (($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x-1]][$campo]) && ($matriz[$matriz_aux['indice'][$x]][$campo_extra] != $matriz[$matriz_aux['indice'][$x-1]][$campo_extra]))) { print retornaIntervaloHora(str_replace("¢", " / ", $campo_imprime));}?>&nbsp;</b></font></td>
     <?
     } else {
     ?>
        <td nowrap align="<?print $align?>" <?if($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x+1]][$campo]){print "style='border-bottom:yes;'";}?> ><font class="<?print $fonte?>">&nbsp;   <? if (($matriz[$matriz_aux['indice'][$x]][$campo] != $matriz[$matriz_aux['indice'][$x-1]][$campo]) || (($matriz[$matriz_aux['indice'][$x]][$campo] == $matriz[$matriz_aux['indice'][$x-1]][$campo]) && ($matriz[$matriz_aux['indice'][$x]][$campo_extra] != $matriz[$matriz_aux['indice'][$x-1]][$campo_extra]))) { print str_replace("¢", " / ", $campo_imprime); }?>&nbsp;</b></font></td>
     <?
     }
     ?>
        <?if($campo != $campo1) {?>
        <td nowrap align="<?print $align1?>"><font class="<?print $fonte?>">  <?print str_replace("¢"," / ",$campo_imprime1);?>&nbsp;</b></font></td>
        <?}?>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print $matriz[$matriz_aux['indice'][$x]]['qtd'];?></b></font></td>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL']);?></b></font></td>
        <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd']);?></b></font></td>
        <?if($imprime_duracao == "sim"){?>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print VerificaTime($time,$matriz[$matriz_aux['indice'][$x]]['duracao']);?></b></font></td>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO']);?></b></font></td>
           <td nowrap align="right"           ><font class="<?print $fonte?>">   <?print percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd']);?></b></font></td>
        <?}?>
     </tr>
     <?
     if($campo_extra){
       $campo1 = $campo1_aux;
     }
     $total_reg      += 1;
     $sub_total_reg  += 1;
     $sub_perc       += percent($matriz[$matriz_aux['indice'][$x]]['qtd'], $matriz['TOTAL']['qtd']);
     $sub_perc_tempo       += percent($matriz[$matriz_aux['indice'][$x]]['duracao'], $matriz['TOTAL_TEMPO']['qtd']);

     //print $matriz[$matriz_aux['indice'][$x]][$campo].$matriz[$matriz_aux['indice'][$x+1]][$campo];
     //print $campo."-".$campo1;
     if((($matriz[$matriz_aux['indice'][$x]][$campo]) != ($matriz[$matriz_aux['indice'][$x+1]][$campo])) && (($campo != "uf" && $campo != "concat(ddi,'¢',ddd)" && $campo != "prefixo_telefone" && $campo != "nb" )|| ($campo == "grupo" && $campo1 != $campo)|| ($campo == "nb" && $campo1 != $campo)|| ($campo == "uf" && $campo1 == "tipo_ligacao"))) {
       if ($campo_aux == "hora_minuto") {
         $desc_campo= urlEncode("<b> ".$titulo.": </b>".retornaIntervaloHora($campo_imprime))." -> ";
       } else {
         $desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";
       }
       $tabelao_rel.="<tr  bgcolor=".$session['td_destaque1'].">";
       $tabelao_rel.="   <td nowrap align='left'  style='border-right:none;'><font class=".$fonte.">SUBTOTAL</b></font></td>";
       if($campo != $campo1) {
         $tabelao_rel.="   <td nowrap align='left'  style='border-right:none;'><font class=".$fonte."></b></font></td>";
       }
       $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">".$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL']."</b></font></td>";
       $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">100.0 </b></font></td>";
       $tabelao_rel.="   <td nowrap align='right'                           ><font class=".$fonte.">".$sub_perc."</b></font></td>";
       $qtd_cols="5";
       if($imprime_duracao == "sim") {
         $qtd_cols="8";
         $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">".VerificaTime($time,$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO'])."</b></font></td>";
         $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">100.0</b></font></td>";
         $tabelao_rel.="<td nowrap align='right'><font class=".$fonte.">".$sub_perc_tempo."</b></font></td>";
       }
       $tabelao_rel.="</tr>";
       $tabelao_rel.="<tr><td colspan=".$qtd_cols." >&nbsp;</td></tr>";

       if($campo != $campo1) {
     ?>
       <tr  bgcolor="<?print $session['td_destaque1']?>"
       <?if((($session['origem']!="LIGBOLADA") || ($session['origem'] == $session['representante'])) && ($deonde != "DACNET" && $deonde!= "visao_personalizada_dac" && $deonde != "email_batch") ) {?>
          onMouseDown="window.location='<?print $prog_prox.'?deonde='.$deonde.'&anoini='.$anoini.'&mesini='.$mesini.'&diaini='.$diaini.'&anofim='.$anofim.'&mesfim='.$mesfim.'&diafim='.$diafim.'&tipo_popup='.$tipo_popup.'&tira_duplicidade='.$tira_duplicidade.'&procura=OK&repre='.$repre.'&time='.$time.'&where='.urlencode($where)."&campo=".urlencode($campo_prox)."&campo_ant=".urlencode($campo)."&vlr_campo=".trim($matriz[$matriz_aux['indice'][$x]][$campo])."&desc_campo=".$desc_campo."&titulo_ant=".$titulo."&monta_titulo=".urlEncode($monta_titulo)."&s_passa=".urlencode($s_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&tipo_nv=".$tipo_nv?>&campo_aux=<?print $campo_aux.$string_passa_get;?>';javascript:style.background='<?print $corclick?>'"  onMouseOver="javascript:style.background='<?print $cor1?>';style.cursor='pointer';style.cursor='hand'" OnMouseOut="javascript:style.background='<?print $session['td_destaque1']?>'"
       <?}?>
       >
                <td  align="left"  style='border-right:none;'><font class="<?print $fonte?>">SUBTOTAL&nbsp;</b></font></td>
                <?if($campo != $campo1){?>
                <td  align="left"  style='border-left:none;' ><font class="<?print $fonte?>">                                                                                            </b></font></td>
                <?}?>
                <td  align="right"                           ><font class="<?print $fonte?>">   <?print $matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL'];?>         </b></font></td>
                <td  align="right"                           ><font class="<?print $fonte?>">   <?print "100.0"?>                                                                        </b></font></td>
                <td  align="right"                           ><font class="<?print $fonte?>">   <?print $sub_perc;?>                                                                     </b></font></td>
                <?if($imprime_duracao == "sim"){?>
                  <td align="right"                           ><font class="<?print $fonte?>">   <?print VerificaTime($time,$matriz_sub[trim($matriz[$matriz_aux['indice'][$x]][$campo])]['SUBTOTAL_TEMPO']);?>   </b></font></td>
                  <td align="right"                           ><font class="<?print $fonte?>">   <?print "100.0"?>                                                                       </b></font></td>
                  <td align="right"                           ><font class="<?print $fonte?>">   <?print $sub_perc_tempo;?>                                                              </b></font></td>
                <?}?>
                </tr>
       <tr><td colspan=13 ><font class="<?print $fonte?>">&nbsp;&nbsp;</td></tr>
     <?
       }
       $sub_perc=0;
       $sub_perc_tempo=0;
       $sub_total_reg=0;
     }
     $campo_imprime  = "";
     $campo_imprime1 = "";
}
$tabelao_rel.="<tr bgcolor=".$session['td_destaque'].">";
$tabelao_rel.="   <td nowrap align=".$align."><font class='txt6'><font color=#FFFFFF><b>&nbsp;TOTAL</b></font></td>";
if($campo != $campo1){
  $tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".$total_reg."</b></font></td>";
}
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".$matriz['TOTAL']['qtd']."</b></font></td>";
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>-</b></font></td>";
$tabelao_rel.="   <td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>100.0</b></font></td>";
if($imprime_duracao == "sim"){
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>".VerificaTime($time,$matriz['TOTAL_TEMPO']['qtd'])."</b></font></td>";
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>-</b></font></td>";
  $tabelao_rel.="<td nowrap align='right'><font class='txt6'><font color=#FFFFFF><b>100.0</b></font></td>";
}
$tabelao_rel.="</tr>";
   ?>
     <tr bgcolor="<?print $session['td_destaque']?>">
        <td nowrap align="<?print $align?>"><font class="txt6"><b>   TOTAL                               </b></font></td>
        <?if($campo != $campo1){?>
        <td nowrap align="right"           ><font class="txt6"><b>   <?print $total_reg;?>               </b></font></td>
        <?}?>
        <td nowrap align="right"           ><font class="txt6"><b>   <?print $matriz['TOTAL']['qtd'];?>      </b></font></td>

        <td nowrap align="right"           ><font class="txt6"><b>   <?print "-";?>                      </b></font></td>
        <td nowrap align="right"           ><font class="txt6"><b>   <?print "100.0";?>                  </b></font></td>
        <?if($imprime_duracao == "sim"){?>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print VerificaTime($time,$matriz['TOTAL_TEMPO']['qtd']);?></b></font></td>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print "-";?>                      </b></font></td>
           <td nowrap align="right"           ><font class="txt6"><b>   <?print "100.0";?>                  </b></font></td>
        <?}?>
     </tr>
  </table>
<?if($deonde != "DACNET" && $deonde != "visao_personalizada"&& $deonde != "visao_personalizada_dac" && $deonde != "email_batch") {?>

  <BR>
  <form name="simula" method="post" action="dac_con_regiao_det_impressao.php" target="Janela">
     <input type="hidden" name="tabelao_rel"    value="<?print urlencode($tabelao_rel)?>">
     <input type="hidden" name="tabelao_titulo" value="<?print urlencode($tabelao_titulo)?>">
     <input type="hidden" name="tipo"           value="">
  </form>
<?/*********************************Tabela Com o Botão para impressão Funcao Imprime Relatório*************/?>
    <table align="center">
      <tr>
        <td align="center" nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Imprimir o Relatório" onClick="imprimeRelatorio('imprime')">
            <img src="imagens/print1.gif" width="20" align="botton" ><font class="txt5"><b>&nbsp;
        </td>
        <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório para o Excel" onClick="imprimeRelatorio('excel')">
          <center><img src="imagens/excel.gif" align="botton" ><font class="txt5"><b>&nbsp;</center>
        </td>
        <td>
        <?
        //$dados_array = substr($dados_array,1);
        $dados_array = substr($dados_array,0,StrLen($dados_array)-1);
        $legenda = substr($legenda,0,StrLen($legenda)-1);
        ?>
           <img  title="Grafico da Tabela" onmouseover="style.cursor='pointer';style.cursor='hand'" src="imagens/grafico_peq.gif" width="25" height="25" onClick="MostraGrafico(document.grafico)">
           <form name="grafico" method="POST"     target="JanelaGrafico" action="cc_graficos.php">
             <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
             <input type="hidden" name="legenda"         value="<?print $legenda?>">
             <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
          </form>
        </td>
        <td>
        </td>
        <!--<td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório em Formato PDF" onClick="imprimeRelatorio('pdf')">
          <center><img src="imagens/xx.gif" align="botton" ><font class="txt5"><b>&nbsp;</center>
        </td>-->
      </tr>
    </table>


<?
}
if($deonde== "visao_personalizada" || $deonde== "visao_personalizada_dac") {
  $dados_array = substr($dados_array,0,StrLen($dados_array)-1);
  $legenda     = substr($legenda,0,StrLen($legenda)-1);
  ?>
    </td>
    </tr>
  </table>

  <script language="Javascript">
  document.getElementById("div_grafico").innerHTML='<?print "<img src=\"cc_graficos_1.php?tituloX=Gráfico&width=300&height=200&align_legenda=left&legenda=".$legenda."&dados_array=".$dados_array."&titulo_grafico=".$titulo_grafico."&tipo_grafico=".$tipo_grafico."\">";?>';
  </script>

  <?
}
if($deonde== "email_batch") {
  $dados_array = substr($dados_array,0,StrLen($dados_array)-1);
  $legenda     = substr($legenda,0,StrLen($legenda)-1);
  ?>
    </td>
    </tr>
  </table>
<?print "<img src=\"cc_graficos_1.php?tituloX=Gráfico&width=300&height=200&align_legenda=left&legenda=".$legenda."&dados_array=".$dados_array."&titulo_grafico=".$titulo_grafico."&tipo_grafico=".$tipo_grafico."\">";?>

  <?
}




}else{
  if($mes_ini){
    print "<center><font class='txtvermelho'><b>Nenhum Registro Encontrado";
  }
}
//*********************************************************************************************************
//***************************-------TABELA DE BUSCA TODAS IGUAIS-------************************************
//*********************************************************************************************************
if($deonde != "DACNET" && $deonde != "visao_personalizada"&& $deonde != "visao_personalizada_dac" && $deonde != "email_batch") {
  if($pag == "1" || (!$dia_ini)) {


?>
   <form name="consulta" method="get" action="<?print $programa?>" onSubmit="return checa(this)">
   <input type="hidden" name="pag" value="1">
   <input type="hidden" name="procura" value="<?print $procura?>">
<?
$sql_pes         = "SELECT data_inicio_nivel FROM tbniveis where nivel = 'F2' ";
$query_pes       = mysql_query ($sql_pes, $connect);
    if($data_pes = mysql_fetch_array ($query_pes)){?>
       <input type="hidden" name="data_inicio_nivel" value="<?print $data_pes['data_inicio_nivel'];?>">
  <?}else{?>
       <input type="hidden" name="data_inicio_nivel" value="false">
  <?}
  $sql_pes         = "SELECT data_inclusao FROM tbadmin where login = '".$session['operador']."' ";
  $query_pes       = mysql_query ($sql_pes, $connect);
    if($data_pes        = mysql_fetch_array ($query_pes)){?>
       <input type="hidden" name="data_inicio_oper" value="<?print $data_pes['data_inclusao'];?>">
  <?}else{?>
       <input type="hidden" name="data_inicio_oper" value="false">
  <?}?>

   <table width="300" border="1" cellpadding="0" cellspacing="0" align="center"  bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
     <tr bgcolor="<?print $session['td_destaque']?>">
       <td colspan= "2" align="center"><font class="titcol"><b>
         Representante:<select name="repre" onchange="consulta.procura.value=''; document.consulta.submit()">
         <?print montaCombo("REPRE",$repre,$session['representante'])?>
         </select>
     <tr bgcolor="<?print $session['td_destaque1']?>">
     <td width="450">
       <table width="450" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
           <tr  >
              <td align="center" nowrap><font class="txt5"><b>Relatório:
                  <select name="relatorio" onChange="javascript:selecionaAction(this.value); consulta.procura.value=''; document.consulta.submit();" consistir="sempre" tipodado="preenchido" msg="Selecione o Relatório!">
                    <?
                      if($_SESSION["session"]["representante"] == "URANET-TVO" || $_SESSION["session"]["representante"] == "URANET-TWE" || $_SESSION["session"]["representante"] == "URANET-CPD" || $_SESSION["session"]["representante"] == "URANET-PRE") {
                        $repre_URARE = $_SESSION["session"]["representante"];
                      } else {
                        $repre_URARE = $repre;
                      }

                      print MontaCombo("URARE", $relatorio, $repre_URARE);
                    ?>
                  </select>
                  <input maxlength="3"  size="2"style="background:<?print $session['td_destaque1']?>;border:none;font=bold;text-align=right" type="text" name="qtd_lig" value="<?print $qtd_lig?>">
              </td>
              <td colspan="2"  nowrap align="center"><font class="txt5"><b></b>
                 <input type="radio" name="time"  value="min"<?if($time == "min" || $time == ""){print "checked";}?>><b>Minuto</b>
                 <input type="radio" name="time"  value="seg"<?if($time == "seg"){print "checked";}?>><b>Segundo</b>
              </td>
           </tr>
       </table>
       <table width="444" border="1" cellpadding="2" cellspacing="0" align="center"  bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>" >
         <tr bgcolor="<? $session['td_dado3']?>">
            <td colspan= "2">
              <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado2'];?>">
                  <tr bgcolor="<?print $session['td_dado2']?>">
                      <td width="50%" align="center">
                           <font class="txt5"><b>Hora Inicial:
                           <select name="hora_ini">
                               <?for ($i=0; $i<24; $i++){ ?><option value="<?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_ini, $i, "00");?>><?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                           </select><b>:</b>
                           <select name="min_ini" <?print $disabled?>>
                              <option value="00" <?if($min_ini == "00" || $min_fim == ""){ print "selected";}?>>00</option>
                              <option value="15" <?if($min_ini == "15"){ print "selected";}?>>15</option>
                              <option value="30" <?if($min_ini == "30"){ print "selected";}?>>30</option>
                              <option value="45" <?if($min_ini == "45"){ print "selected";}?>>45</option>
                           </select>
                      </td>
                         <td width="50%" align="center">
                           <font class="txt5"><b>Hora Final:
                           <select name="hora_fim">
                               <?for ($i=0; $i<=24; $i++){ ?><option value="<?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_fim, $i, "24");?>><?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                           </select><b>:</b>
                           <select name="min_fim" <?print $disabled?>>
                              <option value="00"<?if($min_fim == "00" || $min_fim == ""){ print "selected";}?> >00</option>
                              <option value="15"<?if($min_fim == "15"){ print "selected";}?> >15</option>
                              <option value="30"<?if($min_fim == "30"){ print "selected";}?> >30</option>
                              <option value="45"<?if($min_fim == "45"){ print "selected";}?> >45</option>
                           </select><b></b>
                      </td>
                      <?if($session["valida_versao"] == "FILTRO" || $sistema_identificacao == "teste"|| $session["operador"] == "bmc0002"){?>
                      <td rowspan="2"><?
                      require_once("/libs/func/VPFuncoes.php");
                      print VPFiltro($repre,$session["operador"],$session["tp_user"],"K29","dac_con_regiao_det.php");

                  ?>   </td>
                  <?}?>
                   </tr>
                  <tr bgcolor="<?print $session['td_dado2']?>">
                    <td  align="center" colspan="2"><font class="txt5">
               <?
               print dataCalendarioNovo("dia_ini","mes_ini","ano_ini","dia_fim","mes_fim","ano_fim","","","","consulta");
               ?>
                     </td>

                  </tr>
               </table>

            </td>
          </tr>
          <tr bgcolor="<?print $session['td_dado3']?>">
                <td  align="left"nowrap><font class="txt5"><b>DDD:</b>
                     <select name="ddd"   msg="Selecione um Produto!" <?print $disabled?>>
                      <?
                      $arr_ddd = Split(",",ValorSelecaoDDD($session["operador"]));

                      $x=0;
                      if($arr_ddd[0] != "----"){
                        While($arr_ddd[$x]){
                          if($x == "0"){
                            $where_ddd = $where_ddd." ddd in('".$arr_ddd[$x]."'";
                          }else{
                            $where_ddd = $where_ddd.",'".$arr_ddd[$x]."'";
                          }
                          $x++;
                        }
                        $where_ddd = $where_ddd." ) ";
                      }
                      $sql_pes        = "SELECT ddd,regiao FROM tblgcddd ".(($where_ddd) ? " WHERE {$where_ddd}" : "")." GROUP BY ddd";
                      $query_pes      = DescExecQuery($sql_pes, $connect3, 'N');
                      print "<option value='' selected>TODOS</option>";
                      while($ddd_pes  = mysql_fetch_array ($query_pes)){
                        if($ddd == $ddd_pes['ddd']){$selected = "selected";}
                        print "<option value='".$ddd_pes['ddd']."'".$selected.">".$ddd_pes['ddd']." - ".$ddd_pes['regiao']."</option>";
                        $selected = "";
                      }
                      ?>
                     </select>
                </td>
                <td  align="center" nowrap><font class="txt5"><b>Tel:</b>
                  <input type="text" name="tel_prefixo" id="tel_prefixo" value="<?print $tel_prefixo?>" size="5" maxlength="5"  onKeyUp="pula(this,5,tel_sufixo);">-<input type="text" name="tel_sufixo" value="<?print $tel_sufixo?>" size="5" maxlength="4" onblur="VerificaFone()">
                  <input type="hidden" name="tel_consulta" value="<?print $tel_consulta?>" consistir="sopreenchido" tipodado="telefone" minlength="1" msg="Preencha o Telefone Corretamente!" idAlvo="tel_prefixo">
                </td>


           </tr>
          <?
          if($tipo_telefone == "celular"){
            $color_celular  =  $session['td_dado1'];
            $color_fixo     =  $session['td_destaque'];
            $color_ambos    =  $session['td_destaque'];
            $font_celular   =  $session['td_destaque'];
            $font_fixo      =  $session['td_dado3'];
            $font_ambos     =  $session['td_dado3'];
          }else{
            if($tipo_telefone == "fixo"){
              $color_celular  = $session['td_destaque'];
              $color_fixo     = $session['td_dado1'];
              $color_ambos    = $session['td_destaque'];
              $font_celular   = $session['td_dado3'];
              $font_fixo      = $session['td_destaque'];
              $font_ambos     = $session['td_dado3'];
            }else{
              $color_celular  = $session['td_destaque'];
              $color_fixo     = $session['td_destaque'];
              $color_ambos    = $session['td_dado1'];
              $font_celular   = $session['td_dado3'];
              $font_fixo      = $session['td_dado3'];
              $font_ambos     = $session['td_destaque'];
            }
          }
          ?>
          <script language="javascript">
          <!--
          function VerificaTipoTel(obj_clica,outros1,outros2){
            document.consulta.tipo_telefone.value = obj_clica.name;

            obj_clica.style.background ='<?print $session['td_dado1']?>';
            obj_clica.style.color      ='<?print $session['td_destaque']?>';

            outros1.style.background   ='<?print $session['td_destaque']?>';
            outros1.style.color        ='<?print $session['td_dado1']?>';

            outros2.style.background   ='<?print $session['td_destaque']?>';
            outros2.style.color        ='<?print $session['td_dado1']?>';

          }
          -->
          </script>
           <!--
             <input type="hidden" name="tipo_telefone" <?if($tipo_telefone == ""){print "value='ambos'";}else{print "value='".$tipo_telefone."'";}?>>
             <?//onclick="VerificaTipoTel(this,document.consulta.fixo,document.consulta.celular)"   style="width='15';height='15'; background='<?print $color_ambos?>';color='<?print $font_ambos?>'""><b>Ambos</b>
             <?//onclick="VerificaTipoTel(this,document.consulta.ambos,document.consulta.celular)"  style="width='15';height='15'; background='<?print $color_fixo?>';color='<?print $font_fixo?>'""><b>Fixos</b>
           -->
           <tr bgcolor="<?print $session['td_dado3']?>">
             <?
             if($repre == "TELEFCOBRA"){?>
                <td  align="left" nowrap>
                     <font class="txt5"><b>Lote:</b>
                     <input type="text" name="qg_lote" value="<?print $qg_lote?>" size="8" maxlength="5"  >
                     <font class="txt5"><b>Nrc:</b>
                     <input type="text" name="qg_nrc"  value="<?print $qg_nrc?>"  size="15" maxlength="11"  >
                </td>
             <?}else{?>
             <td nowrap align="left" nowrap><font class="txt5"><b>Grupo:</b>
               <select name="grupo">
                <option value="">TODOS</option>
                <?print gambiDacGrupoOption($repre, $grupo);?>
                <?print MontaCombo("GRATE", $grupo, $repre, "A", "ZZ", "valor-descricao");?>
               </select>
             </td>
             <?}?>
             <td  align="left" nowrap  ><font class="txt5">
                <input type="radio" name="tipo_telefone" value="ambos"   <?if($tipo_telefone == "ambos" || $tipo_telefone == ""){print "checked";}?>><b>Todos</b>
                <input type="radio" name="tipo_telefone" value="fixo"    <?if($tipo_telefone == "fixo"                         ){print "checked";}?>><b>Fixo</b>
                <input type="radio" name="tipo_telefone" value="celular" <?if($tipo_telefone == "celular"                      ){print "checked";}?>><b>Cel</b>
                <input type="radio" name="tipo_telefone" value="ddi"     <?if($tipo_telefone == "ddi"                          ){print "checked";}?>><b>DDI</b>
             </td>
          </tr>
          <tr bgcolor="<?print $session['td_dado3']?>">

          <?
            if(!$atendimento){$atendimento = "R";}?>
             <td align="left" colspan="2"><font class="txt5"><b>
                Tipo de Ligação:
                <input type="radio" name="atd_radio" value="R" <?if($atendimento == "R"){print "CHECKED";}?> OnClick="CarregaAtend(this);">REC
                <input type="radio" name="atd_radio" value="A" <?if($atendimento == "A"){print "CHECKED";}?> OnClick="CarregaAtend(this);">ATV
                <input type="hidden" name="atendimento" value="<?print $atendimento;?>">
                <select name="st_atendimento" consistencia="" consistencia1="pre" msg="Selecione um Atendimento!">
                  <option <?if(!$st_atendimento){print "selected";}?> value="TODOS">TODOS</option>
                  <?print MontaCombo("URAL".$atendimento, $st_atendimento, $repre );?>
                </select>
             </td>
            </tr>
            <tr bgcolor="<?print $session['td_dado3']?>">
            <?



            /////******************************************************************************************//////
            ////*********************Verifica se o Repre tem a Classe URAST para montar o combo**********//////
            /////******************************************************************************************//////
            //MUDADO de ADSTV para URAST

            $q_aux = "SELECT COUNT(*) AS cont FROM tb_classe WHERE (cod_classe = 'URAST')  AND (representante = '".$repre."') AND (idioma='1') AND (tipo_reg='T') AND (status = 'A')";
            $query = mysql_query ($q_aux, $connect);
            $rec = mysql_fetch_array($query);
            $colspan = "2";
            if (($rec['cont'] != 0) || DefineRepre($session["representante"]) == "URANET"){
              $colspan = "";
              ?>
                 <td align="left"><font class="txt5"><b>Situação:&nbsp;&nbsp;
                  <select name="status" consistir="sempre" tipodado="preenchido" msg="Selecione uma Situação!">
                   <?if(!$status) { $status="T";} ?>
                   <?print MontaCombo("URAST", $status, $repre);?>
                  </select>
                 </td>

            <?}

            if (DefineRepre($session["representante"]) == "URANET"){
            ?>
             <td align="left" colspan="<?print $colspan;?>"><font class="txt5"><b>Grp/Máq:&nbsp;&nbsp;

                <select name="maquinas" consistir="sempre" tipodado="preenchido" msg="Selecione uma Máquina!">
                  <?if(!$maquinas){$maquinas="T";} ?>
                  <?print MontaCombo("URAMQ", $maquinas, $repre);?>
                </select>
             </td>
             <?}?>

            </tr>


<?
/*************************************************************/
// Verifica se tem URAFR, se tiver, monta o filtro
/*************************************************************/
$q = "SELECT vlr_classe,desc_classe FROM tb_classe WHERE cod_classe LIKE 'URAFR' AND representante = '".$repre."' ";
$q = DescQuery($q, $session["operador"], $_SERVER["PHP_SELF"]);
$query = mysql_query($q,$connect);
if ($rec = mysql_fetch_assoc($query)) {
  do {
    $mtr_existe_tlre9[$rec["vlr_classe"]] = $rec["desc_classe"];
  } while ($rec = mysql_fetch_assoc($query));
  $option_TLRE9    = MontaCombo("URAFR", $tipo_filtro_combo, $repre, "A");
  $titfiltroclasse = $titClasse;
}
/*************************************************************/
// Verifica se tem URAFR, se tiver, monta o filtro
/*************************************************************/
if (count((array)$mtr_existe_tlre9) > 0) {?>
  <tr bgcolor="<?print $session["td_dado1"];?>">
    <td colspan="2" nowrap class="txt5"><font class=\"txt5\"><strong>
      <?print $titfiltroclasse;?>:</strong></font>&nbsp;
      <select name="combo_condicao" id="combo_condicao">
        <?print $option_TLRE9;?>
      </select>
      <img align="absmiddle" vspace="0" src="imagens/ico_add.gif" width="15px" style="cursor:pointer;" onClick="AddFiltroAdicional();" title="Adicionar <?print $titfiltroclasse;?> Selecionado">&nbsp;
      <img align="absmiddle" vspace="0" src="imagens/ico_del.gif" width="15px" style="cursor:pointer;" onClick="RemoveTodos();"        title="Remover <?print $titfiltroclasse;?> Selecionado"  >
      <?if ($session["print_sql"] != "N") {?>
          &nbsp;<img align="absmiddle" vspace="0" src="imagens/ico_classe.gif" width="15px" style="cursor:pointer;" onClick="AbreJanela2('cc_classe_pesquisa_altera_inclui.php?consistencia2_inclui=simples&botao=recusa&classe=URAFR&repre=<?print $repre;?>&acesso=A', 'janelaLupa', 650, 350,'Mostra Classe')">
      <?}?>
    </td>
  </tr>
  <tr bgcolor="<?print $session["td_dado1"];?>">
    <input type="hidden" name="filtro_adicional"        id="id_filtro_adicional" value="<?print $filtro_adicional;?>">
    <input type="hidden" name="classe_filtro_adicional" id="id_classe_filtro"    value="URAFR">
    <td colspan="4" id="id_filtros_add" class="txt5" style="font-weight: bold;"><?
      if ($filtro_adicional){
        $array_filtros = explode("¢A¢",$filtro_adicional);
        foreach($array_filtros as $chave => $valor){
          if ($valor){
            $ajax_parametros = explode("§",$valor);

            $ajax_parametros_aux_cp = explode(",",$ajax_parametros[0]);
            $ajax_parametros[0]     = $ajax_parametros_aux_cp[0];
            $ajax_parametros_aux_cp = $ajax_parametros_aux_cp[1];

            if (is_array(${$ajax_parametros[0]."_filtro"})){
              foreach(${$ajax_parametros[0]."_filtro"} as $chave_fil => $valor_fil){
                print "<input type='hidden' name='".$ajax_parametros[0]."_filtro[".$chave_fil."]' value='".$valor_fil."'>";
              }
            } else {
              print "<input type='hidden' name='".$ajax_parametros[0]."_filtro' value='".${$ajax_parametros[0]."_filtro"}."'>";
            }

            if ($ajax_parametros_aux_cp){
              if (is_array(${$ajax_parametros_aux_cp."_filtro"})){
                foreach(${$ajax_parametros_aux_cp."_filtro"} as $chave_fil => $valor_fil){
                  print "<input type='hidden' name='".$ajax_parametros_aux_cp."_filtro[".$chave_fil."]' value='".$valor_fil."'>";
                }
              } else {
                print "<input type='hidden' name='".$ajax_parametros_aux_cp."_filtro' value='".${$ajax_parametros_aux_cp."_filtro"}."'>";
              }
            }
          }
        }?>
        <script language="javascript">
          AtuFiltroAdicional();
        </script><?
      }?>
    </td>
  </tr><?
} else {
  if ($session["print_sql"] != "N") {?>
    <tr bgcolor="<?print $session["td_dado1"];?>">
      <td align="left" nowrap colspan="2"><font class="txt5"><strong>Para parametrizar o filtro adicional, crie a classe <font color="Red">URAFR</font></strong></font></td>
    </tr><?
  }
}?>





<?
  //}
?>




















<?
/////******************************************************************************************//////
////****************Fim Verifica se o Repre tem a Classe "ADSTV" para montar o combo**********//////
/////******************************************************************************************//////

          ?>
         </table>
       </td>
       <td align="center" valign="top">
       <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session['td_destaque'];?>" bordercolordark="<?print $session['td_dado3'];?>">
           <tr>
           <?if(!$order_servico){$order_servico = 'vlr_classe';}
                $q_nbap2 = "SELECT COUNT(*) FROM tb_classe WHERE cod_classe = 'NBAP2' AND representante = '".$repre."' AND idioma = '1' AND tipo_reg = 'T' AND vlr_classe = '';";
                if ($query2 = DescExecQuery($q_nbap2, $connect)){
                  if($rec = mysql_fetch_assoc ($query2)){
                    if ($rec["COUNT(*)"] >= 1){
                      $mostra_nbap2 = true;
                    } else {
                      $mostra_nbap2 = false;
                      if($order_servico == "agrup_servicos"){
                        $order_servico = "vlr_classe";
                      }
                    }
                  }
                } else {
                  print mysql_error($connect);
                }
              ?>
              <td align="center" width="50%" nowrap><font class="txt5">
              <strong>Serviço:</strong>&nbsp;
                  <font class="txt5"><b>Abc<input type="radio" name="order_servico" value="desc_classe" <?if($order_servico == "desc_classe"){ print "checked";}?> onclick="document.consulta.submit()">
                  <font class="txt5"><b>123<input type="radio" name="order_servico" value="vlr_classe"  <?if($order_servico == "vlr_classe"){ print "checked";}?> onclick="document.consulta.submit()">
              </td>
              <td align="right" width="50%" align="center" nowrap><font class="txt5">
                <? if($mostra_nbap2 == true){ ?>
                  <input type="radio" name="order_servico" value="agrup_servicos" <?if($order_servico == "agrup_servicos"){ print "checked";}?> onclick="document.consulta.submit()">
                  <strong>Agrupar </strong>&nbsp;
                <? $st = true; } ?>
                     <? if(strpos($session['sub_niveis'], "A0D") != false){
                          if($st != true){ ?>
                            <strong>Agrupar </strong>&nbsp;
                        <? }
                         if($mostra_nbap2 == true){ ?>
                          <img onclick="incluiNBAP2('<? print $repre; ?>', 'S', '<? print ValorClasse("REPRE", $repre, "URANET"); ?>');" width="14" height="14" src="imagens/ico_classe.gif" title="Incluir Agrupamento" style="cursor: pointer;">
                      <? } elseif($session['representante'] == "URANET"){ ?>
                          <img onclick="incluiNBAP2('<? print $repre; ?>', 'N', '<? print ValorClasse("REPRE", $repre, "URANET"); ?>');" width="14" height="14" src="imagens/ico_classe.gif" title="Incluir Agrupamento" style="cursor: pointer;">
                      <? }
                     } ?>
              </td>
           </tr>
           <tr  >
             <td align="center" colspan="2"><font class="txt1"><b>
              <?if($order_servico == "agrup_servicos"){?>
              <input type="hidden" name="agrup_selecionado" id="agrup_selecionado" value="<? print $agrup_selecionado;?>">
              <?}?>
               <select <? if($order_servico != "agrup_servicos"){?> multiple <? }?> size="8" name="s[]" id='servico'  consistir="sempre" tipodado="preenchido" msg="Selecione o(s) Serviço(s)!" style="width: 100%" <? if($order_servico == "agrup_servicos"){?> onclick="mantemAgrup(this.value);" <?}?>>
                  <?
                  if($order_servico == "agrup_servicos"){
                    $agrupamentos = getArrayClasse("tb_classe", ConnectDB(), "descricao", "NBAP2", $repre, "A", "ZZ");
                    foreach ($agrupamentos["itens"] as $agrup){
                        unset($selected);
                        $desc_agrup = explode("¢", $agrup["descricao"]);
                        if($agrup["valor"] == $agrup_selecionado){
                          $selected = "selected";
                        }
                        print "<option value='".$agrup["valor"]."' ".$selected.">".$desc_agrup[0]."</option>";
                    }
                  } else {
                    print MontaLista("URANB", $s, $repre,"","",$order_servico,"");
                  }
                  ?>
               </select>
             </td>
           </tr>
           <tr>
              <td align="center" nowrap colspan="2" ><font class="txt5"><b>Tirar Duplicidade:
                <input type="radio" name="tira_duplicidade" value="sim" <?if($tira_duplicidade == "sim"  ){print "checked";}?>><b>Sim</b>
                <input type="radio" name="tira_duplicidade" value=""    <?if($tira_duplicidade == ""     ){print "checked";}?>><b>Não</b>
                <?
                if($repre == "BMC1" || $repre == "IMBRA" || $sistema_identificacao =="teste" ){
                  if($array_relatorio[1] == "parm_data" || $array_relatorio[1] == "tlig" ||  $array_relatorio[1] == "grupo2" ||  $array_relatorio[1] == "grupo_tipo" ) {
                    $visiblility_dupl = "visible";
                  }else{
                    $visiblility_dupl = "hidden";
                  }?>

                  <span  id='div_duplicidade' style="visibility:<?print $visiblility_dupl?>">

                  <input   type="radio" name="tira_duplicidade"  id="tira_duplicidade_imbra"  value="dup"    <?if($tira_duplicidade == "dup"     ){print "checked";}?>><b>Duplicidade Geral</b>
                  </span>
                  <?}?>


              </td>
           </tr>
       </table>
       </td>
       </tr>
       </table>
      <br><div align="center"><input type="button" name="enviar" id='bt_procurar' value="Enviar" onmousedown="VerificaForm()" class="but_proc_on"></div>
   </form>
<?
  }
}else{
     if($deonde == "visao_personalizada" && $pag==1) {
?>
      <form name='form_visao_personalizada' action="" method="GET" >
        <input type="hidden" name="carrega_dados" value="">

       <?if($ctritgl_vp){?>
        <input type="hidden" name="ctritgl_vp" value="<?print $ctritgl_vp?>">
        <?}else{
           foreach ($_REQUEST as $key_vp=>$vlr_vp){
             print "<input type='hidden' name='".$key_vp."' value='".$vlr_vp."'>";
           }
        }?>
        <input type="hidden" name="deonde" value="<?print $deonde?>">
        <input type="hidden" name="titulo" value="<?print $titulo?>">
        <input type="hidden" name="tipo_popup" value="<?print $tipo_popup?>">
        <input type="hidden" name="busca_form_vp" value="ok">



        <table width="600" cellspacing="0" cellpadding="2" border="1" align="center" style="border-collapse: collapse;">
          <tr>

            <td  width='30%' class="txt5" align="center"><B><?print "Data Ligação";?></b>
            <?/*?>
            <select name="parm_busca_dia" id="parm_busca_dia" consistencia="sempre" consistencia1="pre" msg="Selecione a Data!" style="width: 200;" OnChange="javascript:verificaData(this);">
                <?print MontaCombo($classe_TLRE5, $parm_busca_dia, DefineRepre($repre), "A", "ZD");?>
              </select>
              <?*/?>
            </td>

            <td class="txt5">
               <?
                require_once("funcoes/DataCalendario.php");
                print dataCalendarioDuplaV4("diaini","mesini","anoini","diafim","mesfim","anofim","","","","","S","","URANET",false);
               ?>
            </td>
          </tr>
         </table>
         <br>
         <div align="center"><input type="button" name="btnProcurar"    value=" Procurar " onclick="Javascript:enviaFormVisao();" onMouseOver="style.cursor='hand'" onMouseOut="style.cursor='default'" class="butprocon" <?print $botão_disabled?>></div>
      </form>

      <?
  }
}
?>
<?print GerarRodape($voltar);?>
</body>
<script language="javascript">ap_showWaitMessage('waitDiv', 0);</script>
</html>