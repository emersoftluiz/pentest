<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
include "cores.php";
require_once("gambi_dac_grupo_switch.php");
require_once("/libs/func/DateTime.php");

if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}
ini_set("memory_limit", "1024M");

$connect  = ConnectDB();
//$connect2 = ConnectLOGURA();
/************************************************************************************************************************
funcoes do programa*****************************************************************************************************
*************************************************************************************************************************/
if(!function_exists("VerificaTime")){
   function VerificaTime($time, $segundos){
      if($time == "seg"){
         return round($segundos);
      }else{
         return CalcTime($segundos);
      }
   }
}

if(!function_exists("percentTrafego")){
function percentTrafego($parcial , $total , $tipo_perc){
  if ($parcial == 0) {return 0;}
  if ($total   == 0) {return 0;}

  $aux = $parcial * 100;
  $percent = round ($aux / $total, 1);
  $ix = strpos ($percent, ".");
  $result = substr ($percent, 0, $ix + 2);
  if ((int) $ix == 0) {$result = $percent . '.0';}
  if($tipo_perc == "virgula"){
    $result = str_replace(".",",",$result);
  }
  return $result;
}

}


//print "<pre>";
//print_R($_GET );
//print "</pre>";



if (strrpos($_GET["where"], '&lt;&gt;')) {
  # code...
  $where = str_replace("&lt;&gt;", "<>", $_GET["where"]);
}


if ($_GET["tipo_popup"] == "AJ2") {
  $where = urldecode($_GET["where"]);
  $desc_campo = urldecode($_GET["desc_campo"]);
  $servico_passa = urldecode($_GET["servico_passa"]);
}

/*
if($flag_post){
$where         = urldecode($where);
$monta_titulo  = urldecode($monta_titulo);
$servico_passa = urldecode($servico_passa);
}
*/

/*
$q = "select vlr_classe,desc_classe,representante from tb_classe where cod_classe = 'URATF'";
$rec = DescExecQuery($q, $connect);
while($vlr = mysql_fetch_array($rec)){
   //  print  "<li>".$vlr["vlr_classe"].$vlr["representante"]."-----------".$vlr["desc_classe"];
   $matrix_tb_classe[$vlr["vlr_classe"].$vlr["representante"]] = $vlr["desc_classe"];
}
*/

function getParametro($param, $grupo, $data) {
  global $StrDataInicio, $StrDataFim, $connect2;
  static $arrURATF;

  if(!isset($arrURATF[$grupo])) {
   $q = "SELECT data_ligacao, tempo_ideal, nivel_ideal, tma_ideal, abandono_ideal, interv_aband, interv_fila, interv_tma FROM tb_param_uratf WHERE data_ligacao BETWEEN '".$StrDataInicio."' AND '".$StrDataFim."' AND grupo = '".$grupo."'";
    $query = DescExecQuery($q, $connect2);

    $arrURATF[$grupo]["ok"] = "S";

    while($rec = mysql_fetch_assoc($query)) {

      $arrURATF[$grupo][$rec["data_ligacao"]]["TEMPOIDEAL"   ] = $rec["tempo_ideal"   ];
      $arrURATF[$grupo][$rec["data_ligacao"]]["NIVELIDEAL"   ] = $rec["nivel_ideal"   ];
      $arrURATF[$grupo][$rec["data_ligacao"]]["TMAIDEAL"     ] = $rec["tma_ideal"     ];
      $arrURATF[$grupo][$rec["data_ligacao"]]["ABANDONOIDEAL"] = $rec["abandono_ideal"];
      $arrURATF[$grupo][$rec["data_ligacao"]]["INTERV_ABAND" ] = $rec["interv_aband"  ];
      $arrURATF[$grupo][$rec["data_ligacao"]]["INTERV_FILA"  ] = $rec["interv_fila"   ];
      $arrURATF[$grupo][$rec["data_ligacao"]]["INTERV_TMA"   ] = $rec["interv_tma"    ];

    }
  }

  $ret = $arrURATF[$grupo][$data][$param];
  if(!$ret) {
    return "0";
  } else {
    return $ret;
  }
/*
//   global $matrix_tb_classe;
   //  print "<br><br><br>".count($matrix_tb_classe);
   //print "<br>".$matrix_tb_classe[trim($grupo)."P-".$param.$repre]."<Br><Br>";
   if($matrix_tb_classe[trim($grupo)."P-".$param.$repre]){
      //print "<li>ACHOU ".trim($grupo)."P-".$param.$repre;
      return $matrix_tb_classe[trim($grupo)."P-".$param.$repre];
   }else{
      if($matrix_tb_classe[$param.$repre]){
         //print "<li>ACHOU ".$param.$repre;
         return $matrix_tb_classe[$param.$repre];

      }else{
         if($matrix_tb_classe[$param."URANET"]){
            //print "<li>ACHOU ".$param."URANET";
            return $matrix_tb_classe[$param."URANET"];
         }else{
            //print "<li>**********ACHOU 0".$param."-". $grupo."-".$repre;
            return "0";

         }

      }
   }
*/
}

function MontaMatrizCalendario($data_ini,$data_fim, $tipo_cale = '', $repre = 'URANET'){
   $connect = ConnectDB();
   $dia_ini = Substr($data_ini,8,2);
   $dia_fim = Substr($data_fim,8,2);
   $mes_ini = Substr($data_ini,5,2);
   $mes_fim = Substr($data_fim,5,2);
   $ano_ini = Substr($data_ini,0,4);
   $ano_fim = Substr($data_fim,0,4);

   if($tipo_cale == 'sac') {
    $repre_cale = $repre;
    $tabela_cale = 'tb_calendario_sac';
   } else {
    $repre_cale = 'URANET';
    $tabela_cale = 'tb_calendario';
   }

   if($mes < 10){$mes = "0".$mes;}
    $q = "SELECT * FROM ".$tabela_cale." WHERE ((cale_ano = '".$ano_ini."' and cale_mes >= '".$mes_ini."') and (cale_ano = '".$ano_fim."' and cale_mes <= '".$mes_fim."')) and representante = '".$repre_cale."'";

   $query = DescExecQuery($q, $connect)
   or die(mysql_error($connect));
   $x = 1;
   while ($rec = mysql_fetch_array($query)){
      for($dia=1;$dia <=31;$dia++){
         if($dia<10){$dia = "0".$dia;}
         $indice                  = $rec['cale_ano']."-".$rec['cale_mes']."-".$dia;
         $matriz[$indice]['vlr']    = $rec["dia_".$dia];
      }
   }
   return $matriz;
}

function verificaCorPerc($campo_func,$campo_func_tot){
   include "cores.php";
   $vlr_cor = Percent($campo_func,$campo_func_tot);
   if($vlr_cor < 50){
      $cor_return = $verde_claro;
   }else{
      if($vlr_cor >= 50 && $vlr_cor <= 99){
         $cor_return = $amarelo;
      }else{
         if($vlr_cor > 99){
            $cor_return = $vermelho;
         }else{
            $cor_return = "ERRO!";
         }
      }
   }
   return $cor_return;
}
function verificaCorPercNivel($campo_func,$campo_func_tot){
   include "cores.php";
   $vlr_cor = Percent($campo_func,$campo_func_tot);
   if($vlr_cor < 50){
      $cor_return = $vermelho;
   }else{
      if($vlr_cor >= 50 && $vlr_cor <= 99){
         $cor_return = $vermelho;
      }else{
         if($vlr_cor > 99){
            $cor_return = $verde_claro;
         }else{
            $cor_return = "ERRO!!!!";
         }
      }
   }
   return $cor_return;
}

//************************************************************************************************************************
//FIM das funcoes do programa*********************************************************************************************
//************************************************************************************************************************


//************************************************************************************************************************
//tratamento das variaveis  do programa***********************************************************************************
//************************************************************************************************************************

if(!$param_usa_resumo_aux){
   $param_usa_resumo_aux = $param_usa_resumo;
}

if($classe_servico == "URANB"){
   $classe_servico = "URANB";
   $campo_servico  = "nb";
   $desc_servico   = "Servico";
}else{
   $classe_servico = "GRATE";
   $campo_servico  = "grupo";
   $desc_servico   = "Grupo";
}

If ($StrDataInicio){
   $dia_ini  = Substr($StrDataInicio,"8","2");
   $mes_ini  = Substr($StrDataInicio,"5","2");
   $ano_ini  = Substr($StrDataInicio,"0","4");
   $dia_fim  = Substr($StrDataFim,"8","2");
   $mes_fim  = Substr($StrDataFim,"5","2");
   $ano_fim  = Substr($StrDataFim ,"0","4");
   $hora_ini = Substr($StrHoraInicio,"0","2");
   $min_ini  = Substr($StrHoraInicio,"3","5");
   $hora_fim = Substr($StrHoraFim,"0","2");
   $min_fim  = Substr($StrHoraFim,"3","5");
}else{
   $StrDataInicio = $ano_ini. '-' .$mes_ini.'-'.$dia_ini;
   $StrDataFim    = $ano_fim.'-'.$mes_fim.'-'.$dia_fim;
   $StrHoraInicio = $hora_ini.':'.$min_ini;
   $StrHoraFim    = $hora_fim.':'.$min_fim;
}

//Esta chamada à função ConnectLOGS tem que estar aqui devido às variáveis que ela utiliza
$connect2 = ConnectLOGS($repre, $ano_ini.$mes_ini);
switch($campo){
   case "trafego_maquina":
      $campo  = "concat(ura_grupo,'¢',grupo)";
      $campo_x  = ",concat(ura_grupo,'¢',grupo)";
      $campo_pes = "hora_ligacao_det";
      $titulo = "Maquina";
      $q = "select vlr_classe from tb_classe where cod_classe='URAT2' and  desc_classe ='Primeira Tela' and tipo_reg= 'I' and representante = '".$repre."' and status = 'U' ";
      $rec = DescExecQuery($q, $connect);
      if($vlr = mysql_fetch_array($rec)){
         $relatorio_prim_tela      = $vlr["vlr_classe"];
         $monta_relatorio_aux      = $vlr["vlr_classe"];
      } else {
         $q = "select vlr_classe from tb_classe where cod_classe='URAT2' and  desc_classe ='Primeira Tela' and tipo_reg= 'I' and representante = 'URANET' and status = 'U' ";
         $rec = DescExecQuery($q, $connect);
         if($vlr = mysql_fetch_array($rec)){
            $monta_relatorio_aux      = $vlr["vlr_classe"];
         } else {
            print "FAVOR INCLUIR O PARAMETRO DA PRIMEIRA TELA NA CLASSE URAT2";
            exit;
         }
      }
      $arr_colunas = split("=",$monta_relatorio_aux);
      $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

      break;


   case "dimen_transf":
      $campo  = "concat(grupo,'¢',grupo_transferencia)";
      $campo_x  = ",concat(grupo,'¢',grupo_transferencia)";
      $campo_pes = "hora_ligacao_det";
      $titulo = "Grupo";
      break;

   case "trafego_grupo":
      $campo  = "grupo";
      $campo_pes = "hora_ligacao_det";
      $titulo = "Grupo";
      $q = "select vlr_classe from tb_classe where cod_classe='URAT2' and  desc_classe ='Primeira Tela' and tipo_reg= 'I' and representante = '".$repre."' and status = 'U' ";
      $rec = DescExecQuery($q, $connect);
      if($vlr = mysql_fetch_array($rec)){
         $relatorio_prim_tela      = $vlr["vlr_classe"];
         $monta_relatorio_aux      = $vlr["vlr_classe"];
      }else{
         $q = "select vlr_classe from tb_classe where cod_classe='URAT2' and  desc_classe ='Primeira Tela' and tipo_reg= 'I' and representante = 'URANET' and status = 'U' ";
         $rec = DescExecQuery($q, $connect);
         if($vlr = mysql_fetch_array($rec)){
            $monta_relatorio_aux      = $vlr["vlr_classe"];
         }else{
            print "FAVOR INCLUIR O PARAMETRO DA PRIMEIRA TELA NA CLASSE URAT2";
            exit;
         }
      }
      $arr_colunas = split("=",$monta_relatorio_aux);
      $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

      break;
   case "trafego":
      $campo  = "data_ligacao";
      $campo_pes = "hora_ligacao_det";
      $titulo = "Data";
      $campo_pesquisa_Select = "";
      $arr_colunas = split("=",$relatorio);
      $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);
      break;
   case "hora_ligacao";
   $campo = "hora_ligacao";
   $campo_pes = "hora_ligacao_det";
   $titulo = "<img src='imagens/1hora.gif' width='15' height='15' align='center'> Hora";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;
   case "hora_ligacao_grupo";
   $campo = "hora_ligacao_grupo";
   $campo_pes = "hora_ligacao_det";
   $titulo = "<img src='imagens/1hora.gif' width='15' height='15' align='center'> Hora";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;
   case "hora_ligacao_30_grupo";
   $campo = "hora_ligacao_30_grupo";
   $campo_pes = "hora_ligacao_30_grupo";
   $titulo = "<img src='imagens/6hora.gif' width='15' height='15' align='center'> Grupo - 30  Minutos";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;
   case "hora_ligacao_30";
   $campo = "hora_ligacao_30";
   $campo_pes = "hora_ligacao_30";
   $titulo = "<img src='imagens/6hora.gif' width='15' height='15' align='center'>30 Minutos";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;

   case "hora_ligacao_15_grupo";
   $campo = "hora_ligacao_15_grupo";
   $campo_pes = "hora_ligacao_15_grupo";
   $titulo = "<img src='imagens/3hora.gif' width='15' height='15' align='center'>Grupo - 15 Minutos";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;
   case "hora_ligacao_15";
   $campo = "hora_ligacao_15";
   $campo_pes = "hora_ligacao_15";
   $titulo = "<img src='imagens/3hora.gif' width='15' height='15' align='center'>15 Minutos";
   $arr_colunas = split("=",$relatorio);
   $monta_colunas = substr($arr_colunas[1],1,StrLen($arr_colunas[1])-2);

   break;
}

if(!$monta_colunas){
   $monta_colunas   = '1,2,3,4,5,6,7,8,9,10,11,12,20,13,14,15,16,17,18,19';
   if($session["operador"]== "adm"){
      $monta_colunas   .= ",21,22,23";
   }
}
$arr_monta_colunas = split(",",$monta_colunas);


//************************************************************************************************************************
//fim do tratamento das variaveis  do programa****************************************************************************
//************************************************************************************************************************




//*************************************************************************************************
//************************************ ---- Preparando o Where ------ *****************************
//*************************************************************************************************

$where = str_replace("\'" , "'" ,$where);
if($desc_campo !=  urldecode("%3Cb%3E+Grupo%3A+%3C%2Fb%3E+TODOS+OS+GRUPOS%20->%20")){
   if(trim($vlr_campo)){
      if($campo_ant == "hora_ligacao_ini"){
         $where = $where."and ".$campo_ant." like '".trim($vlr_campo)."%' and ".$campo_ant1." = '".trim($vlr_campo1)."' ";
      }else{
         $where = $where."and ".$campo_ant." ='".trim($vlr_campo)."'";
      }
   }
}

//*************************************************************************************************
//************************************ ---- FIM do Preparando o Where ------ **********************
//*************************************************************************************************












//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//************************************ ----LOGICA DE ARMAZENAMENTO DA MATRIZ **********************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************

//zerando variaveis na primeira vez
$indice_menor_movimento                       = 1000000000;
$indice_maior_movimento                       = 0;
$matriz["total"]["abandonadas_ura"]           = 0;
$matriz["total"]["ligacoes"]                  = 0;
$matriz["total"]["oferecidas"]                = 0;
$matriz["total"]["ocupadas"]                  = 0;
$matriz["total"]["atendidas"]                 = 0;
$matriz["total"]["atendidas_operador"]        = 0;
$matriz["total"]["atendidas_velocidade"]      = 0;
$matriz["total"]["atendidas_operador_20"]     = 0;
$matriz["total"]["atendidas_operador_40"]     = 0;
$matriz["total"]["atendidas_operador_60"]     = 0;
$matriz["total"]["atendidas_operador_80"]     = 0;
$matriz["total"]["atendidas_operador_m80"]    = 0;
$matriz["total"]["atendidas_maior_tmc"]       = 0;
$matriz["total"]["atendidas_fila_maior_tmc"]  = 0;
$matriz["total"]["atendidas_fila_0"]          = 0;
$matriz["total"]["atendidas_fila_20"]         = 0;
$matriz["total"]["atendidas_fila_40"]         = 0;
$matriz["total"]["atendidas_fila_60"]         = 0;
$matriz["total"]["atendidas_fila_80"]         = 0;
$matriz["total"]["atendidas_fila_m80"]        = 0;
$matriz["total"]["atendidas_tempo_ideal"]     = 0;
$matriz["total"]["atendidas_tempo_nao_ideal"] = 0;
$matriz["total"]["abandonadas"]               = 0;
$matriz["total"]["abandonadas_cliente"]       = 0;
$matriz["total"]["abandonadas_maior_tmc"]     = 0;
$matriz["total"]["abandonadas_cliente_20"]    = 0;
$matriz["total"]["abandonadas_cliente_40"]    = 0;
$matriz["total"]["abandonadas_cliente_60"]    = 0;
$matriz["total"]["abandonadas_cliente_80"]    = 0;
$matriz["total"]["abandonadas_cliente_m80"]   = 0;
$matriz["total"]["efetuadas"]                 = 0;
$matriz["total"]["leads"]                     = 0;
$matriz["total"]["efetuadas_operador"]        = 0;
$matriz["total"]["tempo_tot_breack"]          = 0;
$matriz["total"]["agentes_total"]             = 0;
$matriz["total"]["agentes_disponivel"]        = 0;
$matriz["total"]["agentes_receptivo"]         = 0;
$matriz["total"]["agentes_ativo"]             = 0;
$matriz["total"]["agentes_pausa_break"]       = 0;
$matriz["total"]["agentes_suspenso"]          = 0;

$y = 0;
$param_diferentes = false;

if($periodo_pesq == 'sac' || $periodo_pesq == 'no_sac') {
  $cale = MontaMatrizCalendario($StrDataInicio,$StrDataFim, 'sac', $repre);  
} else {
  $cale = MontaMatrizCalendario($StrDataInicio,$StrDataFim);  
}



//logica de loop nos dias para fazer as querys dia a dia
$ano_mes_ini = substr($ano_ini, 2, 2).$mes_ini;
$ano_mes_fim = substr($ano_fim, 2, 2).$mes_fim;

if($ano_mes_ini <= $ano_mes_fim && $mes_ini != ""){
   $ano_mes = $ano_mes_ini;
   while($ano_mes <= $ano_mes_fim){
      if($ano_mes == $ano_mes_ini && $ano_mes == $ano_mes_fim){
         $dia_procura     = $dia_ini+0;
         $dia_procura_fim = $dia_fim+0;
      }else{
         if($ano_mes == $ano_mes_ini && $ano_mes < $ano_mes_fim ){
            $dia_procura = $dia_ini+0;
            $dia_procura_fim = 31;
         }else{
            if($ano_mes > $ano_mes_ini && $ano_mes == $ano_mes_fim ){
               $dia_procura = 1;
               $dia_procura_fim = $dia_fim+0;
            }else{
               if($ano_mes > $ano_mes_ini && $ano_mes < $ano_mes_fim ){
                  $dia_procura = 1;
                  $dia_procura_fim = 31;
               }else{
               }
            }
         }
      }
      //loop em todos os dias para fazer as querys

      while($dia_procura <= $dia_procura_fim){


         $dia_procura = ($dia_procura+0);
         //monta where do dia para ser pego na chave
         if($dia_procura <10){$dia_procura = "0".$dia_procura;}
         $where_dia_procura = "and data_ligacao = '20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura."'";

         switch($periodo_pesq) {
            case "sab":
               if (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "D")) {
                  $dia_procura++;
                  continue 2;
               }
               break;
            case "sex":
               if (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "S") || ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "D")) {
                  $dia_procura++;
                  continue 2;
               }
               break;
            case "fds":
               if (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "S") && ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "D")&& ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "F")) {
                  $dia_procura++;
                  continue 2;
               }
               break;
            case "sac":

            if (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "E") && ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "O") && ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "M") && ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] != "2")) {
                  $dia_procura++;
                  continue 2;
               }
               break;

          case "no_sac":

            if (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "E") || ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "O") || ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "M") || ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "2")) {
                  $dia_procura++;
                  continue 2;
               }
               break;

         }
         if($cons_feriado == "nao" && (($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "F") || ($cale["20".substr($ano_mes,0,2)."-".substr($ano_mes,2)."-".$dia_procura]['vlr'] == "I") )){
            $dia_procura++;
            continue;
         }

         //verifica nbs do where existente faz o destrinchamento para montar um array de nbs para fazer outro loop
         //por nb assim temdo 2 loops um por data outro por nb dentro da data
         if(StrPos($where, $campo_servico." in(")){
            for($x=StrPos($where, $campo_servico." in(");($char_where != ")" && $x < 4000)  ;$x++ ){
               $char_where = Substr($where,$x,1);
               $string_nb .= $char_where;
            }
         }

         $string_nb_arr = Str_Replace("'","",$string_nb);
         $string_nb_arr = Str_Replace($campo_servico." in(","",$string_nb_arr);
         $string_nb_arr = Str_Replace(")","",$string_nb_arr);
         $arr_nb = Split(",",$string_nb_arr);





         if($StrDataInicio > "2006-07-01"){
            $campos_agentes = " , agentes_disponivel,agentes_ativo,agentes_receptivo,agentes_total,agentes_pausa_break,agentes_suspenso,qtd_atualizacao ";
         }



         //loop nos nbs, esse loop eh realizado a cada data do loop acima
         for($x_nb=0;$arr_nb[$x_nb];$x_nb++){
            $where_nb = Str_Replace($string_nb," ".$campo_servico." = '".$arr_nb[$x_nb]."'",$where);
            $where_nb = Str_Replace("AND data_ligacao BETWEEN '".$StrDataInicio."' AND '".$StrDataFim."'"," ",$where_nb);

            $where_nb = gambiAcertaGrupo($where_nb);


            // if($repre == "BICBANCO" && $campo == "data_ligacao") {
            //   $param_usa_resumo_aux = "N";
            // } 
            //VERIFICA SE É RESUMO OU NÃO
            //se resumo vai na loguraXXXXR
            //senao vai na logura normal
            if($param_usa_resumo_aux == "S"){
               if($campo == "hora_ligacao_30" || $campo == "hora_ligacao_15"){
                  $campo_hora = ", LEFT(hora_ligacao_ini, 5) AS ".$campo." ";
               }elseif($campo == "hora_ligacao_30_grupo" || $campo == "hora_ligacao_15_grupo"){
                  $campo_hora = ", concat(grupo,LEFT(hora_ligacao_ini, 5)) AS ".$campo." ";
                }elseif($campo == "hora_ligacao_grupo"){
                  $campo_hora = ", concat(grupo,LEFT(hora_ligacao_ini, 2),':00') AS ".$campo." ";
               }else{
                  $campo_hora = "";
               }

// print "<li>".$repre; 
// if($repre == "BICBANCO" && $campo == "data_ligacao") {
//   $tabela_logura = "logura".$ano_mes;
//   $where_dia_procura = str_replace("dia_ligacao", "data_ligacao", $where_dia_procura);
//   $campo_data = "data_ligacao";
//   $campo_hora = "hora_ligacao_ini";
//   $campo_fila = "duracao_fila";
//   $campo_resposta = "";
//   $qtd_fila = "qtd_ligacao";
// } else {
//   $tabela_logura = "logura".$ano_mes."R ";
//   $campo_data = "data_ligacao";
//   $campo_hora = "hora_ligacao";
//   $campo_fila = "duracao_abfila";
//   $campo_resposta = "duracao_resposta,";
//   $qtd_fila = "qtd_ligacao_fila";
// }
// print "<li>".$where_dia_procura;
               //LOGURA RESUMO
          $sql = "SELECT ".
                        "data_ligacao        , tipo_ligacao    , hora_ligacao_ini    , grupo               , ".
                        "dia_ligacao         , tipo_atendimento, hora_ligacao        , duracao_ligacao     , ".
                        "duracao_fila        , duracao_abfila  , duracao_operador    , duracao_resposta    , ".
                        "qtd_ligacao AS total, qtd_ligacao_fila, qtd_ligacao_operador, qtd_ligacao_abfila  , ".
                        "tempo_maior_chamada , tempo_maior_fila, tempo_maior_abfila  , tempo_maior_operador, ".
                        "tempo_maior_resposta, interv_tma      , qtd_tma_1           , qtd_tma_2           , ".
                        "qtd_tma_3           , qtd_tma_4       , qtd_tma_mais        , interv_fila         , ".
                        "qtd_atend_fila_1    , qtd_atend_fila_2, qtd_atend_fila_3    , qtd_atend_fila_4    , ".
                        "qtd_atend_fila_mais , interv_aband    , qtd_abfila_1        , qtd_abfila_2        , ".
                        "qtd_abfila_3        , qtd_abfila_4    , qtd_abfila_mais     , qtd_operador_ideal  , ".
                        "qtd_abfila_ideal    , ideal_tempo_fila, ideal_tma   ".$campo_hora." ".$campos_agentes." ".
                      "FROM logura".$ano_mes."R ".$where_nb." ".$where_dia_procura;
            }else{
               //LOGURA COMPLETA
               $sql = " SELECT COUNT(*) AS total , COUNT(*) AS qtd_ligacao_operador       , data_ligacao      , tipo_atendimento ,".
               "       tipo_ligacao      , duracao_fila AS tempo_maior_abfila      , duracao_ligacao  , duracao_operador  ,".
               "       duracao_fila      , duracao_operador AS tempo_maior_operador, grupo ".$campo_x."            , login_operador    ,".
               "       hora_operador_ini , duracao_fila AS tempo_maior_fila        , hora_ligacao_ini                     ,".
               "                           left(hora_ligacao_ini,2) as hora_ligacao                                       ,".
               "                           left(hora_ligacao_ini,5) as ".$campo_pes."                                         ".
               " FROM logura".$ano_mes." ".$where_nb." ".$where_dia_procura.
               " GROUP BY  data_ligacao    ,tipo_atendimento   ,tipo_ligacao   ,duracao_ligacao                           ,".
               "          duracao_operador,duracao_fila,grupo , login_operador, hora_operador_ini                         ,".
               "          hora_ligacao_ini,hora_ligacao  ".$campo_x."     ,".$campo_pes;
            }

            
            $sql = DescQuery($sql, $session["operador"], $PHP_SELF);
            //imprime a primeira query para nao imprimir todas
            if($session["print_sql"] == "S" /*&& !$imprimiu_query*/){
               print  "<font class='txt5'><b>".$arr_nb[$x_nb]."-</b>".$sql."<br></font>";
               $imprimiu_query = true;
            }
            
            if($rec = DescExecQuery($sql, $connect2)){
               if($vlr = mysql_fetch_array($rec)){
                  $c=0;
                  do{
                     $c++;
                     //**********************VERIFICA QUAL O CAMPO PARA MONTAR O INDICE
                     switch($campo){

                        case "hora_ligacao_grupo"://monta o indice de 30 rm 30 minutoa
                        $campo_horario_aux = substr($vlr[$campo],-5);

                        $indice = substr($vlr[$campo],0,-5)." - ".ValorClasse("GRATE",substr($vlr[$campo],0,-5),$repre)."-".$campo_horario_aux;


                        break;
                        case "hora_ligacao_30_grupo"://monta o indice de 30 rm 30 minutoa
                        unset($indice);
                        $hora    = $vlr["hora_ligacao"].":00";
                        $hora_29 = $vlr["hora_ligacao"].":29";
                        $hora_59 = $vlr["hora_ligacao"].":59";


                        $campo_horario_aux = substr($vlr[$campo],-5);

                        if(($campo_horario_aux >= $hora) && ($campo_horario_aux <= $hora_29) ){
                           $indice =  $hora."hs - ".$hora_29."hs";
                        }else{
                           if(($campo_horario_aux >= $hora_29) && ($campo_horario_aux <= $hora_59) ){
                              $indice = substr($hora_29,0,2).":30hs - ".$hora_59."hs";
                           }else{
                              print "ERRO!";
                           }
                        }

                        $indice = substr($vlr[$campo],0,-5)." - ".ValorClasse("GRATE",substr($vlr[$campo],0,-5),$repre)."-".$indice;


                        break;
                        case "hora_ligacao_30"://monta o indice de 30 rm 30 minutoa
                        $hora    = $vlr["hora_ligacao"].":00";
                        $hora_29 = $vlr["hora_ligacao"].":29";
                        $hora_59 = $vlr["hora_ligacao"].":59";

                        if(($vlr[$campo] >= $hora) && ($vlr[$campo] <= $hora_29) ){
                           $indice =  $hora."hs - ".$hora_29."hs";
                        }else{
                           if(($vlr[$campo] >= $hora_29) && ($vlr[$campo] <= $hora_59) ){
                              $indice = substr($hora_29,0,2).":30hs - ".$hora_59."hs";
                           }else{
                              print "ERRO!";
                           }
                        }
                        break;



                        case "hora_ligacao_15"://monta o indice de 15 em 15 minutoa
                        $hora = $vlr["hora_ligacao"].":00";
                        $hora_14 = $vlr["hora_ligacao"].":14";
                        $hora_29 = $vlr["hora_ligacao"].":29";
                        $hora_44 = $vlr["hora_ligacao"].":44";
                        $hora_59 = $vlr["hora_ligacao"].":59";
                        if(($vlr[$campo] >= $hora) && ($vlr[$campo] <= $hora_14) ){
                           $indice =  $hora."hs - ".$hora_14."hs";
                        }else{
                           if(($vlr[$campo] >= $hora_14) && ($vlr[$campo] <= $hora_29) ){
                              $indice =  substr($hora_14,0,2).":15hs - ".$hora_29."hs";
                           }else{
                              if(($vlr[$campo] >= $hora_29) && ($vlr[$campo] <= $hora_44) ){
                                 $indice =  substr($hora_29,0,2).":30hs - ".$hora_44."hs";
                              }else{
                                 if(($vlr[$campo] >= $hora_44) && ($vlr[$campo] <= $hora_59) ){
                                    $indice =  substr($hora_44,0,2).":45hs - ".$hora_59."hs";
                                 }else{
                                    print "ERRO!";
                                 }
                              }
                           }
                        }
                        break;

                        case "hora_ligacao_15_grupo"://monta o indice de 15 em 15 minutoa
                        $hora = $vlr["hora_ligacao"].":00";
                        $hora_14 = $vlr["hora_ligacao"].":14";
                        $hora_29 = $vlr["hora_ligacao"].":29";
                        $hora_44 = $vlr["hora_ligacao"].":44";
                        $hora_59 = $vlr["hora_ligacao"].":59";


                        $campo_horario_aux = substr($vlr[$campo],-5);
                        if(($campo_horario_aux >= $hora) && ($campo_horario_aux <= $hora_14) ){
                           $indice =  $hora."hs - ".$hora_14."hs";
                        }else{
                           if(($campo_horario_aux >= $hora_14) && ($campo_horario_aux <= $hora_29) ){
                              $indice =  substr($hora_14,0,2).":15hs - ".$hora_29."hs";
                           }else{
                              if(($campo_horario_aux >= $hora_29) && ($campo_horario_aux <= $hora_44) ){
                                 $indice =  substr($hora_29,0,2).":30hs - ".$hora_44."hs";
                              }else{
                                 if(($campo_horario_aux >= $hora_44) && ($campo_horario_aux <= $hora_59) ){
                                    $indice =  substr($hora_44,0,2).":45hs - ".$hora_59."hs";
                                 }else{
                                    print "ERRO!";
                                 }
                              }
                           }
                        }
                        $indice = substr($vlr[$campo],0,-5)." - ".ValorClasse("GRATE",substr($vlr[$campo],0,-5),$repre)."-".$indice;

                        break;
                        default://monta Sendo o campo determinado no parametro
                        $indice = $vlr[$campo];
                        break;
                     }
                     //****************************************************************




                     if($data_ant != $vlr["data_ligacao"]){
                        $data_ant = $vlr["data_ligacao"];
                        $qtd_dias++;
                     }


                     if($param_usa_resumo_aux == "S"){
                       //atribui os parametros vindo da loguraR.
                        $intervalo_parametro_tma   = $vlr["interv_tma"      ];
                        $intervalo_parametro_fila  = $vlr["interv_fila"     ];
                        $intervalo_parametro_aband = $vlr["interv_aband"    ];
                        $tempo_ideal               = $vlr["ideal_tempo_fila"];
                        $tma_ideal                 = $vlr["ideal_tma"       ];
                     }else{
                       //atribui os parametros vindo da tb_param_uratf.
                       $intervalo_parametro_tma   = getParametro("INTERV_TMA"  , $vlr["grupo"], $vlr["data_ligacao"]);
                       $intervalo_parametro_fila  = getParametro("INTERV_FILA" , $vlr["grupo"], $vlr["data_ligacao"]);
                       $intervalo_parametro_aband = getParametro("INTERV_ABAND", $vlr["grupo"], $vlr["data_ligacao"]);
                       $tempo_ideal               = getParametro("TEMPOIDEAL"  , $vlr["grupo"], $vlr["data_ligacao"]);
                       $tma_ideal                 = getParametro("TMAIDEAL"    , $vlr["grupo"], $vlr["data_ligacao"]);
                     }

                     $nivel_servico_ideal         = getParametro("NIVELIDEAL"   , $vlr["grupo"], $vlr["data_ligacao"]);
                     $abandono_ideal              = getParametro("ABANDONOIDEAL", $vlr["grupo"], $vlr["data_ligacao"]);

                     //echo "Grupo: |".$vlr["grupo"]."|-- Repre: |".$repre."|-- PARAM_USA_RESUMO_AUX: |".$param_usa_resumo_aux."|-- TEMPO_IDEAL: |".$tempo_ideal."|<br>";

                     if($tempo_ideal == " -- " || $tempo_ideal == ""){
                        $tempo_ideal = 0;
                     }
                     if($nivel_servico_ideal == " -- " || $nivel_servico_ideal == ""){
                        $nivel_servico_ideal=0;
                     }
                     if($abandono_ideal == " -- " || $abandono_ideal == ""){
                        $abandono_ideal = 0;
                     }
                     if($tma_ideal == " -- " || $tma_ideal == ""){
                        $tma_ideal=0;
                     }

                     $matriz[$indice]["intervalo_parametro_tma"]   = $intervalo_parametro_tma  ;
                     $matriz[$indice]["intervalo_parametro_fila"]  = $intervalo_parametro_fila ;
                     $matriz[$indice]["intervalo_parametro_aband"] = $intervalo_parametro_aband;
                     //              print $indice."-(".$tempo_ideal.")";
                     $matriz[$indice]["tempo_ideal"]               = $tempo_ideal;
                     $matriz[$indice]["nivel_servico_ideal"]       = $nivel_servico_ideal ;
                     $matriz[$indice]["abandono_ideal"]            = $abandono_ideal ;
                     $matriz[$indice]["tma_ideal"]                 = $tma_ideal ;



                     if(($y > 0)&&(
                     ($matriz[$matriz_aux["indice"][($y-1)]]["intervalo_parametro_tma"]   <> $intervalo_parametro_tma   && $intervalo_parametro_tma       <> 0) ||
                     ($matriz[$matriz_aux["indice"][($y-1)]]["tma_ideal"]                 <> $tma_ideal                 && $tma_ideal                     <> 0) ||
                     ($matriz[$matriz_aux["indice"][($y-1)]]["tempo_ideal"]               <> $tempo_ideal               && $tempo_ideal                   <> 0) ||
                     ($matriz[$matriz_aux["indice"][($y-1)]]["intervalo_parametro_fila"]  <> $intervalo_parametro_fila  && $intervalo_parametro_fila      <> 0) ||
                     ($matriz[$matriz_aux["indice"][($y-1)]]["intervalo_parametro_aband"] <> $intervalo_parametro_aband && $intervalo_parametro_aband     <> 0) )){
                        $param_diferentes = true;
                     }

                     //tratamento das variaveis de controle dos parametros
                     $interv_tma[1]   = $intervalo_parametro_tma;
                     $interv_tma[2]   = $intervalo_parametro_tma * 2;
                     $interv_tma[3]   = $intervalo_parametro_tma * 3;
                     $interv_tma[4]   = $intervalo_parametro_tma * 4;
                     
                     $interv_fila[1]  = $intervalo_parametro_fila;
                     $interv_fila[2]  = $intervalo_parametro_fila * 2;
                     $interv_fila[3]  = $intervalo_parametro_fila * 3;
                     $interv_fila[4]  = $intervalo_parametro_fila * 4;
                     
                     $interv_aband[1] = $intervalo_parametro_aband;
                     $interv_aband[2] = $intervalo_parametro_aband * 2;
                     $interv_aband[3] = $intervalo_parametro_aband * 3;
                     $interv_aband[4] = $intervalo_parametro_aband * 4;

                     if((BuscaNaMatriz($matriz_aux["indice"] , $indice) == -1)) {
                        $matriz_aux["indice"][$y] = $indice;
                        if($y > $tot_matriz){$tot_matriz = $y;}
                        $y++;
                        //*******Zerando as Variaveis para o relatorio nao ficar em branco**************

                        $matriz[$indice]["abandonadas_ura"]           = 0;
                        $matriz[$indice]["ligacoes"]                  = 0;
                        $matriz[$indice]["oferecidas"]                = 0;
                        $matriz[$indice]["ocupadas"]                  = 0;
                        $matriz[$indice]["atendidas"]                 = 0;
                        $matriz[$indice]["atendidas_operador"]        = 0;
                        $matriz[$indice]["atendidas_velocidade"]      = 0;
                        $matriz[$indice]["atendidas_operador_20"]     = 0;
                        $matriz[$indice]["atendidas_operador_40"]     = 0;
                        $matriz[$indice]["atendidas_operador_60"]     = 0;
                        $matriz[$indice]["atendidas_operador_80"]     = 0;
                        $matriz[$indice]["atendidas_operador_m80"]    = 0;
                        $matriz[$indice]["atendidas_maior_tmc"]       = 0;
                        $matriz[$indice]["atendidas_fila_maior_tmc"]  = 0;
                        $matriz[$indice]["atendidas_fila_0"]          = 0;
                        $matriz[$indice]["atendidas_fila_20"]         = 0;
                        $matriz[$indice]["atendidas_fila_40"]         = 0;
                        $matriz[$indice]["atendidas_fila_60"]         = 0;
                        $matriz[$indice]["atendidas_fila_80"]         = 0;
                        $matriz[$indice]["atendidas_fila_m80"]        = 0;
                        $matriz[$indice]["atendidas_tempo_ideal"]     = 0;
                        $matriz[$indice]["atendidas_tempo_nao_ideal"] = 0;
                        
                        $matriz[$indice]["abandonadas"]               = 0;
                        $matriz[$indice]["abandonadas_cliente"]       = 0;
                        $matriz[$indice]["abandonadas_maior_tmc"]     = 0;
                        $matriz[$indice]["abandonadas_cliente_20"]    = 0;
                        $matriz[$indice]["abandonadas_cliente_40"]    = 0;
                        $matriz[$indice]["abandonadas_cliente_60"]    = 0;
                        $matriz[$indice]["abandonadas_cliente_80"]    = 0;
                        $matriz[$indice]["abandonadas_cliente_m80"]   = 0;
                        $matriz[$indice]["efetuadas"]                 = 0;
                        $matriz[$indice]["leads"]                     = 0;
                        $matriz[$indice]["efetuadas_operador"]        = 0;
                        $matriz[$indice]["tempo_tot_breack"]          = 0;
                        $matriz[$indice]["agentes_total"]             = 0;
                     }




                     $tipo_atendimento = trim($vlr["tipo_atendimento"]);
                     if($vlr["grupo"]){
                        $matriz[$indice]["ligacoes"] += $vlr["total"];
                        $matriz["total"]["ligacoes"] += $vlr["total"];
                        if($matriz[$indice]["ligacoes"] > $indice_maior_movimento){
                           $indice_maior_movimento = $matriz[$indice]["ligacoes"];
                        }
                        if($matriz[$indice]["ligacoes"] > 0 && $matriz[$indice]["ligacoes"] < $indice_menor_movimento ){
                           $indice_menor_movimento = $matriz[$indice]["ligacoes"];
                        }
                     }


                     //TOTAL DE AGENTES TRABALHANDO NO MOMENTO
                     $matriz[$indice]["agentes_total"]       += $vlr["agentes_total"];
                     $matriz["total"]["agentes_total"]       += $vlr["agentes_total"];
                     
                     
                     $matriz[$indice]["agentes_disponivel"]  += $vlr["agentes_disponivel"];
                     $matriz["total"]["agentes_disponivel"]  += $vlr["agentes_disponivel"];
                     
                     $matriz[$indice]["agentes_receptivo"]   += $vlr["agentes_receptivo"];
                     $matriz["total"]["agentes_receptivo"]   += $vlr["agentes_receptivo"];
                     
                     $matriz[$indice]["agentes_ativo"]       += $vlr["agentes_ativo"];
                     $matriz["total"]["agentes_ativo"]       += $vlr["agentes_ativo"];
                     
                     $matriz[$indice]["agentes_pausa_break"] += $vlr["agentes_pausa_break"];
                     $matriz["total"]["agentes_pausa_break"] += $vlr["agentes_pausa_break"];
                     
                     $matriz[$indice]["agentes_suspenso"]    += $vlr["agentes_suspenso"];
                     $matriz["total"]["agentes_suspenso"]    += $vlr["agentes_suspenso"];




                     $matriz[$indice]["qtd_atualizacao"]  += $vlr["qtd_atualizacao"];
                     $matriz["total"]["qtd_atualizacao"]  += $vlr["qtd_atualizacao"];


                     //IF DE CHAMADAS ATENDIDAS***************************************************************************
                     if((trim($vlr["tipo_atendimento"]) == "R" || trim($vlr["tipo_atendimento"]) == "H") && (trim($vlr['tipo_ligacao']) == "002" || trim($vlr['tipo_ligacao']) == "003"  || trim($vlr['tipo_ligacao']) == "018") ) {
                        /*
                        --->   Reclamação Metlife, não estava somando as rediscagens
                        //                   $matriz[$indice]["atendidas"         ] += $vlr["qtd_ligacao_operador"];
                        //                   $matriz["total"]["oferecidas"        ] += $vlr["qtd_ligacao_operador"];
                        alfredo */
                        $matriz[$indice]["atendidas"         ] += $vlr["total"];
                        $matriz["total"]["oferecidas"        ] += $vlr["total"];
                        $matriz[$indice]["atendidas_operador"] += $vlr["duracao_operador"    ];

                        $matriz["total"]["atendidas"         ] += $vlr["total"           ];
                        $matriz["total"]["atendidas_operador"] += $vlr["duracao_operador"];

                        $matriz[$indice]["tempo_fila"] += $vlr["duracao_fila"];
                        $matriz["total"]["tempo_fila"] += $vlr["duracao_fila"];

                        if($matriz[$indice]["atendidas_maior_tmc"] < $vlr["tempo_maior_operador"]){
                           $matriz[$indice]["atendidas_maior_tmc"] = $vlr["tempo_maior_operador"];
                        }

                        if($matriz["total"]["atendidas_maior_tmc"] < $vlr["tempo_maior_operador"]){
                           $matriz["total"]["atendidas_maior_tmc"] = $vlr["tempo_maior_operador"];
                        }

                        if($matriz[$indice]["atendidas_fila_maior_tmc"] < $vlr["tempo_maior_fila"]){
                           $matriz[$indice]["atendidas_fila_maior_tmc"] = $vlr["tempo_maior_fila"];
                        }

                        if($matriz["total"]["atendidas_fila_maior_tmc"] < $vlr["tempo_maior_fila"]){
                           $matriz["total"]["atendidas_fila_maior_tmc"] = $vlr["tempo_maior_fila"];
                        }

                        if($param_usa_resumo_aux == "S"){
                           $matriz[$indice]["atendidas_velocidade"  ] += $vlr["duracao_resposta"];
                           $matriz["total"]["atendidas_velocidade"  ] += $vlr["duracao_resposta"];

                           /*****************************************************************/
                           /*********************** Colunas do TMA quebradas pelo parâmetro */
                           /*****************************************************************/
                           $aux = $vlr["total"] - $vlr["qtd_tma_2"] - $vlr["qtd_tma_3"] - $vlr["qtd_tma_4"] - $vlr["qtd_tma_mais"];
                           $matriz[$indice]["atendidas_operador_20" ] += $aux;
                           $matriz["total"]["atendidas_operador_20" ] += $aux;

                           $matriz[$indice]["atendidas_operador_40" ] += $vlr["qtd_tma_2"];
                           $matriz["total"]["atendidas_operador_40" ] += $vlr["qtd_tma_2"];

                           $matriz[$indice]["atendidas_operador_60" ] += $vlr["qtd_tma_3"];
                           $matriz["total"]["atendidas_operador_60" ] += $vlr["qtd_tma_3"];

                           $matriz[$indice]["atendidas_operador_80" ] += $vlr["qtd_tma_4"];
                           $matriz["total"]["atendidas_operador_80" ] += $vlr["qtd_tma_4"];

                           $matriz[$indice]["atendidas_operador_m80"] += $vlr["qtd_tma_mais"];
                           $matriz["total"]["atendidas_operador_m80"] += $vlr["qtd_tma_mais"];
                           /*****************************************************************/
                           /******************* FIM Colunas do TMA quebradas pelo parâmetro */
                           /*****************************************************************/

                           /*****************************************************************/
                           /********* Colunas do atendidos na fila quebradas pelo parâmetro */
                           /*****************************************************************/
                           /*
                           --->   Reclamação Metlife, não estava somando as rediscagens
                           //                     $matriz[$indice]["atendidas_fila_0"] += ($vlr["qtd_ligacao_operador"] - $vlr["qtd_ligacao_fila"]);
                           //                     $matriz["total"]["atendidas_fila_0"] += ($vlr["qtd_ligacao_operador"] - $vlr["qtd_ligacao_fila"]);
                           */
//                           $aaaaaa = "<li>".$matriz[$indice]["atendidas_fila_0"]." + ".$vlr["total"]." - ".$vlr["qtd_ligacao_fila"]." = ".($matriz[$indice]["atendidas_fila_0"] + $vlr["total"] - $vlr["qtd_ligacao_fila"])."§";
//                           echo $aaaaaa;
                           $matriz[$indice]["atendidas_fila_0"]   += ($vlr["total"] - $vlr["qtd_ligacao_fila"]);
                           $matriz["total"]["atendidas_fila_0"]   += ($vlr["total"] - $vlr["qtd_ligacao_fila"]);
                           
                           $matriz[$indice]["atendidas_fila_20" ] += $vlr["qtd_atend_fila_1"];
                           $matriz["total"]["atendidas_fila_20" ] += $vlr["qtd_atend_fila_1"];
                           
                           $matriz[$indice]["atendidas_fila_40" ] += $vlr["qtd_atend_fila_2"];
                           $matriz["total"]["atendidas_fila_40" ] += $vlr["qtd_atend_fila_2"];
                           
                           $matriz[$indice]["atendidas_fila_60" ] += $vlr["qtd_atend_fila_3"];
                           $matriz["total"]["atendidas_fila_60" ] += $vlr["qtd_atend_fila_3"];
                           
                           $matriz[$indice]["atendidas_fila_80" ] += $vlr["qtd_atend_fila_4"];
                           $matriz["total"]["atendidas_fila_80" ] += $vlr["qtd_atend_fila_4"];
                           
                           $matriz[$indice]["atendidas_fila_m80"] += $vlr["qtd_atend_fila_mais"];
                           $matriz["total"]["atendidas_fila_m80"] += $vlr["qtd_atend_fila_mais"];
                           /*****************************************************************/
                           /***** FIM Colunas do atendidos na fila quebradas pelo parâmetro */
                           /*****************************************************************/

                           /*****************************************************************/
                           /********************************************** Nível de Serviço */
                           /*****************************************************************/
                           /*
                           --->   Estava com problema no nível de serviço
                           $matriz[$indice]["atendidas_tempo_ideal"] = $matriz[$indice]["atendidas_fila_0"] + $matriz[$indice]["atendidas_fila_20"];
                           $matriz["total"]["atendidas_tempo_ideal"] = $matriz["total"]["atendidas_fila_0"] + $matriz["total"]["atendidas_fila_20"];
                           */
                           $matriz[$indice]["atendidas_tempo_ideal"] += $vlr["qtd_operador_ideal"];
                           $matriz["total"]["atendidas_tempo_ideal"] += $vlr["qtd_operador_ideal"];

                           /*
                           --->   Estava com problema no nível de serviço
                           //                     $matriz[$indice]["atendidas_tempo_nao_ideal"] += $vlr["qtd_ligacao_operador"] - $vlr["qtd_operador_ideal"];
                           //                     $matriz["total"]["atendidas_tempo_nao_ideal"] += $vlr["qtd_ligacao_operador"] - $vlr["qtd_operador_ideal"];
                           */

                           $matriz[$indice]["atendidas_tempo_nao_ideal"] = $matriz[$indice]["atendidas"] - $matriz[$indice]["atendidas_tempo_ideal"];
                           $matriz["total"]["atendidas_tempo_nao_ideal"] = $matriz["total"]["atendidas"] - $matriz["total"]["atendidas_tempo_ideal"];

                           /*****************************************************************/
                           /****************************************** FIM Nível de Serviço */
                           /*****************************************************************/
                        }else{
                           /*****************************************************************/
                           /*************************************** Tempo médio de resposta */
                           /*****************************************************************/
                           if($vlr["hora_operador_ini"] != "00:00:00"){
                              $matriz[$indice]["atendidas_velocidade"] += CalculaSegundos($vlr["hora_operador_ini"]) - CalculaSegundos($vlr["hora_ligacao_ini"]);
                              $matriz["total"]["atendidas_velocidade"] += CalculaSegundos($vlr["hora_operador_ini"]) - CalculaSegundos($vlr["hora_ligacao_ini"]);
                           }
                           /*****************************************************************/
                           /*********************************** FIM Tempo médio de resposta */
                           /*****************************************************************/

                           /*****************************************************************/
                           /*********************** Colunas do TMA quebradas pelo parâmetro */
                           /*****************************************************************/
                           if($vlr["duracao_operador"] <= $interv_tma[1]) {
                              $matriz[$indice]["atendidas_operador_20"] += $vlr["total"];
                              $matriz["total"]["atendidas_operador_20"] += $vlr["total"];
                           }else{
                              if($vlr["duracao_operador"] <= $interv_tma[2]){
                                 $matriz[$indice]["atendidas_operador_40"] += $vlr["total"];
                                 $matriz["total"]["atendidas_operador_40"] += $vlr["total"];
                              }else{
                                 if($vlr["duracao_operador"] <= $interv_tma[3]){
                                    $matriz[$indice]["atendidas_operador_60"] += $vlr["total"];
                                    $matriz["total"]["atendidas_operador_60"] += $vlr["total"];
                                 }else{
                                    if($vlr["duracao_operador"] <= $interv_tma[4]){
                                       $matriz[$indice]["atendidas_operador_80"] += $vlr["total"];
                                       $matriz["total"]["atendidas_operador_80"] += $vlr["total"];
                                    }else{
                                       $matriz[$indice]["atendidas_operador_m80"] += $vlr["total"];
                                       $matriz["total"]["atendidas_operador_m80"] += $vlr["total"];
                                    }
                                 }
                              }
                           }
                           /*****************************************************************/
                           /******************* FIM Colunas do TMA quebradas pelo parâmetro */
                           /*****************************************************************/

                           /*****************************************************************/
                           /********* Colunas do atendidos na fila quebradas pelo parâmetro */
                           /*****************************************************************/
                           if($vlr["duracao_fila"] > 0){
                              if($vlr["duracao_fila"] <= $interv_fila[1]){
                                 $matriz[$indice]["atendidas_fila_20"] += $vlr["total"];
                                 $matriz["total"]["atendidas_fila_20"] += $vlr["total"];
                              }else{
                                 if($vlr["duracao_fila"] <= $interv_fila[2]){
                                    $matriz[$indice]["atendidas_fila_40"] += $vlr["total"];
                                    $matriz["total"]["atendidas_fila_40"] += $vlr["total"];
                                 }else{
                                    if($vlr["duracao_fila"] <= $interv_fila[3]){
                                       $matriz[$indice]["atendidas_fila_60"] += $vlr["total"];
                                       $matriz["total"]["atendidas_fila_60"] += $vlr["total"];
                                    }else{
                                       if($vlr["duracao_fila"] <= $interv_fila[4]){
                                          $matriz[$indice]["atendidas_fila_80"] += $vlr["total"];
                                          $matriz["total"]["atendidas_fila_80"] += $vlr["total"];
                                       }else{
                                          $matriz[$indice]["atendidas_fila_m80"] += $vlr["total"];
                                          $matriz["total"]["atendidas_fila_m80"] += $vlr["total"];
                                       }
                                    }
                                 }
                              }
                           }else{
                              $matriz[$indice]["atendidas_fila_0"] += $vlr["total"];
                              $matriz["total"]["atendidas_fila_0"] += $vlr["total"];
                           }
                           /*****************************************************************/
                           /***** FIM Colunas do atendidos na fila quebradas pelo parâmetro */
                           /*****************************************************************/

                           /*****************************************************************/
                           /********************************************** Nível de Serviço */
                           /*****************************************************************/
                           if($vlr["duracao_fila"] <= $tempo_ideal){
                              $matriz[$indice]["atendidas_tempo_ideal"] += $vlr["total"];
                              $matriz["total"]["atendidas_tempo_ideal"] += $vlr["total"];
                           }else{
                              $matriz[$indice]["atendidas_tempo_nao_ideal"] += $vlr["total"];
                              $matriz["total"]["atendidas_tempo_nao_ideal"] += $vlr["total"];
                           }
                           /*****************************************************************/
                           /****************************************** FIM Nível de Serviço */
                           /*****************************************************************/
                        }
                     }else{

                        //IF DE CHAMADAS ABANDONADAS***************************************************************************
                        if((trim($vlr["tipo_atendimento"]) == "R" || trim($vlr["tipo_atendimento"]) == "H") && ((trim($vlr["tipo_ligacao"]) == "013") || (trim($vlr["tipo_ligacao"]) == "004") || (trim($vlr["tipo_ligacao"]) == "028") || (trim($vlr["tipo_ligacao"]) == "007") || (trim($vlr["tipo_ligacao"]) == "013") || (trim($vlr["tipo_ligacao"]) == "020") || (trim($vlr["tipo_ligacao"]) == "022") || (trim($vlr["tipo_ligacao"]) == "521") || (trim($vlr["tipo_ligacao"]) == "528") )) {
                           //Coluna Abandonadas com Tempo Médio

                           if((trim($vlr["tipo_ligacao"]) == "004") || (trim($vlr["tipo_ligacao"]) == "013") || (trim($vlr["tipo_ligacao"]) == "007") || (trim($vlr["tipo_ligacao"]) == "020") || (trim($vlr["tipo_ligacao"]) == "022")   ) {
                              $matriz[$indice]["abandonadas_ura"]  += $vlr["total"];
                              $matriz["total"]["abandonadas_ura"]  += $vlr["total"];
                           }else{
                              $matriz[$indice]["abandonadas"        ] += $vlr["total"          ];
                              $matriz["total"]["oferecidas"         ] += $vlr["total"          ];
                              $matriz["total"]["abandonadas"        ] += $vlr["total"          ];
                           }

                           if($matriz[$indice]["abandonadas_maior_tmc"] < $vlr["tempo_maior_abfila"]){
                              $matriz[$indice]["abandonadas_maior_tmc"] = $vlr["tempo_maior_abfila"];
                           }

                           if($matriz["total"]["abandonadas_maior_tmc"] < $vlr["tempo_maior_abfila"]){
                              $matriz["total"]["abandonadas_maior_tmc"] = $vlr["tempo_maior_abfila"];
                           }

                           if((trim($vlr['tipo_ligacao']) == "028") ){
                              $matriz[$indice]["abandonadas_cliente"] += $vlr["duracao_fila"];
                              $matriz["total"]["abandonadas_cliente"] += $vlr["duracao_fila"];

                              if($param_usa_resumo_aux == "S"){
                                 $matriz[$indice]["abandonadas_cliente_20" ] += $vlr["qtd_abfila_1"];
                                 $matriz["total"]["abandonadas_cliente_20" ] += $vlr["qtd_abfila_1"];
                                 
                                 $matriz[$indice]["abandonadas_cliente_40" ] += $vlr["qtd_abfila_2"];
                                 $matriz["total"]["abandonadas_cliente_40" ] += $vlr["qtd_abfila_2"];
                                 
                                 $matriz[$indice]["abandonadas_cliente_60" ] += $vlr["qtd_abfila_3"];
                                 $matriz["total"]["abandonadas_cliente_60" ] += $vlr["qtd_abfila_3"];
                                 
                                 $matriz[$indice]["abandonadas_cliente_80" ] += $vlr["qtd_abfila_4"];
                                 $matriz["total"]["abandonadas_cliente_80" ] += $vlr["qtd_abfila_4"];
                                 
                                 $matriz[$indice]["abandonadas_cliente_m80"] += $vlr["qtd_abfila_mais"];
                                 $matriz["total"]["abandonadas_cliente_m80"] += $vlr["qtd_abfila_mais"];

                                 $matriz[$indice]["abandonadas_ideal"] += $vlr["qtd_abfila_ideal"];
                                 $matriz["total"]["abandonadas_ideal"] += $vlr["qtd_abfila_ideal"];
                                 
                                 $matriz[$indice]["duracao_atd_fila"]  += $vlr["duracao_ligacao"];
                                 $matriz["total"]["duracao_atd_fila"]  += $vlr["duracao_ligacao"];


                              }else{
                                 if($vlr["duracao_fila"] <= $tempo_ideal){
                                    $matriz[$indice]["abandonadas_ideal"] += $vlr["total"];
                                    $matriz["total"]["abandonadas_ideal"] += $vlr["total"];
                                 }

                                 if($vlr["duracao_fila"] >= 0 && $vlr["duracao_fila"] <= $interv_aband[1]){
                                    $matriz[$indice]["abandonadas_cliente_20"] += $vlr["total"];
                                    $matriz["total"]  ["abandonadas_cliente_20"] += $vlr["total"];
                                 }else{
                                    if($vlr["duracao_fila"] <= $interv_aband[2]){
                                       $matriz[$indice]["abandonadas_cliente_40"] += $vlr["total"];
                                       $matriz["total"]["abandonadas_cliente_40"] += $vlr["total"];
                                    }else{
                                       if($vlr["duracao_fila"] <= $interv_aband[3]){
                                          $matriz[$indice]["abandonadas_cliente_60"] += $vlr["total"];
                                          $matriz["total"]["abandonadas_cliente_60"] += $vlr["total"];
                                       }else{
                                          if($vlr["duracao_fila"] <= $interv_aband[4]){
                                             $matriz[$indice]["abandonadas_cliente_80"] += $vlr["total"];
                                             $matriz["total"]["abandonadas_cliente_80"] += $vlr["total"];
                                          }else{
                                             $matriz[$indice]["abandonadas_cliente_m80"] += $vlr["total"];
                                             $matriz["total"]["abandonadas_cliente_m80"] += $vlr["total"];
                                          }
                                       }
                                    }
                                 }

                              }
                           }

                        } else {
                           //IF DE CHAMADAS EFETUADAS***************************************************************************
                           if((trim($vlr['tipo_atendimento']) == "R") && ((trim($vlr['tipo_ligacao']) == "010"))  ) {
                              $matriz[$indice]["leads"]               += $vlr["total"];
                              $matriz["total"]["leads"]               += $vlr["total"];
                           }else{

                           //IF DE CHAMADAS EFETUADAS***************************************************************************
                           if((trim($vlr['tipo_atendimento']) == "A") && ((trim($vlr['tipo_ligacao']) == "001") || (trim($vlr['tipo_ligacao']) == "003")  )) {
                              $matriz[$indice]["efetuadas"]          += $vlr["total"];
                              $matriz[$indice]["efetuadas_operador"] += $vlr['duracao_operador'];
                              $matriz["total"]["efetuadas"]          += $vlr["total"];
                              $matriz["total"]["efetuadas_operador"] += $vlr['duracao_operador'];
                              //Coluna Atendidas com Tempo Medio
                              if($vlr['duracao_operador'] <= $interv_tma[1]){
                                 $matriz[$indice]["atendidas_operador_20"]   += $vlr["total"];
                                 $matriz["total"]  ["atendidas_operador_20"] += $vlr["total"];
                              }
                              if($vlr['duracao_operador'] > $interv_tma[1] && $vlr['duracao_operador'] <= $interv_tma[2]){
                                 $matriz[$indice]["atendidas_operador_40"]   += $vlr["total"];
                                 $matriz["total"]  ["atendidas_operador_40"] += $vlr["total"];
                              }
                              if($vlr['duracao_operador'] > $interv_tma[2] && $vlr['duracao_operador'] <= $interv_tma[3]){
                                 $matriz[$indice]["atendidas_operador_60"]   += $vlr["total"];
                                 $matriz["total"]  ["atendidas_operador_60"] += $vlr["total"];
                              }
                              if($vlr['duracao_operador'] > $interv_tma[3] && $vlr['duracao_operador'] <= $interv_tma[4]){
                                 $matriz[$indice]["atendidas_operador_80"]   += $vlr["total"];
                                 $matriz["total"]  ["atendidas_operador_80"] += $vlr["total"];
                              }
                              if($vlr['duracao_operador'] > $interv_tma[4]){
                                 $matriz[$indice]["atendidas_operador_m80"]   += $vlr["total"];
                                 $matriz["total"]  ["atendidas_operador_m80"] += $vlr["total"];
                              }
                              ///////////
                           } else {
                              //OCUPADAS


                              if($cons_bloq == "sim"){
                              if((trim($vlr['tipo_atendimento']) == "R" || trim($vlr['tipo_atendimento']) == "H") && (trim($vlr['tipo_ligacao']) == "034" || trim($vlr['tipo_ligacao']) == "006" || trim($vlr['tipo_ligacao']) == "502" || trim($vlr['tipo_ligacao']) == "503" ) ){
                                 $matriz[$indice]["ocupadas"  ] += $vlr["total"];
                                 $matriz["total"]["ocupadas"  ] += $vlr["total"];
                                 $matriz["total"]["oferecidas"] += $vlr["total"];
                              }else{
                                 //print trim($vlr['tipo_ligacao'])."-<br>";
                              }
                              }else{

                              if((trim($vlr['tipo_atendimento']) == "R" || trim($vlr['tipo_atendimento']) == "H") && (trim($vlr['tipo_ligacao']) == "006" || trim($vlr['tipo_ligacao']) == "502" || trim($vlr['tipo_ligacao']) == "503" ) ){
                                 $matriz[$indice]["ocupadas"  ] += $vlr["total"];
                                 $matriz["total"]["ocupadas"  ] += $vlr["total"];
                                 $matriz["total"]["oferecidas"] += $vlr["total"];
                              }else{
                                 //print trim($vlr['tipo_ligacao'])."-<br>";
                              }
                              }
                           }
                           }
                        }
                     }
                     $matriz[$indice]["oferecidas"]  = $matriz[$indice]["atendidas"] + $matriz[$indice]["abandonadas"]+ $matriz[$indice]["ocupadas"];
                  }while($vlr  = mysql_fetch_array($rec));
                  //   print date("H:i:s")."---";
               }else{
                  $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
               }
            }else{
               if($session["operador"] == "adm"){
                  $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Tabela<br>";
               }else{
                  $msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
               }
            }
         }//fim do loop dos nbs
         $dia_procura++;
      }//fim do loop do dia a dia do mes

      $ano_mes = inc_ano_mes($ano_mes);
   }//fim do loop mes a mes
}
//print "<pre>";
//print_r($matriz);
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//********************************* FIM DA LOGICA DE ARMAZENAMENTO DA MATRIZ **********************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************













//*************************************************************************************************
//************************************ ---- CABECA DO PROGRAMA ------ **********************
//*************************************************************************************************
?>
<!DOCTYPE html>
<html>
  <head>
    <title><?print $session["sistema"]?></title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <?print $v1_style_css?>
    <script type="text/javascript" src="consistencia.js"></script>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/montaDivPopUp.js"></script>
    <script type="text/javascript" src="/js/screenBlock.js"></script>
    <script type="text/javascript">
    function VerificaForm() {
      data_ini = document.consulta.ano_ini.value+'-'+document.consulta.mes_ini.value+'-'+document.consulta.dia_ini.value;
      if(document.consulta.data_inicio_nivel.value < data_ini ){
        if(checa(document.consulta)){
          document.consulta.submit();
        }
      }else{
        ano_nivel = document.consulta.data_inicio_nivel.value.substring(0,4);
        mes_nivel = document.consulta.data_inicio_nivel.value.substring(5,7);
        dia_nivel = document.consulta.data_inicio_nivel.value.substring(8,10);

        alert('A Data Inicial deve ser maior que '+ dia_nivel+'/'+mes_nivel+'/'+ano_nivel)
      }

    }

    function imprimeRelatorio(querystring){
      strHelpOptions =  "location=no";
      strHelpOptions += ",toolbar=no";
      strHelpOptions += ",titlebar=no";
      strHelpOptions += ",menubar=no";
      strHelpOptions += ",status=no";
      strHelpOptions += ",scrollbars=yes";
      strHelpOptions += ",top=";
      strHelpOptions += (1);
      strHelpOptions += ",left=";
      strHelpOptions += (1);
      strHelpOptions += ",width=750";
      strHelpOptions += ",height=420";
      HistoCliente = window.open('dac_con_trafego_geral_impressao_v2.php?'+querystring,'HistoCliente',strHelpOptions);
      HistoCliente.focus();
    }

    function imprimeRelatorioExcel(tipo){
      document.simula.tipo.value = tipo;

      table = $("#divDadosTrafego").clone(true);
      table.find("#detalhe_retorio_clicado").remove();
      table.find("#item_hr").remove();
      table.find("#item_30").remove();
      table.find("#item_15").remove();
      table.find("comentar").remove();
      table.find("#td_vazia").remove();

      table.find('input').each(function(index, elemento){
        if($(elemento).attr('src') == 'imagens/1hora.gif'){
          $(elemento).closest('td').remove();
        }

        if($(elemento).attr('src') == 'imagens/6hora.gif'){
          $(elemento).closest('td').remove();
        }

        if($(elemento).attr('src') == 'imagens/3hora.gif'){
          $(elemento).closest('td').remove();
        }
      });

      table.find('#trGraficosTrafego').remove();

      strHelpOptions =  "location=no";
      strHelpOptions += ",toolbar=no";
      strHelpOptions += ",titlebar=no";
      strHelpOptions += ",menubar=no";
      strHelpOptions += ",status=no";
      strHelpOptions += ",scrollbars=yes";
      strHelpOptions += ",top=1";
      strHelpOptions += ",left=1";
      strHelpOptions += ",width=720";
      strHelpOptions += ",height=520";
      Janela         = window.open('', 'Janela', strHelpOptions);
      Janela.focus();


      // tabelao_rel = $("#divDadosTrafego").html().replace('/<comentar>/', '<!--');
      // tabelao_rel = tabelao_rel.replace('/o_numero_de_colunas/', 'colspan="2"');
      // tabelao_rel = tabelao_rel.replace('/</comentar>/','-->');

      if(tipo == "excel"){


        console.log($(table).get(0));


        $("#trGraficosTrafego").remove();
        document.simula_excel.tabelao_rel.value    = $(table).html();
        document.simula_excel.tabelao_titulo.value = $("#divTituloTrafego").html();
        document.simula_excel.submit();

      }else{

        document.simula.tabelao_rel.value = $("#divDadosTrafego").html();
        document.simula.tabelao_titulo.value = $("#divTituloTrafego").html();
        document.simula.submit();

      }
    }

    function abreDetalhe(link, titulo) {

      //var elem = $("#input_status");
      var elem = $(".removeClique_td");

      if ( elem.is( ":disabled" ) === false ){
        //console.log("3if");
        $(".removeClique_td").attr('disabled', true);
        if( elem.is( ":disabled" ) === true ){
        //console.log("ok");
      }
      }else {

        //console.log("nada");
      }


      <?
      if ($_SESSION["ssitgl_browser"] == "IE" && $_SESSION["ssitgl_browser_versao"] >= "11") {
        ?>
        montaDivPopUp("1", link + '&tipo_popup=AJ2', "JanTrafegV2", "98%", "95%", titulo, "CC", "<?print $session["td_destaque"];?>", "N", "", "S", "", "N");
        <?
      } else {
        ?>
        window.location = link;
        <?
      }
      ?>
    }
    </script>
  </head>
<?
include "carregando.php";
?>
<script language="javascript">ap_showWaitMessage('waitDiv', 1);</script>
<?
//*************************************************************************************************
//************************************ ----FIM DA  CABECA DO PROGRAMA ------ **********************
//*************************************************************************************************




//*************************************************************************************************
//************************************ ---- CORPO DO PROGRAMA ------ **********************
//*************************************************************************************************


//if($form_volta){
//   print urldecode($form_volta);
//   $voltar = "Javascript:document.form_volta.submit();";
//}else{
$voltar = "javascript:window.history.back()";
//}
?>

<body>
<?include("include_erlang.html");?>
<?
if($deonde != 'iboard') {
  print GerarCabecalho($voltar, "Tráfego Geral", "", "");  
}

?>


<?
//tabela com o titulo do programa!! dados pesquisados no filtro


//calculadora de erlang
$tabela_calc_erlang =  "<form NAME='calls_form' target='_self'>";
$tabela_calc_erlang .=  "<input TYPE='hidden' ONCHANGE='ValidateCalls()'      SIZE='8' NAME='Calls_Edit'          value='0'     maxlength='5'  class='RightAlign'>";
$tabela_calc_erlang .=      "<input TYPE='hidden' ONCHANGE='ValidateDuration()'   SIZE='8' NAME='Duration_Edit'       value='0'     maxlength='12' class='RightAlign'>";
$tabela_calc_erlang .=      "<input TYPE='hidden' ONCHANGE='ValidateDelay()'      SIZE='8' NAME='Delay_Edit'          value='0'     maxlength='12' class='RightAlign'>";
$tabela_calc_erlang .=   "</form> ";
//******************
print $tabela_calc_erlang;

if ($mes_ini) {
   $tabelao_titulo.="<div id='divTituloTrafego' style='display:none;'><table border=0 width=650 cellpadding=2 cellspacing=0>";
   $tabelao_titulo.="   <tr>";
   $tabelao_titulo.="      <td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;".ValorClasse("REPRE",$repre,"URANET")."</td>";
   $tabelao_titulo.="   </tr>";
   $tabelao_titulo.="   <tr>";
   if($campo){
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Relatório:</b>".$titulo." - <b> Período: </b>".BrDate($StrDataInicio)." à ".BrDate($StrDataFim)." - ".$StrHoraInicio." à".$StrHoraFim."</td>";
   }
   $tabelao_titulo.="   </tr>";
   $tabelao_titulo.="</table>";
   $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
   $tabelao_titulo.="   <tr>";
   if($ddd                          ){$monta_titulo1 .= "<b>DDD: </b> ".$ddd." ->  ";}
   if($tipo_telefone                ){$monta_titulo1 .= "<b>Tipo de Telefone: </b> ".Strtoupper($tipo_telefone)." ->  ";}
   if($grupo                        ){$monta_titulo1 .= "<b>Grupo: </b> ".Strtoupper($grupo)." - ".ValorClasse("GRATE",$grupo,repre)." ->  ";}
   if($tel_prefixo  || $tel_sufixo  ){$monta_titulo1 .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}
   if($ramal         ){
      $tabelao_titulo1 .="<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Ramal:</b>".$ramal."</td>";
   }
   if($monta_titulo ||$monta_titulo1 || $desc_campo){
      $monta_titulo1 =  $monta_titulo.$monta_titulo1.$desc_campo;
      $tabelao_titulo.="<td nowrap align='left'><font class='txt5'>&nbsp;".$monta_titulo1."</td>";
   }
   $tabelao_titulo.="   </tr>";
   $tabelao_titulo.="</table>";
   if($classe_servico == "GRATE"){$desc_servico =  "Grupo";}else{$desc_servico = "Serviço";}
   if($s || $s_passa){
      $tabelao_titulo.="<table border='0' width='650' cellpadding='2' cellspacing='0'>";
      $tabelao_titulo.="   <tr>";
      $tabelao_titulo.="      <td>";
      $tabelao_titulo.="         <table border=0 align='left' cellpadding='0' cellspacing='0'>";
      $tabelao_titulo.="           <tr>";
      $tabelao_titulo.="              <td align='left'><font class='txt5'><b>&nbsp;&nbsp;".$desc_servico."(s): </b>";
      $x=0;
      if($s[$x]){
         while($s[$x]){
            $s_passa1  = $s_passa1.$s[$x]." - ".ValorClasse($classe_servico,$s[$x],$repre)."  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            $x++;
         }
      };
      $tabelao_titulo.=                $s_passa1."</td>";
      $tabelao_titulo.="           </tr>";
      $tabelao_titulo.="         </table>";
      $tabelao_titulo.="      </td>";
      $tabelao_titulo.="   </tr>";
      $tabelao_titulo.=" </table>";
      $tabelao_titulo.=" <BR><BR>";
   }
   $tabelao_titulo.="</div>";
   print $tabelao_titulo;
}


?>
<?if($mes_ini){?>
  <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session['td_dado1']?>">
      <?if($campo     ){?><td nowrap align="left"><font class="txt5">    <b>&nbsp;&nbsp;Relatório:      </b>Tráfego Geral</td><?}?>
      <?if($StrHoraInicio ){?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Entre  </b><?print $StrHoraInicio?><b> e </b><?print $StrHoraFim?></td><?}?>
      <?if($StrDataInicio ){?><td nowrap align="left"><font class="txt5"><b>&nbsp;&nbsp;Período de: </b><?print BrDate($StrDataInicio)?><b> até: </b><?print BrDate($StrDataFim)?></td><?}?>
    </tr>
  </table>
  <table border="2" align="center" width="520" bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session['td_dado1']?>">
       <?if($login_operador){ $monta_titulo = $monta_titulo ."<b>Login Pesquisado: </b> ".$login_operador." ->  ";}?>
       <?if($ramal){ $monta_titulo = $monta_titulo ."<b>Ramal: </b> ".$ramal." ->  ";}?>
       <?if($equipe){ $monta_titulo = $monta_titulo ."<b>Equipe: </b> ".$equipe." ->  ";}?>
       <?if($login_operador1){ $monta_titulo = $monta_titulo ."<b>Agente Pesquisado: </b> ".$login_operador1." ->  ";}?>
       <?if($monta_titulo || $desc_campo){?>
          <td nowrap align="left"><font class="txt5" >&nbsp;&nbsp;<?print $monta_titulo =  $monta_titulo.$desc_campo;?></td>
       <?}?>
    </tr>
  </table>
  <br>
   <?if($servico || $servico_passa){?>
      <table border="0" width="700" align="center">
        <tr>
           <td align="center">
              <table border="2" align="center"  bordercolor="<?print $session['td_destaque']?>" cellpadding="2" cellspacing="0">
                <tr bgcolor="<?print $session['td_dado1']?>">
                   <td align="left"><font class="txt5"><b><?if($classe_servico == "GRATE"){print "Grupo";}else{print "Serviço";}?>(s):</b><?$x=0;if($servico[$x]){while($servico[$x]){$servico_passa  = $servico_passa.$servico[$x]." - ".ValorClasse($classe_servico,$servico[$x],$session['representante'])." | "; $x++;}};print $servico_passa?></td>
                </tr>
              </table>
           </td>
        </tr>
      </table>
      <br>
   <?}?>
<?}
//FIM DA TABELA COM O TITULO DO PROGRAMA




























//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//********************************* LOGICA DE IMPRESSAO DA TABELA *********************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
//*************************************************************************************************
if(($busca == "ok") || $pag != 1){
   if($y != "0"){


      //DADOS EXTRAIDOS DA TB_REGISTRO DE LIGACAO PARA ACHAR AS INDEVIDAS....
      //CAMPO 26
      if(StrPos(" ".$monta_colunas,",26,") > -1){
        $tb_registro_lig = trim(ValorClasse("RLREP",$repre,"URANET"));

        if($tb_registro_lig == "--"){
          $tb_registro_lig = "tb_registro_lig";
        }




         if($campo == "data_ligacao"){
            $connectREG_LIG = ConnectREG_LIG();
            if($StrDataInicio == $StrDataFim){
               $where_data_reg_lig = "and lig_data = '".$StrDataInicio."'";
            }else{
               $where_data_reg_lig = "and lig_data between '".$StrDataInicio."' and  '".$StrDataFim."' ";
            }
            $q = "SELECT  count(*) as total,lig_data FROM ".$tb_registro_lig." WHERE representante='".$repre."' and grupo='".$vlr_campo."' and tipo_registro='02' ".$where_data_reg_lig."   group by lig_data";
            if($session["operador"]== "adm"){
               print "<br><br>".$q;
            }
            $q = DescQuery($q,$session["operador"],$PHP_SELF);
            if($query_reg_lig = DescExecQuery($q, $connectREG_LIG)){
               while($vlr_reg_lig = mysql_fetch_array($query_reg_lig)){
                  $matriz_rl[$vlr_reg_lig["lig_data"]] +=  $vlr_reg_lig["total"];
                  $matriz_rl["total"] +=  $vlr_reg_lig["total"]+0;
               }
            }
         }else{
            if($campo == "hora_ligacao"){
               $connectREG_LIG = ConnectREG_LIG();
               $where_data_reg_lig = "and lig_data = '".$vlr_campo."'";
               $q = "SELECT  count(*) as total,lig_data , sum(lig_hora_00) as qtd_hora_00,   sum(lig_hora_01) as qtd_hora_01,   sum(lig_hora_02) as qtd_hora_02,   sum(lig_hora_03) as qtd_hora_03,   sum(lig_hora_04) as qtd_hora_04,   sum(lig_hora_05) as qtd_hora_05,   sum(lig_hora_06) as qtd_hora_06,   sum(lig_hora_07) as qtd_hora_07,   sum(lig_hora_08) as qtd_hora_08,   sum(lig_hora_09) as qtd_hora_09,   sum(lig_hora_10) as qtd_hora_10,   sum(lig_hora_11) as qtd_hora_11,   sum(lig_hora_12) as qtd_hora_12,   sum(lig_hora_13) as qtd_hora_13,   sum(lig_hora_14) as qtd_hora_14,   sum(lig_hora_15) as qtd_hora_15,   sum(lig_hora_16) as qtd_hora_16,   sum(lig_hora_17) as qtd_hora_17,   sum(lig_hora_18) as qtd_hora_18,   sum(lig_hora_19) as qtd_hora_19,   sum(lig_hora_20) as qtd_hora_20,   sum(lig_hora_21) as qtd_hora_21,   sum(lig_hora_22) as qtd_hora_22,   sum(lig_hora_23) as qtd_hora_23  FROM ".$tb_registro_lig." WHERE representante='".$repre."' and grupo='".$vlr_campo1."' and tipo_registro='02' ".$where_data_reg_lig."  group by lig_data";     if($session["operador"]== "adm"){
                  print "<br><br>".$q;
               }
               $q = DescQuery($q,$session["operador"],$PHP_SELF);
               if($query_reg_lig = DescExecQuery($q, $connectREG_LIG)){
                  while($vlr_reg_lig = mysql_fetch_array($query_reg_lig)){
                     $hora = "0";
                     while($hora<= 24){
                        if($hora<10){$hora = "0".$hora;}
                        $matriz_rl[$hora]    +=  $vlr_reg_lig["qtd_hora_".$hora]+0;
                        $matriz_rl["total"]  +=  $vlr_reg_lig["qtd_hora_".$hora]+0;
                        $hora++;
                     }
                  }
               }
            }else{

            }
         }

      }























      //*************************************************************************************************
      //********************************* INICIO DA TABELA DOS DADOS*** *********************************
      //*************************************************************************************************
      $cab_tabela_imprime =  "    <div id='divDadosTrafego'> <table  style='border-collapse:collapse' width='50%' border='1' cellpadding='0' cellspacing='0' align='center'  >";
      //*************************************************************************************************
      //*******************  ARMAZENAMENTO INICIO DA LINHA DO CABECALHO DA TABELA*************************
      //*************************************************************************************************

      //descrição dos tipos de ligacao para montar o titulo das colunas
      $desc_tipo["001"] = "001 - ".ValorClasse("URAL".trim($tipo_atendimento),"001",$repre);
      $desc_tipo["002"] = "002 - ".ValorClasse("URAL".trim($tipo_atendimento),"002",$repre);
      $desc_tipo["003"] = "003 - ".ValorClasse("URAL".trim($tipo_atendimento),"003",$repre);
      $desc_tipo["004"] = "004 - ".ValorClasse("URAL".trim($tipo_atendimento),"004",$repre);
      $desc_tipo["006"] = "006 - ".ValorClasse("URAL".trim($tipo_atendimento),"006",$repre);
      $desc_tipo["013"] = "013 - ".ValorClasse("URAL".trim($tipo_atendimento),"013",$repre);
      $desc_tipo["028"] = "028 - ".ValorClasse("URAL".trim($tipo_atendimento),"028",$repre);
      $desc_tipo["034"] = "034 - ".ValorClasse("URAL".trim($tipo_atendimento),"034",$repre);

      $cab_tabela_imprime.= "       <tr bgcolor='".$session['td_destaque']."'>";
      if($campo == "data_ligacao"){
         $cab_tabela_imprime.= "             <comentar>";
         $cab_tabela_imprime.= "               <td  colspan='3' id='detalhe_retorio_clicado' align='center' title='Detalha o relatório clicado de 15 em 15 min ,30 em 30,hora em hora'><font class='txt6'><b>Detalhar           </a></font></td>";
         $cab_tabela_imprime.= "             </comentar>";
      }
      if($campo == "grupo" || $campo == "ura_grupo" || $campo == "concat(ura_grupo,'¢',grupo)"){
         $cab_tabela_imprime.= "             <comentar>";
         $cab_tabela_imprime.= "               <td id='detalhe_retorio_clicado' align='center' title='Detalha o relatório clicado dia a dia'><font class='txt6'><b>Detalhar           </a></font></td>";
         $cab_tabela_imprime.= "             </comentar>";
      }



      $cab_tabela_imprime  .= "        <td rowspan='2' ";
      if($campo == "data_ligacao"){
         $cab_tabela_imprime .=" colspan='2' ";
      }
      $cab_tabela_imprime.= " align='center'><font class='txt6'><b>".$titulo."        </font></td>";
      if($cons_bloq == "sim"){
        $str_bloq = "+\n".$desc_tipo["034"];
      }

      $cab_tabela_imprime1 .= "        <td             colspan='3' align='center' valign='top'  title='Total=\n".$desc_tipo["001"]."+\n".$desc_tipo["002"]."+\n".$desc_tipo["003"]."+\n".$desc_tipo["004"]."+\n".$desc_tipo["006"].$str_bloq."+\n".$desc_tipo["013"]."+\n".$desc_tipo["028"]."\nAban=\n".$desc_tipo["004"]."\n\nLead=\n".$desc_tipo["010"]."'><font class='txt6'><b>Ligações                                           </font></td>";
      $cab_tabela_imprime2 .= "        <td             colspan='5' align='center' valign='top'><font class='txt6' title='Ofer=\nAten+AbFi+Ocup\n\nAten=\n".$desc_tipo["002"]."+\n".$desc_tipo["003"]."\n\nAbFi=\n".$desc_tipo["028"]."\n\nOcup=\n".$desc_tipo["006"].$str_bloq."\n\nEfet=\nAtivo'><b>Chamadas Humano                                    </font></td>";
      $cab_tabela_imprime3 .= "        <td             colspan='2'  align='center' valign='top' title='(AbFi*100/Ofer)' ><font class='txt6'><b>% de Abandono </font></td>";
      $cab_tabela_imprime4 .= "        <td             colspan='2' align='center' valign='top' title='(Duracão das ligações Aten)/Aten'><font class='txt6'><b>TMA</font></td>";
      $cab_tabela_imprime5 .= "        <td             colspan='5' align='center' valign='top' title='Total Aten com o  TMA no intervalo de tempo de ".$interv_tma[1]."s'><font class='txt6'   ><b>Atendidas com TMA                        </font></td>";
      $cab_tabela_imprime6 .= "        <td rowspan='2'             align='center' valign='top' title='Aten".($interv_tma[1])." + Aten".($interv_tma[2])." + Aten".($interv_tma[3])." + Aten>".($interv_tma[4])."'><font class='txt6'  ><b>Atendidas com TMA maior que ".$interv_tma[1]."s                  </font></td>";
      $cab_tabela_imprime7 .= "        <td rowspan='2'             align='center' valign='top' title='Maior TMA encontrado no atendimento'><font class='txt6'  ><b>Chamadas  com Maior TMA                  </font></td>";
      $cab_tabela_imprime8 .= "        <td rowspan='2'             align='center' valign='top' title='É o tempo médio que a chamada levou para ser atendida =(tempo_atendidas_antes_do_humano/aten )' ><font class='txt6'><b>Tempo Médio de Resposta TMR              </font></td>";
      $cab_tabela_imprime9 .= "        <td rowspan='2'             align='center' valign='top' title='É o tempo total da fila / Aten' ><font class='txt6'><b>Tempo Médio de Espera   TME              </font></td>";
      $cab_tabela_imprime10.= "        <td rowspan='2'             align='center' valign='top' title='É o tempo total da fila / Aten com fila > 0' ><font class='txt6'><b>Tempo Médio de Espera   Fila             </font></td>";
      $cab_tabela_imprime11.= "        <td             colspan='6' align='center' valign='top' title='Total Aten com o tempo de fila no intervalo de tempo de ".$interv_fila[1]."s'><font class='txt6'><b>Atendidas em até X segundos na Fila      </font></td>";
      $cab_tabela_imprime12.= "        <td rowspan='2'             align='center' valign='top' title='Soma das Aten com o tempo maior que  ".$interv_fila[1]."s' ><font class='txt6'><b>Atendidas na fila maior que ".$interv_fila[1]."s                      </font></td>";
      $cab_tabela_imprime13.= "        <td rowspan='2'             align='center' valign='top' title='Maior tempo encontrado na fila das Aten'><font class='txt6'><b>Maior Tempo em fila                      </font></td>";
      $cab_tabela_imprime14.= "        <td rowspan='2'             align='center' valign='top' title='(Duracão da fila das AbFi)/AbFi'><font class='txt6'><b>Tempo Médio para Abandono                </font></td>";
      $cab_tabela_imprime15.= "        <td             colspan='5' align='center' valign='top' title='Total Abfi com o de tempo de Fila no intervalo de ".$interv_aband[1]."s'><font class='txt6'><b>Abandonadas até X segundos na Fila       </font></td>";
      $cab_tabela_imprime16.= "        <td rowspan='2'             align='center' valign='top' title='Total Abfi com o de tempo de Fila  maior que ".$interv_aband[1]."s' ><font class='txt6'><b>Abandonadas na Fila maior que ".$interv_aband[1]."s       </font></td>";
      $cab_tabela_imprime17.= "        <td rowspan='2'             align='center' valign='top' title='Maior tempo da fila das AbFi' ><font class='txt6'><b>Maior Tempo para Abandono                </font></td>";
      $cab_tabela_imprime18.= "        <td             colspan='2' align='center' valign='top' title='(Aten tempo_ideal +AbFi tempo_ideal)*100/(Ofer)' ><font class='txt6'><b>Nivel Serviço</a></font></td>";
      $cab_tabela_imprime19.= "        <td rowspan='2'             align='center' valign='top' title='Aten com o tempo de fila > tempo_ideal ' ><font class='txt6'><b>Atendidas Maior que o Tempo Ideal<br></a></font></td>";
      $cab_tabela_imprime20.= "        <td rowspan='2'             align='center' valign='top' title='Todas as Aten com a fila >0'><font class='txt6'><b>Total Atendidas na Fila                  </font></td>";
      $cab_tabela_imprime21.= "        <td rowspan='2'             align='center' valign='top'><font class='txt6'><b>Total Break                              </font></td>";
      $cab_tabela_imprime22.= "        <td colspan='3'            align='center' valign='top' title='Média de Agentes Totais/Presentes/Ausentes no Sistema \n\n\n Tot=Agentes que utilizaram o sistema \n\n Ause=Agentes que estao em Pausa/Break/Suspenso \n\n Pres=Agentes Que estao Disponíveis/Ativo/Receptivo'><font class='txt6'><b>Agentes                                  </font></td>";
      if($campo != "data_ligacao"){
         $cab_tabela_imprime22.= "        <td colspan='3'            align='center' valign='top' title='Quantidade de agentes que é esperado para atender a demanda de ligações \n\n Erl=DURACAO_OFERECIDAS/TEMPO_INDICE \n\nNeces=CALCULADORA DE ERLANG \n\n TEMPO_INDICE=Tempo em segundos do intervalo\n\n\n Calculo=Diferênca entre AGENTES_PRESENTE-AGENTES_NECESS'><font class='txt6'><b>Dimensionamento                                  </font></td>";
      }
      $cab_tabela_imprime23.= "        <td             colspan='2' align='center' valign='top' title='(Aten tempo_ideal)*100/(Ofer)' ><font class='txt6'><b>Nivel Serviço sem Aband</a></font></td>";
      $cab_tabela_imprime24.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Permitidas</a></font></td>";
      $cab_tabela_imprime25.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Atendidas</a></font></td>";
      $cab_tabela_imprime26.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Indevidas</a></font></td>";
      $cab_tabela_imprime27.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Atendidas em até ".$tempo_ideal."s</a></font></td>";
      $cab_tabela_imprime28.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Atendidas acima de ".$tempo_ideal."s</a></font></td>";
      $cab_tabela_imprime29.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Desistência antes do Anúncio</a></font></td>";
      $cab_tabela_imprime30.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Abandonadas em até ".$tempo_ideal."s</a></font></td>";
      $cab_tabela_imprime31.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Abandonadas acima de ".$tempo_ideal."s</a></font></td>";
      $cab_tabela_imprime32.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Desistência depois do Anúncio</a></font></td>";
      $cab_tabela_imprime33.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>%Desistência</a></font></td>";
      $cab_tabela_imprime34.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>TMO</a></font></td>";
      $cab_tabela_imprime35.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>TME</a></font></td>";
      $cab_tabela_imprime36.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Ligações em até ".$tempo_ideal."s</a></font></td>";
      $cab_tabela_imprime37.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>%Atendidas</a></font></td>";
      $cab_tabela_imprime38.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Nivel Serviço<br>".$nivel_servico_ideal."% em ".$tempo_ideal."s<br>s/Aban</a></font></td>";
      $cab_tabela_imprime39.= "        <td rowspan='2' align='center' valign='top' title='' ><font class='txt6'><b>Ocupadas</a></font></td>";
      $cab_tabela_imprime40.= "        <td rowspan='2' align='center' valign='top' title='Aten com o tempo até  ".$interv_fila[1]."s' ><font class='txt6'><b>Atendidas na fila até ".$interv_fila[1]."s                      </font></td>";
      $cab_tabela_imprime41.= "        <td rowspan='2' align='center' valign='top' title='Aten sem fila' ><font class='txt6'><b>Atendidas sem Fila                      </font></td>";



      //*************************************************************************************************
      //******************  ARMAZENAMENTO INICIO DA LINHA DO ITEM DO CABECALHO DA TABELA*****************
      //*************************************************************************************************
      $cab1_tabela_imprime.= "      <tr bgcolor='".$session['td_destaque1']."'>";
      if($campo == "data_ligacao"){
         $cab1_tabela_imprime.= "          <comentar>";
         $cab1_tabela_imprime.= "            <td align='center' nowrap id='item_hr' ><font class='peq'><b>Hr   </font></td>";
         $cab1_tabela_imprime.= "            <td align='center' nowrap id='item_30' ><font class='peq'><b>30   </font></td>";
         $cab1_tabela_imprime.= "            <td align='center' nowrap id='item_15' ><font class='peq'><b>15   </font></td>";
         $cab1_tabela_imprime.= "          </comentar>";
      }
      if($campo == "grupo" ||$campo == "ura_grupo" || $campo == "concat(ura_grupo,'¢',grupo)"){
         $cab1_tabela_imprime.= "          <comentar>";
         $cab1_tabela_imprime.= "            <td id='item_hr' align='center' nowrap ><font class='peq'><b>Dia   </font></td>";
         $cab1_tabela_imprime.= "          </comentar>";
      }

      $cab1_tabela_imprime1.= "         <td align='center' nowrap ><font class='peq'><b>Total   </font></td>";
      $cab1_tabela_imprime1.= "         <td align='center' nowrap ><font class='peq'><b>Lead    </font></td>";
      $cab1_tabela_imprime1.= "         <td align='center' nowrap ><font class='peq'><b>Aban    </font></td>";
      $cab1_tabela_imprime2.= "         <td align='center' nowrap ><font class='peq'><b>Ofer    </font></td>";
      $cab1_tabela_imprime2.= "         <td align='center' nowrap ><font class='peq'><b>Aten    </font></td>";
      $cab1_tabela_imprime2.= "         <td align='center' nowrap ><font class='peq'><b>AbFi    </font></td>";
      $cab1_tabela_imprime2.= "         <td align='center' nowrap ><font class='peq'><b>Ocup    </font></td>";

      $cab1_tabela_imprime2.= "         <td align='center' nowrap ><font class='peq'><b>Efet    </font></td>";
      $cab1_tabela_imprime3.= "         <td align='center' nowrap ><font class='peq'><b>Meta    </font></td>";
      $cab1_tabela_imprime3.= "         <td align='center' nowrap ><font class='peq'><b>Atingido    </font></td>";
      $cab1_tabela_imprime4.= "         <td align='center' nowrap ><font class='peq'><b>Meta    </font></td>";
      $cab1_tabela_imprime4.= "         <td align='center' nowrap ><font class='peq'><b>Atingido    </font></td>";

      $cab1_tabela_imprime5.= "         <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_tma[1]."</font></td>";
      $cab1_tabela_imprime5.= "         <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_tma[2]."</font></td>";
      $cab1_tabela_imprime5.= "         <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_tma[3]."</font></td>";
      $cab1_tabela_imprime5.= "         <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_tma[4]."</font></td>";
      $cab1_tabela_imprime5.= "         <td align='center' width='25' nowrap ><font class='peq'><b>+".$interv_tma[4]."</font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>00    </font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_fila[1]."</font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_fila[2]."</font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_fila[3]."</font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_fila[4]."</font></td>";
      $cab1_tabela_imprime11.= "        <td align='center' width='25' nowrap ><font class='peq'><b>+".$interv_fila[4]."</font></td>";
      $cab1_tabela_imprime15.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_aband[1]."</font></td>";
      $cab1_tabela_imprime15.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_aband[2]."</font></td>";
      $cab1_tabela_imprime15.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_aband[3]."</font></td>";
      $cab1_tabela_imprime15.= "        <td align='center' width='25' nowrap ><font class='peq'><b>".$interv_aband[4]."</font></td>";
      $cab1_tabela_imprime15.= "        <td align='center' width='25' nowrap ><font class='peq'><b>+".$interv_aband[4]."</font></td>";
      $cab1_tabela_imprime18.= "        <td align='center' nowrap ><font class='peq'><b>Meta    </font></td>";
      $cab1_tabela_imprime18.= "        <td align='center' nowrap ><font class='peq'><b>Atingido    </font></td>";


      $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Tot     </font></td>";
      $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Ause    </font></td>";
      $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Pres    </font></td>";
      if($campo != "data_ligacao"){
         $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Erl   </font></td>";
         $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Neces   </font></td>";
         $cab1_tabela_imprime22.= "        <td align='center' nowrap ><font class='peq'><b>Cálculo   </font></td>";
      }
      $cab1_tabela_imprime23.= "        <td align='center' nowrap ><font class='peq'><b>Meta    </font></td>";
      $cab1_tabela_imprime23.= "        <td align='center' nowrap ><font class='peq'><b>Atingido    </font></td>";


      //IMPRIMINDO A LINHA CONFORME O PARAMETRO MONTA COLUNAS
      $tabela_imprime = $cab_tabela_imprime;
      for($xcol=0;$xcol<sizeOf($arr_monta_colunas);$xcol++){
         $aux  = "cab_tabela_imprime".$arr_monta_colunas[$xcol];
         $tabela_imprime .= $$aux;
      }
      $tabela_imprime .= $cab1_tabela_imprime;
      for($xcol=0;$xcol<sizeOf($arr_monta_colunas); $xcol++){
         $aux  = "cab1_tabela_imprime".$arr_monta_colunas[$xcol];
         $tabela_imprime .= $$aux;
      }









      //************Ordenando a matriz para impressao*************************
      sort($matriz_aux["indice"]);
      //***********************************************************************










      //*************************************************************************************************
      //****************** LOOP NAS LINHAS DOS DADOS ARMAZENADOS NA MATRIZ              *****************
      //*************************************************************************************************

      for($x = 0; $x <= $tot_matriz; $x++){
         //indice da matriz
         $indice = $matriz_aux["indice"][$x];

         //atribui as variaves os valores do parametro
         $intervalo_parametro_tma   =  $matriz[$indice]["intervalo_parametro_tma"]   ;
         $intervalo_parametro_fila  =  $matriz[$indice]["intervalo_parametro_fila"]  ;
         $intervalo_parametro_aband =  $matriz[$indice]["intervalo_parametro_aband"] ;
         $tempo_ideal               =  $matriz[$indice]["tempo_ideal"]               ;
         $nivel_servico_ideal       =  $matriz[$indice]["nivel_servico_ideal"]       ;
         $abandono_ideal            =  $matriz[$indice]["abandono_ideal"]            ;
         $tma_ideal                 =  $matriz[$indice]["tma_ideal"]                 ;




         //VERIFICA DADOS NA TABELA PONTO QUANTIDADE DE AGENTES,TEMPO TOTAL DO BREAK
         if($campo=="data_ligacao"){
            $campo_ponto = $indice;
            $campo_ponto1= trim($vlr_campo);
         }else{
            $campo_ponto = trim($vlr_campo);
            $campo_ponto1= trim($vlr_campo1);
         }



         if ($campo_ponto1 != "") {

           $arrLogins = array();
           $q = "SELECT DISTINCT(login) FROM tb_ponto_log_".getAnoMesRes($campo_ponto)." WHERE representante = '{$repre}' AND data = '{$campo_ponto}' AND (atende_escolheu LIKE '{$campo_ponto1}_|%' OR atende_escolheu LIKE '%{$campo_ponto1}_|%')";


           $query = DescExecQuery($q, $connect);
           while ($rec = mysql_fetch_assoc($query)) {
             $arrLogins[] = $rec["login"];
           }

           $pt = "SELECT count(*) as nro_agentes,sum(tempo_tot_lanche+tempo_pausa00+tempo_pausa01+tempo_pausa02+tempo_pausa03+tempo_pausa04+tempo_pausa05+tempo_pausa06+tempo_pausa07+tempo_pausa08) AS tempo_tot_breack FROM tbponto WHERE data_entrada ='".$campo_ponto."' AND login IN ('".implode("', '", $arrLogins)."')";

           $query  = DescExecQuery($pt, $connect);
           if($ponto  = mysql_fetch_array($query)){
             if($ponto["nro_agentes"]){
               $matriz[$indice]["tempo_tot_breack"]  = $ponto["tempo_tot_breack"];
               $matriz["total"]["tempo_tot_breack"]   += $matriz[$indice]["tempo_tot_breack"];
               //$matriz[$indice]["agentes_total"]       = $ponto["agentes_total"];
               //$matriz["total"]["agentes_total"]        += $matriz[$indice]["agentes_total"] ;
             }
           }else{
             $matriz[$indice]["tempo_tot_breack"] += 0;
           }

         } else {
           $matriz[$indice]["tempo_tot_breack"] += 0;
         }
         //******************************************************************************










         //Carrega valores medios atravez dos valores da matriz
         if($matriz[$indice]["abandonadas"]){
            $tempo_m_abandono       =  $matriz[$indice]["abandonadas_cliente"]/$matriz[$indice]["abandonadas"];
         }
         $tot_fila_linha = $matriz[$indice]["atendidas_fila_20"] +$matriz[$indice]["atendidas_fila_40"] + $matriz[$indice]["atendidas_fila_60"] + $matriz[$indice]["atendidas_fila_80"] + $matriz[$indice]["atendidas_fila_m80"];
         $total_geral_fila += $tot_fila_linha;
         if($tot_fila_linha){
            $tempo_m_fila = $matriz[$indice]["tempo_fila"] / $tot_fila_linha;
         }
         if($matriz[$indice]["atendidas"]){
            $tempo_m_fila_todas     =  $matriz[$indice]['tempo_fila']/$matriz[$indice]["atendidas"];
            $velocidade_atendimento = $matriz[$indice]['atendidas_velocidade']/$matriz[$indice]["atendidas"];

            //print "<li><li>AT_IDEAL=".$matriz[$indice]["atendidas_tempo_ideal"]."----AB_IDEAL=".$matriz[$indice]["abandonadas_ideal"]."///".$matriz[$indice]["oferecidas"];
            $nivel_servico              = PercentTrafego($matriz[$indice]["atendidas_tempo_ideal"] + $matriz[$indice]["abandonadas_ideal"], $matriz[$indice]["oferecidas"],$tipo_perc);
            $nivel_servico_sem_abandono = PercentTrafego($matriz[$indice]["atendidas_tempo_ideal"]                                        , $matriz[$indice]["oferecidas"],$tipo_perc);
         }else{
            $tempo_m_fila_todas    =0;
            $velocidade_atendimento=0;
            $nivel_servico         =0;
            $nivel_servico_sem_abandono=0;
         }
         if(($matriz[$indice]["atendidas"] + $matriz[$indice]["efetuadas"]) > 0){
            $tempo_m_conversa      =($matriz[$indice]["atendidas_operador"] + $matriz[$indice]["efetuadas_operador"])/($matriz[$indice]["atendidas"]+ $matriz[$indice]["efetuadas"]);
         }
         if(($matriz["total"]["atendidas"]+ $matriz["total"]["efetuadas"]) > 0){
            $total_tempo_m_conversa = ($matriz["total"]["atendidas_operador"] + $matriz["total"]["efetuadas_operador"])/($matriz["total"]["atendidas"]+ $matriz["total"]["efetuadas"]);
         }else{
            $total_tempo_m_conversa =0;
         }

         //*********************************************************




         //TRATAMENTO DO CAMPO QUE É O INDICE DA MATRIZ
         switch($campo){
            case "concat(grupo,'¢',grupo_transferencia)":
               $aux_camp_indice = explode("¢",$indice);
               $grupo_origem = ValorClasse("GRATE",trim($aux_camp_indice[0]),$repre);
               $grupo_transf = ValorClasse("GRATE",trim($aux_camp_indice[1]),$repre);

               if ($grupo_origem  == " -- ") {
                $grupo_origem = "Sem origem";
               }

               if ($grupo_transf  == " -- ") {
                $grupo_transf = "Sem Transferencia";
               }
               if ($aux_camp_indice[0] && $aux_camp_indice[1]) {
                $campo_imprime  = "(".$aux_camp_indice[0].") = ".$grupo_origem." - (".$aux_camp_indice[1].") > ".$grupo_transf;
               } elseif (!$aux_camp_indice[0] && $aux_camp_indice[1]) {
                $campo_imprime  = $grupo_origem." - (".$aux_camp_indice[1].") > ".$grupo_transf;
               } elseif ($aux_camp_indice[0] && !$aux_camp_indice[1]) {
                $campo_imprime  = "(".$aux_camp_indice[0].") = ".$grupo_origem." - ".$grupo_transf;
               }
               $campo_imprime1 = "";
               $align  = "left";
               $align1 = "left";
               break;
            case "ura_grupo":
               $campo_imprime  = $indice . " - ".ValorClasse("URAM2",trim($indice),$repre);
               $campo_imprime1 = "";
               $align  = "left";
               $align1 = "left";
               break;
            case "concat(ura_grupo,'¢',grupo)":
               $aux_camp_indice = explode("¢",$indice);
               $campo_imprime  = ValorClasse("URAM2",trim($aux_camp_indice[0]),$repre)." - ".$aux_camp_indice[1]." ".ValorClasse("GRATE",trim($aux_camp_indice[1]),$repre);
               $campo_imprime1 = "";
               $align  = "left";
               $align1 = "left";
               break;
            case "grupo":
               $campo_imprime  = $indice . " - ".ValorClasse("GRATE",trim($indice),$repre);
               $campo_imprime1 = "";
               $align  = "left";
               $align1 = "left";
               break;
            case "data_ligacao":
               $campo_imprime  = BRDATE($indice)    ;
               if (DiaUtil($indice,$repre) == false) {
                  $tabela_oper .= " <font color='#FF0000'>";
               }else{
                  $tabela_oper .= " <font color='#000000'>";
               }
               $campo_imprime1 = $tabela_oper.DiaSemana($indice) ;
               $align  = "right";
               $align1 = "left";
               break;
            case "hora_ligacao":
               $campo_imprime  = $indice ;
               $campo_imprime1 = $indice ;
               $align  = "center";
               $align1 = "center";
               break;

            default:
               $campo_imprime  = $indice ;
               $campo_imprime1 = $indice ;
               $align  = "center";
               $align1 = "center";
               break;
         }
         //**********************************************




         //TRATAMENTO DE CORES
         $cor   = $session['td_dado3'];
         $cor1  = $session['td_dado1'];
         $fonte = "peq";
         $corclick = $session['td_destaque1'];

         $desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";
         $verde_claro = StrToLower($verde_claro);


         $cor_aband = verificaCorPerc(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]) ,$abandono_ideal);
         $cor_tma   = verificaCorPerc($tempo_m_conversa ,$tma_ideal);
         $cor_nivel = verificaCorPercNivel($nivel_servico    ,$nivel_servico_ideal);
         $cor_nivel_sem_abandono = verificaCorPercNivel($nivel_servico_sem_abandono    ,$nivel_servico_ideal);

         if($indice_maior_movimento == $matriz[$indice]["ligacoes"]){
            $cor_dmaior = " bgcolor = '".$verde."' " ;
         }else{
            $cor_dmaior = " " ;
         }
         //*******************





         //********SCRIPT QUE DEIXA A LINHA VERDINHA
         // NA VERDADE NAO SEI COMO ELE FUNCIONA POIS A FUNCAO EH DUPLICADA VARIAS VEZES E NAO DA ERRO

            ?>
                        <script language="javascript">
                        <!--
                        global  = ''
                        function bgColors(globals,obj){
                           if(globals == 'click' && obj.style.background != '<?print $verde_claro?>'){
                              obj.style.background='<?print $verde_claro?>'
                              global ='true'
                           }else{
                              if(globals == 'click' && obj.style.background =='<?print $verde_claro?>'){
                                 obj.style.background='<?print $session['td_dado3']?>'
                                 global = false
                              }
                           }
                           if(obj.style.background == ''){
                              if(globals == 'over'){
                                 obj.style.background='<?print $session['td_dado1']?>'
                              }
                              if(globals == 'out'){
                                 obj.style.background='<?print $session['td_dado3']?>'
                              }
                           }


                        }
                        -->
                        </script>
            <?
            //*************FIM DO SCRIPT







            //DADOS PARA O GRAFICO******************************************************
            if(($campo == "data_ligacao")){
               $dados_array1 .= Substr(BrDate($indice),0,2)."ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."§";
               $dados_array2 .= Substr(BrDate($indice),0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
               $dados_array3 .= Substr(BrDate($indice),0,2)."ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
               $dados_array4 .= Substr(BrDate($indice),0,2)."ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
               $dados_array5 .= Substr(BrDate($indice),0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
            }else{
               if(($campo == "grupo") || ($campo == "ura_grupo") || ($campo == "concat(ura_grupo,'¢',grupo)") ){
                  $dados_array1 .= Substr($indice,0,4)."ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."§";
                  $dados_array2 .= Substr($indice,0,4)."ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                  $dados_array3 .= Substr($indice,0,4)."ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                  $dados_array4 .= Substr($indice,0,4)."ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                  $dados_array5 .= Substr($indice,0,4)."ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
               }else{
                  if(($campo == "hora_ligacao" || $campo == "hora_ligacao_grupo")){
                     $dados_array1 .= Substr($indice,0,2)."ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."§";
                     $dados_array2 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                     $dados_array3 .= Substr($indice,0,2)."ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                     $dados_array4 .= Substr($indice,0,2)."ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                     $dados_array5 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
                  }else{
                     if(($campo == "hora_ligacao_30" || $campo == "hora_ligacao_30_grupo")){
                        if($x%2==0){;
                        $dados_array1 .= Substr($indice,0,2)."ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."§";
                        $dados_array2 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                        $dados_array3 .= Substr($indice,0,2)."ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                        $dados_array4 .= Substr($indice,0,2)."ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                        $dados_array5 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
                        }else{
                           $dados_array1 .= " ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."ª".round($total_tempo_m_conversa)."§";
                           $dados_array2 .= " ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                           $dados_array3 .= " ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                           $dados_array4 .= " ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                           $dados_array5 .= " ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
                        }
                     }else{
                        if($x%4==0){
                           $dados_array1 .= Substr($indice,0,2)."ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."§";
                           $dados_array2 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                           $dados_array3 .= Substr($indice,0,2)."ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                           $dados_array4 .= Substr($indice,0,2)."ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                           $dados_array5 .= Substr($indice,0,2)."ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
                        }else{
                           $dados_array1 .= " ª".$matriz[$indice]["oferecidas"]."ª".$matriz[$indice]["atendidas"]."ª".round($total_tempo_m_conversa)."§";
                           $dados_array2 .= " ª".$nivel_servico_ideal."ª".$nivel_servico."ª". Percent($matriz["total"]["atendidas_tempo_ideal"] + $matriz["total"]['abandonadas_ideal'],$matriz["total"]["oferecidas"])."§";
                           $dados_array3 .= " ª".$tma_ideal."ª".round($tempo_m_conversa)."ª".round($total_tempo_m_conversa)."§";
                           $dados_array4 .= " ª".$abandono_ideal."ª".round(Percent($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"]))."ª".Percent($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"])."§";
                           $dados_array5 .= " ª".$nivel_servico_ideal."ª".$nivel_servico_sem_abandono."ª". Percent($matriz["total"]["atendidas_tempo_ideal"],$matriz["total"]["oferecidas"])."§";
                        }
                     }
                  }
               }
            }
            //****************************************************************************











            //*************************************************************************************************
            //******************  ARMAZENAMENTO INICIO DA LINHA DOS DADOS DA TABELA*****************
            //*************************************************************************************************
            $dado_tabela_imprime = "          <tr bgcolor='".$cor."' ";
            $dado_tabela_imprime .= "             OnMouseOut =\"Javascript:if(this.style.background !='".$verde_claro."'){style.background='".$session['td_dado3']."'};bgColors('out',this) \" ";
            $dado_tabela_imprime .= "             OnMouseOver=\"Javascript:if(this.style.background !='".$verde_claro."'){style.background='".$session['td_dado1']."'};bgColors('over',this)\" ";
            $dado_tabela_imprime .= "             OnClick    =\"Javascript:bgColors('click',this)\"";
            $dado_tabela_imprime .= "          >";

            /*
            $dados_formAux = "document.frmAuxiliar.action                    = 'dac_con_trafego_geral_v2.php';
            document.frmAuxiliar.periodo_pesq.value        = '".$periodo_pesq."';
            document.frmAuxiliar.cons_feriado.value        = '".$cons_feriado."';
            document.frmAuxiliar.relatorio.value           = '".$relatorio."';
            document.frmAuxiliar.classe_servico.value      = '".$classe_servico."';
            document.frmAuxiliar.param_resumo_dias.value   = '".$param_resumo_dias."';
            document.frmAuxiliar.param_usa_resumo.value    = '".$param_usa_resumo."';
            document.frmAuxiliar.repre.value               = '".$repre."';
            document.frmAuxiliar.time.value                = '".$time."';
            document.frmAuxiliar.where.value               = '".urlencode($where)."';
            document.frmAuxiliar.campo_ant.value           = '".$campo."';
            document.frmAuxiliar.vlr_campo.value           = '".trim($indice)."';
            document.frmAuxiliar.vlr_campo1.value          = '".trim($vlr_campo)."';
            document.frmAuxiliar.desc_campo.value          = '".$desc_campo."';
            document.frmAuxiliar.monta_titulo.value        = '".urlencode($monta_titulo)."';
            document.frmAuxiliar.servico_passa.value       = '".urlencode($servico_passa)."';
            document.frmAuxiliar.StrDataInicio.value       = '".$StrDataInicio."';
            document.frmAuxiliar.StrDataFim.value          = '".$StrDataFim."';
            document.frmAuxiliar.StrHoraInicio.value       = '".$StrHoraInicio."';
            document.frmAuxiliar.StrHoraFim.value          = '".$StrHoraFim."';
            document.frmAuxiliar.intervalo_parametro.value = '".$intervalo_parametro."';";
            */


            //CLIQUE NOS DETALHES 1H 30MIN 15MIN
            if($campo == "data_ligacao"){
               $dado_tabela_imprime.= "          <comentar>";


                 $dado_tabela_imprime.= "               <td nowrap align='center' >
                                                                <font class='".$fonte."'>
                                                                      <input type='image'  class='removeClique_td' src='imagens/1hora.gif' title='Relatório dividido por hora'   onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao', 'Relatório dividido por hora');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">

                                                                    ";
                 if($vlr_campo == "" && $vlr_campo1 == "" && ($repre=="UNIMED" || $repre=="UNIMED-ARE")){
                 $dado_tabela_imprime.= "
                                                                      <input type='image'  class='removeClique_td' src='imagens/1hora_verde.gif' title='Relatório dividido por hora - Grupo'  onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_grupo', 'Relatório dividido por hora');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                                                    ";
                 }
                 $dado_tabela_imprime.= "                       </font>
                                                        </td>";
                 $dado_tabela_imprime.= "               <td nowrap align='center' >
                                                                  <font class='".$fonte."'>
                                                                      <input type='image'  class='removeClique_td' src='imagens/6hora.gif'title='Relatório dividido em 30 Minutos' onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_30', 'Relatório dividido em 30 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                                                    ";
                 if($vlr_campo == "" && $vlr_campo1 == "" && ($repre=="UNIMED" || $repre=="UNIMED-ARE")){
                 $dado_tabela_imprime.= "
                                                                      <input type='image'  class='removeClique_td' src='imagens/6hora_verde.gif'title='Relatório dividido em 30 Minutos - Grupo'       onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_30_grupo', 'Relatório dividido em 30 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                                                    ";
                 }

                 $dado_tabela_imprime.= "                          </font>
                                                        </td>";
                 $dado_tabela_imprime.= "               <td nowrap align='center'  >
                                                                  <font class='".$fonte."'>
                                                                    <input type='image'  class='removeClique_td' src='imagens/3hora.gif'title='Relatório dividido em 15 Minutos' onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_15', 'Relatório dividido em 15 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\" >
                                                                    ";
                 if($vlr_campo == "" && $vlr_campo1 == "" && ($repre=="UNIMED" || $repre=="UNIMED-ARE")){
                 $dado_tabela_imprime.= "
                                                                      <input type='image'  class='removeClique_td' src='imagens/3hora_verde.gif'title='Relatório dividido em 15 Minutos - Grupo'    onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_15_grupo', 'Relatório dividido em 15 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\" >
                                                                    ";
                 }
                 $dado_tabela_imprime.= "                           </font>
                                                        </td>";


               /*

               $dado_tabela_imprime.= "               <td nowrap align='center' onMouseDown=\" ".$dados_formAux." document.frmAuxiliar.campo.value='hora_ligacao';   document.frmAuxiliar.submit();javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\"><font class='".$fonte."'><img src='imagens/1hora.gif' title='Relatório dividido por hora'></font></td>";
               $dado_tabela_imprime.= "               <td nowrap align='center' onMouseDown=\" ".$dados_formAux." document.frmAuxiliar.campo.value='hora_ligacao_30';document.frmAuxiliar.submit();javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\"><font class='".$fonte."'><img src='imagens/6hora.gif'title='Relatório dividido em 30 Minutos'></font></td>";
               $dado_tabela_imprime.= "               <td nowrap align='center' onMouseDown=\" ".$dados_formAux." document.frmAuxiliar.campo.value='hora_ligacao_15';document.frmAuxiliar.submit();javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\"><font class='".$fonte."'><img src='imagens/3hora.gif'title='Relatório dividido em 15 Minutos'></font></td>";
               */

               $dado_tabela_imprime.= "          </comentar>";
            }


            //CLIQUE NOS DETALHES DIA A DIA
            if($campo == "grupo" ||$campo == "ura_grupo" || $campo == "concat(ura_grupo,'¢',grupo)"){
               $dado_tabela_imprime.= "          <comentar>";

               /*              $dado_tabela_imprime.= "               <td nowrap align='center' onMouseDown=\" ".$dados_formAux." document.frmAuxiliar.campo.value='trafego';document.frmAuxiliar.submit();javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\"><font class='".$fonte."'><img src='imagens/1hora.gif' title='Relatório dividido por hora'></font></td>";*/

               $dado_tabela_imprime.= "               <td nowrap align='center'>
                                                        <font class='".$fonte."'>
                                                          <input type='image'  class='removeClique_td' src='imagens/1hora.gif' title='Relatório dividido por hora'  onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".trim($indice)."&vlr_campo1=".trim($vlr_campo)."&desc_campo=".$desc_campo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=trafego', 'Relatório dividido por hora');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                                        </font>
                                                      </td>";

               $dado_tabela_imprime.= "          </comentar>";
            }

            //CAMPO INDICE QUE É IMPRESSO
            $dado_tabela_imprime.= "            <td nowrap align='".$align."' ><font class='".$fonte."'>".$campo_imprime."</font></td>";
            if($campo == "data_ligacao"){
               $dado_tabela_imprime.= "         <td nowrap align='".$align."'  ><font class='".$fonte."'>".$campo_imprime1."</font></td>";
            }

            $dado_tabela_imprime1 = "            <td nowrap align='right' ".$cor_dmaior.$cor_dmenor." ><font class='".$fonte."'>".$matriz[$indice]["ligacoes"]."    </font></td>";
            $dado_tabela_imprime1 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["leads"]."     </font></td>";
            $dado_tabela_imprime1 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_ura"]."    </font></td>";
            $dado_tabela_imprime2 = "            <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["oferecidas"]."    </font></td>";
            $dado_tabela_imprime2 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas"]."    </font></td>";
            $dado_tabela_imprime2 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas"]."   </font></td>";
            $dado_tabela_imprime2 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["ocupadas"]."   </font></td>";

            $dado_tabela_imprime2 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["efetuadas"]."     </font></td>";

            $dado_tabela_imprime3  = "           <td nowrap align='right'  bgcolor='".$cor_aband."'><font class='".$fonte."'>".$abandono_ideal."</font></td>";
            $dado_tabela_imprime3 .= "           <td nowrap align='right'  bgcolor='".$cor_aband."'><font class='".$fonte."'>".PercentTrafego($matriz[$indice]["abandonadas"],$matriz[$indice]["oferecidas"],$tipo_perc)."</font></td>";
            $dado_tabela_imprime4 = "            <td nowrap align='right'  bgcolor='".$cor_tma."'>  <font class='".$fonte."'>".VerificaTime($time,$tma_ideal)."          </font></td>";
            $dado_tabela_imprime4 .= "           <td nowrap align='right'  bgcolor='".$cor_tma."'>  <font class='".$fonte."'>".VerificaTime($time,$tempo_m_conversa)."          </font></td>";
            $dado_tabela_imprime5 = "            <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_operador_20"]."          </font></td>";
            $dado_tabela_imprime5 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_operador_40"]."          </font></td>";
            $dado_tabela_imprime5 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_operador_60"]."          </font></td>";
            $dado_tabela_imprime5 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_operador_80"]."          </font></td>";
            $dado_tabela_imprime5 .= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_operador_m80"]."         </font></td>";
            $dado_tabela_imprime6 = "            <td nowrap align='right' ><font class='".$fonte."'>".($matriz[$indice]["atendidas_operador_40"]+$matriz[$indice]["atendidas_operador_60"]+$matriz[$indice]["atendidas_operador_80"]+$matriz[$indice]["atendidas_operador_m80"])."</font></td>";
            $dado_tabela_imprime7 = "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$matriz[$indice]["atendidas_maior_tmc"])."</font></td>";
            $dado_tabela_imprime8 = "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$velocidade_atendimento)."          </font></td>";
            $dado_tabela_imprime9 = "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$tempo_m_fila_todas)."                                                 </font></td>";
            $dado_tabela_imprime10= "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$tempo_m_fila)."                                              </font></td>";
            $dado_tabela_imprime11= "            <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_0"]."          </font></td>";
            $dado_tabela_imprime11.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_20"]."          </font></td>";
            $dado_tabela_imprime11.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_40"]."          </font></td>";
            $dado_tabela_imprime11.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_60"]."          </font></td>";
            $dado_tabela_imprime11.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_80"]."          </font></td>";
            $dado_tabela_imprime11.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas_fila_m80"]."         </font></td>";
            $dado_tabela_imprime12= "            <td nowrap align='right' ><font class='".$fonte."'>".($matriz[$indice]["atendidas_fila_40"]+$matriz[$indice]["atendidas_fila_60"]+$matriz[$indice]["atendidas_fila_80"]+$matriz[$indice]["atendidas_fila_m80"])."         </font></td>";
            $dado_tabela_imprime13= "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$matriz[$indice]["atendidas_fila_maior_tmc"])."         </font></td>";
            $dado_tabela_imprime14= "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$tempo_m_abandono)."            </font></td>";
            $dado_tabela_imprime15= "            <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_cliente_20"]."          </font></td>";
            $dado_tabela_imprime15.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_cliente_40"]."          </font></td>";
            $dado_tabela_imprime15.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_cliente_60"]."          </font></td>";
            $dado_tabela_imprime15.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_cliente_80"]."          </font></td>";
            $dado_tabela_imprime15.= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_cliente_m80"]."         </font></td>";
            $dado_tabela_imprime16= "            <td nowrap align='right' ><font class='".$fonte."'>".($matriz[$indice]["abandonadas_cliente_40"]+$matriz[$indice]["abandonadas_cliente_60"]+$matriz[$indice]["abandonadas_cliente_80"]+$matriz[$indice]["abandonadas_cliente_m80"])."</font></td>";
            $dado_tabela_imprime17= "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$matriz[$indice]["abandonadas_maior_tmc"])."</font></td>";
            $dado_tabela_imprime18= "            <td nowrap align='right' bgcolor='".$cor_nivel."'><font class='".$fonte."'>".$nivel_servico_ideal."% em ".$tempo_ideal."s</font></td>";
            $dado_tabela_imprime18.= "           <td nowrap align='right' bgcolor='".$cor_nivel."'><font class='".$fonte."'>".$nivel_servico."</font></td>";
            $dado_tabela_imprime19= "            <td nowrap align='right' bgcolor='".$cor_nivel."'><font class='".$fonte."'>".$matriz[$indice]["atendidas_tempo_nao_ideal"]."</font></td>";
            $dado_tabela_imprime20= "            <td nowrap align='right' ><font class='".$fonte."'>".($matriz[$indice]["atendidas_fila_m80"]+$matriz[$indice]["atendidas_fila_80"]+$matriz[$indice]["atendidas_fila_60"]+$matriz[$indice]["atendidas_fila_40"]+$matriz[$indice]["atendidas_fila_20"])."         </font></td>";
            $dado_tabela_imprime21= "            <td nowrap align='right' ><font class='".$fonte."'>".VerificaTime($time,$matriz[$indice]["tempo_tot_breack"])."                </font></td>";
            switch ($campo){
               case "hora_ligacao":
               case "hora_ligacao_grupo":
                  $nro_divisao = 3600*$qtd_dias;
                  break;
               case "data_ligacao":
                  $nro_divisao = (3600*24)*$qtd_dias;;
                  break;
               case "hora_ligacao_30":
               case "hora_ligacao_30_grupo":
                  $nro_divisao = (3600/2)*$qtd_dias;;
                  break;
               case "hora_ligacao_15":
               case "hora_ligacao_15_grupo":
                  $nro_divisao = (3600/4)*$qtd_dias;;
                  break;
               default:
                  $nro_divisao = 3600*$qtd_dias;;
                  break;


            }
            if($matriz[$indice]["qtd_atualizacao"]){
               $ag_total = round(($matriz[$indice]["agentes_total"]/$matriz[$indice]["qtd_atualizacao"]),1);
               $ag_pres  = round((($matriz[$indice]["agentes_disponivel"]+$matriz[$indice]["agentes_ativo"]+$matriz[$indice]["agentes_receptivo"])/$matriz[$indice]["qtd_atualizacao"]),1);
               $ag_ause  = round((($matriz[$indice]["agentes_pausa_break"]+$matriz[$indice]["agentes_suspenso"])/$matriz[$indice]["qtd_atualizacao"]),1);

               if($session["operador"] == "RE000161"){
                  print "<li>".$matriz[$indice]["atendidas_operador"]."+".$matriz[$indice]["duracao_atd_fila"]."/".$nro_divisao;
               }
               $erlang  = round(($matriz[$indice]["atendidas_operador"]+$matriz[$indice]["duracao_atd_fila"])/(($nro_divisao)),1);
               $difer   = round($ag_pres,1)-$erlang ;


               $dado_tabela_imprime22 = "<script language='Javascript'>";
               $dado_tabela_imprime22.=     "document.calls_form.Delay_Edit.value    ='".$tempo_ideal."';";
               if($campo== "hora_ligacao_30" || $campo== "hora_ligacao_30_grupo"){
                  $campo_multiplica = (($matriz[$indice]["oferecidas"]+0)*2)/$qtd_dias;
               }else{
                  if($campo== "hora_ligacao_15" || $campo== "hora_ligacao_15_grupo"){
                     $campo_multiplica = (($matriz[$indice]["oferecidas"]+0)*4)/$qtd_dias;
                  }else{
                     $campo_multiplica = (($matriz[$indice]["oferecidas"]+0))/$qtd_dias;
                  }

               }


               $dado_tabela_imprime22.=     "document.calls_form.Calls_Edit.value    = '".$campo_multiplica."';";
               $dado_tabela_imprime22.=     "document.calls_form.Duration_Edit.value = '".($tempo_m_conversa+0)."';";
               $dado_tabela_imprime22.=     "
              result    = CalcPressed('manual');
              diferenca = Math.round(parseFloat('".$ag_pres."')-result);
              if(diferenca > 0){
                 diferenca_str = \"<font color='".$verde_escuro."'> Sobra \"+diferenca;
              }else{
                 diferenca_str = \"<font color='#FF0000'>Falta \"+(diferenca*(-1));
              }
  //          alert(diferenca_str);
  //          alert(document.calls_form.Delay_Edit.value+'---'+document.calls_form.Calls_Edit.value+'---'+document.calls_form.Duration_Edit.value+'===='+result+'   diferenca==='+diferenca);
              ";
               $dado_tabela_imprime22.= "</script>";

            }else{
               $ag_total = 0;
               $ag_pres  = 0;
               $ag_ause  = 0;
               $erlang   = 0;
               $cor_diff = $verde_claro;
            }
            $dado_tabela_imprime22 .= "            <td nowrap align='right' ><font class='".$fonte."'>".round($ag_total,1)."         </font></td>";
            $dado_tabela_imprime22 .= "            <td nowrap align='right' ><font class='".$fonte."'>".round($ag_ause,1)."         </font></td>";
            $dado_tabela_imprime22 .= "            <td nowrap align='right' ><font class='".$fonte."'>".round($ag_pres,1)."         </font></td>";

            if($campo != "data_ligacao"){
               $dado_tabela_imprime22.= "            <td nowrap align='right' ><font class='".$fonte."'>".round($erlang,1)."         </font></td>";
               $dado_tabela_imprime22.= "            <td nowrap align='right' ><font class='".$fonte."' id='result_".$x."'><script language='Javascript'>\$('#result_".$x."').html(result);</script>         </font></td>";
               $dado_tabela_imprime22.= "            <td nowrap align='left' ><font class='".$fonte."' id='diferenca_str_".$x."'><script language='Javascript'>\$('#diferenca_str_".$x."').html(diferenca_str);</script> </font></td>";
            }

            $dado_tabela_imprime23= "           <td nowrap align='right' bgcolor='".$cor_nivel."'><font class='".$fonte."'>".$nivel_servico_ideal."% em ".$tempo_ideal."s</font></td>";
            $dado_tabela_imprime23.= "           <td nowrap align='right' bgcolor='".$cor_nivel_sem_abandono."'><font class='".$fonte."'>".$nivel_servico_sem_abandono."         </font></td>";
            $dado_tabela_imprime24= "           <td nowrap align='right' ".$cor_dmaior.$cor_dmenor." ><font class='".$fonte."'>".$matriz[$indice]["ligacoes"]."    </font></td>";
            $dado_tabela_imprime25= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["atendidas"]."    </font></td>";
            $dado_tabela_imprime26= "           <td nowrap align='right' ><font class='".$fonte."'>".($matriz_rl[$indice]+0)."    </font></td>";
            $dado_tabela_imprime27= "           <td nowrap align='right' ><font class='".$fonte."'>".($matriz[$indice]["atendidas_operador_20"]+0)."    </font></td>";
            $dado_tabela_imprime28= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["atendidas_operador_40"]+$matriz[$indice]["atendidas_operador_60"]+$matriz[$indice]["atendidas_operador_80"]+$matriz[$indice]["atendidas_operador_m80"])."          </font></td>";
            $dado_tabela_imprime29= "           <td nowrap align='right' ><font class='".$fonte."'>".$matriz[$indice]["abandonadas_ura"]."    </font></td>";
            $dado_tabela_imprime30= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".$matriz[$indice]["abandonadas_cliente_20"]."         </font></td>";
            $dado_tabela_imprime31= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["abandonadas_cliente_40"]+$matriz[$indice]["abandonadas_cliente_60"]+$matriz[$indice]["abandonadas_cliente_80"]+$matriz[$indice]["abandonadas_cliente_m80"])."         </font></td>";
            $dado_tabela_imprime32= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["abandonadas_cliente_20"] + $matriz[$indice]["abandonadas_cliente_40"]+$matriz[$indice]["abandonadas_cliente_60"]+$matriz[$indice]["abandonadas_cliente_80"]+$matriz[$indice]["abandonadas_cliente_m80"])."         </font></td>";
            $dado_tabela_imprime33= "           <td nowrap align='right'  bgcolor='".$cor_aband."'><font class='".$fonte."'>&nbsp;".PercentTrafego(($matriz[$indice]["abandonadas_cliente_20"]+$matriz[$indice]["abandonadas_cliente_40"]+$matriz[$indice]["abandonadas_cliente_60"]+$matriz[$indice]["abandonadas_cliente_80"]+$matriz[$indice]["abandonadas_cliente_m80"]),$matriz[$indice]["ligacoes"],$tipo_perc)."&nbsp;</font></td>";
            $dado_tabela_imprime34= "           <td nowrap align='center' bgcolor='".$cor_tma."'>  <font class='".$fonte."'>&nbsp;".VerificaTime($time,$tempo_m_conversa)."          </font></td>";
            $dado_tabela_imprime35= "           <td nowrap align='center' ><font class='".$fonte."'>&nbsp;".VerificaTime($time,$tempo_m_fila)."                                              </font></td>";
            $dado_tabela_imprime36= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["atendidas_fila_0"]+$matriz[$indice]["atendidas_fila_20"])."          </font></td>";
            $dado_tabela_imprime37= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".PercentTrafego(($matriz[$indice]["atendidas_fila_0"]+$matriz[$indice]["atendidas_fila_20"]),$matriz[$indice]["atendidas"],$tipo_perc)."&nbsp;</font></td>";

            $nivel_servico_rl          = PercentTrafego(($matriz[$indice]["atendidas_tempo_ideal"]+$matriz[$indice]['abandonadas_ideal']),(($matriz[$indice]["atendidas"]-$matriz_rl[$indice])),$tipo_perc);
            $dado_tabela_imprime38= "           <td nowrap align='right' bgcolor='".$cor_nivel."'><font class='".$fonte."'>&nbsp;".$nivel_servico_rl."</font></td>";
            $dado_tabela_imprime39= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".$matriz[$indice]["ocupadas"]."</font></td>";
            $dado_tabela_imprime40= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["atendidas_fila_20"])."</font></td>";
            $dado_tabela_imprime41= "           <td nowrap align='right' ><font class='".$fonte."'>&nbsp;".($matriz[$indice]["atendidas_fila_0"])."</font></td>";




            //ORDENANDO AS COLUNAS PARA IMPRESSAO CONFORME O PARAMETRO MONTA COLUNAS

            $tabela_imprime .= $dado_tabela_imprime;
            for($xcol=0;$xcol<sizeOf($arr_monta_colunas);$xcol++){
               $aux  = "dado_tabela_imprime".$arr_monta_colunas[$xcol];
               $tabela_imprime .= $$aux;
            }


            //ZERANDO AS VARIAVEIS
            $tempo_m_abandono       = 0;
            $velocidade_atendimento = 0;
            $nivel_servico          = 0;
            $tempo_m_conversa       = 0;
            $tempo_m_fila           = 0;
      }//LOOP DO DADO
      //*************************************************************************************************
      //******************FIM  LOOP NAS LINHAS DOS DADOS ARMAZENADOS NA MATRIZ          *****************
      //*************************************************************************************************










      //*************************************************************************************************
      //******************TOTAL DA TABELA              **************************************************
      //*************************************************************************************************


      //Carrega valores medios atravez dos valores da matriz
      if($matriz["total"]["abandonadas"]){
         $total_tempo_m_abandono = $matriz["total"]["abandonadas_cliente"]/$matriz["total"]["abandonadas"];
      }
      if($total_geral_fila){
         $total_tempo_m_fila = $matriz["total"]['tempo_fila']/$total_geral_fila;
      }
      if($matriz["total"]["atendidas"]){
         $total_tempo_m_fila_todas         = $matriz["total"]["tempo_fila"]           / $matriz["total"]["atendidas"];
         $total_velocidade_atendimento     = $matriz["total"]["atendidas_velocidade"] / $matriz["total"]["atendidas"];
         $total_nivel_servico              = PercentTrafego(($matriz["total"]["atendidas_tempo_ideal"]+$matriz["total"]['abandonadas_ideal']),($matriz["total"]["oferecidas"]),$tipo_perc);
         $total_nivel_servico_sem_abandono = PercentTrafego($matriz["total"]["atendidas_tempo_ideal"],($matriz["total"]["oferecidas"]),$tipo_perc);
      }
      //******************************************************













      //*************************************************************************************************
      //******************  ARMAZENAMENTO INICIO DA LINHA DOS TOTAL****************************
      //*************************************************************************************************

      $tot_tabela_imprime.= "        <tr  bgcolor='".$session['tda_destaque']."'>";
      //CLIQUE NOS DETALHES 1H 30MIN 15MIN
      if($campo == "data_ligacao"){
         $tot_tabela_imprime.= "          <comentar>";
         $tot_tabela_imprime.= "            <td nowrap align='center'>
                                              <font class='".$fonte."'>
                                                <input type='image'  class='removeClique_td' src='imagens/1hora.gif' title='Relatório dividido por hora' onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=&vlr_campo1=&desc_campo=".UrlEncode("<b>Data:</b> Todas</b>")."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao', 'Relatório dividido por hora');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                              </font>
                                            </td>";
         $tot_tabela_imprime.= "            <td nowrap align='center'>
                                              <font class='".$fonte."'>
                                                <input type='image'  class='removeClique_td' src='imagens/6hora.gif'title='Relatório dividido em 30 Minutos' onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=&vlr_campo1=&desc_campo=".UrlEncode("<b>Data:</b> Todas</b>")."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_30', 'Relatório dividido em 30 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                              </font>
                                            </td>";
         $tot_tabela_imprime.= "            <td nowrap align='center'>
                                              <font class='".$fonte."'>
                                                <input type='image'  class='removeClique_td' src='imagens/3hora.gif'title='Relatório dividido em 15 Minutos'  onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=&vlr_campo1=&desc_campo=".UrlEncode("<b>Data:</b> Todas</b>")."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=hora_ligacao_15', 'Relatório dividido em 15 Minutos');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                              </font>
                                            </td>";
         $tot_tabela_imprime.= "          </comentar>";
      }


      //CLIQUE NOS DETALHES DIA A DIA
      if($campo == "grupo"  || $campo == "ura_grupo" || $campo == "concat(ura_grupo,'¢',grupo)"){
         if($param_diferentes == false){
            $tot_tabela_imprime.= "          <comentar>";
            $tot_tabela_imprime.= "             <td nowrap align='center'>
                                                  <font class='".$fonte."'>
                                                      <input type='image'  class='removeClique_td' src='imagens/1hora.gif' title='Total por Data' onClick=\"abreDetalhe('dac_con_trafego_geral_v2.php?periodo_pesq=".$periodo_pesq."&cons_bloq=".$cons_bloq."&cons_feriado=".$cons_feriado."&relatorio=".$relatorio."&classe_servico=".$classe_servico."&param_resumo_dias=".$param_resumo_dias."&param_usa_resumo=".$param_usa_resumo."&repre=".$repre."&time=".$time."&tipo_perc=".$tipo_perc."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=&vlr_campo1=&desc_campo=".UrlEncode("<b>Data:</b> Todas</b>")."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."&intervalo_parametro=".$intervalo_parametro."&campo=trafego', 'Total por Data');javascript:style.background='".$corclick."'\" onMouseOver=\"javascript:style.background='".$session['td_destaque1']."';style.cursor='pointer';style.cursor='hand'\" OnMouseOut=\"javascript:style.background='".$cor."'\">
                                                  </font>
                                                </td>";
            $tot_tabela_imprime.= "          </comentar>";
         }else{
            $tot_tabela_imprime.= "          <comentar>";
            $tot_tabela_imprime.= "               <td id='td_vazia' nowrap align='center'><font class='txt5'>&nbsp;</td>";
            $tot_tabela_imprime.= "          </comentar>";
         }

      }


      //COLUNA TOTAL
      $tot_tabela_imprime.= "            <td nowrap align='right' ";
      if($campo == "data_ligacao"){
         $tot_tabela_imprime  .=  "o_numero_de_colunas";
      }
      $tot_tabela_imprime.= "><font class='txt5'><b>TOTAL</font></td>";
      $tot_tabela_imprime1 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["ligacoes"]."    </font></td>";
      $tot_tabela_imprime1 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["leads"]."     </font></td>";
      $tot_tabela_imprime1 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_ura"]."    </font></td>";

      $tot_tabela_imprime2 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["oferecidas"]."    </font></td>";
      $tot_tabela_imprime2 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas"]."    </font></td>";
      $tot_tabela_imprime2 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas"]."   </font></td>";
      $tot_tabela_imprime2 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["ocupadas"]."     </font></td>";

      $tot_tabela_imprime2 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["efetuadas"]."     </font></td>";

      $tot_tabela_imprime3 .= "            <td nowrap align='right' colspan='2'  ><font class='txt5'><b>".PercentTrafego($matriz["total"]["abandonadas"],$matriz["total"]["oferecidas"],$tipo_perc)." </font></td>";
      $tot_tabela_imprime4 .= "            <td nowrap align='right' colspan='2' ><font class='txt5'><b>".VerificaTime($time,$total_tempo_m_conversa)."                    </font></td>";
      $tot_tabela_imprime5 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_operador_20"]."          </font></td>";
      $tot_tabela_imprime5 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_operador_40"]."          </font></td>";
      $tot_tabela_imprime5 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_operador_60"]."          </font></td>";
      $tot_tabela_imprime5 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_operador_80"]."          </font></td>";
      $tot_tabela_imprime5 .= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_operador_m80"]."          </font></td>";
      $tot_tabela_imprime6 .= "            <td nowrap align='right'             ><font class='txt5'><b>".($matriz["total"]["atendidas_operador_40"]+$matriz["total"]["atendidas_operador_60"]+$matriz["total"]["atendidas_operador_80"]+$matriz["total"]["atendidas_operador_m80"])."    </font></td>";
      $tot_tabela_imprime7 .= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$matriz["total"]["atendidas_maior_tmc"])."    </font></td>";
      $tot_tabela_imprime8 .= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$total_velocidade_atendimento)."          </font></td>";
      $tot_tabela_imprime9 .= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$total_tempo_m_fila_todas)."          </font></td>";
      $tot_tabela_imprime10.= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$total_tempo_m_fila)."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_0"]."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_20"]."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_40"]."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_60"]."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_80"]."          </font></td>";
      $tot_tabela_imprime11.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_fila_m80"]."         </font></td>";
      $tot_tabela_imprime12.= "            <td nowrap align='right'             ><font class='txt5'><b>".($matriz["total"]["atendidas_fila_40"]+$matriz["total"]["atendidas_fila_60"]+$matriz["total"]["atendidas_fila_80"]+$matriz["total"]["atendidas_fila_m80"])."          </font></td>";
      $tot_tabela_imprime13.= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$matriz["total"]["atendidas_fila_maior_tmc"])."          </font></td>";
      $tot_tabela_imprime14.= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$total_tempo_m_abandono)."          </font></td>";
      $tot_tabela_imprime15.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_cliente_20"]."          </font></td>";
      $tot_tabela_imprime15.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_cliente_40"]."          </font></td>";
      $tot_tabela_imprime15.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_cliente_60"]."          </font></td>";
      $tot_tabela_imprime15.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_cliente_80"]."          </font></td>";
      $tot_tabela_imprime15.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["abandonadas_cliente_m80"]."         </font></td>";
      $tot_tabela_imprime16.= "            <td nowrap align='right'             ><font class='txt5'><b>".($matriz["total"]["abandonadas_cliente_40"]+$matriz["total"]["abandonadas_cliente_60"]+$matriz["total"]["abandonadas_cliente_80"]+$matriz["total"]["abandonadas_cliente_m80"])."          </font></td>";
      $tot_tabela_imprime17.= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$matriz["total"]["abandonadas_maior_tmc"])."          </font></td>";
      $tot_tabela_imprime18.= "            <td nowrap align='right' colspan='2' ><font class='txt5'><b>".$total_nivel_servico."                                               </font></td>";
      $tot_tabela_imprime19.= "            <td nowrap align='right'             ><font class='txt5'><b>".$matriz["total"]["atendidas_tempo_nao_ideal"]."                                               </font></td>";
      $tot_tabela_imprime20.= "            <td nowrap align='right'             ><font class='txt5'><b>".($matriz["total"]["atendidas_fila_m80"]+$matriz["total"]["atendidas_fila_80"]+$matriz["total"]["atendidas_fila_60"]+$matriz["total"]["atendidas_fila_40"]+$matriz["total"]["atendidas_fila_20"])."         </font></td>";
      $tot_tabela_imprime21.= "            <td nowrap align='right'             ><font class='txt5'><b>".VerificaTime($time,$matriz["total"]["tempo_tot_breack"])."               </font></td>";

      if($matriz["total"]["qtd_atualizacao"]){
         $ag_total = round(($matriz["total"]["agentes_total"]/$matriz["total"]["qtd_atualizacao"]),1);
         $ag_pres  = round((($matriz["total"]["agentes_disponivel"]+$matriz["total"]["agentes_ativo"]+$matriz["total"]["agentes_receptivo"])/$matriz["total"]["qtd_atualizacao"]),1);
         $ag_ause  = round((($matriz["total"]["agentes_pausa_break"]+$matriz["total"]["agentes_suspenso"])/$matriz["total"]["qtd_atualizacao"]),1);

         //print $nro_divisao."****".count($matriz_aux["indice"]);


         if($session["operador"] == "RE000161"){
            print "<li>".$matriz["total"]["atendidas_operador"]."++++".$matriz["total"]["duracao_atd_fila"]."////".($nro_divisao*count($matriz_aux["indice"]))."======". round(($matriz["total"]["atendidas_operador"]+$matriz["total"]["duracao_atd_fila"])/(($nro_divisao)*count($matriz_aux["indice"])),1);
         }
         $erlang   = round(($matriz["total"]["atendidas_operador"]+$matriz["total"]["duracao_atd_fila"])/(($nro_divisao)*count($matriz_aux["indice"])),1);
         $difer    = round($ag_pres,1)-$erlang ;
         if($difer>=0){
            $dif = "".$difer;
            $cor_diff = $verde_claro;
         }else{
            $dif = $difer*(-1);
            $cor_diff = $vermelho;
         }
      }else{
         $ag_total = 0;
         $ag_pres  = 0;
         $ag_ause  = 0;
         $dif=0;
         $erlang=0;
      }


      $tot_tabela_imprime22 = "<script language='Javascript'>";
      $tot_tabela_imprime22.=     "document.calls_form.Delay_Edit.value    ='".$tempo_ideal."';";
      $tot_tabela_imprime22.=     "document.calls_form.Calls_Edit.value    = '".($matriz["total"]["oferecidas"]/count($matriz_aux["indice"]))/$qtd_dias."';";
      $tot_tabela_imprime22.=     "document.calls_form.Duration_Edit.value = '".($total_tempo_m_conversa+0)."';";
      $tot_tabela_imprime22.=     "
    result    = CalcPressed('manual');
    diferenca = Math.round(parseFloat('".$ag_pres."')-result);

    if(diferenca > 0){
       diferenca_str = \"<font color='".$verde_escuro."'> Sobra \"+diferenca;
    }else{
       diferenca_str = \"<font color='#FF0000'>Falta \"+(diferenca*(-1));
    }

    ";
      $tot_tabela_imprime22.= "</script>";
      $tot_tabela_imprime22.= "            <td nowrap align='right'             ><font class='txt5'><b>".$ag_total."         </font></td>";
      $tot_tabela_imprime22.= "            <td nowrap align='right'             ><font class='txt5'><b>".$ag_ause."         </font></td>";
      $tot_tabela_imprime22.= "            <td nowrap align='right'             ><font class='txt5'><b>".$ag_pres."         </font></td>";

      if($campo != "data_ligacao"){
         $tot_tabela_imprime22.= "            <td nowrap align='right'             ><font class='txt5'><b>".$erlang."         </font></td>";
         $tot_tabela_imprime22.= "           <td nowrap align='right' ><font class='txt5' id='result_tot'><script language='Javascript'>\$('#result_tot').html(result);</script>         </font></td>";
         $tot_tabela_imprime22.= "            <td nowrap align='left' ><font class='txt5' id='diferenca_str_tot'><script language='Javascript'>\$('#diferenca_str_tot').html(diferenca_str);</script> </font></td>";
      }

      $tot_tabela_imprime23.= "            <td nowrap align='right' colspan='2' ><font class='txt5'><b>".$total_nivel_servico_sem_abandono."         </font></td>";
      $tot_tabela_imprime24.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["ligacoes"]."    </font></td>";
      $tot_tabela_imprime25.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["atendidas"]."    </font></td>";
      $tot_tabela_imprime26.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz_rl["total"]+0)."    </font></td>";
      $tot_tabela_imprime27.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["atendidas_operador_20"]."          </font></td>";
      $tot_tabela_imprime28.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["atendidas_operador_40"]+$matriz["total"]["atendidas_operador_60"]+$matriz["total"]["atendidas_operador_80"]+$matriz["total"]["atendidas_operador_m80"])."          </font></td>";
      $tot_tabela_imprime29.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["abandonadas_ura"]."    </font></td>";
      $tot_tabela_imprime30.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["abandonadas_cliente_20"]."         </font></td>";
      $tot_tabela_imprime31.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["abandonadas_cliente_40"]+$matriz["total"]["abandonadas_cliente_60"]+$matriz["total"]["abandonadas_cliente_80"]+$matriz["total"]["abandonadas_cliente_m80"])."         </font></td>";
      $tot_tabela_imprime32.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["abandonadas_cliente_20"]+$matriz["total"]["abandonadas_cliente_40"]+$matriz["total"]["abandonadas_cliente_60"]+$matriz["total"]["abandonadas_cliente_80"]+$matriz["total"]["abandonadas_cliente_m80"])."         </font></td>";
      $tot_tabela_imprime33.= "            <td nowrap align='right'          ><b><font class='".$fonte."'>"   .PercentTrafego(($matriz["total"]["abandonadas_cliente_20"]+$matriz["total"]["abandonadas_cliente_40"]+$matriz["total"]["abandonadas_cliente_60"]+$matriz["total"]["abandonadas_cliente_80"]+$matriz["total"]["abandonadas_cliente_m80"]),$matriz["total"]["ligacoes"],$tipo_perc)."&nbsp;</font></td>";
      $tot_tabela_imprime34.= "            <td nowrap align='center'         ><b><font class='".$fonte."'>"   .VerificaTime($time,$tempo_m_conversa)."          </font></td>";
      $tot_tabela_imprime35.= "            <td nowrap align='center'            ><font class='".$fonte."'><b>".VerificaTime($time,$tempo_m_fila)."                                              </font></td>";
      $tot_tabela_imprime36.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["atendidas_fila_0"]+$matriz["total"]["atendidas_fila_20"])."          </font></td>";
      $tot_tabela_imprime37.= "            <td nowrap align='right'          ><b><font class='".$fonte."'>"   .PercentTrafego(($matriz["total"]["atendidas_fila_0"]+$matriz["total"]["atendidas_fila_20"]),$matriz["total"]["atendidas"],$tipo_perc)."&nbsp;</font></td>";
      $total_nivel_servico_rl            = PercentTrafego(($matriz["total"]["atendidas_tempo_ideal"]+$matriz["total"]['abandonadas_ideal']),(($matriz["total"]["atendidas"]-$matriz_rl["total"])) ,$tipo_perc);
      $tot_tabela_imprime38.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$total_nivel_servico_rl."</font></td>";
      $tot_tabela_imprime39.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".$matriz["total"]["ocupadas"]."</font></td>";
      $tot_tabela_imprime40.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["atendidas_fila_20"])."</font></td>";
      $tot_tabela_imprime41.= "            <td nowrap align='right'             ><font class='".$fonte."'><b>".($matriz["total"]["atendidas_fila_0"])."</font></td>";









      //*************************************************************************************************
      //******************  ARMAZENAMENTO INICIO DA LINHA AUXILIAR DOS GRAFICOS**************************
      //*************************************************************************************************
      $tot1_tabela_imprime.= "       <tr id='trGraficosTrafego' bgcolor=''>";
      $tot1_tabela_imprime.= "        <td nowrap align='left' ";
      if($campo == "data_ligacao"){
         $tot1_tabela_imprime.= " colspan='5'";
      }
      if($campo == "grupo" || $campo == "nome_maquia" ){
         $tot1_tabela_imprime.= " colspan='2'";
      }
      $tot1_tabela_imprime .= "><font class='txt5'><b>Gráficos    &nbsp;</font></td>";
      $tot1_tabela_imprime1.= "        <td             colspan='3'  align='center' valign='top'><font class='txt6'>                            </a></font></td>";
      $tot1_tabela_imprime2.= "        <td             colspan='5'  align='center' valign='top'><font class='txt6'><img  title='Grafico da Tabela' onmouseover=\"style.cursor='pointer';style.cursor='hand'\" src='imagens/grafico_peq.gif' width='15' onClick=\"MostraGrafico(document.grafico1)\"></font></td>";
      $tot1_tabela_imprime3.= "        <td rowspan='2' colspan='2'  align='center' valign='top'><font class='txt6'><img  title='Grafico da Tabela' onmouseover=\"style.cursor='pointer';style.cursor='hand'\" src='imagens/grafico_peq.gif' width='15' onClick=\"MostraGrafico(document.grafico4)\"></font></td>";
      $tot1_tabela_imprime4.= "        <td rowspan='2' colspan='2'  align='center' valign='top'><font class='txt6'><img  title='Grafico da Tabela' onmouseover=\"style.cursor='pointer';style.cursor='hand'\" src='imagens/grafico_peq.gif' width='15' onClick=\"MostraGrafico(document.grafico3)\"></font></td>";
      $tot1_tabela_imprime5.= "        <td             colspan='5'  align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime6.= "        <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime7.= "        <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime8.= "        <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime9.= "        <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime10.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime11.= "       <td             colspan='6'  align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime12.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime13.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime14.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime15.= "       <td             colspan='5'  align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime16.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime17.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime18.= "       <td rowspan='2' colspan='2'  align='center' valign='top'><font class='txt6'><b><img  title='Grafico da Tabela' onmouseover=\"style.cursor='pointer';style.cursor='hand'\" src='imagens/grafico_peq.gif' width='15' onClick=\"MostraGrafico(document.grafico2)\"></a></font></td>";
      $tot1_tabela_imprime19.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime20.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'></font></td>";
      $tot1_tabela_imprime21.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime22.= "       <td rowspan='2'              align='center' valign='top'><font class='txt6'><b></font></td>";
      $tot1_tabela_imprime23.= "       <td rowspan='2' colspan='2'  align='center' valign='top'><font class='txt6'><b><img  title='Grafico da Tabela' onmouseover=\"style.cursor='pointer';style.cursor='hand'\" src='imagens/grafico_peq.gif' width='15' onClick=\"MostraGrafico(document.grafico5)\"></a></font></td>";




      //ORDENANDO AS COLUNAS PARA IMPRESSAO CONFORME O PARAMETRO MONTA COLUNAS
      $tabela_imprime .= $tot_tabela_imprime;
      for($xcol=0;$xcol<sizeOf($arr_monta_colunas);$xcol++){
         $aux  = "tot_tabela_imprime".$arr_monta_colunas[$xcol];
         $tabela_imprime .= $$aux;
      }

      if(!StrPos(" ".$monta_colunas,",26,")){
         $tabela_imprime .= $tot1_tabela_imprime;
         for($xcol=0;$xcol<sizeOf($arr_monta_colunas);$xcol++){
            $aux  = "tot1_tabela_imprime".$arr_monta_colunas[$xcol];
            $tabela_imprime .= $$aux;
         }
      }
      $tabela_imprime.= "          <comentar>";
      $tabela_imprime.= "     </table></div>";
      //*********************************************************************












      //IMPRIMINDO A TABELA
      $tabela_imprime2 = str_replace('<comentar>','',$tabela_imprime);
      $tabela_imprime2 = str_replace('o_numero_de_colunas','colspan=\'2\'',$tabela_imprime);
      print $tabela_imprime2 = str_replace('</comentar>','',$tabela_imprime2);
      //******************
      ?>




      <?
      //LEGENDA DAS CORES
      ?>

      <BR>
      <table align="center" width="550" border="0" cellspacing="0" cellpadding="0" bordercolor="<?print $session['td_destaque']?>">
         <tr>
           <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session['td_destaque']?>"><tr><td align="center" bgcolor="<?print $vermelho   ?>"><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>
           <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;Fora da Meta        </td>
           <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session['td_destaque']?>"><tr><td align="center" bgcolor="<?print $amarelo    ?>"><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>
           <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;Alerta (50% da Meta)</td>
           <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session['td_destaque']?>"><tr><td align="center" bgcolor="<?print $verde_claro?>"><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>
           <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;Dentro da Meta      </td>
         </tr>
      </table>
      <br>

      <?
      //TABELA PARA IMPRESSAO,EXEL
      ?>
      <table align="center">
         <tr>
            <?if($session['operador'] == "adm"){?>
               <td style="border='none'" align="right">
                 <img src="imagens/info.gif" width="30" alt="Clique para Informações sobre o Relatório" onMouseOver="style.cursor='pointer';style.cursor='hand'" onMouseOut="style.cursor='default'" onClick="AbreJanela('dac_ajuda_trafego_geral.html','Ajuda','700','500')">
               </td>
            <?}?>
            <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório para o Excel" onClick="imprimeRelatorioExcel('excel')">
              <center><img src="imagens/excel.gif" align="bottom" ><font class="txt5"><b>&nbsp;</center>
            </td>
            <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Imprimir" onClick="imprimeRelatorioExcel('imprimir')">
              <center><img src="imagens/print1.gif"  width="25" align="bottom" ><font class="txt5"><b>&nbsp;</center>
            </td>
         </tr>
      </table>
      <?
      //*******************FORMULARIO DE IMPRESSAO,EXEL CARREGA TODAS AS VARIAVEIS DO PROGRAMA
      ?>
  <form name="simula_excel" method="post" action="dac_con_trafego_geral_excel.php" target="Janela">
         <?
         $tabela_imprime3 = str_replace('<comentar>','<!-- ',$tabela_imprime);
         $tabela_imprime3 = str_replace('o_numero_de_colunas','colspan=\'2\'',$tabela_imprime3);
         $tabela_imprime3 = str_replace('</comentar>','-->',$tabela_imprime3);
         ?>
         <input type="hidden" name="tabelao_rel"    value="<?print urlencode($tabela_imprime3)?>">
         <input type="hidden" name="tabelao_titulo"    value="<?print urlencode($tabelao_titulo)?>">
         <input type="hidden" name="tipo"           value="excel">
  </form>


        <form name="simula" method="post" action="dac_con_trafego_geral_impressao_v2.php" target="Janela">
               <?
               $tabela_imprime3 = str_replace('<comentar>','<!-- ',$tabela_imprime);
               $tabela_imprime3 = str_replace('o_numero_de_colunas','colspan=\'2\'',$tabela_imprime3);
               $tabela_imprime3 = str_replace('</comentar>','-->',$tabela_imprime3);
               ?>
               <input type="hidden" name="tabelao_rel"    value="<?print urlencode($tabela_imprime3)?>">
               <input type="hidden" name="tabelao_titulo" value="<?print urlencode($tabelao_titulo)?>">
               <input type="hidden" name="tipo"           value="">
                  <?
                  //******************************************************************************
                  //CAMPOS que é montado com todas as variaveis necessarias para a IMPRESSAO******
                  //******************************************************************************
                  //para execução desse programa na volta
                  $keys = array_keys($HTTP_GET_VARS);
                  for($x = 0; $x < count($keys); $x++) {
                     $HTTP_GET_VARS[$keys[$x]] = str_replace("\'" , "'" ,$HTTP_GET_VARS[$keys[$x]]);
                     if(is_array($HTTP_GET_VARS[$keys[$x]])){
                        foreach ($HTTP_GET_VARS[$keys[$x]] as $key => $val) {
                           $form_filtro   .= "<input type=\"hidden\" name=\"".$keys[$x]."[]\"    value=\"".$val."\">";
                        }
                     }elsE{
                        $form_filtro   .= "<input type=\"hidden\" name=\"".$keys[$x]."\"    value=\"".$HTTP_GET_VARS[$keys[$x]]."\">";
                     }
                  }
                  $keys = array_keys((array)$HTTP_POST_VARS);
                  for($x = 0; $x < count((array)$keys); $x++) {
                     $HTTP_POST_VARS[$keys[$x]] = str_replace("\'" , "'" ,$HTTP_POST_VARS[$keys[$x]]);
                     if(is_array($HTTP_POST_VARS[$keys[$x]])){
                        foreach ($HTTP_POST_VARS[$keys[$x]] as $key => $val) {
                           $form_filtro   .= "<input type=\"hidden\" name=\"".$keys[$x]."[]\"    value=\"".$val."\">";
                        }
                     }elsE{
                        $form_filtro .= "<input type=\"hidden\" name=\"".$keys[$x]."\"    value=\"".$HTTP_POST_VARS[$keys[$x]]."\">";
                     }
                  }
                  print $form_filtro;
                  //**********************************************************************************
                  //FIM CAMPOS que é montado com todas as variaveis necessarias para a IMPRESSAO******
                  //**********************************************************************************





                  //**********************************************************************************
                  //CAMPOS dos graficos da impressao**************************************************
                  //**********************************************************************************
                  ?>
                  <input type="hidden" name="tot_graficos_imprime"      value="5">
                  <?
                  //***********Grafico1
                  $titulo_grafico = "Ligações - Oferecidas X Atendidas";
                  $legenda        = "Oferecidas§Atendidas";
                  $dados_array    = substr($dados_array1,0,StrLen($dados_array1)-1);
                  ?>
                  <input type="hidden" name="grafico1_dados_array"      value="<?print $dados_array         ?>">
                  <input type="hidden" name="grafico1_legenda"          value="<?print $legenda?>">
                  <input type="hidden" name="grafico1_titulo_grafico"   value="<?print $titulo_grafico      ?>">
                  <input type="hidden" name="grafico1_tipo_grafico"     value="linepoints">
                  <?
                  //***********Grafico2
                  $titulo_grafico = "Nivel de Serviço - Esperado X Atingido";
                  $legenda        = "Esperado§Atingido§Total";
                  $dados_array    = substr($dados_array2,0,StrLen($dados_array2)-1);
                  ?>
                  <input type="hidden" name="grafico2_dados_array"      value="<?print $dados_array         ?>">
                  <input type="hidden" name="grafico2_legenda"          value="<?print $legenda?>">
                  <input type="hidden" name="grafico2_titulo_grafico"   value="<?print $titulo_grafico      ?>">
                  <input type="hidden" name="grafico2_tipo_grafico"     value="linepoints">
                  <?
                  //***********Grafico3
                  $titulo_grafico = "Tempo Médio de Atendimento - Esperado X Atingido";
                  $legenda        = "Esperado§Atingido§Total";
                  $dados_array    = substr($dados_array3,0,StrLen($dados_array3)-1);
                  ?>
                  <input type="hidden" name="grafico3_dados_array"      value="<?print $dados_array         ?>">
                  <input type="hidden" name="grafico3_legenda"          value="<?print $legenda?>">
                  <input type="hidden" name="grafico3_titulo_grafico"   value="<?print $titulo_grafico      ?>">
                  <input type="hidden" name="grafico3_tipo_grafico"     value="linepoints">
                  <?
                  //***********Grafico4
                  $titulo_grafico = "Abandono - Esperado X Atingido";
                  $legenda        = "Esperado§Atingido§Total";
                  $dados_array    = substr($dados_array4,0,StrLen($dados_array4)-1);
                  ?>
                  <input type="hidden" name="grafico4_dados_array"      value="<?print $dados_array         ?>">
                  <input type="hidden" name="grafico4_legenda"          value="<?print $legenda?>">
                  <input type="hidden" name="grafico4_titulo_grafico"   value="<?print $titulo_grafico      ?>">
                  <input type="hidden" name="grafico4_tipo_grafico"     value="linepoints">
                  <?
                  //***********Grafico5
                  $titulo_grafico = "Nivel de Serviço - Esperado X Atingido";
                  $legenda        = "Esperado§Atingido§Total";
                  $dados_array    = substr($dados_array5,0,StrLen($dados_array5)-1);
                  ?>
                  <input type="hidden" name="grafico5_dados_array"      value="<?print $dados_array         ?>">
                  <input type="hidden" name="grafico5_legenda"          value="<?print $legenda?>">
                  <input type="hidden" name="grafico5_titulo_grafico"   value="<?print $titulo_grafico      ?>">
                  <input type="hidden" name="grafico5_tipo_grafico"     value="linepoints">
                  <?
                  //**********************************************************************************
                  //FIM CAMPOS dos graficos da impressao**************************************************
                  //**********************************************************************************
                  ?>

       </form>
      <?
      //FIM DO FORMULARIO DE IMPRESSAO,EXEL CARREGA TODAS AS VARIAVEIS DO PROGRAMA



   }else{
      if($mes_ini){
        if($periodo_pesq == 'sac' && !is_array($cale)) {
          print "<center><font class='txtvermelho'><b>Calendário SAC ainda não foi cadastrado. Selecionar outro filtro de data."; 
        } else {
          print "<center><font class='txtvermelho'><b>Nenhum Registro Encontrado";
        }
      }
     
   }
}








//***********Grafico1
$titulo_grafico = "Ligações - Oferecidas X Atendidas";
$legenda        = "Oferecidas§Atendidas";
$dados_array    = substr($dados_array1,0,StrLen($dados_array1)-1);
       ?>

       <form name="<?print 'grafico1'?>" method="POST" target="JanelaGrafico" action="cc_graficos.php">
         <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
         <input type="hidden" name="legenda"          value="<?print $legenda?>">
         <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
      </form>
      <?
      //***********Grafico2
      $titulo_grafico = "Nivel de Serviço - Esperado X Atingido";
      $legenda        = "Esperado§Atingido§Total";
      $dados_array    = substr($dados_array2,0,StrLen($dados_array2)-1);
       ?>

       <form name="<?print 'grafico2'?>" method="POST" target="JanelaGrafico" action="cc_graficos.php">
         <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
         <input type="hidden" name="legenda"          value="<?print $legenda?>">
         <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
      </form>
      <?
      //***********Grafico3
      $titulo_grafico = "Tempo Médio de Atendimento - Esperado X Atingido";
      $legenda        = "Esperado§Atingido§Total";
      $dados_array    = substr($dados_array3,0,StrLen($dados_array3)-1);
       ?>

       <form name="<?print 'grafico3'?>" method="POST" target="JanelaGrafico" action="cc_graficos.php">
         <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
         <input type="hidden" name="legenda"          value="<?print $legenda?>">
         <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
      </form>
<?
//***********Grafico4
$titulo_grafico = "Abandono - Esperado X Atingido";
$legenda        = "Esperado§Atingido§Total";
$dados_array    = substr($dados_array4,0,StrLen($dados_array4)-1);
       ?>

       <form name="<?print 'grafico4'?>" method="POST" target="JanelaGrafico" action="cc_graficos.php">
         <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
         <input type="hidden" name="legenda"          value="<?print $legenda?>">
         <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
      </form>

      <?
      //***********Grafico5
      $titulo_grafico = "Nivel de Serviço - Esperado X Atingido";
      $legenda        = "Esperado§Atingido§Total";
      $dados_array    = substr($dados_array5,0,StrLen($dados_array5)-1);
       ?>

       <form name="<?print 'grafico5'?>" method="POST" target="JanelaGrafico" action="cc_graficos.php">
         <input type="hidden" name="dados_array"      value="<?print $dados_array         ?>">
         <input type="hidden" name="legenda"          value="<?print $legenda?>">
         <input type="hidden" name="titulo_grafico"   value="<?print $titulo_grafico      ?>">
      </form>


<?
if($deonde != 'iboard') {
  print GerarRodape($voltar);
}
?>
<?/*
       <form name="frmAuxiliar" method="POST" action="">
       <input type="hidden" name="periodo_pesq"         value="">
       <input type="hidden" name="cons_feriado"         value="">
       <input type="hidden" name="relatorio"            value="">
       <input type="hidden" name="classe_servico"       value="">
       <input type="hidden" name="param_resumo_dias"    value="">
       <input type="hidden" name="param_usa_resumo"     value="">
       <input type="hidden" name="repre"                value="">
       <input type="hidden" name="time"                 value="">
       <input type="hidden" name="where"                value="">
       <input type="hidden" name="campo_ant"            value="">
       <input type="hidden" name="vlr_campo"            value="">
       <input type="hidden" name="vlr_campo1"           value="">
       <input type="hidden" name="desc_campo"           value="">
       <input type="hidden" name="monta_titulo"         value="">
       <input type="hidden" name="servico_passa"        value="">
       <input type="hidden" name="StrDataInicio"        value="">
       <input type="hidden" name="StrDataFim"           value="">
       <input type="hidden" name="StrHoraInicio"        value="">
       <input type="hidden" name="StrHoraFim"           value="">
       <input type="hidden" name="intervalo_parametro"  value="">
       <input type="hidden" name="campo"                value="">
       <input type="hidden" name="flag_post"            value="S">
       </form>
*/?>


</body>
<script language="javascript">ap_showWaitMessage('waitDiv', 0);</script>
</html>