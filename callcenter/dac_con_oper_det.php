<?
session_start();
session_register("session");
include "cc_libcallcenter.php";
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}

$connect  = ConnectDB();
//$connect2 = ConnectLOGURA();
$connect3 = ConnectAPOIO();


if($deonde == "DACNET"){



if(!$repre){	
	$repre           = "CONTACTPAN";
	$relatorio       = "dac_con_oper_det.php§login_operador§login_operador";
	$time            = "min";//min ou seg";
	$servico[0]      = "4001";
}

 

$pag = 1;
$busca = "ok";
$hora_ini = "00";
$min_ini = "00";
$hora_fim = "24";
$min_fim =  "00";
$dia_ini = date("d");
$mes_ini = date("m");
$ano_ini = date("Y");
$dia_fim = date("d");
$mes_fim = date("m");
$ano_fim = date("Y");

$classe_servico  = "GRATE";
$ramal           =  "";
$grupo           = "" ;
$equipe          = ""; 
$classe_tipo = "todos";

$ddd = "" ;
$tel_prefixo ="";
$tel_sufixo = "";
}




require_once("/libs/ctr/DataManager.php");
if($pag == 1){
	$data_man_grava = new DataManager($session["operador"]);
	$data_man_grava->gravaDados("filtro_agentes",$_REQUEST);
}

if($_GET["carrega_dados"] == "sim"){
	$data_man_recupera = new DataManager($session["operador"]);
	$data_man_recupera->carrega("filtro_agentes");
	$data_man_recupera->criaVars();
	if($relatorio){
		$array_relatorio = split("§", $relatorio);
		$programa = $array_relatorio[0];
		if($PHP_SELF != "/".DOCROOT.$programa){
			header ("Location:".HTTPHOST.DOCROOT.$programa."?carrega_dados=sim");
			exit;
		}
	}
}



$q = "select vlr_classe,desc_classe,representante from tb_classe where cod_classe = 'URATF'";
$rec = mysql_query($q, $connect);
while($vlr = mysql_fetch_array($rec)){
	//  print  "<li>".$vlr["vlr_classe"].$vlr["representante"]."-----------".$vlr["desc_classe"];
	$matrix_tb_classe[$vlr["vlr_classe"].$vlr["representante"]] = $vlr["desc_classe"];
}

function getParametro($param, $grupo, $repre){
	global $matrix_tb_classe;
	//  print "<br><br><br>".count($matrix_tb_classe);
	//print "<br>".$matrix_tb_classe[trim($grupo)."P-".$param.$repre]."<Br><Br>";
	if($matrix_tb_classe[trim($grupo)."P-".$param.$repre]){
		//print "<li>ACHOU ".trim($grupo)."P-".$param.$repre;
		return $matrix_tb_classe[trim($grupo)."P-".$param.$repre];
	}else{
		if($matrix_tb_classe[$param.$repre]){
			//print "<li>ACHOU ".$param.$repre;
			return $matrix_tb_classe[$param.$repre];

		}else{
			if($matrix_tb_classe[$param."URANET"]){
				//print "<li>ACHOU ".$param."URANET";
				return $matrix_tb_classe[$param."URANET"];
			}else{
				//print "<li>**********ACHOU 0".$param."-". $grupo."-".$repre;
				return "0";

			}

		}
	}
}

function VerificaTime($time, $segundos){
	if($time == "seg"){
		return $segundos;
	}else{
		return CalcTime($segundos);
	}
}

if($classe_servico== "URANB"){
	$classe_servico =   "URANB";
	$campo_servico = "nb";
	$desc_servico = "Servico";
}else{
	$classe_servico = "GRATE";
	$campo_servico = "grupo";
	$desc_servico   = "Grupo";
}

If ($StrDataInicio){
	$dia_ini = Substr($StrDataInicio,"8","2");
	$mes_ini = Substr($StrDataInicio,"5","2");
	$ano_ini = Substr($StrDataInicio,"0","4");

	$dia_fim = Substr($StrDataFim,"8","2");
	$mes_fim = Substr($StrDataFim,"5","2");
	$ano_fim = Substr($StrDataFim ,"0","4");


	$hora_ini = Substr($StrHoraInicio,"0","2");
	$min_ini  = Substr($StrHoraInicio,"3","5");


	$hora_fim = Substr($StrHoraFim,"0","2");
	$min_fim  = Substr($StrHoraFim,"3","5");
}else{
	$StrDataInicio = $ano_ini. '-' .$mes_ini.'-'.$dia_ini;
	$StrDataFim    = $ano_fim.'-'.$mes_fim.'-'.$dia_fim;

	$StrHoraInicio = $hora_ini.':'.$min_ini;
	$StrHoraFim    = $hora_fim.':'.$min_fim;
}

//Esta chamada à função ConnectLOGS tem que estar aqui devido às variáveis que ela utiliza
$connect2 = ConnectLOGS($repre, $ano_ini.$mes_ini);

if($relatorio){
	//Dividindo o VlrClasse da pesquisa em um array
	//com a posicao [0] o nome do programa
	//e a posicao [1] o campo do BD*************
	$array_relatorio = split("§", $relatorio);
	$programa = $array_relatorio[0];
	$campo    = $array_relatorio[1];
	$campo1   = $array_relatorio[2];
	//********************************************************

}

//Verificando qual o programa que esta sendo executado e fazendo a suas arvores
switch($campo){
	case "login":
		$campo      = "login_operador";
		$campo1     = "tipo_ligacao";
		$campo_extra= "tipo_atendimento";
		$virg = " , ";
		$campo_prox = "hora_operador_ini";
		$campo_prox1= "hora_operador_ini";
		$prog_prox  = "dac_con_oper_det.php";
		$titulo     = "Agente";
		$titulo1    = "Tipo de Ligacao";
		break;
	case "login1":
		$campo      = "login_operador";
		$campo1     = "hora_operador_ini";
		$campo_prox = "tipo_ligacao";
		$campo_prox1= "tipo_ligacao";
		$prog_prox  = "dac_con_oper_det.php";
		$titulo     = "Agente";
		$titulo1    = "Horário";
		break;
	case "login2":
		$campo      = "login_operador";
		$campo1     = "desligou";
		$campo_prox = "hora_operador_ini";
		$campo_prox1= "hora_operador_ini";
		$prog_prox  = "dac_con_oper_det.php";
		$titulo     = "Agente";
		$titulo1    = "Quem Desligou";
		break;
	case "login3":
		$campo      = "login_operador";
		$campo1     = "nb";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Agente";
		$titulo1    = "Serviço";
		break;
	case "login4":
		$campo      = "login_operador";
		$campo1     = "ramal";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Agente";
		$titulo1    = "Ramal";
		break;
	case "login5":
		$campo      = "login_operador";
		$campo1     = "grupo_transferencia";
		$campo_prox = "hora_operador_ini";
		$campo_prox1= "hora_operador_ini";
		$prog_prox  = "dac_con_oper_det.php";
		$titulo     = "Agente";
		$titulo1    = "Grupo Transferencia";
		break;
	case "ramal":
		$campo      = "ramal";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Ramal";
		$titulo1    = "Agente";
		break;
	case "hora":
		$campo      = "hora_operador_ini";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Hora da Ligacao";
		$titulo1    = "Agente";
		break;
	case "servico":
		$campo      = "nb";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Serviço";
		$titulo1    = "Agente";
		break;
	case "grupo":
		$campo      = "grupo";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Grupo de Atendimento";
		$titulo1    = "Agente";
		break;
	case "deslig":
		$campo      = "desligou";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Quem Desligou";
		$titulo1    = "Agente";
		break;
	case "tipo":
		$campo      = "tipo_ligacao";
		$campo1     = "login_operador";
		$campo_extra= "tipo_atendimento";
		$virg = " , ";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Tipo de Ligação";
		$titulo1    = "Agente";
		break;
	case "hora_operador_ini":
		$campo      = "login_operador";
		$campo1     = "hora_operador_ini";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Agente";
		$titulo1    = "Horário";
		break;
	case "tipo_ligacao":
		$campo_extra= "tipo_atendimento";
		$virg = " , ";
		$campo      = "login_operador";
		$campo1     = "tipo_ligacao";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Agente";
		$titulo1    = "Tipo de Ligação";
		break;
	case "grupo_transferencia":
		$campo      = "grupo_transferencia";
		$campo1     = "login_operador";
		$campo_prox = "det";
		$campo_prox1= "det";
		$prog_prox  = "dac_con_oper_lig.php";
		$titulo     = "Grupo Transferência";
		$titulo1    = "Agente";
		break;
	default:
		if($campo != "login_operador"){
			$campo      = $campo;
			$campo1     = "login_operador";
			$campo_prox = "det";
			$campo_prox1= "det";
			$prog_prox  = "dac_con_oper_lig.php";
			$titulo     = $campo;
			$titulo1    = "Agente";
		}else{
			$campo       = "login_operador";
			$campo1      = $campo1;
			$campo_prox  = "det";
			$campo_prox1 = "det";
			$prog_prox   = "dac_con_oper_lig.php";
			$titulo      = "Agente";
			$titulo1     = $campo;
		}
		break;
}


$arr_tit_campo = Split("-",ValorClasse("URARO",$relatorio,$repre));
if($arr_tit_campo[0]){
	$titulo  = $arr_tit_campo[0];
}
if($arr_tit_campo[1]){
	$titulo1 = $arr_tit_campo[1];
}


//*************************************************************************************************
//************************************ ---- Preparando os Wheres ------ ***************************
//*************************************************************************************************

if(!$where){
	$where = "Where ";


	//*************Preparando o where dos servicos selecionados*********
	$x = 0;

	While($servico[$x]){
		if($x == "0"){
			$where = $where." ".$campo_servico." in('".substr($servico[$x],0,4)."'";
		}else{
			$where = $where.",'".substr($servico[$x],0,4)."'";
		}
		$x++;
	}
	$where = $where." )";
	//******************************************************************


	//*************Preparando o where dos tipos ligacao******************
	$y = 0;
	if ($tipo_ligacao[$y] && $tipo_ligacao[$y] != "") {
		While($tipo_ligacao[$y]){
			if($y == "0"){
				$where = $where." and tipo_ligacao  in('".$tipo_ligacao[$y]."'";
			}else{
				$where = $where.",'".$tipo_ligacao[$y]."'";
			}
			$y++;
		}
		$where = $where." )";
	}
	//******************************************************************



	if($classe_tipo == ""){ $classe_tipo = "todos";}


	if($x == 1) {
		$mostra_tmaideal=$x;
		$tma_ideal = getParametro("TMAIDEAL",$servico[0],$repre);
	}


	if($StrDataInicio == $StrDataFim){
		$where = $where." and  data_ligacao = '".$StrDataInicio."'";
	}else{
		$where = $where." and  data_ligacao between '".$StrDataInicio."' and '".$StrDataFim."'";
	}
	if($grupo){
		$where = $where." and grupo = '".$grupo."'  ";
	}

	if($StrHoraInicio != "00:00" || $StrHoraFim != "24:00"){
		$where = $where." and hora_ligacao_ini between '".$StrHoraInicio.":00' and  '".CalculaDifSegundos($StrHoraFim.":00",1)."' ";
	}
	if($ramal){
		$where = $where." and ramal = '".$ramal."'  ";
	}
	if($equipe){
		$where = $where." and equipe = '".$equipe."'  ";
	}
	if($ddd){
		$where = $where." and ddd = '".$ddd."'  ";
	}
	if($tel_prefixo){
		$where = $where." and prefixo_telefone like '".$tel_prefixo."%'  ";
	}
	if($tel_sufixo){
		$where = $where." and sufixo_telefone like '".$tel_sufixo."%'  ";
	}
	if($repre){
		$where = $where." and empresa = '".DefineRepre($repre)."'  ";
	}
	if($login_operador){

		$where = $where." and login_operador like '".$login_operador."%'  ";
	}
	if($login_operador1){
		if ($login_operador1 != "sem_discador")  {
			$where = $where." and login_operador = '".$login_operador1."'  ";
		}else  {
			$where = $where." and login_operador not like 'disc%' ";
		}
	}


}else{
	$where = str_replace("\'" , "'" ,$where);
	$where = $where."and ".$campo_ant." like '".trim($vlr_campo)."%'";
	if(($campo_ant1) && ($campo_ant1 != $campo_ant)){
		$where = $where."and ".$campo_ant1." like '".trim($vlr_campo1)."%'";
	}
}


if($busca){
	$y = 0;

	$ano_mes_ini = substr($ano_ini, 2, 2).$mes_ini;
	$ano_mes_fim = substr($ano_fim, 2, 2).$mes_fim;
	if(($mes_ini <= $mes_fim) ||  $mes_ini != ""){
		$ano_mes = $ano_mes_ini;
		while($ano_mes <= $ano_mes_fim){
			if($campo1 == "hora_operador_ini"){
				$var_campo1 =  "left(".$campo1.",2) as ".$campo1;
			}else{
				$var_campo1 = $campo1;
			}

			if($campo == "hora_operador_ini"){
				$var_campo =  "left(".$campo.",2) as ".$campo;
			}else{
				$var_campo = $campo;
			}

			if(StrPos($where, "".$campo_servico." in(")){
				for($x=StrPos($where, "".$campo_servico." in(");($char_where != ")" && $x < 4000)  ;$x++ ){
					$char_where = Substr($where,$x,1);
					$string_nb .= $char_where;
				}

			}
			$string_nb_arr = Str_Replace("'","",$string_nb);
			$string_nb_arr = Str_Replace("".$campo_servico." in(","",$string_nb_arr);
			$string_nb_arr = Str_Replace(")","",$string_nb_arr);
			$arr_nb = Split(",",$string_nb_arr);


			$string_nb_arr = Str_Replace("'","",$string_nb);
			$string_nb_arr = Str_Replace("".$campo_servico." in(","",$string_nb_arr);
			$string_nb_arr = Str_Replace(")","",$string_nb_arr);
			$arr_nb = Split(",",$string_nb_arr); 
			for($x_nb=0;$arr_nb[$x_nb];$x_nb++){
				$where_nb = Str_Replace($string_nb," ".$campo_servico." = '".trim($arr_nb[$x_nb])."'",$where);

				$sql = "SELECT ".$campo_extra."".$virg."".$var_campo." ,".$var_campo1.",sum(duracao_operador) as duracao_operador, count(*)as total FROM logura".$ano_mes." ".$where_nb." GROUP BY ".$campo_extra."".$virg."".$campo.",".$campo1."";
				$sql = DescQuery($sql, $session["operador"], $PHP_SELF);

				if($session["print_sql"] == "S" && $x_nb==0){
					print $sql."<br>";
				}

				if($rec = mysql_query($sql, $connect2)){
					if($vlr = mysql_fetch_array($rec)){
						do{
							$var_aux_campo       = StrToUpper($vlr[$campo]);
							$var_aux_campo1      = StrToUpper($vlr[$campo1]);
							$var_aux_campo_extra = $vlr[$campo_extra];

							$indice            = $var_aux_campo.$var_aux_campo1.$var_aux_campo_extra;

							if((BuscaNaMatriz($matriz_aux[indice] , $indice) == -1)) {
								$matriz_aux["indice"][$y] = $indice;

								$matriz[$indice][$campo]       = $var_aux_campo;
								$matriz[$indice][$campo1]      = $var_aux_campo1;
								$matriz[$indice][$campo_extra] = $var_aux_campo_extra;

								if($y > $tot_matriz){$tot_matriz = $y;}
								$y++;
							}
							$matriz[$indice]["duracao"]                            += $vlr["duracao_operador"];
							$matriz_sub[STRTOUPPER($vlr[$campo])]["SUBTOTALTEMPO"] += $vlr["duracao_operador"];
							$matriz["TOTAL"]["duracao"]                            += $vlr["duracao_operador"];
							$matriz[$indice]["qtd"]                                += $vlr["total"];
							$matriz_sub[STRTOUPPER($vlr[$campo])]["SUBTOTAL"]      += $vlr["total"];
							$matriz["TOTAL"]["qtd"]                                += $vlr["total"];
						}while($vlr  = mysql_fetch_array($rec));
					}else{
						$msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
					}
				}else{
					if($session["operador"] == "adm"){
						$msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Tabela<br>";
					}else{
						$msg_nao_conectou =  $msg_nao_conectou."<center><font class='txtvermelho'><b>No mês ".$ano_mes." não existe Ligações<br>";
					}
				}
			}
			$ano_mes = inc_ano_mes($ano_mes);
		}
	}
}

$numero_erro = mysql_errno($connect2);

if($pag){
	$voltar = "cc_consulta.php?nivel=F";
}else{
	$voltar = "Javascript:history.back();";
}

//*************Titulo da função GerarCabecalho*********

$titulo_cabecalho = "Estatística por Agente";

if($mes_ini){
	$titulo_cabecalho.= " de - ".BRdate($StrDataInicio)." até ".BRdate($StrDataFim);
}else{
	$titulo_cabecalho.= " - Faça sua Pesquisa";
}
//*****************************************************
?>

<html>
<head>
   <title><?print $session[sistema]?></title>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <?print $v1_style_css?>
<script language="javascript" type="text/javascript" src="consistencia.js"></script>
<script language="javascript">
<!--

function selecionaAction(relatorio){
	relatorio = relatorio.split('§');
	programa = relatorio[0];
	document.consulta.action=programa;
}
function VerificaForm(){
	data_ini = document.consulta.ano_ini.value+'-'+document.consulta.mes_ini.value+'-'+document.consulta.dia_ini.value;
	date_fim = document.consulta.ano_fim.value+'-'+document.consulta.mes_fim.value+'-'+document.consulta.dia_fim.value;

	date_ini = new Date(document.consulta.ano_ini.value, (document.consulta.mes_ini.value - 1), document.consulta.dia_ini.value);
	date_fim = new Date(document.consulta.ano_fim.value, (document.consulta.mes_fim.value - 1), document.consulta.dia_fim.value);

	if(document.consulta.data_inicio_nivel.value < data_ini ){
		if(checa(document.consulta)){
			<?if($agente_resumo){?>
			if((date_fim - date_ini)/86400000 <= <?print ($agente_resumo-1)?>){
				if(checa(document.consulta)){
					document.consulta.submit();
					document.consulta.busca.value = 'ok';
				}
			}else{
				if(document.consulta.login_operador1.value){
					if(checa(document.consulta)){
						document.consulta.busca.value = 'ok';
						document.consulta.submit();
					}

				}else{
					alert('Para consulta acima de <?print $agente_resumo?> dia(s) , selecione um Agente.');
					return false;

				}
			}

			<?}else{?>
			if((date_fim - date_ini)/86400000 <= 30){
				if(checa(document.consulta)){
					document.consulta.busca.value = 'ok';
					document.consulta.submit();
				}
			}else{
				alert('O intervalo máximo para consulta é de 30 dias.');
				return false;
			}

			<?}?>

			document.consulta.busca.value = 'ok';
			document.consulta.submit();
		}
	}else{
		ano_nivel = document.consulta.data_inicio_nivel.value.substring(0,4);
		mes_nivel = document.consulta.data_inicio_nivel.value.substring(5,7);
		dia_nivel = document.consulta.data_inicio_nivel.value.substring(8,10);
		alert('A Data Inicial deve ser maior que '+ dia_nivel+'/'+mes_nivel+'/'+ano_nivel)
	}

}

function imprimeRelatorio(tipo){

	document.simula.tipo.value=tipo;
	strHelpOptions =  "location=no";
	strHelpOptions += ",toolbar=no";
	strHelpOptions += ",titlebar=no";
	strHelpOptions += ",menubar=no";
	strHelpOptions += ",status=no";
	strHelpOptions += ",scrollbars=yes";
	strHelpOptions += ",top=1";
	strHelpOptions += ",left=1";
	strHelpOptions += ",width=720";
	strHelpOptions += ",height=520";
	Janela = window.open('', 'Janela', strHelpOptions);
	Janela.focus();
	document.simula2.submit();
}








function imprimeRelatorio2(tipo){
	document.simula.tipo.value=tipo;
	strHelpOptions =  "location=no";
	strHelpOptions += ",toolbar=no";
	strHelpOptions += ",titlebar=no";
	strHelpOptions += ",menubar=no";
	strHelpOptions += ",status=no";
	strHelpOptions += ",scrollbars=yes";
	strHelpOptions += ",top=1";
	strHelpOptions += ",left=1";
	strHelpOptions += ",width=720";
	strHelpOptions += ",height=520";
	Janela = window.open('', 'Janela', strHelpOptions);
	Janela.focus();
	document.simula.submit();
}

-->
</script>
</head>
<body>
<br>

<?
print GerarCabecalho($voltar, $titulo_cabecalho, "", "");

if($deonde != "DACNET"){
if($mes_ini){

	$tabelao_titulo.= "<table border='2' align='center' width='520' bordercolor=".$session["td_destaque"]." cellpadding='2' cellspacing='0'>";
	$tabelao_titulo.=   "<tr bgcolor=".$session["td_dado1"].">";
	if($campo     ){
		$tabelao_titulo.= "<td nowrap align='left'><font class='txt5'>    <b>&nbsp;&nbsp;Relatório:      </b>".$titulo."</td>";
	}
	if($StrHoraInicio ){
		$tabelao_titulo.= "<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Entre  </b>".$StrHoraInicio."<b> e </b>".$StrHoraFim."</td>";
	}
	if($StrDataInicio ){
		$tabelao_titulo.= "<td nowrap align='left'><font class='txt5'><b>&nbsp;&nbsp;Período de: </b>".BrDate($StrDataInicio)."<b> até: </b>".BrDate($StrDataFim)."</td>";
	}
	$tabelao_titulo.=   "</tr>";
	$tabelao_titulo.= "</table>";
	$tabelao_titulo.= "<br>";
	print $tabelao_titulo;
?>
  <table border="2" align="center" width="520" bordercolor="<?print $session["td_destaque"]?>" cellpadding="2" cellspacing="0">
    <tr bgcolor="<?print $session["td_dado1"]?>">
       <?if($login_operador){ $monta_titulo                .= "<b>Login Pesquisado: </b> ".$login_operador." ->  ";}?>
       <?if($ddd                          ){ $monta_titulo .= "<b>DDD: </b> ".$ddd." ->  ";}?>
       <?if($tel_prefixo  || $tel_sufixo  ){ $monta_titulo .= "<b>Telefone: </b> ".$tel_prefixo."-".$tel_sufixo." ->  ";}?>
       <?if($ramal){ $monta_titulo = $monta_titulo ."<b>Ramal: </b> ".$ramal." ->  ";}?>
       <?if($grupo){ $monta_titulo = $monta_titulo ."<b>Grupo: </b> ".$grupo." ->  ";}?>
       <?if($equipe){
       	$array_equipe = explode("¢",$equipe);
         $monta_titulo = $monta_titulo ."<b>Equipe: </b> ".valorclasse("EQUIP",$array_equipe[1],$repre)." ->  ";}?>
       <?if($login_operador1){ $monta_titulo = $monta_titulo ."<b>Agente Pesquisado: </b> ".$login_operador1." ->  ";}?>
       <?if($monta_titulo || $desc_campo){?>
          <td nowrap align="left"><font class="txt5" >&nbsp;&nbsp;<?print $monta_titulo =  $monta_titulo.$desc_campo;?></td>
       <?}?>
    </tr>
  </table>
  <br>
   <?if($servico || $servico_passa){
   	$tabelao_servico = "<table border='0' width='700' align='center'>";
   	$tabelao_servico .=  "<tr>";
   	$tabelao_servico .=    "<td align='center'>";
   	$tabelao_servico .=       "<table border='2' align='center'  bordercolor='".$session["td_destaque"]."' cellpadding='2' cellspacing='0'>";
   	$tabelao_servico .=         "<tr bgcolor='".$session["td_dado1"]."'>";
   	$tabelao_servico .=            "<td align='left'><font class='txt5'><b>".$desc_servico."(s):</b>";
   	$x=0;
   	if($servico[$x]){
   		while($servico[$x]){
   			$servico_passa  = $servico_passa.$servico[$x]." - ".ValorClasse($classe_servico,$servico[$x],$repre)." | ";
   			$x++;
   		}
   	}
   	$tabelao_servico .= $servico_passa;
   	$tabelao_servico .= "</td>";
   	$tabelao_servico .=          "</tr>";
   	$tabelao_servico .=        "</table>";
   	$tabelao_servico .=     "</td>";
   	$tabelao_servico .=  "</tr>";
   	$tabelao_servico .="</table>";
   	$tabelao_servico .="<br>";
   	print $tabelao_servico;
   }
}
}

//print $msg_nao_conectou;
if(($busca == "ok")){
	if($y != "0"){

		$tabelao_rel.="<table width='500' border='1' cellpadding='0' cellspacing='0' align='center'  style='border-collapse:collapse'>";
		$tabelao_rel.="       <tr>";
		$tabelao_rel.="        <td rowspan='2' align='center' bgcolor='".$session[td_destaque]."'><font class='txt6'><b>".$titulo."</a></font></td>";
		if($campo != $campo1){
		  $tabelao_rel.="        <td rowspan='2' align='center' bgcolor='".$session[td_destaque]."'><font class='txt6'><b>".$titulo1."</a></font></td>";
		}
		$tabelao_rel.="        <td align='center' colspan='5' bgcolor='".$session[td_destaque]."'><font class='txt6'><b>Totais</font></td>";
		$tabelao_rel.="       </tr>";
		$tabelao_rel.="       <tr>";
		$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>Ligações    </font></td>";
		$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>%(".$titulo.")    </font></td>";
		$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>%(Total)    </font></td>";
		$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>Duração    </font></td>";
		if ($mostra_tmaideal == 1) {
			$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>TMA ".VerificaTime($time,$tma_ideal)."</font></td>";
		} else {
			$tabelao_rel.="        <td align='center' nowrap  bgcolor='".$session[td_destaque1]."'><font class='peq'><b>TMA    </font></td>";
		}
		$tabelao_rel.="       </tr>";

		//ordenando a matriz................................
		sort($matriz_aux[indice],SORT_STRING);
		//reset($matriz_aux[indice]);
		//ordenando a matriz................................



		for($x = 0; $x <= $tot_matriz; $x++){
			$tma = $matriz[$matriz_aux[indice][$x]][duracao]/$matriz[$matriz_aux[indice][$x]][qtd];

			$cor  = $session[td_dado3];
			$cor1 = $session[td_dado1];
			$fonte = "peq";
			$corclick = $session[td_destaque1];

			Switch($campo){
				case "login_operador":
					$campo_imprime = NomeResumidoLogin($matriz[$matriz_aux[indice][$x]][$campo]);
					$align= "left";
					break;
				case "data_ligacao":
					$campo_imprime = BRDATE($matriz[$matriz_aux[indice][$x]][$campo]);
					$align= "center";
					break;
				case "hora_operador_ini":
					$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo]."h";
					$align1= "center";
					break;
				case "tipo_ligacao":
					if($campo_extra){
						$campo_compara = $campo_extra;
					}else{
						$campo_compara = $campo;
					}
					if(trim($matriz[$matriz_aux[indice][$x]][$campo_compara]) == "A"){
						$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo]."-".ValorClasse("URALA",$matriz[$matriz_aux[indice][$x]][$campo],$repre);
					}else{
						$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo]."-".ValorClasse("URALR",$matriz[$matriz_aux[indice][$x]][$campo],$repre);
					}
					$align1= "center";
					break;
				case "desligou":
					$campo_imprime = ValorClasse("URADL",$matriz[$matriz_aux[indice][$x]][$campo],$repre);
					$align1= "center";
					break;
				case $campo_servico:
					$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo]." - ".ValorClasse($classe_servico,$matriz[$matriz_aux[indice][$x]][$campo],$repre);
					$align1= "center";
					break;
				case "grupo":
				case "grupo_transferencia":
					if(trim($matriz[$matriz_aux[indice][$x]][$campo]) == "URA" && $campo == "grupo_transferencia"){
						$campo_imprime = "URA";
					}else{
						if(trim($matriz[$matriz_aux[indice][$x]][$campo]) == "" && $campo == "grupo_transferencia"){
							$campo_imprime = "Não Transferiu";
						}else{
							$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo]." - ".ValorClasse("GRATE",$matriz[$matriz_aux[indice][$x]][$campo],$repre);
						}
					}
					$align1= "center";
					break;

				case "tipo_atendimento":
					if(trim($matriz[$matriz_aux[indice][$x]][$campo]) == "A"){
						$campo_imprime = "Ativo";
					}else{
						if(trim($matriz[$matriz_aux[indice][$x]][$campo]) == "R"){
							$campo_imprime = "Receptivo";
						}else{
							$campo_imprime = "Tipo de  Atendimento não Definido - ".$matriz[$matriz_aux[indice][$x]][$campo];
						}
					}
					$align= "left";
					break;
				case "equipe":
					$campo_imprime = ValorClasse("EQUIP",$matriz[$matriz_aux[indice][$x]][$campo],$repre);
					$align1= "left";
					break;
				default:
					$campo_imprime = $matriz[$matriz_aux[indice][$x]][$campo];
					$align= "left";
					break;
			}

			Switch($campo1){
				case "login_operador":
					$campo_imprime1 = NomeResumidoLogin($matriz[$matriz_aux[indice][$x]][$campo1]);
					$align1= "left";
					break;
				case "hora_operador_ini":
					$campo_imprime1 = $matriz[$matriz_aux[indice][$x]][$campo1]."h";
					$align1= "center";
					break;
				case "desligou":
					$campo_imprime1 = ValorClasse("URADL",$matriz[$matriz_aux[indice][$x]][$campo1],$repre);
					$align1= "center";
					break;
				case "tipo_ligacao":
					if($campo_extra){
						$campo_compara = $campo_extra;
					}else{
						$campo_compara = $campo;
					}
					if(trim($matriz[$matriz_aux[indice][$x]][$campo_compara]) == "A"){
						$campo_imprime1 = $matriz[$matriz_aux[indice][$x]][$campo1]."-".ValorClasse("URALA",$matriz[$matriz_aux[indice][$x]][$campo1],$repre);
					}else{
						$campo_imprime1 = $matriz[$matriz_aux[indice][$x]][$campo1]."-".ValorClasse("URALR",$matriz[$matriz_aux[indice][$x]][$campo1],$repre);
					}
					$align1= "left";
					break;
				case "grupo":
				case "grupo_transferencia":
					if(trim($matriz[$matriz_aux[indice][$x]][$campo1]) == "URA" && $campo1 == "grupo_transferencia"){
						$campo_imprime1 = "URA";
					}else{
						if(trim($matriz[$matriz_aux[indice][$x]][$campo1]) == "" && $campo1 == "grupo_transferencia"){
							$campo_imprime1 = "Não Transferiu";
						}else{
							$campo_imprime1 = $matriz[$matriz_aux[indice][$x]][$campo1]." - ".ValorClasse("GRATE",$matriz[$matriz_aux[indice][$x]][$campo1],$repre);
						}
					}
					$align1= "left";
					break;
				case "data_ligacao":
					$campo_imprime1 = BRDATE($matriz[$matriz_aux[indice][$x]][$campo1]);
					$align= "center";
					break;
				default:
					$campo_imprime1 = $matriz[$matriz_aux[indice][$x]][$campo1];
					$align1= "left";
					break;


			}
			//print $campo_prox."aaaaaaa";

			if($campo_extra){
				$campo1_aux = $campo1;
				//$campo1 = $campo_extra;
			}

			if(StrPos($monta_titulo,$titulo)){
				$desc_campo= urlEncode("<b> ".$titulo1.": </b>".$campo_imprime1)." -> ";
			}else{
				if(StrPos($monta_titulo,$titulo1)){
					$desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";
				}else{
					$desc_campo= urlEncode("<b>".$titulo1.": </b>".$campo_imprime1."<b> -> ".$titulo.": </b>".$campo_imprime)." -> ";
				}

			}

			if(!$tma_ideal) {
				$cor_td1=$cor;
			}elseif ($tma_ideal <= $tma ) {
				$cor_td1 = "#FFAAAA";
			}else { $cor_td1 = "#BBFBBB"; }

            if($deonde != "DACNET"){
			   $click_tr = "onMouseDown=\"window.location='".$prog_prox."?busca=ok&classe_servico=".$classe_servico."&repre=".$repre."&time=".$time."&where=".urlencode($where)."&campo=".$campo_prox1."&campo_ant=".$campo1."&vlr_campo=".$matriz[$matriz_aux[indice][$x]][$campo1]."&campo_ant1=".$campo."&vlr_campo1=".$matriz[$matriz_aux[indice][$x]][$campo]."&desc_campo=".$desc_campo."&titulo_ant=".$titulo1."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."';javascript:style.background='".$corclick."';\"";
            }
			$tabelao_rel.="<tr ".$click_tr.">";
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='".$align."' ><font class='".$fonte."'>";if($matriz[$matriz_aux[indice][$x]][$campo] != $matriz[$matriz_aux[indice][$x-1]][$campo]){$tabelao_rel.= $campo_imprime;}$tabelao_rel.= "&nbsp;</b></font></td>";
			if($campo != $campo1){
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='".$align1."'><font class='".$fonte."'>".$campo_imprime1."</b></font></td>";
			}
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='right'           ><font class='".$fonte."'>".$matriz[$matriz_aux[indice][$x]][qtd]."</b></font></td>";
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='right'           ><font class='".$fonte."'>".percent($matriz[$matriz_aux[indice][$x]][qtd], $matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTAL])."</b></font></td>";
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='right'           ><font class='".$fonte."'>".percent($matriz[$matriz_aux[indice][$x]][qtd], $matriz[TOTAL][qtd])."</b></font></td>";
			$tabelao_rel.="   <td onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor."';\" bgcolor='".$cor."' nowrap align='right'           ><font class='".$fonte."'>".VerificaTime($time,$matriz[$matriz_aux[indice][$x]][duracao])."</b></font></td>";
			$tabelao_rel.="   <td bgcolor='".$cor_td1."' onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$cor_td1."';\" bgcolor='".$cor_td1."' nowrap align='right'           ><font class='".$fonte."'>".VerificaTime($time,round($tma))."</b></font></td>";
			$tabelao_rel.="</tr>";


			if($campo_extra){
				$campo1 = $campo1_aux;
			}
			$total_reg  += 1;
			$sub_total_reg  += 1;
			$sub_perc += percent($matriz[$matriz_aux[indice][$x]][qtd], $matriz[TOTAL][qtd]);



			if((($matriz[$matriz_aux[indice][$x]][$campo]) != ($matriz[$matriz_aux[indice][$x+1]][$campo])) && ($campo != $campo1) && $campo != "uf" && $campo != "ddd" && $campo != "prefixo_telefone" && $matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTAL] != "") {
				$subtot_tma = $matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTALTEMPO]/$matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTAL];
				$desc_campo= urlEncode("<b> ".$titulo.": </b>".$campo_imprime)." -> ";

				if(!$tma_ideal) {
					$cor_td2 = $session[td_destaque1];
				}else {
					if ($subtot_tma > $tma_ideal) {
						$cor_td2 = $session[td_destaque1];
					}else { $cor_td2 = "#008B45"; }
				}
                if($deonde != "DACNET"){
				  $click_tr = "onMouseDown=\"window.location='".$prog_prox."?busca=ok&classe_servico=".$classe_servico."&repre=".$repre."&time=".$time."&where=".urlencode($where)."&campo=".$campo_prox."&campo_ant=".$campo."&vlr_campo=".$matriz[$matriz_aux[indice][$x]][$campo]."&desc_campo=".$desc_campo."&titulo_ant=".$titulo."&monta_titulo=".urlEncode($monta_titulo)."&servico_passa=".urlencode($servico_passa)."&StrDataInicio=".$StrDataInicio."&StrDataFim=".$StrDataFim."&StrHoraInicio=".$StrHoraInicio."&StrHoraFim=".$StrHoraFim."';javascript:style.background='".$corclick."';\"  onMouseOver=\"javascript:style.background='".$cor1."';style.cursor='pointer';style.cursor='hand';\" OnMouseOut=\"javascript:style.background='".$session[td_destaque1]."';\"";
                }
				$tabelao_rel.="        <tr >";
				$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='left' ><font class='".$fonte."'>&nbsp;   SUBTOTAL      &nbsp;</b></font></td>";
				if($campo != $campo1){
			  	$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='left' ><font class='".$fonte."'>&nbsp;   </b></font></td>";
				}
				$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='right'                           ><font class='".$fonte."'>".$matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTAL]."                            </b></font></td>";
				$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='right'                           ><font class='".$fonte."'>100.0                               </b></font></td>";
				$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='right'                           ><font class='".$fonte."'>".$sub_perc."                          </b></font></td>";
				$tabelao_rel.="          <td bgcolor='".$session[td_destaque1]."' nowrap align='right'                           ><font class='".$fonte."'>".VerificaTime($time,$matriz_sub[trim($matriz[$matriz_aux[indice][$x]][$campo])][SUBTOTALTEMPO])."                       </b></font></td>";
				$tabelao_rel.="          <td bgcolor='".$cor_td2."' nowrap align='right'                           ><font class='".$fonte."'>".VerificaTime($time,round($subtot_tma))."                               </font></td>";
				$tabelao_rel.="        </tr>";
				$tabelao_rel.="        <tr><td  colspan='7' ><img src='imagens/blank.gif' height='8'></td></tr>";

				$sub_perc=0;
				$sub_total_reg=0;
			}
		}
		$tma_tot = $matriz[TOTAL][duracao]/$matriz[TOTAL][qtd];

		if (!$tma_ideal) {
			$cor_td3 = $session[td_destaque];
		} else {
			if ($tma_tot > $tma_ideal ) {
				$cor_td3 = $session[td_destaque];
			}else { $cor_td3 = "#006400"; }
		}

		$tabelao_rel.="        <tr>";
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='".$align."'><font class='txt6'><b>&nbsp;   TOTAL &nbsp;</b></font></td>";
		if($campo != $campo1){
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='right'           ><font class='txt6'><b>".$total_reg."</b></font></td>";
		}
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='right'           ><font class='txt6'><b>".$matriz[TOTAL][qtd]."                               </b></font></td>";
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='right'           ><font class='txt6'><b>   - &nbsp;</b></font></td>";
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='right'           ><font class='txt6'><b>   100.0    </b></font></td>";
		$tabelao_rel.="           <td bgcolor='".$session[td_destaque]."' nowrap align='right'           ><font class='txt6'><b>   ".VerificaTime($time,$matriz[TOTAL][duracao])."                               </b></font></td>";
		$tabelao_rel.="           <td bgcolor='".$cor_td3."' nowrap align='right'           ><font class='txt6'><b>   ".VerificaTime($time,round($tma_tot))."</b></font></td>";
		$tabelao_rel.="        </tr>";
		$tabelao_rel.="     </table>";
		print $tabelao_rel;

?>

      <?
      //LEGENDA DAS CORES
      ?>
<?
if($deonde != "DACNET"){
?>
      <BR>
      <table align="center" width="550" border="0" cellspacing="0" cellpadding="0" bordercolor="<?print $session[td_destaque]?>">
         <tr>
           <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session[td_destaque]?>"><tr><td align="center" bgcolor="#FFAAAA"><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>
           <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;TMA Fora do Esperado   </td>
           <!-- <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session[td_destaque]?>"><tr><td align="center" bgcolor="<?print $amarelo    ?>"><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>-->
           <!-- <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;Alerta (50% da Meta)</td>-->
           <td><table align="right" border="1" cellspacing="0" cellpadding="0" bordercolor="<?print $session[td_destaque]?>"><tr><td align="center" bgcolor="#BBFBBB" ><font class="txt5">&nbsp;&nbsp;&nbsp;&nbsp;               </td></tr></table></td>
           <td align="left"   bordercolor="white"  width="150"><font class='txt5'>&nbsp;&nbsp;TMA Dentro do Esperado  </td>
         </tr>
      </table>
      <br>


     <BR>
<?/******************************* Exportando para Excel******************************************/?>
  <form name="simula" method="post" action="mp3_excel_impressao.php" target="Janela">
     <input type="hidden" name="tabelao_titulo1"    value="<?print urlencode($tabelao_titulo)?>">
     <input type="hidden" name="tabelao_servico"   value="<?print urlencode($tabelao_servico)?>">
     <input type="hidden" name="tabelao_rel"    value="<?print urlencode($tabelao_rel)?>">
     <input type="hidden" name="tipo"           value="">
  </form>


<table align="center"><tr>
        <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Exportar o Relatório para o Excel" onClick="imprimeRelatorio2('excel')">
          <center><img src="imagens/excel.gif" align="bottom" ><font class="txt5"><b>&nbsp;</center>
        </td>

<?/*******************************FIM Exportando para Excel******************************************/?>

<?//*********************************Tabela Com o Botão para impressão Funcao Imprime Relatório*************?>
        <td nowrap onmouseover="style.cursor='pointer';style.cursor='hand'" title="Clique para Imprimir o Relatório" onClick="imprimeRelatorio('imprime')">
          <center><img src="imagens/print1.gif" width="20" align="botton" ></center>
        </td>
      </tr>
    </table>
    <form name="simula2" method="post" action="dac_con_regiao_det_impressao.php" target="Janela"                              >
      <input type="hidden" name="tabelao_titulo"    value="<?print urlencode($tabelao_titulo)?>"                              >
      <input type="hidden" name="tabelao_servico"   value="<?print urlencode($tabelao_servico)?>"                             >
      <input type="hidden" name="tabelao_rel"       value="<?print urlencode(str_replace('onMouseDown','bla',$tabelao_rel))?>">
      <input type="hidden" name="tipo"              value="imprime">
    </form>
<?//******************************************************************************************************* ?>
   <?
}   
	}else{
		if($mes_ini){
			if($numero_erro == "1053"){
				print "<center><font class='txtvermelho'><b>Diminuir o intervalo de Data e Refazer Consulta";
			}else{
				print "<center><font class='txtvermelho'><b>Nenhum Registro Encontrado";
			}
		}
	}
}
//*********************************************************************************************************
//***************************-------TABELA DE BUSCA TODAS IGUAIS-------************************************
//*********************************************************************************************************

if(($pag == "1" || (!$dia_ini)) && $deonde != "DACNET"){
   ?>
   <form name="consulta" method="get" action="<?print $programa?>" onSubmit="return checa(this)">

<?
$sql_pes         = "SELECT data_inicio_nivel FROM tbniveis where nivel = 'F2' ";
$query_pes       = mysql_query ($sql_pes, $connect);
if($data_pes        = mysql_fetch_array ($query_pes)){
?>
     <input type="hidden" name="data_inicio_nivel" value="<?print $data_pes[data_inicio_nivel];?>">
<?
}else{
?>
     <input type="hidden" name="data_inicio_nivel" value="false">
<?
}
?>
<input type="hidden" name="agente_resumo" value="<?print $agente_resumo?>">
<input type="hidden" name="pag"   value="1">
<input type="hidden" name="busca" value="">
   <table width="300" border="1" cellpadding="0" cellspacing="0" align="center"  bordercolorlight="<?print $session[td_destaque];?>" bordercolordark="<?print $session[td_dado3];?>">
     <tr bgcolor="<?print $session[td_destaque]?>">
       <td colspan= "2" align="center"><font class="txt6"><b>
       <?
       $combo_repre = MontaCombo("REPRE",$repre, $session[representante]);
       $titulo_repre = $titClasse;
       ?>
       <font class="txt6"><b><?print $titulo_repre?>:</b>
        <select name="repre" onChange="window.location='dac_con_oper_det.php?pag=1&ano_ini='+document.consulta.ano_ini.value+'&mes_ini='+document.consulta.mes_ini.value+'&dia_ini='+document.consulta.dia_ini.value+'&agente_resumo=<?print $agente_resumo?>&ano_fim='+document.consulta.ano_fim.value+'&mes_fim='+document.consulta.mes_fim.value+'&dia_fim='+document.consulta.dia_fim.value+'&hora_ini='+document.consulta.hora_ini.value+'&min_ini='+document.consulta.min_ini.value+'&hora_fim='+document.consulta.hora_fim.value+'&min_fim='+document.consulta.min_fim.value+'&relatorio='+document.consulta.relatorio.value+'&repre='+this.value+''">
            <?print $combo_repre;?>
          </select>
       </td>

     <tr bgcolor="<?print $session[td_destaque1]?>">
     <td width="450">
       <table width="450" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session[td_destaque];?>" bordercolordark="<?print $session[td_dado3];?>">
           <tr  >
              <td align="center"><font class="txt5"><b>Relatório:
                  <select name="relatorio" onChange="selecionaAction(this.value)" consistencia="sempre" consistencia1="pre" msg="Selecione o Relatório!"><?print MontaCombo("URARO", $relatorio, $repre);?></select>
              </td>
                <td colspan="2" align="center"><font class="txt5"><b></b>
                   <input type="radio" name="time"  value="min"<?if($time == "min" || $time == ""){print "checked";}?>><b>Minuto</b>
                   <input type="radio" name="time"  value="seg"<?if($time == "seg"){print "checked";}?>><b>Segundo</b>
                </td>

           </tr>
       </table>
       <table width="444" border="1" cellpadding="2" cellspacing="0" align="center"  bordercolorlight="<?print $session[td_destaque];?>" bordercolordark="<?print $session[td_dado3];?>" >
         <tr bgcolor="<? $session[td_dado3]?>">
            <td colspan= "2">
              <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session[td_destaque];?>" bordercolordark="<?print $session[td_dado2];?>">
                  <tr bgcolor="<?print $session[td_dado2]?>">
                      <td width="50%" align="center">
                           <font class="txt5"><b>Hora Inicial:
                           <select name="hora_ini">
                               <?for ($i=0; $i<24; $i++){ ?><option value="<?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_ini, $i, "00");?>><?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                           </select><b>:</b>
                           <select name="min_ini" <?print $disabled?>>
                              <option value="00" <?if($min_ini == "00" || $min_fim == ""){ print "selected";}?>>00</option>
                              <option value="15" <?if($min_ini == "15"){ print "selected";}?>>15</option>
                              <option value="30" <?if($min_ini == "30"){ print "selected";}?>>30</option>
                              <option value="45" <?if($min_ini == "45"){ print "selected";}?>>45</option>
                           </select><b></b>
                      </td>
                         <td width="50%" align="center">
                           <font class="txt5"><b>Hora Final:
                           <select name="hora_fim">
                               <?for ($i=0; $i<=24; $i++){ ?><option value="<?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?>"<?print ImprimeSelected($hora_fim, $i, "24");?>><?if ($i < 10){$xi = $i; $xi="0".$xi;print $xi;} else{print $i;}?></option><?}?>
                           </select><b>:</b>
                           <select name="min_fim" <?print $disabled?>>
                              <option value="00"<?if($min_fim == "00" || $min_fim == ""){ print "selected";}?> >00</option>
                              <option value="15"<?if($min_fim == "15"){ print "selected";}?> >15</option>
                              <option value="30"<?if($min_fim == "30"){ print "selected";}?> >30</option>
                              <option value="45"<?if($min_fim == "45"){ print "selected";}?> >45</option>
                           </select><b></b>
                      </td>
                   </tr>
                  <tr bgcolor="<?print $session[td_dado2]?>">
                    <td  align="center" colspan="2"><font class="txt5">
               <?
               print dataCalendarioNovo("dia_ini","mes_ini","ano_ini","dia_fim","mes_fim","ano_fim","","","","consulta");
               ?>
                     </td>
                  </tr>
               </table>
            </td>
          </tr>

          <tr bgcolor="<?print $session[td_dado3]?>">
              <!--******************************************EQUIPE**************************************-->
              <?

              $tit_equipe = "SELECT desc_classe FROM tb_classe WHERE cod_classe = 'EQUIP' AND representante = '".$repre."' AND tipo_reg = 'T'";
              $query_tit = mysql_query($tit_equipe,$connect);
              if( $vlr = mysql_fetch_array($query_tit)){
              	$tit_equipe = $vlr["desc_classe"];
              }else{
              	$tit_equipe = "Equipe";
              }
              ?>


              <td nowrap align="Left"><font class="txt5"><b><?print $tit_equipe?>:</b>
                    <?
                    $where_repre  = "and representante = '".$repre."'";
                    $rec   = "SELECT desc_classe,vlr_classe FROM tb_classe WHERE cod_classe = 'EQUIP' and status = 'A' and tipo_reg<>'T' ".$where_repre."";
                    $query = mysql_query($rec, $connect);
                    $rec   = mysql_fetch_array($query);
                    ?>

                    <select name="equipe"
                         if($busca == "ok"){
                            onChange="window.location='dac_con_oper_det.php?<?print str_replace("&equipe=".$equipe , "" ,$QUERY_STRING)?>&equipe='+this.value"
                         }else{
                            onChange="window.location='dac_con_oper_det.php?pag=1&ano_ini='+document.consulta.ano_ini.value+'&mes_ini='+document.consulta.mes_ini.value+'&dia_ini='+document.consulta.dia_ini.value+'&ano_fim='+document.consulta.ano_fim.value+'&mes_fim='+document.consulta.mes_fim.value+'&dia_fim='+document.consulta.dia_fim.value+'&agente_resumo=<?print $agente_resumo?>&hora_ini='+document.consulta.hora_ini.value+'&min_ini='+document.consulta.min_ini.value+'&hora_fim='+document.consulta.hora_fim.value+'&min_fim='+document.consulta.min_fim.value+'&relatorio='+document.consulta.relatorio.value+'&repre='+document.consulta.repre.value+'&equipe='+this.value+''"
                         }
                     >
                         <?
                         do{
                         ?>
                              <option value="<?print $rec[vlr_classe];?>" <?if($equipe == $rec[vlr_classe]){print "selected";}?>> <?print $rec[desc_classe];?></option>
                         <?
                         }while($rec = mysql_fetch_array($query));
                         ?>
                         <option value="" <? if($equipe == ""){print "selected";}?>>TODOS</option>
                    </select>
                    <!--*******************************AGENTE***************************************************-->
                    <font class="txt5"><b>Agente:</b>
                    <?
                    $where_repre  = "and empresa = '".DefineRepre($repre)."'";
                    if($equipe != ""){
                    	$where_equipe = "and equipe = '".$equipe."'";
                    }
                    $rec = "SELECT nome_resumido,login,tp_user FROM tbadmin WHERE tp_user in('OPE','MON','COO','DES') ".$where_repre." ".$where_equipe." ORDER BY nome_resumido";
                    //print $rec;
                    $query = mysql_query($rec, $connect);
                    $rec = mysql_fetch_array($query);
                    ?>
                    <select name="login_operador1" <?print $disabled?>>
                         <?
                         do{
                         	if($rec[tp_user] == "DES"){
                         		$cor_usuario = "txtvermelho3";
                         	}else{
                         		$cor_usuario = "txt5";
                         	}
                         ?>
                              <option class="<?print $cor_usuario;?>" value="<?print $rec[login];?>" <?if($login_operador1 == $rec[login] ){print "selected";}?>> <?print $rec[nome_resumido]."-".$rec[login];?></option>
                         <?
                         }while($rec = mysql_fetch_array($query));
                         ?>
                       <option value="sem_discador" <?if($login_operador1 == "sem_discador"){print "selected";}?>>TODOS SEM DISCADOR</option>
                       <option value="" <?if($login_operador1 == ""){print "selected";}?>>TODOS</option>
                    </select>
               </td>
               <td rowspan='4' nowrap><font class="txt5">
               <input type="radio" name="classe_tipo" value="URALR" <?if($classe_tipo == "URALR"){ print "checked";}?> onclick="document.consulta.submit()">
               <b>Receptivo</b>
               <input type="radio" name="classe_tipo" value="URALA" <?if($classe_tipo == "URALA"){ print "checked";}?> onclick="document.consulta.submit()">
               <b>Ativo</b>
               <input type="radio" name="classe_tipo" value="todos" <?if($classe_tipo == "todos"){ print "checked";}?> onclick="document.consulta.submit()">
               <b>Ambos</b><BR>
                 <select multiple size='7' name="tipo_ligacao[]" <?if($classe_tipo == "todos"){ print "disabled";}?>>
                   <?if($classe_tipo != "todos"){
                   	print MontaLista($classe_tipo,$tipo_ligacao,$repre,"","",$order_servico,"S");
                   }else {
                   	print MontaLista("URALR",$tipo_ligacao,$repre,"","",$order_servico,"S");
                    }?>
                 </select>
               </td>
          </tr>
          <tr bgcolor="<?print $session[td_dado3]?>">
              <td nowrap><font class="txt5"><b>Grupo:</b>
                 <select name="grupo" >
                    <option value="" <?if(!$grupo){print "checked";}?>>TODOS</option>
                    <?print MontaLista("GRATE", $grupo,$repre,"",$grupo);?>
                 </select>
              </td>
          <tr bgcolor="<?print $session[td_dado3]?>">
            <td nowrap align="Left"><font class="txt5"><b>DDD:</b>
               <select name="ddd"   msg="Selecione um Produto!" <?print $disabled?>>
                <?
                $sql_pes        = "SELECT ddd,regiao from tblgcddd where regiao <> 'DDD Inválido' group by ddd";
                $query_pes      = mysql_query ($sql_pes, $connect3);
                print "<option value='' selected>TODOS</option>";
                while($ddd_pes  = mysql_fetch_array ($query_pes)){
                	if($ddd == $ddd_pes[ddd]){$selected = "selected";}
                	print "<option value='".$ddd_pes[ddd]."'".$selected.">".$ddd_pes[ddd]." - ".$ddd_pes[regiao]."</option>";
                	$selected = "";
                }
                ?>
               </select>
            </td>
          </tr>
          <tr bgcolor="<?print $session[td_dado3]?>">
             <td nowrap align="Left"><font class="txt5">
             <b>Tel:</b>
             <input type="text" name="tel_prefixo" value="<?print $tel_prefixo?>" size="4" maxlength="4"  onKeyUp="pula(this,4,tel_sufixo);">-<input type="text" name="tel_sufixo" value="<?print $tel_sufixo?>" size="5" maxlength="4">
             <b>Ramal:</b>
             <input type="text" name="ramal" value="<?print $ramal?>" size="4" maxlength="4"  >
             </td>
          </tr>
       </table>
       </td>
       <td align="center">
       <table width="100%" border="1" cellspacing="0" cellpadding="1" align="center"bordercolorlight="<?print $session[td_destaque];?>" bordercolordark="<?print $session[td_dado3];?>">
           <tr>
              <td align="center" colspan='2'><font class="txt5">
                     <input type="radio" name="classe_servico" value="GRATE" <?if($classe_servico == "GRATE"){ print "checked";}?> onclick="document.consulta.submit()">
                     <b>Grupo(s):</b>
                     <input type="radio" name="classe_servico" value="URANB" <?if($classe_servico == "URANB"){ print "checked";}?> onclick="document.consulta.submit()">
                     <b>Serviço(s):</b>
              </td>
           </tr>
           <tr  >
             <td align="center" ><font class="txt1"><b>
               <select  multiple size="10" name="servico[]"  consistencia="sempre" consistencia1="pre" msg="Selecione o(s) Serviço(s)!">
                  <?print MontaLista($classe_servico, $servico,$repre,"","",  $order_servico); ?>
               </select>
             </td>
             <td>
              <?
              if(!$order_servico){
              	$order_servico = "desc_classe";
              }
              ?>
               <font class="txt5"><b>Abc<br><input type="radio" name="order_servico" value="desc_classe" <?if($order_servico == "desc_classe"){ print "checked";}?> onclick="document.consulta.submit()">
                <br><br>
               <font class="txt5"><b>123<br><input type="radio" name="order_servico" value="vlr_classe" <?if($order_servico == "vlr_classe"){ print "checked";}?> onclick="document.consulta.submit()">

           </tr>

       </table>
       </td>
       </tr>
       </table>
        <br><center><input type="button" name="enviar" value=" Procurar " class="but_liga_on" onclick="VerificaForm()"  style="background-color: <?print $session["td_dado3"]?>;" onMouseOver="javascript:style.background='<?print $session["td_dado1"]?>';style.cursor='pointer';style.cursor='hand';" onMouseOut="javascript:style.background='<?print $session["td_dado3"]?>';"></center>
   </form>
<?
}?>
<br>
<?print GerarRodape($voltar);?>
</body>
</html>
