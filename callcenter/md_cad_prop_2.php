<?php
session_start();
session_register("session");
include "cc_libcallcenter.php";
//error_reporting(E_ALL ^ E_DEPRECATED ^ E_NOTICE);
if (!isset($session)) {header ("Location:".HTTPHOST.DOCROOT."cc_login.php"); exit;}
require_once($_SERVER["DOCUMENT_ROOT"]."/libs/func/AJAXFunc.php");
//arrayr_map_globals("addslashes"); não subir com com esse addslashes, existem muitos hiddens que passam where para o bd por exemplo where_grava_cliente_gss, para casa submit dentro para o proprio md_cad_prop_2.php, ele adiciona uma \ para scape. no final esta chegando \\\' Marcelo comentou esta linha em 21/04/2020
// showvars();
$GLOBALS["ramal_atend"] = $_REQUEST["ramal_atend"];

if (empty($GLOBALS["ramal_atend"]) === true) {
  $GLOBALS["ramal_atend"] = $session["ramal"];
}

require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/bd/Conexao.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/ctr/RamalWeb.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/func/ValidaVersao.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/pst/AtendimentoPST.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/cores.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/md_funcoes.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/mk_funcoes.php");
require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/lib_criptografa.php");
require_once($_SERVER["DOCUMENT_ROOT"]."/libs/lang/tradutor.php");
$objTradutor = new Tradutor($session["idioma"]);

if ($tipo_modelo == "FOLLOWUP_ATV" ||  $tipo_modelo == "FLW_ATV_S_MAIL" || $tipo_modelo == "FOLLOWUP") {
  require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/flw_funcoes.php");
}
if ($_GET["nro_modelo"] == "Z6") {
  foreach ($_GET as $key => $value) {
    $_POST[$key] = ${$key} = $value;
  }
  $sa_tipo = "";
}
//print $nro_modelo;



if($session["md_campo_passa_".$nro_modelo]){
  $arrCMPMod = json_decode($session["md_campo_passa_".$nro_modelo], true);
  if(is_array($arrCMPMod)){
    foreach ($arrCMPMod as $var => $vlr){
      if(!$$var)
        $$var = $vlr;
    }
  }
  unset($arrCMPMod);
}

$mk_numero = achaNroModelo($nro_modelo, $tipo_abertura);

//**************************************************
//Carrega parametros como BD,TABELA etc...
//*************************** ***********************0
carregaParametros1($_REQUEST["repre_param"]);

//gambiarra protocolos boleto promotora
if ($nro_modelo == "AN" && $mk_origem_atd == "52" && $repre_vendedor == "BMC") {
  $sistema_origem = "TU";
  $conclusao = "Conclusão¢¢Solicitou Boleto¢¢¢Observações¢¢Solicitou Boleto SIAPE¢Solicitou Boleto Privado¢";
  $disk_ficha = "N";
  unset($tipo_abre_historico);
}

//DEFININDO QUAL ARQUIVO montaDiv DEVE SER INCLUIDO NO CARREGAMENTO DA PÁGINA
$montaDivPopUp = 'montaDivPopUp';
if ($_SESSION['ambiente'] == 'teste' && (preg_match("/^HONDA/", $repre_vendedor))) {
  $montaDivPopUp = 'montaDivPopUpHonda';
}

//INI-FACILITAR A VERIFICAÇÃO DOS PARÂMETROS DE IDENTIFICAÇÃO DO ATENDIMENTO

//VERIFICA SE O NÚMERO DO PEDIDO DEVE SER GERADO NO INÍCIO DO ATENDIMENTO
$isGeraPedido = (strpos("¢{$selecao_receptivo}¢", "¢gera_pedido¢") !== false);
//VERIFICA SE O MODELO UTILIZA REGISTRO DE ATENDIMENTO
$isRegAtd = ((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A"));
//IDENTIFICA A LIGAÇÃO POR SINCRONISMO COM O DAC
$isLigSinc = (strpos("¢{$selecao_receptivo}¢", "¢r_lig_sinc¢") !== false);
//PEDIDO PODE SER GERADO NO INÍCIO DA LIGAÇÃO
$isGeraPreAtd = (strpos("¢{$selecao_receptivo}¢", "¢pre_atd¢") !== false);
//VERIFICA SE O NÚMERO DO PEDIDO PODE SER GERADO NA URA
$isUraGeraProtocolo = (strpos("¢{$selecao_receptivo}¢", "¢ura_gera_protocolo¢") !== false);

//FIM-FACILITAR A VERIFICAÇÃO DOS PARÂMETROS DE IDENTIFICAÇÃO DO ATENDIMENTO

//VERIFICA SE O REGISTRO É SOMENTE DA LIGAÇÃO
$isRegAtdLig = (($isRegAtd === true) && ($atv_st_venda_cartao == "3"));

if ( $usa_rotina_log_tela == 'S' ) {
  require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/func/LogTela.php");
  $logTela  = new LogTela($repre_vendedor, 'MD'.$nro_modelo, null, null, $param_empresa);
  $logTela->setcampoIdTela($usa_rotina_log_tela_cpo_tela_num);
  $logTela->setcampoIdNPedido($usa_rotina_log_tela_cpo_n_pedido);
  $logTela->setFlagGravaIniAtd(false);
}

//$usa_bootstrap = "N";
if ($session["marca_ponto"] == "S") {
  require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/RamalWeb.php");
  $objRamal = new RamalWeb($session["ip_dac"], $session["porta_dac"], $ramal_atend);
  $id_do_ramal = $objRamal->getCampo("id");
  if (
  (mb_strtolower($session["operador"]) == mb_strtolower($objRamal->getCampo("login_operador"))) && (
  //RAMAL DO CHAT
  ((preg_match("/(([H])[0-9]{3}\\2\|)/", $objRamal->getCampo("atende"))) && (mb_strtolower(substr($ramal_atend, 0, (strlen($session["ramal"]) + 1))) == mb_strtolower($session["ramal"]."H")))
  ||
  //VIDEO NO RAMAL DE TELECOM
  (preg_match("/(([V])[0-9]{3}\\2\|)/", $objRamal->getCampo("atende")))
  ||
  //RAMAL DO IM
  (substr($objRamal->getCampo("atende"),0,1) == "H" && is_numeric(substr($objRamal->getCampo("atende"),1,1)) === false)
  )
  ) {
    //ATENDIMENTO DE CHAT
    if (strpos($selecao_receptivo, "¢r_lig_sinc") === false && $nro_modelo == "BI") {
      $selecao_receptivo .= "¢r_lig_sinc";
      $selecao_receptivo_texto_botao = "Identificar Atendimento";
    }
  }
}

//**************************************************
//Conecta ao BD do Parametro***********************
//**************************************************
if ($host == "") {
  $connectHOST = ConnectDB();
} else {
  $connectHOST = Conecta($host, $user, $senha, $bd);
}

$connect = ConnectDB();
$connect_ramal = ConnectRAMAL();
//**************************************************

if ($usa_repre_vendedor == "S") {
  $repre_sistema = $repre_vendedor;
} else {
  $repre_sistema =  $session["representante"];
}

if ($include_dados) {
  $prg_include_dados     = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_dados_".$include_dados.".php", "N");
  $prg_include_cabecalho = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_cabecalho_".$include_dados.".php", "N");
  $prg_include_conteudo  = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_conteudo_".$include_dados.".php", "N");
}

$tipo_agenda   = explode("¢",$tipo_agenda);
$arr_conclusao = explode("¢",$conclusao);

$classe_midia   = StrtoUpper($classe_midia );
$classe_recusa  = StrtoUpper($classe_recusa);
$classe_c_imp   = StrtoUpper($classe_c_imp );
$classe_agenda  = StrtoUpper($classe_agenda);

if (!$ultima_pos_barra) {
  $ultima_pos_barra = "0";
}
if ($form_aceitou == "S" && !$tipo_atend) {
  $tipo_atend = "1";
}
$arr_campo_nome_razao = explode("¢",$campo_nome_razao);

if ((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) {
  require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/RegAtd.php");
}







if(substr($session["operador"],0,50) == "levchat1" ||  substr($session["operador"],0,50) == "levchat2"){
///colocando parametros na mao para testar*****************

$param_omini["nb"][0] = "HL14";
$param_omini["nb"][1] = "HL23";
$param_omini["nb"][2] = "HL37";
$param_omini["representante"] = $repre_vendedor;


$usa_omnivision = "S";
$omnivision_params = json_encode($param_omini);

//********************************************
}






//**************************************************************
//**************PARÂMETRO SCRIPT ARGUMENTOS*********************
//**************************************************************
if (empty($script_argumento) === false) {
  $mtr_script_argumento = explode("¢", $script_argumento);
} else {
  unset($mtr_script_argumento);
}
//**************************************************************
//**************************************************************
//**************************************************************

//**************************************************************
//**************PARÂMETRO SCRIPT ARGUMENTOS*********************
//**************************************************************
if (empty($script_flutuante) === false) {
  $mtr_script_flutuante = explode("¢", $script_flutuante);
} else {
  unset($mtr_script_flutuante);
}
//**************************************************************
//**************************************************************
//**************************************************************

//**************************************************
if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME) - OS INCLUDES SÓ PODEM SER FEITOS APÓS SEREM CARREGADOS OS PARAMETROS DO MD
  $ibm_sistema = $usa_emu;

  require_once("funcoes/Emulador.php");
  require_once("funcoes/Emulador".$usa_emu.".php");

  getUserPassRe($session["operador"]);
}


//*****************************************************************************************************
//*****************************************************************************************************
//*****************************************************************************************************
//*********************  FUNCOES DO AJAX **************************************************************
//*****************************************************************************************************
//*****************************************************************************************************
//*****************************************************************************************************
require_once("/libs/ctr/xajax/xajax.inc.php");
$xajax_mk = new xajax($PHP_SELF."?nro_modelo=".$nro_modelo."&tipo_abertura=".$tipo_abertura."&nivel_atual=".$nivel_atual);

//PARA CRIAR OUTRA FUNCAO BASTA REGISTRAR ELA ABAIXO
$xajax_mk->registerFunction("LigacaoPower");
/**
 * Funcao que faz ligação e retorna o retorno...
 * essa funcao é invocada via javascript atravez dos metodos de javascript
 *
 * @param fone_com_ddd $fone_liga
 * @param id_tb_ramal $id_cli
 * @param nro_telefone_loop $nro_linha
 * @return return_assincrono
 */
function LigacaoPower($fone_liga,$id_cli,$nro_modelo) {
  require_once("/libs/ctr/CallMaster.php");
  global $session;
  global $disk_ficha;
  global $selecao_receptivo;
  global $mk_origem_atd;
  global $repre_vendedor;

  $retorno          = CallMaster::liga($fone_liga,"MD",$nro_modelo,$id_cli);
  $objResponse      = new xajaxResponse();
  if ($retorno != "OK") {
    $objResponse->addAlert($retorno);
  } else {
    if ($disk_ficha == "O") {
      $objResponse->addScript("document.cadastro.ja_ligou.value = 'S';");
    }

    if ( strpos(" ".$selecao_receptivo, "r_lig_sinc") > 0) {
      if ($nro_modelo == "T9" || $nro_modelo == "9X" || $nro_modelo == "9Y") {
        //FEITO PELO ADRIANO - NÃO PISCAR A TELA QUANDO LIGAR PARA O CLIENTE
      } else {
	      $objResponse->addScript("setTimeout(function(){botao_liga.disabled = false;verificaReceberLigacaoSinc(document.cadastro,'MD');botao_liga.disabled = true;},2000);");
      }

    }

    $objResponse->addScript("document.cadastro.ligou_na_ficha.value = 'S';");
  }
  /*
  if ($nro_modelo == "T8" || $nro_modelo == "T9") {
  if(($mk_origem_atd == "R" || $mk_origem_atd == "01") && ValorClasse("MD".$nro_modelo."L","PAUSA_AUTOMATICA",$repre_vendedor) == "S") {
  mkPausaTela("entraPausa");

  require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/RamalDac.php");
  $objRamalDac = new RamalDac($session["ip_dac"], $session["porta_dac"], $ramal_atend);
  $objRamalDac->setCampo("obs_tela", "TABULANDO LIGAÇÃO");
  $objRamalDac->execUpdate();
  }
  }
  */
  $objResponse->addScript("botao_liga.value = 'Lig';");
  $objResponse->addScript("botao_liga.style.background = '#008800';");
  $objResponse->addScript("botao_liga.disabled = false;");
  $objResponse->addScript("botao_liga.style.width = '22';");

  return   $objResponse->getXML();
}

if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME) - FUNÇÕES AJAX

  $xajax_mk->registerFunction("emuLogIn");
  $xajax_mk->registerFunction("emuLogOut");

  /**
   * Efetua Login no Sistema Emulado (IBM3270)
   *
   * @return xajax XML Response
   */
  function emuLogIn($arr_form_cadastro)
  {
    global $session;

    $inner_emuIdStatus  = "Deslogado";
    $innet_emuIdSession = "";

    if (empty($session["cso_id"]) === true) {
      global $ibm_sistema, $cso_env_login, $cso_env_senha, $ibm_login, $ibm_senha;

      $cso_env_login = $ibm_login;
      $cso_env_senha = $ibm_senha;

      $emuMsgRetorno = emularSist($ibm_sistema, "LOGIN");

      if (empty($session["cso_id"]) === false) {
        $inner_emuIdStatus  = "Logado - ";
        $innet_emuIdSession = $session["cso_id"];
      } else {
        global $emu_error_msg, $alterar_senha_1, $alterar_senha_2;

        if (empty($emu_error_msg) === false) {
          if (empty($emuMsgRetorno) === false) {
            $emu_error_msg = $emuMsgRetorno;
          }
        }

        if (empty($emu_error_msg) === false) {
          if (empty($alterar_senha_1) === false) {
            $emu_error_msg .= " (".$alterar_senha_1.")";
          }
          if (empty($alterar_senha_2) === false) {
            $emu_error_msg .= " (".$alterar_senha_2.")";
          }
        }
      }
    } else {
      $inner_emuIdStatus  = "Logado - ";
      $innet_emuIdSession = $session["cso_id"];

    }

    $resposta = new xajaxResponse();

    $resposta->addAssign("emuIdStatus", "innerHTML", $inner_emuIdStatus);
    $resposta->addAssign("emuIdSession", "innerHTML", $innet_emuIdSession);
    $resposta->addAssign("emuBoxError", "innerHTML", $emu_error_msg);

    global $ibm_sistema;

    if (function_exists("emuLogIn".$ibm_sistema) === true) {
      $resposta->addScript("xajax_emuLogIn".$ibm_sistema."(xajax.getFormValues('cadastro'));");
    } else {
      $resposta->addAssign("id_bt_enviar", "disabled", false);
    }

    return $resposta->getXML();
  }
  /**
   * Efetua Logout no Sistema Emulado (IBM3270)
   *
   * @return xajax XML Response
   */
  function emuLogOut($arr_form_cadastro)
  {
    global $session;

    if (empty($session["cso_id"]) === false) {
      $emuMsgRetorno = disconnectCSO("");
    } else {
      $inner_emuIdStatus  = "Deslogado";
      $innet_emuIdSession = "";
      $emu_error_msg      = "";
    }

    if ($emuMsgRetorno == "OK") {
      $inner_emuIdStatus  = "Deslogado";
      $innet_emuIdSession = "";
      $emu_error_msg      = "";
    } else {
      if (empty($session["cso_id"]) === true) {
        $inner_emuIdStatus  = "Deslogado";
        $innet_emuIdSession = "";
      } else {
        $inner_emuIdStatus  = "Logado - ";
        $innet_emuIdSession = $session["cso_id"];
      }

      $emu_error_msg = $emuMsgRetorno;
    }

    $resposta = new xajaxResponse();

    $resposta->addAssign("emuIdStatus", "innerHTML", $inner_emuIdStatus);
    $resposta->addAssign("emuIdSession", "innerHTML", $innet_emuIdSession);
    $resposta->addAssign("emuBoxError", "innerHTML", $emu_error_msg);


    global $ibm_sistema;

    if (function_exists("emuLogOut".$ibm_sistema) === true) {
      $resposta->addScript("xajax_emuLogOut".$ibm_sistema."(xajax.getFormValues('cadastro'));");
    }

    return $resposta->getXML();
  }
}

function MontaComboMotivoPorGrupo($cod_classe, $vlr_classe, $repre_vendedor, $servico_dac){
  global $connect;
  $options = "<option value=''>-- Selecione --</option>";
  $arrMotivoRecusa = getArrayClasse("tb_classe", $connect, "descricao", $cod_classe, $repre_vendedor, "A", "ZZ");
  $qtde_option = 0;

  if(strlen($servico_dac) == "7" && trim(strtoupper($servico_dac)) != "SEM DAC"){
    $servico_dac = substr($servico_dac,0,6);
  }
  if(strlen($servico_dac) == "5"){
    $servico_dac = substr($servico_dac,0,4);
  }

  if(is_array($arrMotivoRecusa["itens"]) === true) {
    foreach ($arrMotivoRecusa["itens"] as $arrChave => $arrValores) {
      $array_param_motivo = explode("¢", ValorClasse($cod_classe, $arrValores["valor"]."¢", $repre_vendedor));
      if($array_param_motivo[17] && $servico_dac && strpos("****".$array_param_motivo[17], $servico_dac) < 1 && trim(strtoupper($servico_dac)) != "SEM DAC"){
        continue;
      }
      $sel = "";
      if($vlr_classe == $arrValores["valor"])
        $sel = "selected";
      $options.= "<option style='background-color:".$arrValores["cor_bg"]."; color:".$arrValores["cor"].";' value='".$arrValores["valor"]."' ".$sel.">".$arrValores["descricao"]."</option>";
      $qtde_option++;
    }

    if($qtde_option < 1){
      foreach ($arrMotivoRecusa["itens"] as $arrChave => $arrValores) {
        $sel = "";
        if($vlr_classe == $arrValores["valor"])
          $sel = "selected";
        $options.= "<option style='background-color:".$arrValores["cor_bg"]."; color:".$arrValores["cor"].";' value='".$arrValores["valor"]."' ".$sel.">".$arrValores["descricao"]."</option>";
      }
    }
  }
  return $options;
}
/*
* Não permitir o usuário desabilitar os Campos E-mail e Celular juntos
* SU-88698
* @reg_atd_canal = input hidden já existente
* @reg_atd_grupo = input hidden já existente
* (Tela)CNH=BI | (Input)$reg_atd=reg_atd_canal | (Valor)$reg_atd_valores=ac,98
* (Tela)BHB=BT | (Input)$reg_atd=reg_atd_grupo | (Valor)$reg_atd_valores=7030
* @version: 22/10/2019 - Giovanni Silva
*/
function VerificaGravaSolicitanteFiltroObrigatorioEmailsms($numeroModelo) {
  if($GLOBALS['mkFlwParam']['grava_solicitante_filtro_obrigatorio_emailsms']) {
    $exp_emailsms = explode('¢', $GLOBALS['mkFlwParam']['grava_solicitante_filtro_obrigatorio_emailsms']);
    //Campo/Reg_atd_~
    $emailsms_reg = $exp_emailsms[0];
    //Classe
    //$emailsms_classe = $exp_emailsms[1];
    //Valores p/ condição EX:ac,98,7030
    $exp_emailsms_res_valores= explode(',',$exp_emailsms[2]);
    //Monta Condição
    foreach ($exp_emailsms_res_valores as $valor) {
      $exp_emailsms_condicao.= '$("input[name='.$emailsms_reg.']","form[name=form_volta]").val() == "'.$valor.'" || ';
    }
    return substr(trim($exp_emailsms_condicao), 0, -3);
  } else {
    return '';
  }
} //FIM SU-88698 1/4

//include do programa que tem funcoes especificas

$file = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_ajax_".$include_dados.".php", "N");
if (file_exists($file)) {
  include $file;
}

$xajax_mk->processRequests();
//*****************************************************************************************************
//*****************************************************************************************************
//*****************************************************************************************************
//*********************FIM DAS FUNCOES DO AJAX ********************************************************
//*****************************************************************************************************
//*****************************************************************************************************
//*****************************************************************************************************

if (!$vez_atualiza) {
  $vez_atualiza = "0";
}

//**************************************************
//parametros de Data********************************
//**************************************************
$hoje_dia = Date("d");if (strlen($hoje_dia) < 2) { $hoje_dia = "0".$hoje_dia;}
$hoje_mes = Date("m");if (strlen($hoje_mes) < 2) { $hoje_mes = "0".$hoje_mes;}
$hoje_ano = Date("Y");

$data     = date ('Y-m-d');
$hora     = date ('H:i:s');

if (date ('H') >= 15) {
  $prox_periodo = "M";
  $prox_periodo_desc = "MANHÃ";
} else {
  $prox_periodo = "T";
  $prox_periodo_desc = "TARDE";
}
//**************************************************

//*****************************************************************************************************************
//**ESPECIFICO PARA OUVIDORIA PARA ENTRADAS DIFERENTE DE 0800(TELEFONIA) NÃO GRAVAR OS DADOS DA MK_RAMAL(LIGAÇÃO)**
//**SOBRESCREVE O PARAMETRO $BOTAO_SINC_DAC PARA NÃO TRAZER PREENCHIDO A BINA DO CLIENTE NA ROTINA DE TELEFONES****
//*****************************************************************************************************************
if (isset($ouv_origem) === true && empty($ouv_origem) === false && $ouv_origem != "01") {
  $botao_sinc_dac = "N";
}
//*****************************************************************************************************************
//*****************************************************************************************************************
//*****************************************************************************************************************


/**************************************************************************************
** Pega o ID_LIG das ligações coloca em HIDDENS para manda para prox pagina que grava no bd ***
** AGORA CRIA OS HIDDENS MK_RAMAL utilizar este**********************************************
*************************************************************************************/
//Setando os dados da ligacao na tb ramal
if ((is_array($mk_ramal) === false) || (isset($mk_ramal) === false) || $sync_dac == "true") {//verifica se esses dados ja nao veio de tela anterior ou se nao foi carregado
  $objRamal = new RamalWeb($session["ip_dac"], $session["porta_dac"], $ramal_atend);

  if ($sync_dac == "true" || $botao_sinc_dac == "S") {

    $mk_ramal = $objRamal->DadosAtendimentoSinc();
    $servico_dac    = $mk_ramal["grupo"];
    $status_dac     = $mk_ramal["status_dac"];
    $id_lig         = $mk_ramal["id_lig"];
    $bina_cliente   = $mk_ramal["bina_gravacao"];
    $nome_gravacao  = $mk_ramal["nome_gravacao"];
    $hora_ini_dac   = $mk_ramal["hora_ini"];
    $hora_fim_dac   = $mk_ramal["hora_fim"];
    $tempo_tot_lig  = $mk_ramal["duracao"];
  } else {
    $mk_ramal = $objRamal->DadosAtendimento();

  }
  unset($objRamal);
}


if (substr($mk_ramal["grupo"], 0, 2) == "HO" || substr($mk_ramal["grupo"], 0, 2) == "HR") {
  $aux_id_cli_im = explode("¢", $mk_ramal["id_cli"]);
  if ($aux_id_cli_im[2] != "") {
    //variavel que será huardada em um hidden para enviar ao bd para gravar a amarração do canla com o protocolo
    ${"im_chave_".strtolower(substr($mk_ramal["grupo"], 0, 2))."1"} = $aux_id_cli_im[2];

    require_once($_SERVER['DOCUMENT_ROOT'].'/libs/cli/canais/CanalClient.php');
    $clientIM = CanalClient::newCanal($mk_ramal["nb"]);

    //gera o objeto padrão
    if (!is_object($conPropIm)) {
      $conPropIm = new stdClass();
    }

    //busca os dados do primeiro atendimento/tramite do canal
    $conPropIm->result = $clientIM->dadosDoDialogo(${"im_chave_".strtolower(substr($mk_ramal["grupo"], 0, 2))."1"});
    if ($conPropIm->result["status"] === false) {
      print $conPropIm->result["message"]." <br>ROTINA: clientIM->dadosDoDialogo <br>PARAMETRO: ".${"im_chave_".strtolower(substr($mk_ramal["grupo"], 0, 2))."1"}."<br>";
      var_dump($clientIM);
      exit();
    }
  }
}


//***********************************************************************************************
//***********************************************************************************************
//***********************************************************************************************

//*****************PARAMETROS VELHOS NAO UTILIZAR MAIS ESTAS VARIAVEIS
//*****************PARAMETROS VELHOS NAO UTILIZAR MAIS ESTAS VARIAVEIS
//*****************PARAMETROS VELHOS NAO UTILIZAR MAIS ESTAS VARIAVEIS
//*****************PARAMETROS VELHOS NAO UTILIZAR MAIS ESTAS VARIAVEIS
if (!$servico_dac)  {$servico_dac    = $mk_ramal["grupo"];}
if (!$status_dac)   {$status_dac     = $mk_ramal["status_dac"];}
if (!$id_lig)       {$id_lig         = $mk_ramal["id_lig"];}
if (!$bina_cliente) {$bina_cliente   = $mk_ramal["bina_gravacao"];}
if (!$nome_gravacao) {$nome_gravacao  = $mk_ramal["nome_gravacao"];}
if (!$hora_ini_dac) {$hora_ini_dac   = $mk_ramal["hora_ini"];}
if (!$hora_fim_dac) {$hora_fim_dac   = $mk_ramal["hora_fim"];}
if (!$tempo_tot_lig) {$tempo_tot_lig = $mk_ramal["duracao"];}
/*************************************************************************************/

//CARREGA OS DADOS DA TPLIG PARA VALIDACAO DA AGENDA
$arrTplig = AtendimentoPST::getParamLigAtv("array", array(
"sistema" => "MD",
"chave" => $nro_modelo,
"ambiente" => $sistema_identificacao,
"agente" => $session["operador"],
"representante" => $repre_vendedor
));






/**************************************************************************************
** Pega o horario de trabalho do Operador para poder liberar o Horario para agenda ***
*************************************************************************************/
$q = "SELECT hora_trabalho FROM tbadmin WHERE login = '".$session["operador"]."'";
$dados = DescExecQuery($q, $connect);

if ($rec = mysql_fetch_assoc ($dados)) {
  $hora_trabalho = $rec["hora_trabalho"];
  $arr_hora_trabalho = explode("x",$hora_trabalho);
  $max_hora_trabalho = $arr_hora_trabalho[0];
  $min_hora_trabalho = $arr_hora_trabalho[1];

  /********************************************************************************************/
  /*****Caso o hora_trabalho nao esteja batendo com a hora em que o operador esta trabalhando***/
  /******ele so deixa agendar para hj somente no periodo em que ele esta trabalhando************/
  /*********************************************************************************************/
  if (date ('H') < $min_hora_trabalho || date ('H') > $max_hora_trabalho) {
    if (date ('H') < 15) {
      $min_hora_trabalho = "08";
      $max_hora_trabalho = "15";
    } else {
      $min_hora_trabalho = "15";
      $max_hora_trabalho = "22";
    }
  }
  /*********************************************************************************************/
}
/*************************************************************************************/






/********************************************************
** 1      PROCESSO INICIAL DE ATENDIMENTO        *******
** Verifia o tipo de tela e atribui as variaveis *******
*******************************************************/

if ($id == "") {
  if ($vez_atualiza == "0") {
    $atv_nome_razao_ant              = $atv_nome_razao;
    $atv_cpf_cnpj_ant                = $atv_cpf_cnpj;
  }
  $fase_atend = "#dados_cli";

  switch($tipo_modelo) {
    case "ATIVO":
    case "AGENDA_RETORNO":
    case "ATIVO_DISCAR":
    case "ATIVO_LEADS":
    case "RETORNO":
    case "RECEPTIVO":
    case "INDICACAO":
    case "INDICACAO_MK":

      $md_tipo_atendimento = "R";
      if (!$atv_nome_razao         ) {$atv_nome_razao              = $atv_nome_razao_ant  ;}
      if (!$atv_cpf_cnpj           ) {$atv_cpf_cnpj                = $atv_cpf_cnpj_ant    ;}

      if (!$atv_ddd_tel            ) {$atv_ddd_tel                 = $atv_ddd_tel;       }
      if (!$atv_num_tel            ) {$atv_num_tel                 = $atv_num_tel;       }

      if ($repre_vendedor == "IMBRA") {
        if (!$atv_ddd_tel            ) {$atv_ddd_tel                 = substr($mk_ramal["bina_gravacao"],0,2);       }
        if (!$atv_num_tel            ) {$atv_num_tel                 = substr($mk_ramal["bina_gravacao"],2);         }
      }
      if (!$atv_ramal_tel          ) {$atv_ramal_tel               = $atv_ramal_tel       ;}

      if (!$atv_ddd_cont           ) {$atv_ddd_cont                = $atv_ddd_cont        ;}
      if (!$atv_num_cont           ) {$atv_num_cont                = $atv_num_cont        ;}
      if (!$atv_ramal_cont         ) {$atv_ramal_cont              = $atv_ramal_cont      ;}
      if (!$atv_ddd_comercial      ) {$atv_ddd_comercial           = $atv_ddd_comercial   ;}
      if (!$atv_fone_comercial     ) {$atv_fone_comercial          = $atv_fone_comercial  ;}
      if (!$atv_ramal_comercial    ) {$atv_ramal_comercial         = $atv_ramal_comercial ;}
      if (!$atv_login_operador     ) {$atv_login_operador          = $session["operador"] ;}
      if (!$atv_operador_incompl   ) {$atv_operador_incompl        = $session["operador"] ;}
      break;
    case "FOLLOWUP_ATV":
    case "FLW_ATV_S_MAIL":
      $md_tipo_atendimento = "A";
      require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_funcoes.php");
      break;
    case "FOLLOWUP":
      $md_tipo_atendimento = "R";
      require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_funcoes.php");
      break;

    default:
      header ("Location:".HTTPHOST.DOCROOT."md_cad_prop.php?msg_erro=".urlencode("<strong>O tipo ".$tipo_modelo."&nbsp;Não está apto para o Modelo, revise as configuraçõesx"));
      break;
  }
}

/*******************************************************
** 1      Fim PROCESSO INICIAL DE ATENDIMENTO        **
*******************************************************/

/*******************************************************************/
/** Captura a classe correta´para a quantidade mínima de ligações **/
/** se parametro  DISK FICHA = S                                  **/
/*******************************************************************/




if ($disk_ficha == "S" || $disk_ficha == "O") {
  if ((strlen($atv_num_tel) < 6 && strlen($atv_fone_comercial) > 5) || (strlen($atv_num_tel) > 5 && strlen($atv_fone_comercial) < 6)) {
    $quantos_tel = "1 Telefone";
  } else {
    if (strlen($atv_num_tel) > 5 && strlen($atv_fone_comercial) > 5) {
      $quantos_tel = "2 Telefones";
    } else {
      $quantos_tel = "1 Telefone";
    }
  }
  $sql   = "SELECT vlr_classe FROM tb_classe WHERE cod_classe = 'QTLIG' and representante = '".$session["representante"]."' and tipo_reg = 'I' and status = 'A' and desc_classe = '".$quantos_tel."'";
  $dados = DescExecQuery($sql, $connect, "N");
  $rec_min_lig = mysql_fetch_assoc ($dados);
  $qtd_min_lig = $rec_min_lig["vlr_classe"];
} else {
  $qtd_min_lig = 0;
}
/***********************************************************************
** FIM Captura a classe correta´para a quantidade mínima de ligações **
***********************************************************************/

/***********************************************************************
** FUNCAO QUE MONTA OS COMBOS DE STATUS CONFORME O PRODUTO SELECIONADO**
***********************************************************************/
if (($conclusao_receptivo == "S") && ($classe_recusa_status_bk == "S" || $classe_c_imp_status_bk == "S")) {
  function MontaComboStatusBK($cod_classe, $valor, $repre, $empresa, $arrTipoProd, $connect) {
    $where_prod = " AND tipo_produto in('TODOS'";
    if (is_array($arrTipoProd)) {
      foreach ($arrTipoProd as $x =>$tipo_prod) {
        if ($tipo_prod) {
          $where_prod.= ", '".$tipo_prod."'";
          $flag_prod  = 1;
        }
      }
    }

    $where_prod.= " ) ";
    $retorno = "<option value=''>-- Selecione --</option>";
    $q   = "SELECT * FROM tb_status_bk WHERE representante = '".$repre."' and empresa = '".$empresa."' and cod_classe = '".$cod_classe."' ".$where_prod." AND status = 'A' order by descricao ";
    $con = DescExecQuery($q, $connect, "N");
    while($rec = mysql_fetch_assoc($con)) {
      $combo_vlr = $rec["codigo"]."¢".$rec["status_processo"]."¢".$rec["agenda_dias"]."¢".ProximoDiaUtil(date("Y-m-d"), DefineRepre($repre), $rec["agenda_dias"]);
      $sel = "";
      if ($valor == $combo_vlr)
      $sel = "SELECTED";
      $retorno.= "<option value='".$combo_vlr."' ".$sel."> ".$rec["descricao"]."</option>";
    }
    return $retorno;
  }
}
/***********************************************************************
** FIM FUNCAO QUE MONTA OS COMBOS DE STATUS CONFORME O PRODUTO SELECIONADO
***********************************************************************/

//objetos padrões para não dar pau no php7
if (!is_object($conPropIdCli)) {
  $conPropIdCli = new stdClass();
}
if (!is_object($conProp)) {
  $conProp = new stdClass();
}

if(!is_object($conPropImMerge)){
  $conPropImMerge = new stdClass();
}

/********************************************************************************
** ROTINA PREENCHE A TELA COM OS DADOS DO ID_CLI (URATF)
********************************************************************************/
if (strpos(" ".$selecao_receptivo, "preencher_tela_id_cli") > 0) {

  $mk_ramal_grupo_usa = $mk_ramal["grupo"];

  //**************GAMBI PARA BUSCAR O GRUPO NA RAMAL**************
  if($mk_origem_atd_direto) {//significa que passou as origens pelo nivel..
    if ($mk_origem_atd_direto == "RAMAL") {

      //identifica a ligação como se tivesse clicado en identificar atendimento indo na ramal utilizado dentro de abre_modelo.
      $classe_mkpro = "MD".$nro_modelo;
      require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/RamalWeb.php");
      $objRamal = new RamalWeb($session["ip_dac"], $session["porta_dac"], $GLOBALS["ramal_atend"]);
      $mk_ramal_aux = $objRamal->DadosAtendimento();
      $mk_ramal_grupo_usa = $mk_ramal_aux["grupo"];
    }
  }
  //**************************************************************

  /********************************************************************************
  ** INICIO ROTINA PREENCHE A TELA COM OS DADOS DO ID_CPO (URATF)
  ********************************************************************************/
  require_once($_SERVER['DOCUMENT_ROOT']."/libs/pst/DacNetPST.php");
  $objDacNetPST = new DacNetPST();
  unset($msg_ramal_pst);
  $arrParamIdCPO = $objDacNetPST->getParamIdCPO($repre_vendedor, $mk_ramal_grupo_usa, $msg_ramal_pst);
  if ($session["print_sql"] != "N") {
    print "<pre><br><br><br><br><br><br>";
    print "<li>mk_ramal:<br>";
    print_r($mk_ramal);
    print "<li>arrParamIdCPO:<br>";
    print_r($arrParamIdCPO);
    print "<li>".$msg_ramal_pst;
  }

  if ($msg_ramal_pst != "" && strpos($msg_ramal_pst, "Nenhum parâmetro encontrado para o grupo") === false) {
    print "<br><br><br><br><br><font class='txtvermelho'><storng>ERRO NA ROTINA DE PREENCHIMENTO DE CAMPOS COM ID_CLI.<BR>ENTRE EM CONTATO COM O SAC URANET E INFORME O ERRO: ".$msg_ramal_pst."</strong></font>";
  } else {
    if (is_array($arrParamIdCPO)) {
      $arr_id_cli = explode("¢", $mk_ramal["id_cli"]);
      if (is_array($arr_id_cli)) {
        foreach ($arr_id_cli as $chave_cpo => $valor_cpo) {
          $arr_param_vez = explode("§", $arrParamIdCPO[str_pad($chave_cpo+1, 2, "0", STR_PAD_LEFT)]);

          if (count($arr_param_vez) === 1 && $arr_param_vez[0] != "")  {
            //            print "<li>pega o que veio do id_cli<br>";
            //            print_r($arr_param_vez);
            $conPropIdCli->result[$arr_param_vez[0]] = $valor_cpo;
            if (!${$arr_param_vez[0]}) {
              ${$arr_param_vez[0]} = $valor_cpo;
            }
            continue;
          }

          if (count($arr_param_vez) > 1)  {
            $arr_param_vez_aux = explode("¢", $arr_param_vez[1]);

            switch ($arr_param_vez_aux[0]) {
              case "CLASSE":
                //              print "<li>pega da classe<br>";
                //              print_r($arr_param_vez_aux);
                $vlr_temp = str_replace("--", "", trim(ValorClasse(str_replace("__", $nro_modelo,$arr_param_vez_aux[1]), $valor_cpo, $repre_vendedor)));
                if ($vlr_temp != "") {
                  $conPropIdCli->result[$arr_param_vez[0]] = $vlr_temp;
                  if (!${$arr_param_vez[0]}) {
                    ${$arr_param_vez[0]} = $vlr_temp;
                  }
                }
                break;
              case "REPLACE_BRANCO":
                //              print "<li>faz o replace de _ por espaço<br>";
                //              print_r($arr_param_vez_aux);
                $vlr_temp = str_replace("_", " ", $valor_cpo);
                $conPropIdCli->result[$arr_param_vez[0]] = $vlr_temp;
                if (!${$arr_param_vez[0]}) {
                  ${$arr_param_vez[0]} = $vlr_temp;
                }
                break;

              case "REPLACE_NAVEGACAO":
                //              print "<li>faz o replace de ¬ por §<br>";
                //              print_r($arr_param_vez_aux);
                $vlr_temp = str_replace("¬", "§", $valor_cpo);
                $conPropIdCli->result[$arr_param_vez[0]] = $vlr_temp;
                if (!${$arr_param_vez[0]}) {
                  ${$arr_param_vez[0]} = $vlr_temp;
                }
                break;

              default:
                //              print "<li>DE PARA<br>";
                //              print_r($arr_param_vez_aux);
                foreach ($arr_param_vez_aux as $chave => $valor) {
                  $aux = explode("=", $valor);
                  $arr_de_para[$aux[0]] = $aux[1] ;
                }
                //              print_r($arr_de_para);
                if (key_exists($valor_cpo, $arr_de_para)) {
                  $conPropIdCli->result[$arr_param_vez[0]] = $arr_de_para[$valor_cpo];
                  if (!${$arr_param_vez[0]}) {
                    ${$arr_param_vez[0]} = $arr_de_para[$valor_cpo];
                  }
                }
                break;
            }
          }
        }
      }
    }
  }
  /********************************************************************************
  ** FIM ROTINA PREENCHE A TELA COM OS DADOS DO ID_CPO (URATF)
  ********************************************************************************/

  /********************************************************************************
  ** INICIO ROTINA PREENCHE A TELA COM OS DADOS DO IM_CPO_ (URATF)
  ********************************************************************************/
  unset($objDacNetPST);
  $objDacNetPST = new DacNetPST();
  unset($msg_ramal_pst);
  $arrParamIdCPOIM = $objDacNetPST->getParamIdCPOIM($repre_vendedor, $mk_ramal_grupo_usa, $msg_ramal_pst);
  if ($session["print_sql"] != "N") {
    print "<pre><br><br><br><br><br><br>";
    print "<li>mk_ramal:<br>";
    print_r($mk_ramal);
    print "<li>arrParamIdCPOIM:<br>";
    print_r($arrParamIdCPOIM);
    print "<li>conPropIm->result:<br>";
    print_r($conPropIm->result);
    print "<li>".$msg_ramal_pst;
  }

  if ($msg_ramal_pst != "" && strpos($msg_ramal_pst, "Nenhum parâmetro encontrado para o grupo") === false) {
    print "<br><br><br><br><br><font class='txtvermelho'><storng>ERRO NA ROTINA DE PREENCHIMENTO DE CAMPOS COM getParamIdCPOIM.<BR>ENTRE EM CONTATO COM O SAC URANET E INFORME O ERRO: ".$msg_ramal_pst."</strong></font>";
  } else {
    if (is_array($arrParamIdCPOIM)) {

      foreach ($arrParamIdCPOIM as $chave_cpoIM => $valor_cpoIM) {
        $arr_param_vez = explode("§", $valor_cpoIM);
        if (count($arr_param_vez) === 1 && $arr_param_vez[0] != "")  {
          $conPropImMerge->result[$arr_param_vez[0]] = $conPropIm->result[$chave_cpoIM];//gera a matriz que vai fazer o merge com a cliente
          if (!${$arr_param_vez[0]}) {
            ${$arr_param_vez[0]}                  = $conPropIm->result[$chave_cpoIM];//gera a global
          }
          continue;
        }

        if (count($arr_param_vez) > 1)  {
          $arr_param_vez_aux = explode("¢", $arr_param_vez[1]);
          switch ($arr_param_vez_aux[0]) {
            case "CLASSE":
              //              print "<li>pega da classe<br>";
              //              print_r($arr_param_vez_aux);
              $vlr_temp = str_replace("--", "", trim(ValorClasse(str_replace("__", $nro_modelo,$arr_param_vez_aux[1]), $conPropIm->result[$chave_cpoIM], $repre_vendedor)));
              if ($vlr_temp != "") {
                $conPropImMerge->result[$arr_param_vez[0]] = $vlr_temp;//gera a matriz que vai fazer o merge com a cliente
                if (!${$arr_param_vez[0]}) {
                  ${$arr_param_vez[0]} = $vlr_temp;
                }
              }
              break;
            case "REPLACE_BRANCO":
              //              print "<li>faz o replace de _ por espaço<br>";
              //              print_r($arr_param_vez_aux);
              $vlr_temp = str_replace("_", " ", $conPropIm->result[$chave_cpoIM]);
              $conPropImMerge->result[$arr_param_vez[0]] = $vlr_temp;//gera a matriz que vai fazer o merge com a cliente
              if (!${$arr_param_vez[0]}) {
                ${$arr_param_vez[0]} = $vlr_temp;
              }
              break;

            case "REPLACE_NAVEGACAO":
              //              print "<li>faz o replace de ¬ por §<br>";
              //              print_r($arr_param_vez_aux);
              $vlr_temp = str_replace("¬", "§", $conPropIm->result[$chave_cpoIM]);
              $conPropImMerge->result[$arr_param_vez[0]] = $vlr_temp;//gera a matriz que vai fazer o merge com a cliente
              if (!${$arr_param_vez[0]}) {
                ${$arr_param_vez[0]} = $vlr_temp;
              }
              break;

            default:
              //              print "<li>DE PARA<br>";
              //              print_r($arr_param_vez_aux);
              foreach ($arr_param_vez_aux as $chave => $valor) {
                $aux = explode("=", $valor);
                $arr_de_para[$aux[0]] = $aux[1] ;
              }
              //              print_r($arr_de_para);
              if (key_exists($conPropIm->result[$chave_cpoIM], $arr_de_para)) {
                $conPropImMerge->result[$arr_param_vez[0]] = $arr_de_para[$conPropIm->result[$chave_cpoIM]];//gera a matriz que vai fazer o merge com a cliente
                if (!${$arr_param_vez[0]}) {
                  ${$arr_param_vez[0]} = $arr_de_para[$conPropIm->result[$chave_cpoIM]];
                }
              }
              break;
          }
        }
      }
    }
    //Marcelo - 14/04/2022
    if ($nro_modelo == "C0" && $repre_vendedor == "ALELO-O") {
      //caso tenha os dados do IM e tenha campos especificos a serem preenchidos que não estão na URATF e sim no include ajax por conta das regras de negócio
      if (is_array($conPropIm->result) && is_array($IdCPOIM_campos_tela_especifico)) {
        require_once($_SERVER["DOCUMENT_ROOT"]."/libs/func/FollowUpElopar.php");
        $objFollowElopar = new FollowUpElopar($mk_ramal["nb"]);
        //passa os campos do IM para a função normalizar os dados para preenchimento da tela.
        $IdCPOIM_de_para_campos_tela = $objFollowElopar->getArrayProp($conPropIm->result);
        //varre os campos retornados pela rotina de normalização
        foreach ($IdCPOIM_de_para_campos_tela as $campo => $valor) {
          //verifica se no especifico foi definido que o campo deve ser preenchido
          if ($IdCPOIM_campos_tela_especifico[$campo] === true) {
            //rotina anexo do campo extra só traz preenchido se estiver na $conProp->result
            $conPropImMerge->result[$campo] = $valor;
            if (!${"CPOEXTRA_".$campo}) {
              ${"CPOEXTRA_".$campo} = $valor;
            }
          }
        }
      }
    }
  }
}
/********************************************************************************
** FIM ROTINA PREENCHE A TELA COM OS DADOS DO IM_CPO_ (URATF)
********************************************************************************/



/************************************************************************
** ROTINA QUE BUSCA O CLIENTE PESQUISADO NA TELA ANTERIOR MOTNA NO OBJETO
************************************************************************/
//comentei pois isso é default...david 04/10/2013
if ($campo_clique_cliente != 'BOTAO_NOVO') {
	if ($nro_modelo != "GD" && $repre_vendedor != "	SEMPARAR-U") {
	  if(!$campo_clique_cliente && $id_receptivo && $submit_form_cadastro != "true") {
		$arr_id_r = explode("¢",$id_receptivo);
		$campo_clique_cliente = $arr_id_r[0];
	  }
	}

}
/*
if($session["operador"] == "testevsaude") {
	print "<pre>1";
	print_r($GLOBALS);
	print "</pre>";
}
*/
if (($grava_cliente_gss == "S" || $grava_cliente_gss == "P") && ($campo_clique_cliente)) {
  //definindo variaveis

  if (!$campo_campo_clique_cliente)  {
    if ($nro_modelo != "56" && $nro_modelo != "2Z" && $nro_modelo != "I3" && $nro_modelo != "9D" && $nro_modelo != "9A") {
      $campo_campo_clique_cliente = "cpf_cnpj";
    } else {
      if (substr($repre_vendedor,0,8) == "TRIBANCO") {
        $campo_campo_clique_cliente = "trib_matricula";
      }
    }
  }

  /**
   * Temporário (Metlife) - 11/09/2019
   * Nos casos em que o cliente não for selecionado,
   * seta tipo de atendimento como não identificado.
   */
  if ( $nro_modelo == "MI" || $nro_modelo == "D5" || $nro_modelo == "D9" ) {
    if ( strpos($campo_clique_cliente, "BOTAO_NOVO") !== false ) {
        $CPOEXTRA_tipo_atendimento = "2";
    }
  }

  if (empty($cpf_cnpj) === true && $campo_campo_clique_cliente == "cpf_cnpj" && $campo_clique_cliente != "BOTAO_NOVO") {
    $cpf_cnpj = $campo_clique_cliente;
  }
  //********************************

  //tratando caso campo_clique_cliente possua 2 chaves
  if(strpos(" ".$campo_campo_clique_cliente,",") > 0){
    $arr_campo_campo_clique_cliente = explode(",",$campo_campo_clique_cliente);
    $arr_campo_clique_cliente       = explode(",",$campo_clique_cliente);
    $where_grava_cliente_gss = "where ";
    foreach ($arr_campo_campo_clique_cliente as $key_campo_clique=>$valor_campo_clique){
      $where_grava_cliente_gss .= $valor_campo_clique."= '".$arr_campo_clique_cliente[$key_campo_clique]."' and ";
    }
    $where_grava_cliente_gss = substr($where_grava_cliente_gss,0,-4);//retirando o ultimo and
  }else{
    $where_grava_cliente_gss = "where ".$campo_campo_clique_cliente."='".$campo_clique_cliente."'";
  }
  //********************************************************

  if (strpos("**".$campo_clique_cliente, "BOTAO_NOVO") == 0) {
    $conProp = new Conexao($host_cliente,$bd_cliente,$user_cliente,$senha_cliente);
    $q = "SELECT * FROM ".$tabela_cliente." ".$where_grava_cliente_gss;
    if ($session["print_sql"] != "N") {
      print $q;
    }
    $conProp->query($q);

    if (!$nome_razao               ) {$nome_razao          = $conProp->result["nome_razao"];};

    if ($tabela_cliente == $tabela_ativo && substr($tabela_cliente,0,10) != "tb_cliente") {
      if ($conProp->result["ddd_1"]   && !$conPropIdCli->result["ddd_1"])  {$atv_ddd_tel         = $conProp->result["ddd_1"];};
      if ($conProp->result["fone_1"]  && !$conPropIdCli->result["fone_1"]) {$atv_num_tel         = $conProp->result["fone_1"];};
      if ($conProp->result["ramal_1"] && !$conPropIdCli->result["ramal_1"]){$atv_ramal_tel       = $conProp->result["ramal_1"];};
      if ($conProp->result["ddd_2"]   && !$conPropIdCli->result["ddd_2"])  {$atv_ddd_cont        = $conProp->result["ddd_2"];};
      if ($conProp->result["fone_2"]  && !$conPropIdCli->result["fone_2"]) {$atv_num_cont        = $conProp->result["fone_2"];};
      if ($conProp->result["ramal_2"] && !$conPropIdCli->result["ramal_2"]){$atv_ramal_cont      = $conProp->result["ramal_2"];};
      if ($conProp->result["ddd_3"]   && !$conPropIdCli->result["ddd_3"])  {$atv_ddd_comercial   = $conProp->result["ddd_3"];};
      if ($conProp->result["fone_3"]  && !$conPropIdCli->result["fone_3"]) {$atv_fone_comercial  = $conProp->result["fone_3"];};
      if ($conProp->result["ramal_3"] && !$conPropIdCli->result["ramal_3"]){$atv_ramal_comercial = $conProp->result["ramal_3"];};
    } else {
      if (!$conPropIdCli->result["ddd_tel"])         {if ($conProp->result["ddd_tel"])         {$atv_ddd_tel         = $conProp->result["ddd_tel"];        } else {$atv_ddd_tel = "";}}
      if (!$conPropIdCli->result["num_tel"])         {if ($conProp->result["num_tel"])         {$atv_num_tel         = $conProp->result["num_tel"];        } else {$atv_num_tel = "";}}
      if (!$conPropIdCli->result["ramal_tel"])       {if ($conProp->result["ramal_tel"])       {$atv_ramal_tel       = $conProp->result["ramal_tel"];      } else {$atv_ramal_tel = "";}}
      if (!$conPropIdCli->result["ddd_outro"])       {if ($conProp->result["ddd_outro"])       {$atv_ddd_cont        = $conProp->result["ddd_outro"];      } else {$atv_ddd_cont = "";}}
      if (!$conPropIdCli->result["num_outro"])       {if ($conProp->result["num_outro"])       {$atv_num_cont        = $conProp->result["num_outro"];      } else {$atv_num_cont = "";}}
      if (!$conPropIdCli->result["ramal_outro"])     {if ($conProp->result["ramal_outro"])     {$atv_ramal_cont      = $conProp->result["ramal_outro"];    } else {$atv_ramal_cont = "";}}
      if (!$conPropIdCli->result["ddd_comercial"])   {if ($conProp->result["ddd_comercial"])   {$atv_ddd_comercial   = $conProp->result["ddd_comercial"];  } else {$atv_ddd_comercial = "";}}
      if (!$conPropIdCli->result["fone_comercial"])  {if ($conProp->result["fone_comercial"])  {$atv_fone_comercial  = $conProp->result["fone_comercial"]; } else {$atv_fone_comercial = "";}}
      if (!$conPropIdCli->result["ramal_comercial"]) {if ($conProp->result["ramal_comercial"]) {$atv_ramal_comercial = $conProp->result["ramal_comercial"];} else {$atv_ramal_comercial = "";}}
    }
  }





  //print "<pre><br><br><br><br><br><br><br>";







}
/********************************************************************************
** MERGE DA RESULT DA ROTINA QUE BUSCA O CLIENTE PESQUISADO NA TELA ANTERIOR MOTNA NO OBJETO SUBSTITUINDO OS VALORES DA CLIENTE
********************************************************************************/


/********************************************************************************
** ROTINA PREENCHE A TELA COM OS DADOS DO ID_CLI e ID_CPO(URATF)
********************************************************************************/

if (strpos(" ".$selecao_receptivo, "preencher_tela_id_cli") > 0) {

	if ($campo_clique_cliente == 'BOTAO_NOVO' && $cpf_cnpj != "" && $conPropIdCli->result["cpf_cnpj"] != "" && $conPropIdCli->result["cpf_cnpj"] != $cpf_cnpj ) {
		//se for botao novo e ele tiver trocado o cpf_cnpj la na pesquisa nao pode pegar os dados do id

	} else {
		  if (is_array($conProp->result) && is_array($conPropIdCli->result)) {
			  $conProp->result = array_merge($conPropIdCli->result,$conProp->result);
		  } else {
        if (is_array($conPropIdCli->result)) {
          $conProp->result = $conPropIdCli->result;
        }
		  }

      if (is_array($conProp->result) && is_array($conPropImMerge->result)) {
        $conProp->result = array_merge($conProp->result,$conPropImMerge->result);
      } else {
        if (is_array($conPropImMerge->result)) {
          $conProp->result = $conPropImMerge->result;
        }
		  }
	}
}
/********************************************************************************
** FIM MERGE DA RESULT DA ROTINA QUE BUSCA O CLIENTE PESQUISADO NA TELA ANTERIOR MOTNA NO OBJETO SUBSTITUINDO OS VALORES DA CLIENTE
********************************************************************************/



//ROTINAS DO REGISTRO DE ATENDIMENTO
if ((((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) && $nro_modelo != "SA") || (($nro_modelo == "MC") || ($nro_modelo == "HS"))) {// ADICIONANDO ZURICH - MASS CONSUMER (RE006200) VINI

  if (empty($_POST["hidden_servico_dac"]) === true) {
    if (trim($_POST["arr_campos_volta"]["atendimento"]) == "") {
      if ($_POST["arr_campos_volta"]["servico_dac"]) {
        $hidden_servico_dac = $_POST["arr_campos_volta"]["servico_dac"];
      }
      if (!$hidden_servico_dac) {
        if ($session["usa_dac"] == "S") {
          $hidden_servico_dac = $mk_ramal["grupo"];

          if ((strtolower($mk_ramal["grupo"]) != "sem dac") && ((strlen($mk_ramal['grupo']) % 2) == 0) && (substr($mk_ramal["grupo"], 0, 1) == '1')) {
            // EXCEÇÃO PARA GRUPO ATIVO (QUEDA DE LIGAÇÃO NO PREDITIVO / DISCANDO)
            $hidden_servico_dac = $mk_ramal['grupo'].'S';
          }
        }
      }
    } else {
      $hidden_servico_dac = $_POST["arr_campos_volta"]["atendimento"];
    }
  } else {
    $hidden_servico_dac = $_POST["hidden_servico_dac"];
  }
  //Verficando se o Grupo atual pertence à tela de atendimento que foi aberta
  if ((ValorClasse("EK".$nro_modelo."G", $hidden_servico_dac, $repre_vendedor, true)) == " -- ") {
    //Caso não pertencer esvaziamos o serviço dac para obrigar o operador a informar a qual grupo pertence este atendimento
    unset($hidden_servico_dac);
  }

  $opt_combo_servico_dac = MontaCombo("EK".$nro_modelo."G", $hidden_servico_dac, $repre_vendedor);
  $tit_combo_servico_dac = $titClasse;

  if (!((empty($hidden_servico_dac) === true) || (isset($combo_servico_dac) === true))) {
    $reg_atd_grupo = $reg_atd_grupo_atd = substr($hidden_servico_dac, 0, -1);
  }

  if (empty($hidden_servico_dac) === false) {
    ValorClasse("EK".$nro_modelo."A", substr($hidden_servico_dac, 0, -1), $repre_vendedor);

    $reg_atd_canal = $reg_atd_grupo_cond = $_POST["arr_campos_volta"]["reg_atd_grupo_cond"] = $arr_campos_volta["reg_atd_grupo_cond"] = $_REQUEST["arr_campos_volta"]["reg_atd_grupo_cond"] = $condicaoVlrClasse;
  }
}

//ROTINAS DO REGISTRO DE ATENDIMENTO
if($troca_versao){
  if($session["versao_html"] == "5"){
    $session["versao_html"] = "";
  }else{
    $session["versao_html"] = "5";
  }
}

if($session["versao_html"] == "5"){
  $usa_bootstrap = "S";
}


if($nro_modelo == "WZ" || $nro_modelo == "W1") {
  $usa_bootstrap = "S";
}
/*
if($session["operador"] == "testevsaude") {
	print "<pre>2";
	print_r($GLOBALS);
	print "</pre>";
}*/


//$usa_bootstrap = "S";
if($usa_bootstrap == "S") {
?>
<!doctype html>
<html>
<head>
<title><?print $session["sistema"];?></title>
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<!-- *************** CSS *************** -->
<!-- bootstrap -->
<?print IntergrAllHeader();?>
<script type="text/javascript" src="consistencia.js"></script>

<?
} else {
  //feito pelo ADRIANO para testar HTML5 na "Oi TV"
  if ($nro_modelo == "OX" || $nro_modelo == "T9") {
    //  if ($nro_modelo == "9X" || $nro_modelo == "9I" || $nro_modelo == "T9") {
    ?><!doctype html><?
  }
  ?>
  <html>
  <head>
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title><?print $session["sistema"];?></title>
  <?print $v1_style_css;?>
<script type="text/javascript" src="consistencia.js"></script>
<?php
if ($nro_modelo == "TL") {//teleton
  ?>
  <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
  <?php
} else {
  ?>
  <script type="text/javascript" src="/js/jquery.js"></script>
  <?php
}?>
<script type="text/javascript" src="/js/<?=$montaDivPopUp?>.js"></script>
<?
}

if (verificaValidaVersao('SU54216')) {
?>
<script type="text/javascript" src="/js/ia_confirmacao_email.js"></script>
<?
}
?>

<style type="text/css">
  .black_div {
    width: 2000px;
    height: 2000px;
    border: solid 0px #000000;
    margin-top: -150px;
    margin-left: 0px;
    position: absolute;
    background: #000000;
    filter: alpha(opacity=10);
    opacity: .1;
    z-index: 2;
    display: none;
  }
  .loading_div {
    width: 300px;
    height: 100px;
    left: 50%;
    top: 50%;
    border: solid 0px #000000;
    position: absolute;
    background: url('imagens/ia_carregando.gif') top no-repeat;
    margin-top: 0px;
    margin-left: -150px;
    z-index: 9999999;
    display: none;
  }
</style>

<?
if ((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) {
  print getRegAtdJSFunc();
}

//*****************************************************************************************************
//*********************  FUNCOES DO AJAX **************************************************************
//*****************************************************************************************************
$xajax_mk->printJavascript();
$xajax_mk->printDivCarregando();
//*****************************************************************************************************
//********************* FIM DAS FUNCOES DO AJAX *******************************************************
//*****************************************************************************************************
?>
<?include "md_cad_prop_2_js.php"?>
<?
//********************************************************************//
//**************FUNÇÕES E STYLE SCRIPT ARGUMENTOS*********************//
//********************************************************************//
if ($mtr_script_argumento[0] == "S") {
  ?>
<script type="text/javascript">
$(document).ready(function(){
  if ($("#div_script_argumento")[0]) {
    var y_fixo = $("#div_script_argumento").offset().top;
    $(window).scroll(function () {
      $("#div_script_argumento").animate({
        top: y_fixo+$(document).scrollTop()+"px"
      },{duration:0,queue:false}) ;
    });
  }
});

function scriptObrigMostraEsconde(id) {
  if ($("#controle_"+id).val() == "E") {
    $("#controle_"+id).val("M");
    $("#"+id).show();
  } else {
    $("#controle_"+id).val("E");
    $("#"+id).hide();
  }
}
</script>

<?

$div_script_argumento_conteudo_display ="none";

if ($mtr_script_argumento[4] == "A") {
  $div_script_argumento_conteudo_display = "block";
}
?>


<style type="text/css">
#div_script_argumento {
  margin:0;
  padding:0;
  position:absolute;
  z-index: 99999;
  <?if ($session["versao_sistema"] == "novo_v2") {?>
  top:1px;
  left:1px;
  <?} else {?>
  top:70px;
  left:1px;
  <?}?>
}

#div_script_argumento_conteudo {
  height:<?print $mtr_script_argumento[2];?>px;
  width:<?print $mtr_script_argumento[3];?>px;
  display: <?print $div_script_argumento_conteudo_display?>;
  background-color: #FFFFFF;
  border: 2px solid <?print $session["td_destaque"];?>;
  overflow-x: hidden;
  overflow-y: auto;
  z-index: 10000;
}
</style>
<?
}
//**************************************************************//
//**************************************************************//
//**************************************************************//

//********************************************************************//
//**************FUNÇÕES E STYLE SCRIPT OPERADOR*********************//
//********************************************************************//

if ($mtr_script_flutuante[0] == "S") {
  ?>
<script type="text/javascript">
//$(document).ready(function(){
//  var y_fixo = $("#div_script_flutuante").offset().top;
//  $(window).scroll(function () {
//    $("#div_script_flutuante").animate({
//      top: y_fixo+$(document).scrollTop()+"px"
//    },{duration:0,queue:false}
//    );
//  });
//});

$(document).ready(function() {
  var y_fixo = $("#div_script_flutuante").offset().top;
  $(window).scroll(function () {
    MenuFlutuaPOS();
  }).load(function () {
    MenuFlutuaPOS();
  }).resize(function () {
    MenuFlutuaPOS();
  });
});

function MenuFlutuaPOS() {
  var menuLeft, menuTop, telaLeft, telaTop = 0;

  var jObjMenu = $("#div_script_flutuante");
  var jObjCab = $("#gcTable");

  var fimCab = (jObjCab.offset().top);
  menuTop = fimCab;
  if ($(document).scrollTop() >= fimCab) {
    menuTop = $(document).scrollTop();
  }

  jObjMenu.css({
    top: menuTop + "px"
  });
}



function scriptOperadorMostraEsconde(id) {
  if ($("#controle_"+id).val() == "E") {
    $("#controle_"+id).val("M");
    $("#"+id).show();
  } else {
    $("#controle_"+id).val("E");
    $("#"+id).hide();
  }
}
</script>
<?
  $div_script_flutuante_conteudo = "none";
  if ($mtr_script_flutuante[4] == "A") {
    $div_script_flutuante_conteudo = "block";
  }

?>
<style type="text/css">
#div_script_flutuante {

    margin:0;
    padding:0;
    position:absolute;
    z-index: 99999;
    <?if ($session["versao_sistema"] == "novo_v2") {?>
    top:1px;
    right:1px;
    <?} else {?>
    top:70px;
    right:1px;
    <?}?>
}

#div_script_flutuante_conteudo {
  height:<?print $mtr_script_flutuante[2];?>px;
  width:<?print $mtr_script_flutuante[3];?>px;
  display: <?print $div_script_flutuante_conteudo?>;
  background-color: #FFFFFF;
  border: 2px solid <?print $session["td_destaque"];?>;
  overflow-x: hidden;
  overflow-y: auto;
  z-index: 10000;
}
</style>
<?
}
//**************************************************************
//**************************************************************
//**************************************************************
?>
</head>
<?

//******************************************************************************************************
//******************************************************************************************************
//**********************ACOES DO ONLOAD NA PAGINA PRINCIPAL    *****************************************
//******************************************************************************************************
//$onload_acao= "";
if ($flw_tema) {
  if (!$acao && !$focus) {
    $acao = "Tema";
  }
}

if ($tipo_modelo == "ATIVO" || $tipo_modelo == "AGENDA_RETORNO" || $conclusao_receptivo == "S") {
  if (!$acao) {
    $acao        =  $fase_atend;
  }
  $onload_acao .= "atv_concl('".$tipo_atend."');";
} else {
  if(!$focus) {
    $onload_acao .= " document.body.scrollTop='".$ultima_pos_barra."';";
  }
}

if ($nro_modelo != "KA" && $nro_modelo != "XH") {
  if ($acao) {
    $onload_acao .= " window.location = '#".$acao."';";
  }

  if ($mk_acao) {
    $onload_acao .= " window.location = '#".$mk_acao."';";
  }
} else {
  // If temporário Conarec - passar campo clique
  if ($campo_clique_cliente_passa == 'BOTAO_NOVO') {
    $CPOEXTRA_fone_1 = $fone_1;
  }
}

if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME) - ONLOAD LOGIN AUTOMATICO
  $onload_acao .= "emuOnLoad();";
}
//******************************************************************************************************
//******************************************************************************************************
//**********************FIM DAS ACOES DO ONLOAD NA PAGINA PRINCIPAL    *****************************************
//******************************************************************************************************

?>

<body id="body_md" onload="<?print $onload_acao;?><?if ((achaNroModelo($nro_modelo,$tipo_abertura) == "SP" || achaNroModelo($nro_modelo,$tipo_abertura) == "HS") && $focus) {?><?if ($focus == "contentWindow") {?>if (document.getElementById('conteudo')) {document.getElementById('conteudo').contentWindow.focus();}<?} else {?>if ((document.cadastro.<?print $focus?>) && (document.cadastro.<?print $focus?>.type != 'hidden')) { document.cadastro.<?print $focus?>.focus();}<?}}?>">
<div id="black_div"   class="black_div"                 ></div>
<div id="loading_div" class="loading_div" align="center"></div>
<?
if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME) - ALTERAÇÕES DA MENSAGEM CARRENGANDO
?>
<script type="text/javascript">
function emuOnLoad() {
  try {
    document.getElementById('id_bt_enviar').style.width = 250;
    document.getElementById('id_bt_enviar').disabled = true;

    document.getElementById('bt_enviar_value').value = document.getElementById('id_bt_enviar').value;

    xajax_emuLogIn(xajax.getFormValues('cadastro'));
  } catch(e) {
    setTimeout("emuOnLoad();", 300);
  }
}

document.getElementById("carregando").innerHTML = "<table border=\"1\">\n  <tr bgcolor=\"#FF1111\" heigth=\"200\">\n    <td width=\"150\" align=\"center\">\n      <font class=\"txt6\">\n        <strong>\n          <br>\n          <br>\n        AGUARDE\n          <br>\n          <br>\n          <div id=\"emuBoxCarregando\">CONSULTANDO <?print $usa_emu;?></div>\n          <br>\n          <br>\n          <img src=\"imagens/processando.gif\">\n          <br>\n          <br>\n          <br>\n          </strong>\n      </font>\n    </td>\n  </tr>\n</table>\n";

varW  = new Number(document.body.offsetWidth);
varH  = new Number(document.body.offsetHeight);

varCW = new Number(document.getElementById("carregando").offsetWidth);
varCH = new Number(document.getElementById("carregando").offsetWidth);

document.getElementById("carregando").style.top  = ((varH - varCH) / 2);
document.getElementById("carregando").style.left = ((varW - varCW) / 2);

function altSenhaIbm() {
  AbreJanela2('ibm_alt_senha.php?login=<?print $session["operador"]?>&ibm_sistema=<?print $usa_emu;?>' , 'janSenhaIbm', '650', '300', 'Alteração de Senha no <?print ucfirst(strtolower($usa_emu));?>');
}
</script>
<?
}

if ($form_volta_outro) {
  print urldecode($form_volta_outro);
} else {
?>
<form action="md_cad_prop.php" name="form_volta" method="POST">


        <input type="hidden" name="id_lig"               value="<?print $id_lig;?>">
        <input type="hidden" name="status_dac"           value="<?print $status_dac;?>">
        <input type="hidden" name="servico_dac"          value="<?print $servico_dac;?>">
        <input type="hidden" name="bina_cliente"         value="<?print $bina_cliente;?>">
        <input type="hidden" name="nome_gravacao"        value="<?print $nome_gravacao;?>">
        <input type="hidden" name="hora_ini_dac"         value="<?print $hora_ini_dac;?>">
        <input type="hidden" name="abriuMkFrameWork" value="<?=$abriuMkFrameWork;?>">
        <input type="hidden" name="im_classe_mkpro" value="<?=$im_classe_mkpro;?>">

         <input type="hidden" name="nro_modelo"          value="<?print $nro_modelo;?>">
         <input type="hidden" name="repre_param"          value="<?print $repre_param;?>">
         <input type="hidden" name="ramal_atend" value="<?print $ramal_atend;?>">
         <input type="hidden" name="omni_tipo_atend" value="<?= $GLOBALS['omni_tipo_atend'];?>">
         <input type="hidden" name="omni_grupo_atend" value="<?= $GLOBALS['omni_grupo_atend'];?>">
         <input type="hidden" name="tipo_abertura"       value="<?print $tipo_abertura;?>">
         <input type="hidden" name="nivel_atual"         value="<?print $nivel_atual;?>">
         <?//hiddens para indicacao?>
         <input type="hidden" name="dk_campanha"         value="<?print $dk_campanha;?>">
         <input type="hidden" name="dk_campo_chave"      value="<?print $dk_campo_chave;?>">

         <input type="hidden" name="atv_st_venda_cartao" value="<?print $atv_st_venda_cartao;?>">
         <input type="hidden" name="msg_conclusao"       value="">

         <input type='hidden' name='dia_ini'             value='<?print $dia_ini;?>'>
         <input type='hidden' name='mes_ini'             value='<?print $mes_ini;?>'>
         <input type='hidden' name='ano_ini'             value='<?print $ano_ini;?>'>
         <input type='hidden' name='dia_fim'             value='<?print $dia_fim;?>'>
         <input type='hidden' name='mes_fim'             value='<?print $mes_fim;?>'>
         <input type='hidden' name='ano_fim'             value='<?print $ano_fim;?>'>
         <input type='hidden' name='busca'               value='ok'>
         <input type='hidden' name='atv_nome_razao'      value="<?print htmlspecialchars($atv_nome_razao, ENT_QUOTES, 'UTF-8');?>">
         <input type='hidden' name='atv_campanha'        value='<?print $atv_campanha;?>'>
         <input type='hidden' name='tipo'                value='<?print $tipo;?>'>
         <input type='hidden' name='msg_erro'            value='<?print $msg_erro;?>'>
         <input type='hidden' name='id_receptivo'        value='<?print $id_receptivo;?>'>
         <input type='hidden' name='mk_origem_atd_direto'        value='<?print $mk_origem_atd_direto;?>'>
         <input type="hidden" name="titulo_passa"            id="titulo_passa"           value="<?print $titulo_passa;?>">
          <?//******************************CASO O MD SEJA CHAMADO POR OUTRO MD.. UTLIZA PARA GRAVAR A ORIGEM DA CHAMADA//*****************************?>
          <?if($sistema_origem){?>
            <input type="hidden" name="sistema_origem"              id="sistema_origem"             value="<?print $sistema_origem;?>">
            <input type="hidden" name="sistema_origem_empresa"      id="sistema_origem_empresa"     value="<?print $sistema_origem_empresa;?>">
            <input type="hidden" name="sistema_origem_n_pedido"     id="sistema_origem_n_pedido"    value="<?print $sistema_origem_n_pedido;?>">

            <input type="hidden" name="sistema_origem_campanha"            id="sistema_origem_campanha"           value="<?print $sistema_origem_campanha;?>">
            <input type="hidden" name="sistema_origem_classe_campanha"     id="sistema_origem_classe_campanha"    value="<?print $sistema_origem_classe_campanha;?>">
            <input type="hidden" name="sistema_origem_dados_passa"         id="sistema_origem_dados_passa"        value="<?print $sistema_origem_dados_passa;?>">

            <input type="hidden" name="sistema_origem_nome_razao"   id="sistema_origem_nome_razao"     value="<?print $sistema_origem_nome_razao;?>">
            <input type="hidden" name="sistema_origem_cpf_cnpj"     id="sistema_origem_cpf_cnpj"    value="<?print $sistema_origem_cpf_cnpj;?>">
          <?}?>




<?
foreach ($_GET as $name_campo =>$value) {
  print "<input type='hidden' name='".$name_campo."' value='".$value."'>";
}
if (strtoupper($arrTplig["GRVNOR"]) == "DAC") {
?>
            <input type="hidden" name="dk_desliga_dac" value="S">
<?
}

if (is_array($_POST["arr_campos_volta"]) === true) {
  foreach ($_POST["arr_campos_volta"] as $nome_campo_volta => $valor_campo_volta) {
    if (is_array($nome_campo_volta) === false) {
?>
  <input type="hidden" id="campos_volta_frmVolta_<?print $nome_campo_volta;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>]" value="<?print htmlspecialchars($valor_campo_volta, ENT_QUOTES, 'UTF-8');?>">
<?
    } else {
      foreach ($valor_campo_volta as $campo1 => $valor1) {
        if (is_array($valor1) === false) {
?>
  <input type="hidden" id="campos_volta_frmVolta_<?print $nome_campo_volta.$campo1;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>][<?print $campo1;?>]" value="<?print htmlspecialchars($valor1, ENT_QUOTES, 'UTF-8');?>">
<?
        }else {
          foreach ($valor1 as $campo2 => $valor2) {
            if (is_array($valor2) === false) {
?>
  <input type="hidden" id="campos_volta_frmVolta_<?print $nome_campo_volta.$campo1.$campo2;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>][<?print $campo1;?>][<?print $campo2;?>]" value="<?print htmlspecialchars($valor2, ENT_QUOTES, 'UTF-8');?>">
<?
            }else{
              //NAO GERA HIDDEN
            }
          }
        }
      }
    }
  }
}

if ((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) {
  print getRegAtdCampos();
}
?>
</form>
<?
}

/*
if($session["operador"] == "testevsaude") {
	print "<pre>3";
	print_r($GLOBALS);
	print "</pre>";
}*/


?>
<form method="post" action="" name="cadastro" action1="<?print $PHP_SELF."?".$QUERY_STRING?>"  enctype="multipart/form-data">

<input type="hidden" name="mk_acao"   id="mk_acao"            value="">
<?
if ($mk_ramal["grupo"] != "") {
  ?>
  <input type="hidden" name="<?print 'im_chave_'.strtolower(substr($mk_ramal["grupo"], 0, 2)).'1';?>"   id="<?print 'id_im_chave_'.strtolower(substr($mk_ramal["grupo"], 0, 2)).'1'?>"            value="<?print ${'im_chave_'.strtolower(substr($mk_ramal["grupo"], 0, 2)).'1'}?>">
  <?
}
?>


<?if ($flw_arquivo_anexo) {?>
    <input type="hidden" id="flw_arquivo_anexo"        name="flw_arquivo_anexo"  value="<?print $flw_arquivo_anexo?>">
<?}?><?
if (empty($lead_id) === false) {
  ?><script type="text/javascript">
  $(document).ready(function () {
    moldaTelaMK();
  });


  function moldaTelaMK(){
    parent.document.getElementById('iframe_ld').style.height = "100px";
    parent.$('#iframe_ld').css('height', $('body').innerHeight() + 15);
    parent.$('#iframe_ld').css('width', $('body').innerWidth() + 15);

    parent.document.getElementById('iframe_ld').style.height = document.body.scrollHeight + 'px';
    parent.document.getElementById('iframe_ld').style.width  = document.body.scrollWidth + 'px';
    parent.document.getElementById("confirma_tela_md" ).value = "MD_CAD_PROP_2";
    $("#id_bt_enviar").val("Registrar");
  }
  </script>
<?
} else {
  ?>
  <script type="text/javascript">
  function moldaTelaMK(){
    return true;
  }
  </script>
  <?
}
?>
  <input type="hidden" name="submit_form_cadastro" value="true">
  <input type="hidden" name="tipo_popup"         value="<?print $tipo_popup;?>"   >
  <input type="hidden" name="lead_n_pedido"      value="<?print $lead_n_pedido;?>">
  <input type="hidden" name="lead_id"            value="<?print $lead_id;?>"      >
  <input type="hidden" name="lead_mkpro"         value="<?if(!$lead_mkpro) { print $dk_mkpro;} else { print $lead_mkpro;}?>">
  <input type="hidden" name="lead_grupo"         value="<?print $lead_grupo;?>"   >
  <input type="hidden" name="lead_nb"            value="<?print $lead_nb;?>"   >
  <input type="hidden" name="lead_data"          value="<?print $lead_data;?>"   >
  <input type="hidden" name="lead_hora"          value="<?print $lead_hora;?>"   >
  <input type="hidden" name="lead_nome_razao"    value="<?print $lead_nome_razao;?>"   >
  <input type="hidden" name="lead_email"         value="<?print $lead_email;?>"   >
<?
if ($nro_modelo == "BI") {
?>
  <input type="hidden" name="lead_msg" value="<?print $lead_msg;?>">
<?
}
?>
  <input type="hidden" name="mk_grupo_origem"      value="<?print $mk_grupo_origem;?>"   >
  <input type="hidden" name="mk_nb_origem"         value="<?print $mk_nb_origem;?>"   >
  <input type="hidden" name="mk_data_origem"       value="<?print $mk_data_origem;?>"   >
  <input type="hidden" name="mk_hora_origem"       value="<?print $mk_hora_origem;?>"   >





<?
if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME) - CAMPOS PARA GRAVAR VALORES DO BOTÃO ENVIAR
?>
  <input type="hidden" name="arr_bt_enviar[value]" id="bt_enviar_value" value="">
<?
}
if (strtoupper($arrTplig["GRVNOR"]) == "DAC") {
?>
      <input type="hidden" name="dk_desliga_dac" value="S">
<?
}

// Arr com os campos da primeira tela.
if (is_array($_POST["arr_campos_volta"]) === true) {
  foreach ($_POST["arr_campos_volta"] as $nome_campo_volta => $valor_campo_volta) {
    if (is_array($nome_campo_volta) === false) {
?>
  <input type="hidden" id="campos_volta_frmCadastro_<?print $nome_campo_volta;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>]" value="<?print htmlspecialchars($valor_campo_volta, ENT_QUOTES, 'UTF-8');?>">
<?

    } else {
      foreach ($valor_campo_volta as $campo1 => $valor1) {
        if (is_array($valor1) === false) {
?>
  <input type="hidden" id="campos_volta_frmCadastro_<?print $nome_campo_volta.$campo1;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>][<?print $campo1;?>]" value="<?print htmlspecialchars($valor1, ENT_QUOTES, 'UTF-8');?>">
<?
        }else {
          foreach ($valor1 as $campo2 => $valor2) {
            if (is_array($valor2) === false) {
?>
  <input type="hidden" id="campos_volta_frmCadastro_<?print $nome_campo_volta.$campo1.$campo2;?>" name="arr_campos_volta[<?print $nome_campo_volta;?>][<?print $campo1;?>][<?print $campo2;?>]" value="<?print htmlspecialchars($valor2, ENT_QUOTES, 'UTF-8');?>">
<?
            }else{
              //NAO GERA HIDDEN
            }
          }
        }
      }
    }
  }
}
?>
   <input type="hidden" id="id_mesmo_cliente_n_pedido" name="mesmo_cliente_n_pedido" value="<?print $mesmo_cliente_n_pedido?>">
<?
if (($isUraGeraProtocolo === true || (preg_match("/^B[IT]$/", $nro_modelo) == 1)) && ($isRegAtd === true)) {
?>
  <input type="hidden" name="n_pedido_origem" id="n_pedido_origem" value="<?= $n_pedido_origem;?>">
<?
}
?>

   <input type="hidden" name="where_grava_cliente_gss" value="<?print $where_grava_cliente_gss?>">
   <input type="hidden" name="campo_clique_cliente">
   <input type="hidden" name="campo_campo_clique_cliente">

   <?if (!$campo_clique_cliente_passa) {$campo_clique_cliente_passa = $campo_clique_cliente;}?>
   <?if (!$campo_campo_clique_cliente_passa) {$campo_campo_clique_cliente_passa = $campo_campo_clique_cliente;}?>
   <input type="hidden" name="campo_clique_cliente_passa" value="<?print $campo_clique_cliente_passa?>">
   <input type="hidden" name="campo_campo_clique_cliente_passa" value="<?print $campo_campo_clique_cliente_passa?>">
   <input type="hidden" name="abriuMkFrameWork" value="<?=$abriuMkFrameWork;?>">
   <input type="hidden" name="im_classe_mkpro" value="<?=$im_classe_mkpro;?>">
   <input type="hidden" name="nro_modelo"        value="<?print $nro_modelo?>"      >
   <input type="hidden" name="repre_param"          value="<?print $repre_param;?>">
   <input type="hidden" name="ramal_atend" value="<?print $ramal_atend;?>">
   <input type="hidden" name="omni_tipo_atend" value="<?= $GLOBALS['omni_tipo_atend'];?>">
   <input type="hidden" name="omni_grupo_atend" value="<?= $GLOBALS['omni_grupo_atend'];?>">
   <input type="hidden" name="tipo_abertura"     value="<?print $tipo_abertura?>"   >
   <input type="hidden" name="nivel_atual"       value="<?print $nivel_atual?>"     >
   <input type="hidden" name="id_receptivo"      value="<?print $id_receptivo?>"    >
   <input type="hidden" name="form_volta_outro"  value="<?print $form_volta_outro?>">

   <input type="hidden" name="dk_campanha"       value="<?print $dk_campanha?>"    >
   <input type="hidden" name="dk_campo_chave"    value="<?print $dk_campo_chave?>" >



  <input type="hidden" name="mk_campos_conf"    value="" >

<?
if(!$_REQUEST["mk_origem_atd"]){//se tem a rotina da mdl os hiddens é montado na funcao
//*******HIDENS COM OS DADOS DA LIGAÇÃO
foreach ($mk_ramal as $nome_hidden_mk=>$vlr_hidden_mk) {
  print "<input type='hidden' name='mk_ramal[".$nome_hidden_mk."]' id='mk_ramal_".$nome_hidden_mk."' value='".$vlr_hidden_mk."'>";
}
//*************************************
}

//*******HIDDEM QUE É PREENCHIDO QUANDO O OPERADOR SOLICITA
//************PARA SYNCRONIZAR O DAC************************
PRINT "<input type='hidden' name='sync_dac' value=''>";
//**********************************************************

?>
  <input type="hidden" name="id_lig"         value="<?print $id_lig;?>">
  <input type="hidden" name="status_dac"    value="<?print $status_dac;?>">
  <input type="hidden" name="servico_dac"   value="<?print $servico_dac;?>">
  <input type="hidden" name="bina_cliente"  value="<?print $bina_cliente;?>">
  <input type="hidden" name="nome_gravacao" value="<?print $nome_gravacao;?>">
  <input type="hidden" name="hora_ini_dac"  value="<?print $hora_ini_dac;?>">
  <input type="hidden" name="atv_cpf_cnpj"  value="<?print $atv_cpf_cnpj;?>">
  <input type="hidden" name="vez_atualiza"             value="<?print ($vez_atualiza+1);?>">
  <input type="hidden" name="atv_nome_razao_ant"       value="<?print htmlspecialchars($atv_nome_razao_ant, ENT_QUOTES, 'UTF-8');?>">
  <input type="hidden" name="atv_cpf_cnpj_ant"         value="<?print $atv_cpf_cnpj_ant;?>">
  <input type="hidden" name="tipo"                     value="<?print $tipo;?>">
  <input type='hidden' name='dia_ini'                  value='<?print $dia_ini;?>'>
  <input type='hidden' name='mes_ini'                  value='<?print $mes_ini;?>'>
  <input type='hidden' name='ano_ini'                  value='<?print $ano_ini;?>'>
  <input type='hidden' name='dia_fim'                  value='<?print $dia_fim;?>'>
  <input type='hidden' name='mes_fim'                  value='<?print $mes_fim;?>'>
  <input type='hidden' name='ano_fim'                  value='<?print $ano_fim;?>'>
  <input type="hidden" name="tipo_modelo"              value="<?print $tipo_modelo;?>">
  <input type="hidden" name="atv_seq"                  value="<?print $atv_seq;?>">
  <input type="hidden" name="atv_campanha"             value="<?print $atv_campanha;?>">
  <input type="hidden" name="atv_st_venda_cartao"      value="<?print $atv_st_venda_cartao;?>">
  <input type="hidden" name="prp_status"               value="<?print $prp_status;?>">
  <input type="hidden" name="atv_login_operador"       value="<?print $atv_login_operador;?>">
  <input type="hidden" name="atv_operador_incompl"     value="<?print $atv_operador_incompl;?>">

  <input type="hidden" id="id_libera_alcada"        name="libera_alcada"         value="<?print $libera_alcada;?>">
  <input type="hidden" id="id_login_libera_alcada"  name="login_libera_alcada"   value="<?print $login_libera_alcada;?>">
  <input type="hidden" id="id_msg_libera_alcada"    name="msg_libera_alcada"     value="<?print $msg_libera_alcada;?>">

  <input type="hidden" id="id_libera_alcada_2"       name="libera_alcada_2"       value="<?print $libera_alcada_2;?>">
  <input type="hidden" id="id_login_libera_alcada_2" name="login_libera_alcada_2" value="<?print $login_libera_alcada_2;?>">
  <input type="hidden" id="id_msg_libera_alcada_2"   name="msg_libera_alcada_2"   value="<?print $msg_libera_alcada_2;?>">


  <input type="hidden" name="md_tipo_atendimento"      value="<?print $md_tipo_atendimento;?>">

  <input type="hidden" name="mk_email_id"    id="mk_email_id" value="<?print $mk_email_id;?>">


  <input type="hidden" name="titulo_passa"            id="titulo_passa"           value="<?print $titulo_passa;?>">

  <?//******************************CASO O MD SEJA CHAMADO POR OUTRO MD.. UTLIZA PARA GRAVAR A ORIGEM DA CHAMADA//*****************************?>
  <?if($sistema_origem){?>
    <input type="hidden" name="sistema_origem"              id="sistema_origem"             value="<?print $sistema_origem;?>">
    <input type="hidden" name="sistema_origem_empresa"      id="sistema_origem_empresa"     value="<?print $sistema_origem_empresa;?>">
    <input type="hidden" name="sistema_origem_n_pedido"     id="sistema_origem_n_pedido"    value="<?print $sistema_origem_n_pedido;?>">

    <input type="hidden" name="sistema_origem_campanha"            id="sistema_origem_campanha"           value="<?print $sistema_origem_campanha;?>">
    <input type="hidden" name="sistema_origem_classe_campanha"     id="sistema_origem_classe_campanha"    value="<?print $sistema_origem_classe_campanha;?>">
    <input type="hidden" name="sistema_origem_dados_passa"         id="sistema_origem_dados_passa"        value="<?print $sistema_origem_dados_passa;?>">

    <input type="hidden" name="sistema_origem_nome_razao"   id="sistema_origem_nome_razao"     value="<?print $sistema_origem_nome_razao;?>">
    <input type="hidden" name="sistema_origem_cpf_cnpj"     id="sistema_origem_cpf_cnpj"    value="<?print $sistema_origem_cpf_cnpj;?>">
  <?}?>
   <a name="dados_cli" ></a>
   <script type="text/javascript">
   if (document.getElementById('fi_form_volta')) {
     if (document.getElementById('fi_form_volta').getAttribute('action') == '') {
       if (document.getElementById('id_action_hidden_inteligente')) {
         document.getElementById('fi_form_volta').setAttribute('action', document.getElementById('id_action_hidden_inteligente').value);
       }
     }
   }
   </script>
<?
if (($botao_voltar == "S" && empty($mesmo_cliente_n_pedido) === true ) || $_SESSION["ssitgl_voltou_mk_".$nro_modelo] ===true) {
  $volta = "Javascript:document.form_volta.submit()";
  if ($selecao_receptivo == "direto") {
    if(substr($nivel_atual,0,1)=="P"){
      $volta = "Javascript:document.form_volta.action='cc_consulta.php?nivel=P';document.form_volta.submit()";
    }else{
      $volta = "Javascript:document.form_volta.action='cc_consulta.php?nivel=B';document.form_volta.submit()";
    }

  }
  if ($tipo_abertura == "dk_direto") {
    $volta = "Javascript:document.form_volta.action='dk_cad_prop.php?nro_discador=".$session["discador_atende"]."';document.form_volta.submit()";
  }
} else {
  if (empty($volta_especial) === false) {
    $volta = $volta_especial;
  } else {
    $volta = "";
  }
}

if (($tipo_abertura != "janela") || ((($nro_modelo == "BI") || ($nro_modelo == "BT")) && ($arr_campos_volta["deonde_honda"] == "ATV"))) {
  if ($tipo_modelo != "ATIVO") {
    if (( $tipo_modelo == "RECEPTIVO" || $tipo_modelo == "RETORNO") && $funcao_recusa == "S") {
      $imagem .= "R¬";
      $click  .= "apontarRecusa()¬";
    }
  }

  /**********************************************************************************************/
  /******   SERVIÇO DAC FIXO HONDA  *************************************************************/
  /**********************************************************************************************/
  if ($nro_modelo == "BT") {
    if (substr($hidden_servico_dac, 0, -1) == "7030") {
      $consulta_servico_dac = "&servico_dac=".base64_encode($hidden_servico_dac);
    }
  }
  /**********************************************************************************************/
  /****** FIM SERVIÇO DAC FIXO HONDA  ***********************************************************/
  /**********************************************************************************************/

  if ((strpos(" ".$tipo_abre_historico, "botao") > 0) &&
  //NÃO EXIBIR OPÇÕES
  (
  //HONDA - CNH
  (($nro_modelo == "BI") && ((substr($hidden_servico_dac, 0, -1) != "B037") && (substr($hidden_servico_dac, 0, -1) != "B039")))
  ||
  //HONDA - BHB
  (($nro_modelo == "BT") && (substr($hidden_servico_dac, 0, -1) != "B041"))
  ||
  //DEMAIS SISTEMAS
  (($nro_modelo != "BI") && ($nro_modelo != "BT"))
  )
  ) {
    $imagem .= "H¬";
    $click  .= "AbreJanela2('mk_hist_cliente.php?nro_modelo=".achaNroModelo($nro_modelo,$tipo_abertura)."&repre_param=".$repre_param."&nivel_atual=".$nivel_atual."&tipo_abertura=".$tipo_abertura."&id_receptivo=".$id_receptivo."&tipo_dkmd=MD&repre=".$repre_vendedor."&campo_chave=".$campo_chave.$consulta_servico_dac."', 'Historico' ,'98%', '90%', 'Pesquisa Histórico', 'TC')¬;";
  }
  if ((substr($botao_finaliza_cliente, 0, 1) == "A") &&
  //NÃO EXIBIR OPÇÕES
  (
  //HONDA - CNH
  (($nro_modelo == "BI") && ((substr($hidden_servico_dac, 0, -1) != "B037") && (substr($hidden_servico_dac, 0, -1) != "B039")))
  ||
  //HONDA - BHB
  (($nro_modelo == "BT") && (substr($hidden_servico_dac, 0, -1) != "B041"))
  ||
  //DEMAIS SISTEMAS
  (($nro_modelo != "BI") && ($nro_modelo != "BT"))
  )
  ) {
    $imagem .= "HA¬";
    $click  .= "AbreJanela2('mk_hist_cliente_reg_atd.php?nro_modelo=".achaNroModelo($nro_modelo,$tipo_abertura)."&repre_param=".$repre_param."&nivel_atual=".$nivel_atual."&tipo_abertura=".$tipo_abertura."&id_receptivo=".$id_receptivo."&tipo_dkmd=MD&repre=".$repre_vendedor."&campo_chave=".$campo_chave.$consulta_servico_dac."', 'janHistRegAtd' ,'98%', '90%', 'Pesquisa Histórico Registro de Atendimento', 'TC')¬;";
  }
  //print "<L>".$atv_param_repre_vendedor;
  if ($mostra_agenda_retorno == "S" || $mostra_agenda_retorno == "EXTRA") {
    $imagem .= "A¬";
    $click  .= "AbreJanela('cc_agenda_retorno_inclui_cliente.php?repre=".$repre_vendedor."&campanha_indica=".$dk_campanha."&campo_chave_indica=".$dk_campo_chave."&nro_modelo_passa=".achaNroModelo($nro_modelo,$tipo_abertura)."', 'janRegLig', '750','400','Agenda de Retorno')¬";

  }
  if ($mostra_agenda_retorno == "C" || strpos(" ".$mostra_agenda_retorno_opcoes,"NC_PESQUISADO") > 0) {
    $imagem .= "A¬";
    $click  .= "AbreJanela('cc_agenda_retorno_inclui_cliente.php?vend_login_agret='+document.cadastro.vend_login_agret.value+'&repre=".$repre_vendedor."&campanha_indica=".$dk_campanha."&campo_chave_indica=".$dk_campo_chave."&nro_modelo_passa=".achaNroModelo($nro_modelo,$tipo_abertura)."', 'janRegLig', '750','400','Agenda de Retorno')¬";
  }

  if ($mostra_reg_lig == "S"/* && (!$session["discador_atende"])*/) {
    $imagem .= "F¬";
    $click  .= "AbreJanela2('cc_reg_lig_cad.php?repre=".$repre_vendedor."&empresa=".$param_empresa."', 'janRegLig', '98%', '90%','Registro de Ligações', 'TC')¬";
  }

  if ($mostra_pesquisa == "S") {
    $imagem .= "P¬";
    $click  .= "AbreJanela('md_cad_prop.php?tipo_abertura=janela&nivel=BQ1&nro_modelo=FAbM43I34ZX5E5kJfkC-', 'janRegLig', '98%', '90%', 'TC')¬";
  }

  if (($nro_modelo == "BI") && ($reg_atd_grupo_cond == "AC")) {
    for ($i = 1; $i < 5; $i++) {
      if ((preg_match("/(detran.gif)/", ${"abre_nivel_".$i}) == 1) || (preg_match("/^(ZH¢)/", ${"abre_nivel_".$i}) == 1)) {
        unset(${"abre_nivel_".$i});
      }
    }
  }

  //ABRE NÍVEL e ABRE MODELO
  for ($i = 1; $i < 30; $i++) {

    if (empty(${"abre_modelo_".$i}) === false) {

      $arr_abre_modelo_aux = explode("¢",${"abre_modelo_".$i});
      if (($arr_abre_modelo_aux[0]) && ($arr_abre_modelo_aux[2])) {
        $nro_modelo_abre_janela_md_aux  = base64_encode(base64_encode($arr_abre_modelo_aux[0]));
        $imagem .= $arr_abre_modelo_aux[4]."¬";
        $click  .= "AbreJanela('md_cad_prop.php?tipo_abertura=janela&nivel=BN1&repre_param=".$repre_param."&nro_modelo=".$nro_modelo_abre_janela_md_aux."', 'janAbreMd1', '98%', '90%', 'TC')¬";
      }

    }

    if (empty(${"abre_nivel_".$i}) === true) {
      continue;
    }

    //NÃO EXIBIR OPÇÕES
    if (
    //HONDA - CNH
    (($nro_modelo == "BI") && ((substr($hidden_servico_dac, 0, -1) == "B037") || (substr($hidden_servico_dac, 0, -1) == "B039")))
    ||
    //HONDA - BHB
    (($nro_modelo == "BT") && (substr($hidden_servico_dac, 0, -1) == "B041"))
    ) {
      continue;
    }

    $arr_abre_nivel = explode("¢", ${"abre_nivel_".$i});
    if (($arr_abre_nivel[0]) && ($arr_abre_nivel[4]) && ($arr_abre_nivel[2] == "1")) {
      $connect_nivel = ConnectDB();
      if ($query_nivel = DescExecQuery("SELECT programa, nivel, descricao FROM tbniveis WHERE representante = '".$_SESSION["repre_nivel"]."' AND idioma = '".$session["idioma"]."' AND status = 'A' AND nivel='".$arr_abre_nivel[0]."'", $connect_nivel, "N")) {
        if ($rec_nivel = mysql_fetch_assoc($query_nivel)) {

          if (strpos("**".$rec_nivel["programa"], "?") > 0) {
            $rec_nivel["programa"] .= "&";
          } else {
            $rec_nivel["programa"] .= "?";
          }
          $rec_nivel["programa"] .= "nivel=".$rec_nivel["nivel"]."&titulo=".urlencode($rec_nivel["descricao"]);

          if ((substr($rec_nivel["programa"], 0, 6) == "ia_sms") || (substr($rec_nivel["programa"], 0, 7) == "ia_mail") || (substr($rec_nivel["programa"], 0, 6) == "ia_fax")) {
            $rec_nivel["programa"] .= "&repre=".$repre_vendedor."&mk_flag=MD&mk_numero=".$nro_modelo."&campo_chave=".$mesmo_cliente_n_pedido;
            if (substr($repre_vendedor, 0, 7) == "HONDA-U") {
              if ((substr($rec_nivel["programa"], 0, 7) == "ia_mail") && (empty($grupo_email) === false)) {
                $rec_nivel["programa"] .= "&servico=".$grupo_email;
              } else if ((substr($rec_nivel["programa"], 0, 6) == "ia_fax") && (empty($grupo_fax) === false)) {
                $rec_nivel["programa"] .= "&servico=".$grupo_fax;
              }
            }
          }

          $imagem .= $arr_abre_nivel[4]."¬";
          if (substr($rec_nivel["programa"], 0, 7) == "ia_mail") {
            if (substr($repre_vendedor, 0, 7) == "HONDA-U") {

              if (verificaValidaVersao("SU54216") && $rotina_envia_email_abrir_tela_confirmacao == 'S') {
              $click  .= "javascript:if(typeof(email_cadastro_cliente) == 'undefined') {email_cadastro_cliente = '';} iaConfirmaEmail(email_cadastro_cliente, function() { AbreJanelaFormMK('janAbreNivelMD_".$i."', '98%', '90%', 'TC', '".$rec_nivel["programa"]."&tipo_popup=AJ2&destino='+destino+' ', $('form[name=cadastro]').serialize() )});¬";
              } else {
              $click  .= "javascript:AbreJanelaFormMK('janAbreNivelMD_".$i."', '98%', '90%', 'TC', '".$rec_nivel["programa"]."&tipo_popup=AJ2', $('form[name=cadastro]').serialize());¬";
              }
            } else {
              if (verificaValidaVersao("SU54216") && $rotina_envia_email_abrir_tela_confirmacao == 'S') {
              $click  .= "if(typeof(email_cadastro_cliente) == 'undefined') {email_cadastro_cliente = '';} iaConfirmaEmail(email_cadastro_cliente, function() { document.form_extra.method='POST';document.form_extra.form_campos_mk.value=$('form[name=cadastro]').serialize();document.form_extra.target='janAbreNivelMD_".$i."';document.form_extra.action='".$rec_nivel["programa"]."&destino='+destino+''; AbreJanela('', 'janAbreNivelMD_".$i."', '98%', '90%', 'TC');document.form_extra.submit();document.form_extra.target='';document.form_extra.action='';});¬";
              } else {
              $click  .= "document.form_extra.method='POST';document.form_extra.form_campos_mk.value=$('form[name=cadastro]').serialize();document.form_extra.target='janAbreNivelMD_".$i."';document.form_extra.action='".$rec_nivel["programa"]."';AbreJanela('', 'janAbreNivelMD_".$i."', '98%', '90%', 'TC');document.form_extra.submit();document.form_extra.target='';document.form_extra.action='';¬";

              }
            }
            $conteudo_form_extra.= "<input type=\"hidden\" name=\"form_campos_mk\" value=\"\" >";
            $conteudo_form_extra.= "<input type=\"hidden\" name=\"tipo_popup\" value=\"AJ2\" >";
          } else {
            $click .= "AbreJanela('".$rec_nivel["programa"]."', 'janAbreNivelMD_".$i."', '98%', '90%', 'TC');¬";
          }

          unset($rec_nivel);
        }
        unset($query_nivel);
      }
      unset($connect_nivel);
    }
    unset($arr_abre_nivel);
  }

  if (empty($abre_nivel_chat) === false) {
    //INI-CHAT FLUTUANTE
    if ($session["marca_ponto"] == "S") {
      require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/RamalWeb.php");
      $objRamal = new RamalWeb($session["ip_dac"], $session["porta_dac"], $ramal_atend);

      if (mb_strtolower($session["operador"]) == mb_strtolower($objRamal->getCampo("login_operador"))) {
        if ((preg_match("/(([H])[0-9]{3}\\2\|)/", $objRamal->getCampo("atende"))) && (mb_strtolower(substr($ramal_atend, 0, (strlen($session["ramal"]) + 1))) == mb_strtolower($session["ramal"]."H"))) {
          if ($session["operador"] == "suhaivend") {
            //RAMAL DO CHAT
            require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/Im_func.php");
          } else {
            //RAMAL DO CHAT
            require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/Chat.php");
          }

          print getChatFlutuante();
        } else if (preg_match("/(([V])[0-9]{3}\\2\|)/", $objRamal->getCampo("atende"))) {
          //VIDEO NO RAMAL DE TELECOM
          require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/Video.php");
          print getVideoFlutuante();
        } else if (substr($objRamal->getCampo("atende"),0,1) == "H" && is_numeric(substr($objRamal->getCampo("atende"),1,1)) === false) {
          //RAMAL DO IM
          require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/Im_func.php");
          print getChatFlutuante();
        }
      }
    }
    //FIM-CHAT FLUTUANTE
  }
}

if ($mostra_script == "S" || $mostra_script == "M"  || $mostra_script == "") {
  $imagem .= "I¬";
  $click  .= "InfoScript('".$session["nivel_atual"]."','".$repre_vendedor."', '".$mostra_script."')¬";
}
$link_logo = "N";
if (strtolower($tipo_abertura) == "janela") {
  $tipo_popup = "AJ";
}

if ($titulo_passa) {
  $titulo_modelo = $titulo_passa;
}

if(($nro_modelo == "YB") && (strpos($ramal_atend, "H") <= 0 || $mk_origem_atd == "99")) {//mk_origem_atd == "99" Atd sem telefonia
  $volta      = "Javascript:document.form_volta.action='md_cad_prop.php?nivel=B&voltou_atd=S';document.form_volta.submit()";
  $tipo_popup = "";
}

if($session["representante"] == "SUHAI-S") {
  $volta      = "Javascript:document.form_volta.action='md_cad_prop.php?nivel=B&voltou_atd=S';document.form_volta.submit()";
  $_SESSION["ssitgl_voltou_mk_".$nro_modelo] = false;
}

if($session["representante"] == "BOAVISTA-R") {
  $volta = "Javascript:document.form_volta.action='md_cad_prop.php?nivel=B';document.form_volta.submit()";
}


if($session["representante"] == "ES-EXPO") {
  $volta = "Javascript:document.form_volta.action='md_cad_prop.php?nivel=B';document.form_volta.submit()";
}
if($voltar_especifico){
  $volta=$voltar_especifico;
}
if((achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){
  $imagem = "";
  $click = "";
  $titulo_modelo = "";
  print "<br>";
}

print GerarCabecalho($volta, $objTradutor->traduzir($titulo_modelo), $imagem, $click);

if (is_array($_SESSION["ssitgl_grupo_atende"]) === true) {
  foreach ($_SESSION["ssitgl_grupo_atende"] as $key => $value) {
    if(substr($value,0,1) == "H") {
      $_SESSION["ssitgl_voltou_mk_".$nro_modelo] = false;
    }
  }
}

if($include_dados == 'flw_manut_script' || substr($session["representante"],0,6) == "ZURICH" || substr($session["representante"],0,3) == "ES-" || substr($session["representante"],0,3) == "BMG" || substr($session["representante"],0,6) == "URANET" || ($nro_modelo == 'AN' && $repre_vendedor == "BMC" && $mk_origem_atd == '52') || (($nro_modelo == 'TU' || $nro_modelo == '4W') && $repre_vendedor == "BMC" && $mk_origem_atd == '04')) {
  $_SESSION["ssitgl_voltou_mk_".$nro_modelo] = false;
}


if ($_SESSION["ssitgl_voltou_mk_".$nro_modelo] === true && $dk_campo_chave == "") {
  print "<font class='txtvermelho2'>NÃO UTILIZE O BOTÃO VOLTAR DO BROWSER (".$nro_modelo.")</font>";
  exit;
}

// ******************************************************************************************************
// ******************************************************************************************************
// ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA********************************
// ******************************************************************************************************
if (!$IntergrAllHeader) {//se esta no bootstrap monta na linha de atendimento
  if ($mk_origem_atd) {
    print montaDadosMKATD($_REQUEST,$nro_modelo,$repre_vendedor);
  } else {
  ?>
    <input type='hidden' name='mk_origem_atd'            value='<?print $mk_origem_atd;?>'>
    <input type='hidden' name='mk_origem_atd_direto'        value='<?print $mk_origem_atd_direto;?>'>

  <?
  }
}
// ******************************************************************************************************
// ******************************************************************************************************
// ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA******************************
// ******************************************************************************************************

// ******************************************************************************************************
// ******************************************************************************************************
// ************************************* ROTINA DO MESMO CLIENTE N_PEDIDO********************************
// ******************************************************************************************************
if (empty($mesmo_cliente_n_pedido) === false && $nro_modelo != "ZV" && $nro_modelo != "WA" && $nro_modelo != "YB") {
  if ((($nro_modelo == "BI") || ($nro_modelo == "BT")) && ($arr_campos_volta["deonde_honda"] == "ATV")) {
    $botoes = explode("¬", $imagem);
    $clicks = explode("¬", $click);


    for ($i = 0; $i < count($botoes); $i++) {
      $arr[$botoes[$i]] = $clicks[$i];
    }
    unset($botoes);
    unset($clicks);
    if (is_array($arr) === true) {
?>
<table id="gcTable" width="95%" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
    <td id="gcVoltar" nowrap width="15%"></td>
    <td id="gcTitulo" width="70%" align="center" valign="middle" class="tit">
<?
    }
  }
  if($usa_bootstrap == "S"){
    if(!$_REQUEST["mk_ramal_serialize"] && $nro_modelo != "BB"){//quando tem mk_ramal_serialize significa que usa a rotina da MDL e o protocolo é exibido lá

    ?>
      <div class="container panel panel-info">
        <div class="panel-heading">
          <h3 class="panel-title"><?print ((empty($desc_pedido) === false) ? $desc_pedido : "Protocolo");?>: <?print $mesmo_cliente_n_pedido;?></h3>
        </div>
      </div>
      <div class="container panel panel-body">
    <?

    }
  }else{
?>
  <table id="table_mesmo_cliente_n_pedido" style="margin-bottom: 5px;" border="1" cellpadding="4"  bordercolor="<?print $session["td_destaque"]?>" style='border-collapse: collapse'  cellspacing="0" align="center">
    <tr bgcolor="<?print $session["td_dado3"];?>">
      <td align="center">
        <font class="txtvermelho" style="color: #000000;"><strong>
        <?print ((empty($desc_pedido) === false) ? $desc_pedido : "Protocolo");?>: </strong></font>
<?
    if (($isUraGeraProtocolo === true) && ($isRegAtd === true)) {
?>
        <font class="txtvermelho"><strong><?print $n_pedido_origem;?></strong></font>
<?
    } else {
?>
        <font class="txtvermelho"><strong><?print $mesmo_cliente_n_pedido;?></strong></font>
<?
    }
  }
  if ((((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) && $nro_modelo != "SA") || (($nro_modelo == "MC") || ($nro_modelo == "HS"))) {// ADICIONANDO ZURICH - MASS CONSUMER (RE006200) VINI
    $tmp_q = "SELECT vlr_classe, filtro_classe FROM tb_classe WHERE cod_classe = 'EK".$nro_modelo."A' AND representante = '".$repre_vendedor."' AND idioma = '".$session["idioma"]."' AND tipo_reg = 'I'";
    if ($tmp_query = DescExecQuery($tmp_q, ConnectDB())) {
      if ($tmp_rec = mysql_fetch_assoc($tmp_query)) {
        do {
          $tmp_arr_reg_atd_canal[$tmp_rec["vlr_classe"]] = $tmp_rec["filtro_classe"];
        } while ($tmp_rec = mysql_fetch_assoc($tmp_query));
      }
    }
    unset($tmp_q);
    unset($tmp_query);
    unset($tmp_rec);
        ?>
          <script type="text/javascript">
          <?
          if (is_array($tmp_arr_reg_atd_canal) === true) {
            ?>
            arr_reg_atd_canal = new Array();
            arr_reg_atd_grupo = new Array();

            <?
            $tmp_i = 0;
            foreach ($tmp_arr_reg_atd_canal as $tmp_reg_atd_grupo => $tmp_reg_atd_canal) {
              ?>
              arr_reg_atd_canal[<?print $tmp_i;?>] = '<?print $tmp_reg_atd_canal;?>';
              arr_reg_atd_grupo[<?print $tmp_i;?>] = '<?print $tmp_reg_atd_grupo;?>';

              <?
              $tmp_i++;
            }
          }
          unset($tmp_arr_reg_atd_canal);
          unset($tmp_reg_atd_grupo);
          unset($tmp_reg_atd_canal);
          unset($tmp_i);
          ?>
          function mudaServicoDac(servico) {
            var grupo = servico.substr(0, servico.length -1);

            $("#id_hidden_servico_dac").val(servico);
            $("#campos_volta_frmCadastro_servico_dac").val(servico);
            $("#campos_volta_frmVolta_servico_dac").val(servico);

            $("input[name='arr_campos_volta[reg_atd_grupo]']").val(grupo);
            $("#reg_atd_grupo_atd").val(grupo);

            if (arr_reg_atd_canal) {
              var iOf = $.inArray(grupo, arr_reg_atd_grupo);

              $("input[name='reg_atd_canal']").each(function() {
                $(this).val(((iOf > -1) ? arr_reg_atd_canal[iOf] : ""));
              });

              $("input[name='reg_atd_grupo']").each(function() {
                $(this).val(((iOf > -1) ? arr_reg_atd_grupo[iOf] : ""));
              });
            }

            if (typeof(mudaServicoDacEspecifico) == 'function') {
              mudaServicoDacEspecifico(servico);
            }
          }
          </script>

          <?
          if ((empty($hidden_servico_dac) === true) || (isset($combo_servico_dac) === true)) {
            if ($usa_bootstrap == "S") {
              ?>
              <div class="row" style="background:#CFCFCF;">
                <div class="col-md-4 text-left pad-top5">
                  <i class='icon24 i-call-incoming'> <?print $tit_combo_servico_dac?>:</i>
                </div>
                <div class="col-md-8 text-left pad-top5">
              <?
            } else {
              ?>
              <font class="txtvermelho" style="color: #000000;"><strong><span id="tit_servico_dac"><?print $tit_combo_servico_dac;?></span>: </strong></font>
              <?
            }
            ?>
              <select id="id_combo_servico_dac" name="combo_servico_dac" onchange="mudaServicoDac(this.value);" consistir="sempre" tipodado="preenchido" msg="Selecione o <?print $tit_combo_servico_dac;?>">
                <?print $opt_combo_servico_dac;?>
              </select>
          <?
          if($usa_bootstrap == "S") {
          ?>
                </div>
              </div>
          <?
          }
          } else {
          ?>
            <font class="txtvermelho" style="color: #000000;"><strong><?print ValorClasse("EK{$nro_modelo}G", $hidden_servico_dac, $repre_vendedor, true)." (".$hidden_servico_dac.")";?></strong></font>
            <script type="text/javascript">
            $(document).ready(function () {
              $(window).load(function () {
                mudaServicoDac("<?print trim($hidden_servico_dac);?>");
              });
            });
            </script>
          <?
          }
          ?>
          <input type="hidden" name="hidden_servico_dac" id="id_hidden_servico_dac" value="<?print $hidden_servico_dac;?>">
          <input type="hidden" name="reg_atd_grupo_atd" id="reg_atd_grupo_atd" value="<?print $reg_atd_grupo_atd;?>">
          <input type="hidden" name="reg_atd_cond_grupo_atd" id="reg_atd_cond_grupo_atd" value="<?print $reg_atd_cond_grupo_atd;?>">
        <?
        require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/mk_funcoes.php");
        $isPodeEnviarProtocolo = false;

        $auxGrupoProtocol = substr($mk_ramal['grupo'],0,-1);
        if(!empty($auxGrupoProtocol)) {
          if ($enviar_protocolo_atendimento == 'S'  && preg_match("/\b{$auxGrupoProtocol}\b/", $enviar_protocolo_atendimento_grupo) == true) {
            $isPodeEnviarProtocolo = true;
          }
        }

        if ($isPodeEnviarProtocolo === true ) {

          ?>
            <div id='container-envio-protocolo-sms-email' style="display: inline-block"></div>
          <?
          print funcaoEnviarProtocoloPClienteJS();//Funcão javascript
          ?>

            <? if ($enviar_protocolo_atendimento_carregar_espeficio == 'N') {?>
            <script type="text/javascript">
              /*
              * Retorna html com botão de envio de protocolo
              * @author Jeferson Guedes
              */
              $(function () {
                  <? if (empty($enviar_protocolo_atendimento_campo_email)) {?>
                    var auxEmailProtocolo = '';
                    var auxDDDTelefoneProtocolo = '';
                    var auxNroTelefoneProtocolo = '';
                    var auxNomeRazaoProtocolo = '';
                  <?} else {?>
                    var auxEmailProtocolo = $("#<?= $enviar_protocolo_atendimento_campo_email ?>").val();
                    var auxDDDTelefoneProtocolo = $("#<?= $enviar_protocolo_atendimento_campo_ddd_telefone ?>").val();
                    var auxNroTelefoneProtocolo = $("#<?= $enviar_protocolo_atendimento_campo_nro_telefone ?>").val();
                    var auxNomeRazaoProtocolo = $("#<?= $enviar_protocolo_atendimento_campo_nome_razao ?>").val();

                  <?}?>

                  var htmlImgEnvioProtocolo = getButtonEnviarProtocoloJS(
                    '<?= $mesmo_cliente_n_pedido?>',
                    '<?= $repre_vendedor?>',
                    '<?= $nro_modelo?>',
                    auxEmailProtocolo,
                    auxDDDTelefoneProtocolo,
                    auxNroTelefoneProtocolo,
                    auxNomeRazaoProtocolo
                  );
                  delete auxEmailProtocolo, auxDDDTelefoneProtocolo, auxNroTelefoneProtocolo;
                  $('#container-envio-protocolo-sms-email').html(htmlImgEnvioProtocolo);
                });
            </script>
            <?}?>
          <?
        }
  }
  if ($usa_bootstrap == "S") {
    if(!$_REQUEST["mk_ramal_serialize"]){
    ?>
        </div>
      </div>
    <?
    }
  } else {
?>
      </td>
    </tr>
  </table>
<?
  }

  if ((($nro_modelo == "BI") || ($nro_modelo == "BT")) && ($arr_campos_volta["deonde_honda"] == "ATV") && (is_array($arr) === true)) {
    ?>
        </td>
        <td id="gcAjuda" nowrap width="15%" align="right" valign="middle">
          <?
          require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/TelaCTR.php");
          print TelaCTR::setPageFunction($arr);
          ?>
        </td>
      </tr>
    </table>
    <?
  }
}

// ******************************************************************************************************
// ******************************************************************************************************
// ************************************* ROTINA DO MESMO CLIENTE N_PEDIDO********************************
// ******************************************************************************************************
?></a><?
// ******************************************************************************************************
// ******************************************************************************************************
// ************************************* ROTINA MIDIA GRUPO *********************************************
// ******************************************************************************************************
if ($rotina_midia == "S") {

  $classe_rotina_1 = "MI".$nro_modelo."0";
  $classe_rotina_2 = "MI".$nro_modelo."1";
  $classe_rotina_3 = "MI".$nro_modelo."2";

  $q_combo_1          = "SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '".$classe_rotina_1."' AND representante = '".$session["representante"]."' AND idioma = '1' AND tipo_reg = 'I' AND status = 'A' ORDER BY desc_classe";
  $query_combo_1      = DescExecQuery($q_combo_1, ConnectDB(), "N");
  while ($rec_combo_1 = mysql_fetch_assoc($query_combo_1)) {
    if($midia_filtro_1) {
      if($midia_filtro_1 == $rec_combo_1["vlr_classe"]) {
        $selected_combo_1 = " SELECTED ";
      } else {
        $selected_combo_1 = " ";
      }
    } else {
      if(strpos("xxx".$rec_combo_1["vlr_classe"], substr($mk_ramal["bina_gravacao"],0,2).",") > 0) {
        $selected_combo_1 = " SELECTED ";
        $midia_filtro_1 = $rec_combo_1["vlr_classe"];
      } else {
        $selected_combo_1 = " ";
      }
    }
    $combo_rotina_1 .= "<option value='".$rec_combo_1["vlr_classe"]."' ".$selected_combo_1.">".$rec_combo_1["desc_classe"]."</option>";
  }

  if(!$midia_filtro_2) {
    $arr_midia_filtro_2 = explode("¢", $mk_ramal["id_cli"]);
    $midia_filtro_2     = substr($arr_midia_filtro_2[1],0,4);
  }

  $arr_midia_filtro_1 = explode("¢", $midia_filtro_1);
  $regiao_midia_grupo = $arr_midia_filtro_1[1];

  $q_combo_2          = "SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '".$classe_rotina_3."' AND representante = '".$session["representante"]."' AND idioma = '1' AND tipo_reg = 'I' AND status = 'A' AND vlr_classe LIKE '".$regiao_midia_grupo."¢%' ORDER BY desc_classe";
  $query_combo_2      = DescExecQuery($q_combo_2, ConnectDB(), "N");
  while ($rec_combo_2 = mysql_fetch_assoc($query_combo_2)) {
    $indice_combo_2 = explode("¢", $rec_combo_2["vlr_classe"]);
    $array_combo_2[$indice_combo_2[1]] = $indice_combo_2[1];
  }

  if($regiao_midia_grupo && $midia_filtro_2) {
    $where_combo_midia_3 = " AND vlr_classe LIKE '".$regiao_midia_grupo."¢".$midia_filtro_2."%'";
  } else {
    $where_combo_midia_3 = " AND vlr_classe 1=2";
  }
?>
   <br>
   <table style="margin-bottom: 5px;" border="1"  width="870" cellpadding="4"  bordercolor="<?print $session["td_destaque"]?>" style='border-collapse: collapse'  cellspacing="0" align="center">
     <tr bgcolor="<?print $session["td_destaque"];?>">
       <td colspan="4">
         <font class="txt6">
           <strong>Identificação Atendimento:</strong>
         </font>
       </td>
     </tr>
     <?MontaCombo($classe_rotina_1, $midia_filtro_1, $session["representante"]);?>
     <tr bgcolor="<?print $session["td_dado3"];?>">
       <td width="20%"><font class="txt5"><strong><?print $titClasse;?>:</strong></font></td>
       <td>
         <font class="txt5">
           <select name="midia_filtro_1" onchange="atualizaMK();" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o <?print $titClasse;?>.">
             <?if($session["print_sql"] != "N") {?>
               <option value="" style="background: <?print $vermelho?>;"><?print $classe_rotina_1." (".$session["representante"].")";?></option>
             <?}?>
             <option value="">-- Selecione --</option>
             <?print $combo_rotina_1;?>
           </select>
         </font>
       </td>
       <?MontaCombo($classe_rotina_2, $midia_filtro_2, $session["representante"]);?>
       <td><font class="txt5"><strong><?print $titClasse;?>:</strong></font></td>
       <td>
         <font class="txt5">
           <select name="midia_filtro_2" onchange="atualizaMK();" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o <?print $titClasse;?>.">
             <?if($session["print_sql"] != "N") {?>
               <option value="" style="background: <?print $vermelho?>;"><?print $classe_rotina_2." (".$session["representante"].")"?></option>
             <?}?>
             <option value="">-- Selecione --</option>
             <?
             if(is_array($array_combo_2) === true) {
               foreach ($array_combo_2 as $key => $value) {
                 if($value) {
                   if($midia_filtro_2 == $value) {
                     $selected_combo_2 = " SELECTED ";
                   } else {
                     $selected_combo_2 = " ";
                   }
                   print "<option value='".$value."' ".$selected_combo_2.">".ValorClasse($classe_rotina_2, $value, $session["representante"])."</option>";
                 }
               }
             }
             ?>
           </select>
         </font>
       </td>
     </tr>
     <?MontaCombo($classe_rotina_3, $midia_filtro_3, $session["representante"], "A", $where_combo_midia_3);?>
     <tr bgcolor="<?print $session["td_dado3"];?>">
       <td><font class="txt5"><strong><?print $titClasse;?>:</strong></font></td>
       <td colspan="3">
        <font class="txt5">
<?
$q_combo_3     = "SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '".$classe_rotina_3."' AND representante = '".$session["representante"]."' AND idioma = '1' AND tipo_reg = 'I' AND status = 'A' ".$where_combo_midia_3." ORDER BY desc_classe";
$query_combo_3 = DescExecQuery($q_combo_3, ConnectDB(), "N");
$num_rows      = mysql_num_rows($query_combo_3);
if($num_rows > 1) {
  while ($rec_combo_3 = mysql_fetch_assoc($query_combo_3)) {
    if($midia_filtro_3 == $rec_combo_3["vlr_classe"]) {
      $selected_combo_3 = " SELECTED ";
    } else {
      $selected_combo_3 = " ";
    }
    $combo_rotina_3 .= "<option value='".$rec_combo_3["vlr_classe"]."' ".$selected_combo_3.">".$rec_combo_3["desc_classe"]."</option>";
  }
} else if($num_rows == 1) {
  $rec_combo_3     = mysql_fetch_assoc($query_combo_3);
  $combo_rotina_3 .= "<option value='".$rec_combo_3["vlr_classe"]."' SELECTED>".$rec_combo_3["desc_classe"]."</option>";
}
?>
         <select name="midia_filtro_3" onchange="atualizaMK();" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o <?print $titClasse;?>.">
           <?if($session["print_sql"] != "N") {?>
             <option value="" style="background: <?print $vermelho?>;"><?print $classe_rotina_3." (".$session["representante"].")"?></option>
           <?}?>
           <option value="">-- Selecione --</option>
           <?print $combo_rotina_3;?>
         </select>
        </font>
       </td>
     </tr>
   </table>
   <br>
<?

}
// ******************************************************************************************************
// ************************************* ROTINA MIDIA GRUPO *********************************************
// ******************************************************************************************************
// ******************************************************************************************************









// ******************************************************************************************************
// ******************************************************************************************************
// *************************************EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME)*************************
// ******************************************************************************************************

if (($usa_emu != "N") && (empty($usa_emu) === false) && (($usa_emu != "CSO") || ($sistema_identificacao == "teste"))) {
  //if (($usa_emu != "CSO") && (($usa_emu != "N") && (empty($usa_emu) === false))) {
  //EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME)

  //TITULOS DO CABEÇALHO
  $emu_tit_arr = explode("¢", ValorClasse("EMUTI", $usa_emu, "URANET", false));
  //AÇÕES PERMITIDAS
  $emu_act_arr = explode("¢", ValorClasse("EMUTA", $usa_emu, "URANET", false));
  if (trim($emu_act_arr[0]) == "--") {
    unset($emu_act_arr);
  }
?>
  <table style="margin-bottom: 5px;" border="1"  width="650" cellpadding="4"  bordercolor="<?print $session["td_destaque"]?>" style='border-collapse: collapse'  cellspacing="0" align="center">
    <tr bgcolor="<?print $session["td_dado1"];?>">
      <td>
        <font class="txt5">
          <strong><?print $emu_tit_arr[0];?>:</strong>
          <?print $ibm_login;?>
        </font>
      </td>
<?
if (empty($emu_tit_arr[1]) === false) {
?>
      <td>
        <font class="txt5">
          <strong><?print $emu_tit_arr[1];?>:</strong>
          <?print $ibm_user;?>
        </font>
      </td>
<?
}
?>
    <td>
      <font class="txt5">
        <strong><?print $emu_tit_arr[2];?>:</strong>
        <span id="emuIdStatus"></span>
        <span id="emuIdSession"></span>
      </font>
    </td>
<?
if ((is_array($emu_act_arr) === true) && (count($emu_act_arr) > 0)) {
?>
      <td align="right">
        <font class="txt5">
<?
//ALTERAR SENHA
if ((array_search("AS", $emu_act_arr) === false) === false) {
?>
          <img src="imagens/ico_alterar.gif" border="0" title="Alterar Login e Senha" onclick="javascript: altSenhaIbm();">
<?
}
//LOG IN
if ((array_search("LI", $emu_act_arr) === false) === false) {
?>
          <img style="width: 16px; heigth: 16px;" src="imagens/ico_ibm_login.gif" border="0" title="Conectar" onclick="javascript: xajax_emuLogIn(xajax.getFormValues('cadastro'));">
<?
}
//LOG OUT
if ((array_search("LO", $emu_act_arr) === false) === false) {
?>
          <img style="width: 16px; heigth: 16px;" src="imagens/ico_ibm_logout.gif" border="0" title="Desconectar" onclick="javascript: xajax_emuLogOut(xajax.getFormValues('cadastro'));">
<?
}
?>
        </font>
      </td>
<?
}
?>
    </tr>
    <tr>
      <td id="emuBoxError" colspan="4" class="txt5" style="font-size: 12px; font-weight: bold; color: #FF0000; background-color: <?print $session["td_dado3"];?>;"><?print $emu_error_msg;?></td>
    </tr>
  </table>
<?
}
// ******************************************************************************************************
// *************************************EMULAÇÃO DE SISTEMAS IBM3270 (MAINFRAME)*************************
// ******************************************************************************************************
// ******************************************************************************************************

if ($nro_modelo == "BIx") {
  //  $cod_trava_automatico = "02¢13¢21¢23¢26";
  //  $condicao_reg_atd = "73";
  //  $cod_trava_automatico = "";
  //  $reg_atd_auto_click = $_POST["arr_campos_volta"]["reg_atd_auto_click"];
  require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/montaDivRegAtd.php");
  print montaDivRegAtd($repre_vendedor, $nro_modelo, $condicao_reg_atd, "EK".$nro_modelo."Z", "480", "550", "2", "Registro de Atendimento", $reg_atd_auto_click, $cod_trava_automatico);
}

if (!$md_table_width) {
  $md_table_width = "650";
}

if ($IntergrAllHeader) {
  //não tem tabela... voce programa oque precisa
  if($usa_omnivision== "S" || $ramal_atend != ""){
	  $tipo_container_body = "container-fluid";
  }else{
	  $tipo_container_body = "container";
 }
?>
<div  class="<?=$tipo_container_body?> <?if($nro_modelo == "YB" && $dk_campo_chave) {?>gap-left25<?}?>">
<?

} else {
?><table id="table_atendimento" border="1"   width="<?print $md_table_width?>" cellpadding="4"  bordercolor="<?print $session["td_destaque"]?>" style='border-collapse: collapse'  cellspacing="0" align="center">
<?
}

if (substr($repre_vendedor, 0, 3) == "BMC") {
  //**************não remover desta posição*********(Marcelo)*/
  $usa_popup_programado = trim(ValorClasse("EK".$nro_modelo."B", "USA_POPUP_PROGRAMADO", $repre_vendedor));
  if ($usa_popup_programado == "S") {
    require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/brad_popup_programado.php");
  }

  //*********** Modulo de exibição BRADESCO CPV (Rafael) */
  if ($session["operador"] == "bmc0002") {
    require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/brad_modulo_cpv.php");
  }
}




/*******************************************************************************************************/
/*******************************************************************************************************/
/*************************************** INICIO - MSG ALERTA CHAMADA ***********************************/
/*******************************************************************************************************/
/*******************************************************************************************************/
?>

<input type="hidden" name="mk_msg_alerta" id="mk_msg_alerta" value="<?print htmlspecialchars($mk_msg_alerta, ENT_QUOTES, 'UTF-8');?>">
<input type="hidden" id="nao_chama_msg_2_vezes" value=''>
<?
  $displayNoneOrBlock = (empty($mk_msg_alerta) === true) ? 'none' : 'block';

  if ($IntergrAllHeader) {
?>
<i class="icon24 i-warning" id="btn_mk_msg_alerta" style="cursor:pointer; display: <?=$displayNoneOrBlock?>;" onclick="javscript:btnAbreMsgAlerta();"> </i>
<?
  } else {
?>
<img src="imagens/pesquisa_alerta_novo.gif" id="btn_mk_msg_alerta" onclick="javscript:btnAbreMsgAlerta();" style="cursor:pointer; display: <?= $displayNoneOrBlock?>;">
<?
  }

/*******************************************************************************************************/
/*******************************************************************************************************/
/*************************************** FIM - MSG ALERTA CHAMADA **************************************/
/*******************************************************************************************************/
/*******************************************************************************************************/


/*******************************************************************************************************/
/*******************************************************************************************************/
/*************************************** CABECALHO *****************************************************/
/*******************************************************************************************************/
/*******************************************************************************************************/
switch($tipo_modelo) {
  case "ATIVO":
  case "ATIVO_DISCAR":
  case "ATIVO_LEADS":
  case "AGENDA_RETORNO":
  case "RETORNO":
  case "INDICACAO":
  case "INDICACAO_MK":
  case "RECEPTIVO":
    if ($palavra_atendimento == "") {
      $palavra_atendimento = "ATENDIMENTO";
    }

    if ($icone_atendimento == "") {
      $icone_atendimento   = "i-menu-6";
    }

    if ($IntergrAllHeader) {
      print "
      <div class='panel panel-default'>
      ";
      if ($mk_esconde_tr_1_cabecalho != "S") {

	   if ($mk_origem_atd) {
		   print "<div class='panel-body'>";
	   }else{
		   print "<div class='panel-heading'>";

       if(!(achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){
         print "
          <div class='icon'><i class='icon20 ".$icone_atendimento." '></i></div>
          <h4>".$palavra_atendimento."</h4>";
       }
	   }

        // ******************************************************************************************************
        // ******************************************************************************************************
        // ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA********************************
        // ******************************************************************************************************
        if ($IntergrAllHeader) {//se esta no bootstrap monta na linha de atendimento
          if($isLigSinc){
            print montaDadosMKATD($_REQUEST,$nro_modelo,$repre_vendedor);

          } else {
          ?>
          <input type='hidden' name='mk_origem_atd'        value='<?print $mk_origem_atd;?>'>
          <input type='hidden' name='mk_origem_atd_direto' value='<?print $mk_origem_atd_direto;?>'>
          <?
          }
        }
        // ******************************************************************************************************
        // ******************************************************************************************************
        // ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA******************************
        // ******************************************************************************************************

        print "</div><!-- End .panel-heading -->";
      }

if(strpos($tipo_abre_historico, 'spider') !== false){

    if($campo_pesq_historico_abre_historico) {
      $campo_pesq_historico = $campo_pesq_historico_abre_historico;
    }

    if($pesq_historico_abre_historico) {
      $pesq_historico = ${$pesq_historico_abre_historico};
    }

	  if ((!$campo_pesq_historico) && (!$pesq_historico)) {
      $campo_pesq_historico      = $campo_campo_clique_cliente;
      $pesq_historico            = $campo_clique_cliente;
      if (empty($campo_pesq_historico) === true) {
        $campo_pesq_historico      = $campo_campo_clique_cliente_passa;
        $pesq_historico            = $campo_clique_cliente_passa;
      }
	  }

    if($exibicao_abre_historico == 'modo_exibe_fechado') {
      $display_inicial_abre_historico = 'display:none;';
      $display_class_inicial_abre_historico = 'maximize';
    } else {
      $display_inicial_abre_historico = '';
      $display_class_inicial_abre_historico = 'minimize';
    }

    $exibe_spider = true;
    if($pesq_historico_abre_historico && $pesq_historico == '') {
      $exibe_spider = false;
    }


  if($exibe_spider) {
    require_once("/libs/ctr/Spider.php");
    $spd_prop = new Spider("spd_hist", "SP".$nro_modelo."H", $repre_vendedor, "prop_hist");

    if(!$empresas_abre_historico){$empresas_abre_historico = $param_empresa;}
    $spd_prop->setCampoServico("empresa",$empresas_abre_historico);
    $spd_prop->setAnalise($analise_abre_historico);
    $spd_prop->setHeight($tamanho_abre_historico);
    $spd_prop->setWhereAdicional($where_abre_historico);
  //	$spd_prop->inibe_excel_lista         = true;
    $spd_prop->inibeBox();
  }

}



if (strpos($tipo_abre_historico, 'spider') !== false && $local_abre_historico == "top" && $exibe_spider) {


if($campo_pesq_historico != ""){

	if($campo_pesq_historico == ""){print "O Parametro historico está setado como NOVO, porém os campos de pesquisa não estão Setados.";exit;}
	if($pesq_historico == "")      {print "O Parametro historico está setado como NOVO, porém o campo ".$campo_pesq_historico." está vazio";exit;}



			$spd_prop->setWhereAdicional(" AND ".$campo_pesq_historico." = '".$pesq_historico."'");
			$spd_prop->printJavascript();

?>

    <div class="simple-panel simple-panel-primary" >
      <div class="simple-panel-heading">
        <h4 class="simple-panel-title primary"><i class="icon10 primary i-history"></i> Histórico </h4>
          <a class="<?=$display_class_inicial_abre_historico?>" href="#"></a>
      </div>
      <div class="simple-panel-body pad0 gap0" style=<?=$display_inicial_abre_historico?>>
        <div class="row" ">
          <div class="col-sm-12">
            <?
			$spd_prop->imprimeGrafico();
			?>
          </div>
        </div>
      </div>
    </div>
<?
}
}


      print "
      <div class='panel-body gap0 pad0 ".$panel_body_md_classes."'>";
      //***********************************************************
      //INCLUDE DE TODO O ESQUEMA DE PERGUNTAS DO DISCADOR*********
      //***********************************************************
      if(file_exists($prg_include_cabecalho)) {
        include $prg_include_cabecalho;
      }
      //***********************************************************
      //***********************************************************
      //***********************************************************
    } else {
?>
             <?if($mk_esconde_tr_1_cabecalho != "S") { ?>
               <tr id="tr_atendimento" bgcolor="<?print $session["td_destaque"]?>" <?if($nro_modelo == "UA"){?> style="display:none;" <?}?>>
                  <td>
                     <table  width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                           <td align="left">
                              <font class="txt5"><font color="<?print $session["f_td_destaque"]?>"><strong>&nbsp;&nbsp;<?print $palavra_atendimento?>:
                              <div id="div_linha_1_mk"></div>
                           </td>
                        </tr>
                     </table>
                  </td>
               </tr>
               <tr bgcolor="<?print $session["td_dado3"]?>" >
                <td>
             <?}
             //***********************************************************
             //INCLUDE DE TODO O ESQUEMA DE PERGUNTAS DO DISCADOR*********
             //***********************************************************
             if($prg_include_cabecalho) {
               include $prg_include_cabecalho;
             }
             //***********************************************************
             //***********************************************************
             //***********************************************************

             if($mk_esconde_tr_1_cabecalho != "S") {
               print "</td>
                 </tr>";
             }
    }
    if (substr($repre_vendedor, 0, 3) == "BMC") {
      //**************não remover desta posição*********(Marcelo)*/
      $mais_tel_usa_cliente_enriquecido = trim(ValorClasse("EK".$nro_modelo."B", "USA_CLIENTE_ENRIQUECIDO", $repre_vendedor));
      if ($mais_tel_usa_cliente_enriquecido == "S") {
        require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/brad_mais_telefones_higienizacao.php");
      }
      //**************não remover desta posição*********(Marcelo)*/
    }

/**
 * Rodrigo Lemos
 * TEMPORÁRIO - Exibição de modelo e jornada em abas
 */
if ( $utiliza_historico_atendimento == "S" ) {

  if ($IntergrAllHeader) {
?>
  <div class="col-lg-12 div-center" id="conteudo">

    <ul id="myTab" class="nav nav-tabs">
      <li class="active"> <a href="#div_aba_1" data-toggle="tab" id="aba_principal">  <?=$objTradutor->traduzir('Dados Cadastrais');?>         </a></li>
      <li class="">       <a href="#div_aba_2" data-toggle="tab" id="aba_jornada">    <?=$objTradutor->traduzir('Histórico de Atendimento');?> </a></li>
    </ul>
    <div class="tab-content">

      <div class="tab-pane fade active in" id="div_aba_1">

        <div class="row">
          <div class="col-sm-12">
            <?require_once("rotinas/MontaCamposModelo.php");?>
          </div>
        </div>

      </div>

      <div class="tab-pane" id="div_aba_2">

        <div class="row">
          <div class="col-sm-12">
          <?
            require_once($_SERVER['DOCUMENT_ROOT'].'/callcenter/funcoes/HistAtendPadrao.php');
            $objhist = new HistAtendPadrao($repre_vendedor);
            if (!$campo_chave_jornada) {
              $campo_chave_jornada = $campo_chave;
            }
            $classe_mkpro_jor = $classe_mkpro ? $classe_mkpro : $conProp->result['classe_mkpro'];
            print $objhist->montaResumoHist($campo_chave_jornada, $repre_vendedor, $classe_mkpro_jor);
          ?>
          </div>
        </div>

      </div>

    </div>

  </div>
<?
  }

} else {

  if (!$imprimiuCamposModelo) {
    if($IntergrAllHeader) {
      require_once("rotinas/MontaCamposModelo.php");
    }else{
         ?><tr bgcolor="<?print $session["td_dado3"]?>">
              <td><?
              require_once("rotinas/MontaCamposModelo.php");
              ?></td> </tr><?
    }
  }

}



if ($mostra_indica_tela_atd == "S") {
  include("md_cad_prop_2_indica_atendimento.php");
}


break;
  case "FOLLOWUP_ATV":
  case "FOLLOWUP":
  case "FLW_ATV_S_MAIL":
    if ($grupo_acesso_passa) {
      $flw_grupo_acesso = $grupo_acesso_passa;
    }

    $flw_permissoes        = explode("¢", getPermissoes($session["operador"], "MD", achaNroModelo($nro_modelo,$tipo_abertura), "T",$flw_grupo_acesso));
    $flw_user_grupo_acesso = $flw_permissoes[0];
    $flw_user_nivel_acesso = $flw_permissoes[1];
    $flw_user_acesso_ida   = $flw_permissoes[2];
    $flw_user_acesso_volta = $flw_permissoes[3];
    $flw_user_permissoes   = $flw_permissoes[4];
    $flw_user_tempo_exec   = $flw_permissoes[5];
    ?>
    <input type="hidden" name="flw_user_nivel_acesso_login" value="<?print $flw_user_nivel_acesso_login;?>">
    <?

    $arrParamFLW['USA_PROJETO'              ] = 'USA_PROJETO';
    $arrParamFLW['FLW_RESULTADO'            ] = 'FLW_RESULTADO';
    $arrParamFLW['SLA_PARAM'                ] = 'SLA_PARAM';
    $arrParamFLW['TEMPO_SLA_CPO_VLR'        ] = 'TEMPO_SLA_CPO_VLR';
    $arrParamFLW['DEFINE_ADM_PROJETO_MOTIVO'] = 'DEFINE_ADM_PROJETO_MOTIVO';
    $arrParamFLW['GRAVA_SOLICITANTE'        ] = 'GRAVA_SOLICITANTE';
    $arrParamFLW['GRAVA_SOLICITANTE_TIPO'   ] = 'GRAVA_SOLICITANTE_TIPO';
    $arrParamFLW['USA_ATIV_PLATAFORMA'      ] = 'USA_ATIV_PLATAFORMA';
    $arrParamFLW['UTILIZA_ANEXO_ATD'        ] = 'UTILIZA_ANEXO_ATD';
    $arrParamFLW['GRAVA_ANEXO_ATD'          ] = 'GRAVA_ANEXO_ATD';
    $arrParamFLW['CAMPO_EXTRA_APOS_MOTIVO'  ] = 'CAMPO_EXTRA_APOS_MOTIVO';

    //**********************************************************************//
    //* INI - PARAMETROS PARA MOSTRAR LISTA DE OCORRENCIA DENTRO DO MODELO *//
    //**********************************************************************//

    $arrParamFLW['AGRUP_OCO_BTN_PENDENTES_REINCIDENTES'            ] = 'AGRUP_OCO_BTN_PENDENTES_REINCIDENTES';
    $arrParamFLW['AGRUP_OCO_LISTA_PARAMETRIZADA'                   ] = 'AGRUP_OCO_LISTA_PARAMETRIZADA';
    $arrParamFLW['AGRUP_OCO_CMPS_ESPEC_OCO_PENDENTES_REINCIDENTES' ] = 'AGRUP_OCO_CMPS_ESPEC_OCO_PENDENTES_REINCIDENTES';
    $arrParamFLW['AGRUP_OCO_QTD_ULTIMAS_OCORRENCIAS'               ] = 'AGRUP_OCO_QTD_ULTIMAS_OCORRENCIAS';
    $arrParamFLW['AGRUP_OCO_AREA_PERMITIDA_PENDENTES_REINCIDENTES' ] = 'AGRUP_OCO_AREA_PERMITIDA_PENDENTES_REINCIDENTES';
    $arrParamFLW['AGRUP_OCO_MK_ABRE_ESPECIFICO'                    ] = 'AGRUP_OCO_MK_ABRE_ESPECIFICO';
    $arrParamFLW['AGRUP_OCO_ABRE_LISTA_TELA_ATENDIMENTO'           ] = 'AGRUP_OCO_ABRE_LISTA_TELA_ATENDIMENTO';
    $arrParamFLW['AGRUP_OCO_CMPS_ESPEC_OCO_TELA_ATENDIMENTO'       ] = 'AGRUP_OCO_CMPS_ESPEC_OCO_TELA_ATENDIMENTO';
    $arrParamFLW['GRAVA_SOLICITANTE_FILTRO_OBRIGATORIO_EMAILSMS'   ] = 'GRAVA_SOLICITANTE_FILTRO_OBRIGATORIO_EMAILSMS';

    $mkFlwParam = carregaArrParamFLW(achaNroModelo($nro_modelo,$tipo_abertura), $repre_vendedor, $arrParamFLW);

    if($mkFlwParam["tempo_sla_cpo_vlr"]) {
      $utiliza_pisca_tela = "S";
    }

    $perm_spl = explode(",", $flw_user_permissoes);
    $x = 0;
    while($perm_spl[$x]) {
      $permissoes[$perm_spl[$x]] = "S";
      $x++;
    }
    $perm_slp = "";

    $q_flw = DescExecQuery("SELECT count(*) as qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."G"."' and representante = '".$session["representante"]."' and tipo_reg = 'I' and status = 'A' and vlr_classe <> '999'", $connect);

    $r_flw = mysql_fetch_assoc($q_flw);
    $repre_flw = $session["representante"];
    if ($r_flw["qtd"] == "0") {
      $q_flw = DescExecQuery("SELECT count(*) as qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."G"."' and representante = '".$repre_vendedor."' and tipo_reg = 'I' and status = 'A' and vlr_classe <> '999'", $connect);
      $r_flw = mysql_fetch_assoc($q_flw);
      $repre_flw = $repre_vendedor;
    }
    if ($r_flw["qtd"] == "0") {
      $q_flw = DescExecQuery("SELECT count(*) as qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."G"."' and representante = 'URANET' and tipo_reg = 'I' and status = 'A' and vlr_classe <> '999'", $connect);
      $r_flw = mysql_fetch_assoc($q_flw);
      $repre_flw = "URANET";
    }

    if ($r_flw["qtd"] == "0") {
      print "Nenhuma divisão cadastrada - (FM".achaNroModelo($nro_modelo,$tipo_abertura)."G).";
      exit;
    }

    $vlrClasseTitFlw = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","TIT_".achaNroModelo($nro_modelo,$tipo_abertura),"URANET");
    if (trim($vlrClasseTitFlw) == "--") {
      $vlrClasseTitFlw = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","TIT",$repre_vendedor);
      if (trim($vlrClasseTitFlw) == "--") {
        $vlrClasseTitFlw = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","TIT","URANET");
        if (trim($vlrClasseTitFlw) == "--") {
?>
              <div align="center"><font class="txtvermelho"><strong>Classe de parâmetros <?print "FM".achaNroModelo($nro_modelo,$tipo_abertura)."K"?> não encontrada, favor contatar SAC.</strong></font></div>
<?
exit;
        }
      }
    }

    $vlrClasseCalendario = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","CALENDARIO_SLA",$repre_flw);
    if (trim($vlrClasseCalendario) == "--") {
?>
          <div align="center"><font class="txtvermelho"><strong>Parâmetro Calendário da Classe <?print "FM".achaNroModelo($nro_modelo,$tipo_abertura)."K"?> não encontrada, favor contatar SAC.</strong></font></div>
<?
exit;
    }

    $vlrClasseTemaPai = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","SUB_TEMA_".achaNroModelo($nro_modelo,$tipo_abertura),$repre_flw);
    if ($vlrClasseTemaPai == " -- ") {
      $vlrClasseTemaPai = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","SUB_TEMA",$repre_flw);
    }

    $arr_tituloFlw  = explode("¢",$vlrClasseTitFlw);
    $titDivisao     = $arr_tituloFlw[0];
    $titNivel       = $arr_tituloFlw[1];
    $titTema        = $arr_tituloFlw[2];
    $titResponsavel = $arr_tituloFlw[3];
    $titTema_pai    = $arr_tituloFlw[4];
    $titAtendimento = $arr_tituloFlw[7];
    if (!$titAtendimento) {
      $titAtendimento = "Atendimento";
    }

    if ($IntergrAllHeader) {//se esta no bootstrap monta na linha de atendimento
      if($palavra_atendimento == "") {
        $palavra_atendimento = "ATENDIMENTO";
      }
      if ($icone_atendimento == "") {
        $icone_atendimento   = "i-menu-6";

      }


      print "
      <div class='container'>
        <div class='row center'>
          <div class='div-center col-sm-8 col-xs-10'>
          ";
      // ******************************************************************************************************
      // ******************************************************************************************************
      // ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA********************************
      // ******************************************************************************************************
      if($isLigSinc){
        print montaDadosMKATD($_REQUEST,$nro_modelo,$repre_vendedor);

      } else {
          ?>
           <input type='hidden' name='mk_origem_atd'            value='<?print $mk_origem_atd;?>'>
           <input type='hidden' name='mk_origem_atd_direto'     value='<?print $mk_origem_atd_direto;?>'>
          <?
      }

      // ******************************************************************************************************
      // ******************************************************************************************************
      // ************************************* ROTINA DE IDENTIFICACAO DA CHAMADA******************************
      // ******************************************************************************************************

      print "</div></div></div><!-- End .container --><br>
      ";
    }

?>


                <table border="0"  width="650" cellpadding="4"  bordercolor="<?print $session["td_destaque"]?>" style='border-collapse: collapse'  cellspacing="0" align="center">
                  <tr >
                    <td align="center">
                      <center><font class="txt5"><strong><?print $titDivisao;?>:</strong>
                      <?
                      if ($grupo_acesso_passa) {
                      ?>
                                                <input type="hidden" name="flw_grupo_acesso" value="<?print $grupo_acesso_passa?>">
                      <?
                      print ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."G", $grupo_acesso_passa, $repre_flw);
                      } else {
                        if ($flw_user_grupo_acesso == "999") {
                      ?>
                                                <select name="flw_grupo_acesso" OnChange="document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1')); if (confereMK(document.cadastro)) {document.cadastro.submit();}" consistencia="sempre" consistencia1="pre" msg="Selecione a <?print $titDivisao;?>">
                      <?
                      print MontaCombo("FM".achaNroModelo($nro_modelo,$tipo_abertura)."G", $flw_grupo_acesso, $repre_flw);
                      ?>
                                                </select>
                      <?
                        } else {
                          $flw_grupo_acesso = $flw_user_grupo_acesso;
                      ?>
                                                <input type="hidden" name="flw_grupo_acesso" value="<?print $flw_grupo_acesso;?>">
                      <?
                      print ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."G", $flw_grupo_acesso, $repre_flw);
                        }
                      }
                      ?>
                    </td>
                  </tr>
                </table>
                 <?php

                if ( $mkFlwParam['agrup_oco_mk_abre_especifico'] == 'N'
                &&   $mkFlwParam['agrup_oco_abre_lista_tela_atendimento'] == 'S'
                ) {

                  $cmpsEspecPendRein = json_decode($mkFlwParam['agrup_oco_cmps_espec_oco_tela_atendimento'], true);

                  $arr['campos_bd']  = array();
                  $arr['valores'] = array();

                  if (is_array($cmpsEspecPendRein)) {
                    foreach ($cmpsEspecPendRein as $params) {
                      $decode =  explode(' ', $params);
                      $arr['campos_bd'][] = $decode[0];
                      $arr['valores'][]   = ${$decode[1]};
                    }
                  }

                  try {

                    print montaTelaUltimasOcorrencias( "MD".$nro_modelo, getUltimasOcorrencias( "MD".$nro_modelo, $flw_grupo_acesso, $arr['campos_bd'], $arr['valores'] ) , $usa_bootstrap);

                  } catch (Exception $e) {
                  ?>
                    <div class="txtvermelho" align="center"> <strong><?= $e->getMessage() ?></strong></div>
                  <?
                  }
                }

                  ?>
              </td>
             </tr>
             <tr>
               <td>
<?

//***********************************************************
//INCLUDE DE TODO O ESQUEMA DE PERGUNTAS DO DISCADOR*********
//***********************************************************

include $prg_include_cabecalho;

//***********************************************************
//***********************************************************
//***********************************************************
if (substr($repre_vendedor, 0, 3) == "BMC") {
  $mais_tel_usa_cliente_enriquecido = trim(ValorClasse("EK".$nro_modelo."B", "USA_CLIENTE_ENRIQUECIDO", $repre_vendedor));
  if ($mais_tel_usa_cliente_enriquecido == "S") {
    require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/brad_mais_telefones_higienizacao.php");
  }
}
?>
               </td>
             </tr>
<?

if (!$imprimiuCamposModelo) {
  if ($IntergrAllHeader) {
    require_once("rotinas/MontaCamposModelo.php");
  } else {
    ?>
    <tr bgcolor="<?print $session["td_dado3"]?>">
      <td><?
        require_once("rotinas/MontaCamposModelo.php");
    ?></td>
    </tr>
    <?
  }
}



if ($flw_tema) {
  if ($flw_tema_pai) {
    ValorClasse($flw_tema_pai, $flw_tema, $repre_flw);
  }

  if ($flw_usa_anexo != "S"){

    ValorClasse($flw_tema_pai, $flw_tema, $repre_flw);

    if ($condicaoVlrClasse == "68" || $condicaoVlrClasse == "69") {
      $flw_usa_anexo = "S";
      if ($condicaoVlrClasse == "69") {
        $consistir_anexo = "sempre";
        $anexo_obrigatorio = "S";
      } else {
        $anexo_obrigatorio = "N";
      }
    }
  }
}

break;
}

$param_usa_tabulador_lista_extra = $usa_tabulador_lista_extra;
if ( $param_usa_tabulador_lista_extra == 'S' ) {

  ?>
  <script src="/js/tabulador_lista_extra.js?v=<?=rand();?>"></script>
  <?

  require_once("{$_SERVER['DOCUMENT_ROOT']}/callcenter/funcoes/TabuladorListaExtra.php");
  require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/ctr/MKParam.php");

  $le_repre = $param_repre_vendedor ? $param_repre_vendedor : $repre_vendedor;
  $le_siste = $nro_modelo;

  MKParam::carregaArrParam('MD' . $le_siste, $le_repre);

  $tabulador_lista_extra = new TabuladorListaExtra($le_repre, $le_siste);

  $tabela_lista_extra = $tabulador_lista_extra->montaTabelaHTML();
  if ($tabulador_lista_extra->statusexec === true) {
    $html_lista_extra[0] = $tabela_lista_extra;
  } else {
    $html_lista_extra[0] = $tabulador_lista_extra->msgexec;
  }

  if ($exibe_guias_tabulador_lista_extra != 'S') {
    print $html_lista_extra[0];
  }

  $ultimo_item_lista_extra = count($tabulador_lista_extra->itensle);

  for ($i = 1; $i <= 10; $i++) {

    if (${"param_campos_tabulador_lista_extra_" . $i}) {

      ${"tabulador_lista_extra_" . $i} = new TabuladorListaExtra($le_repre, $le_siste, $i, $ultimo_item_lista_extra);

      $tabela_lista_extra = ${"tabulador_lista_extra_" . $i}->montaTabelaHTML();

      if (${"tabulador_lista_extra_" . $i}->statusexec === true) {

        $html_lista_extra[$i] = $tabela_lista_extra;

      } else {

        $html_lista_extra[$i] = ${"tabulador_lista_extra_" . $i}->msgexec;

      }

      if ($exibe_guias_tabulador_lista_extra != 'S') {
        print $html_lista_extra[$i];
      }

      $ultimo_item_lista_extra += count(${"tabulador_lista_extra_" . $i}->itensle);

    }

  }

  // SU 100205 - Exibição de tabulador em guias
  if ($exibe_guias_tabulador_lista_extra == 'S') {

    if (is_array($html_lista_extra)) {

      foreach ($html_lista_extra as $indice => $conteudo_guia) {
        if ($conteudo_guia) {
          if (!$apresentou_titulo) {
            $li = "<ul id='nav-tabulador-lista-extra' class='nav nav-tabs'>";
            $guias = "<div class='tab-content'>";
            $apresentou_titulo = true;
          }

          if (!${"titulo_tabulador_lista_extra_" . $indice}) {
            $titulo_guia = $titulo_tabulador_lista_extra;
          } else {
            $titulo_guia = ${"titulo_tabulador_lista_extra_" . $indice};
          }

          $li .= "<li class='". (!$not_active ? 'active' : '') ."'>".
                    "<a href='#div_aba_{$indice}' data-toggle='tab'>{$titulo_guia}</a>".
                  "</li>";

          $guias .= "<div class='tab-pane fade " . (!$not_active ? 'active in' : '') . "' id='div_aba_{$indice}'>".
                      $conteudo_guia.
                    "</div>";

          $not_active = true;
        }
      }

      $guias .= "</div>";
      $li .= "</ul>";

      print $li . $guias;

    }

  }

}

/**
 * Rodrigo - Exibição de jornada (histórico de atendimento)
 */
/*
if ( $utiliza_historico_atendimento == "S" ) {
  require_once($_SERVER['DOCUMENT_ROOT'].'/callcenter/funcoes/HistAtendPadrao.php');
  $objhist = new HistAtendPadrao($repre_vendedor);
  if (!$campo_chave_jornada) {
    $campo_chave_jornada = $campo_chave;
  }
  $classe_mkpro_jor = $classe_mkpro ? $classe_mkpro : $conProp->result['classe_mkpro'];
  print $objhist->montaResumoHist($campo_chave_jornada, $repre_vendedor, $classe_mkpro_jor);
}
*/

/*******************************************************************************************************/
/*************************************** CABECALHO *****************************************************/
/*******************************************************************************************************/


//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//******************************************** TELEFONES ***************************************************
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
if ($mostra_telefone != "N" || $tipo_modelo == "AGENDA_RETORNO") {

  $arr_desc_tel = explode("¢",$desc_tel);
  //print_r($arr_desc_tel);
  if (!$arr_desc_tel[0]) {
    $arr_desc_tel[0] = "Res";
  }
  //  if (!$arr_desc_tel[1]) {
  //    $arr_desc_tel[1] = "Com";
  //  }
  //  if (!$arr_desc_tel[2]) {
  //    $arr_desc_tel[2] = "Cont";
  //  }
  //  print "<pre>";
  //  print_r($mk_ramal);
  //  print "</pre>";
  if ($botao_sinc_dac == "B" || $botao_sinc_dac == "S" ) {
    if (empty($atv_ddd_tel) === true) {
      if((strtolower($arr_desc_tel[0])=="celular" || strtolower(substr($arr_desc_tel[0],0,5))=="móvel")  && substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
        $atv_ddd_tel = substr($mk_ramal["bina_gravacao"], 0, 2);
      }else{
        if((strtolower($arr_desc_tel[1])=="celular" || strtolower(substr($arr_desc_tel[1],0,5))=="móvel") && substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
          $atv_ddd_comercial = substr($mk_ramal["bina_gravacao"], 0, 2);
        }else{
          if((strtolower($arr_desc_tel[2])=="celular" || strtolower(substr($arr_desc_tel[2],0,5))=="móvel")&& substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
            $atv_ddd_cont = substr($mk_ramal["bina_gravacao"], 0, 2);
          }else{
            $atv_ddd_tel = substr($mk_ramal["bina_gravacao"], 0, 2);
          }
        }
      }
    }
    if (empty($atv_num_tel) === true) {
      if((strtolower($arr_desc_tel[0])=="celular" || strtolower(substr($arr_desc_tel[0],0,5))=="móvel")  && substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
        $atv_num_tel = substr($mk_ramal["bina_gravacao"], 2);
      }else{
        if((strtolower($arr_desc_tel[1])=="celular" || strtolower(substr($arr_desc_tel[1],0,5))=="móvel") && substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
          $atv_fone_comercial = substr($mk_ramal["bina_gravacao"], 2);
        }else{
          if((strtolower($arr_desc_tel[2])=="celular" || strtolower(substr($arr_desc_tel[2],0,5))=="móvel")&& substr($mk_ramal["bina_gravacao"],2,1) >= 6 ){
            $atv_num_cont = substr($mk_ramal["bina_gravacao"], 2);
          }else{
            $atv_num_tel = substr($mk_ramal["bina_gravacao"], 2);
          }
        }
      }
    }
  }

  //tratamento para receber dados quando vem de outra tela... padronização dos campos
  if($atv_ddd_tel == "" && $ddd_tel != ""){$atv_ddd_tel = $ddd_tel;}
  if($atv_num_tel == "" && $num_tel != ""){$atv_num_tel = $num_tel;}
  if($atv_ddd_comercial  == "" && $ddd_comercial  != ""){ $atv_ddd_comercial  = $ddd_comercial;}
  if($atv_fone_comercial == "" && $fone_comercial != ""){ $atv_fone_comercial = $fone_comercial;}
  if($atv_ddd_cont  == "" && $ddd_cont  != ""){ $atv_ddd_cont  = $ddd_cont;}
  if($atv_num_cont == ""  && $num_cont  != ""){ $atv_num_cont  = $num_cont;}




  if($atv_ddd_tel == "" && $ddd_1_novo != ""){$atv_ddd_tel = $ddd_1_novo;}
  if($atv_num_tel == "" && $fone_1_novo != ""){$atv_num_tel = $fone_1_novo;}
  if($atv_ddd_comercial  == "" && $ddd_2_novo  != ""){ $atv_ddd_comercial  =$ddd_2_novo;}
  if($atv_fone_comercial == "" && $fone_2_novo != ""){ $atv_fone_comercial = $fone_2_novo;}
  if($atv_ddd_cont  == "" && $ddd_3_novo  != ""){ $atv_ddd_cont  =$ddd_3_novo;}
  if($atv_num_cont == ""  && $fone_3_novo  != ""){ $atv_num_cont  = $fone_3_novo;}


  if($atv_ddd_tel == "" && $ddd_1 != ""){$atv_ddd_tel = $ddd_1;}
  if($atv_num_tel == "" && $fone_1 != ""){$atv_num_tel = $fone_1;}
  if($atv_ddd_comercial  == "" && $ddd_2  != ""){ $atv_ddd_comercial  =$ddd_2;}
  if($atv_fone_comercial == "" && $fone_2 != ""){ $atv_fone_comercial = $fone_2;}
  if($atv_ddd_cont  == "" && $ddd_3  != ""){ $atv_ddd_cont  =$ddd_3;}
  if($atv_num_cont == ""  && $fone_3  != ""){ $atv_num_cont  = $fone_3;}


  if(!$cor_telefone_1) {
    $cor_telefone_1 = "#008800";
    $cor_telefone_2 = "#B1FFB1";
    $cor_telefone_3 = "#91dF91";
    $style_fone     = "&nbsp;&nbsp;<font class='txt6'><b>TELEFONES</b></font>";
  }




  if($IntergrAllHeader) {
    if(substr($param_repre_vendedor,0,8) == "BOAVISTA"){
      ?>
        <div class="row">
          <div class="col-xs-12 ">
      <?
    }
?>

  <div class='simple-panel' id ='div_telefones' style='border-top-color:<?print $cor_telefone_1?> !important;'>
   <?if($style_fone != "" || $botao_sinc_dac == "S") {?>
      <div class='simple-panel-heading' style="">
        <h4 class='simple-panel-title green'>
          <i class='icon10 i-phone-2'></i>
          <?print $style_fone?>
        </h4>
        <?
        if($im_hw_atende == "S" && $cpf_cnpj){?>
          <script language='JavaScript'>
            function abrirHWContatos(){
              <?$mku = MKUEncodeJS("agenda_cpf={$cpf_cnpj}&agenda_nome={$nome_razao}&agd_grupo_atd={$im_hw_grupo}&agd_nb={$im_hw_nb}&agd_repre={$repre_vendedor}&agd_tp_ct=HW&classe_mkpro=DK{$session["discador_atende"]}", "");?>
              abrePopUpModal("Contato WhatsApp", "im_agenda.php?usaImprimir=NO&mku="+<?print $mku;?>, "MDJanIMAgenda", "600", "500", "pai");
            }
          </script>
          <div class='gap5 fright pointer'>
            <span class="badge badge-inverse" style='height:32px'><h3>Opt In</h3></span>
            <img src='imagens/ext_top_hw.png' width='24' title='Contato Whatsapp' onClick="abrirHWContatos();">
          </div>
        <?}?>
        <?if ($botao_sinc_dac == "S") {?>
             &nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="btn btn-success btn-xs" onclick="Javascript:document.cadastro.sync_dac.value='true'; document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1')); if (confereMK(document.cadastro)) {document.cadastro.submit()};" value="ATUALIZAR TELEFONE DE ORIGEM">
        <?}?>
      </div><!-- End .panel-heading -->
    <?}?>
    <div class='simple-panel-body' id="id_telefones" >

    <div class="row">
    <div class="col-sm-4  gap0 pad0 text-right-md text-right-lg">
                     <span id="id_telefones_enriquecimento"></span>
                     <input type="hidden" name="ja_ligou" value="<?print $ja_ligou?>" <?if ($disk_ficha == "O") {print "consistencia='sempre' consistencia2='pre' msg='Não é possivel finalizar a ficha sem fazer ligação' tipo='hidden'";}?>>
                     <input type="hidden" name="ligou_na_ficha" value="<?print $ligou_na_ficha;?>">
                     <?
                     if(!$consistir_atv_ddd_num_tel){
                       $consistir_atv_ddd_num_tel = "sempre";
                     }

                     //******************************************************************************************************************
                     //**ESPECIFICO PARA OUVIDORIA PARA ENTRADAS DIFERENTE DE 0800(TELEFONIA) NÃO OBRIGAR O PREENCHIMENTO DO TELEFONE 1**
                     //******************************************************************************************************************
                     if ((isset($ouv_origem) === true && empty($ouv_origem) === false && $ouv_origem != "01") || (substr($lead_grupo, 0, 1) === "W") || (substr($lead_grupo, 0, 1) === "E")) {
                       $consistir_atv_ddd_num_tel = "sopreenchido";
                     }
                     //******************************************************************************************************************
                     //******************************************************************************************************************
                     //******************************************************************************************************************
                     //teleton mostra a bina
                     if($nro_modelo == "TL") {
                       print "Bina: ".FormataFone($bina_cliente)."&nbsp;&nbsp;";
                     }

                     if ($nro_modelo == "C0") {
                      $consistir_atv_ddd_num_tel = "sopreenchido";
                     }

                     if($bina_cliente && !$atv_ddd_tel && $include_dados == "ag_bmg"){
                       $atv_ddd_tel = substr($bina_cliente,0,2);
                       $atv_num_tel = substr($bina_cliente,2);
                     }

                     ?>
                     <span id="span_desc_atv_dd_tel"><?print $arr_desc_tel[0]?>:</span><br class="visible-xs">
                                                 <input type="text"    id="id_atv_ddd_tel"   name="atv_ddd_tel"   maxlength="2" style="text-align:right;width:30px"  value="<?print $atv_ddd_tel;?>"    onKeyUp="pula(this,2,atv_num_tel);"        consistencia="<?print $consistir_atv_ddd_num_tel;?>" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[0]?> ">
                                                 <input type="text"    id="id_atv_num_tel"   name="atv_num_tel"                 style="text-align:right;width:80px" size="10"  value="<?print substr($atv_num_tel, 0, 9);?>"    onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_tel', 'id_atv_num_tel', 'id_atv_ramal_tel');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_tel', 'id_atv_num_tel', 'id_atv_ramal_tel');"      consistencia="<?print $consistir_atv_ddd_num_tel;?>" consistencia1="pre" consistencia2=2 consistencia3="<?if ($nro_modelo != "SR") {print "telefone";} else {print "celular";}?>" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[0]?>">
                                                 <span id="id_label_ramal_tel_1">R:</span><input type="text"  id="id_atv_ramal_tel" name="atv_ramal_tel" maxlength="4" style="text-align:right;width:40px"  size="3"  value="<?print $atv_ramal_tel;?>"  onKeyUp="<?if ($arr_desc_tel[1] != "") {?>pula(this,4,atv_ddd_comercial);<?}?>"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[0]?>">
                                                  <?
                                                  if ((($disk_ficha == "S" || $disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP" || $tipo_modelo == "FLW_ATV_S_MAIL") ) { /****$classe_agenda****/
                                                  ?>
                                                                          <input type="button" <?print $status_lig?> name="liga_res" id="liga_res" value="Lig" OnClick="Javascript:<?if($ocorrencia_md == "S"){?>EnviaLigacao('liga_res',document.cadastro.atv_ddd_tel,document.cadastro.atv_num_tel,'document.cadastro.atv_ddd_tel','document.cadastro.atv_num_tel');<?}else{?>mdLiga('liga_res',document.cadastro.atv_ddd_tel,document.cadastro.atv_num_tel);<?}?>" style="width:22; background: #008800; color: #FFFFFF; font-weight: bold;">
                                                  <?
                                                  }




                                      ?>
                                      </div>
                                      <div class="col-sm-4 gap0 pad0  text-right-md text-right-lg">
                                      <?
                                      // Se tiver descrição do segundo telefone
                                      if ($arr_desc_tel[1] != "") {
                                        if(!$consistir_atv_ddd_comercial){
                                          $consistir_atv_ddd_comercial = "sopreenchido";
                                        }

                                                                         ?><span id="span_desc_atv_ddd_comercial"><?print $arr_desc_tel[1]?>:</span><br class="visible-xs">
                                                                           <input type="text"   id="id_atv_ddd_comercial"   name="atv_ddd_comercial"   maxlength="2" style="text-align:right;width:30px" size="1"  value="<?print $atv_ddd_comercial;?>"                  onKeyUp="pula(this,2,atv_fone_comercial);" anteriorConsistencia="<?print $consistir_atv_ddd_comercial?>"  consistencia="<?print $consistir_atv_ddd_comercial?>" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[1]?>">
                                                                           <input type="text"   id="id_atv_fone_comercial"  name="atv_fone_comercial"                style="text-align:right;width:80px" size="10"  value="<?print substr($atv_fone_comercial, 0, 9);?>"  onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_comercial', 'id_atv_fone_comercial', 'id_atv_ramal_comercial');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_comercial', 'id_atv_fone_comercial', 'id_atv_ramal_comercial');"  anteriorConsistencia="<?print $consistir_atv_ddd_comercial?>" consistencia="<?print $consistir_atv_ddd_comercial?>" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[1]?>">
                                                                           <span id="id_label_ramal_tel_2">R:</span><input type="text" id="id_atv_ramal_comercial" name="atv_ramal_comercial" maxlength="4" style="text-align:right;width:40px" size="4"  value="<?print $atv_ramal_comercial;?>"                onKeyUp="<?if ($arr_desc_tel[2] != "") {?>pula(this,4,atv_ddd_cont);<?}?>"        consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[1]?>">
                                                  <?
                                                  if ((($disk_ficha == "S" ||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP"|| $tipo_modelo == "FLW_ATV_S_MAIL") ) {
                                                  ?>
                                                                          <input type="button" <?print $status_lig?> name="liga_com" id="liga_com"  value="Lig" OnClick="Javascript:<?if($ocorrencia_md == "S"){?>EnviaLigacao('liga_com',document.cadastro.atv_ddd_comercial,document.cadastro.atv_fone_comercial,'document.cadastro.atv_ddd_comercial','document.cadastro.atv_fone_comercial');<?}else{?>mdLiga('liga_com',document.cadastro.atv_ddd_comercial,document.cadastro.atv_fone_comercial);<?}?>" style="width: 22; background: #008800; color: #FFFFFF; font-weight: bold;">
                                                  <?
                                                  }
                                      } else {
                                                  ?>
                                                                          <input type="hidden"    name="atv_ddd_comercial"   maxlength="2" size="1" value="<?print $atv_ddd_comercial;?>"  >
                                                                          <input type="hidden"    name="atv_fone_comercial"  maxlength="9" size="9" value="<?print $atv_fone_comercial;?>" >
                                                                          <input type="hidden"    name="atv_ramal_comercial" maxlength="3" size="4" value="<?print $atv_ramal_comercial;?>">
                                                  <?
                                      }




?>
                                      </div>
                                      <div class="col-sm-4  gap0 pad0 text-right-md text-right-lg">
                                      <?

                                      // Se tiver descrição do terceiro telefone
                                      if ($arr_desc_tel[2] != "") {
                                                                          ?><span id="span_desc_atv_ddd_cont"><?print $arr_desc_tel[2]?>:</span><br class="visible-xs">  <input type="text" id="id_atv_ddd_cont"   name="atv_ddd_cont"   maxlength="2" style="text-align:right;width:30px" size="1" value="<?print $atv_ddd_cont;?>"   onKeyUp="pula(this,2,atv_num_cont);" anteriorConsistencia="sopreenchido" consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[2]?>">
                                                                                                     <input type="text" id="id_atv_num_cont"   name="atv_num_cont"                 style="text-align:right;width:80px" size="10" value="<?print substr($atv_num_cont, 0, 9);?>" onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_cont', 'id_atv_num_cont', 'id_atv_ramal_cont');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_cont', 'id_atv_num_cont', 'id_atv_ramal_cont');" consistencia="sopreenchido" anteriorConsistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[2]?>">
                                                                                                     <span id="id_label_ramal_tel_3">R:</span><input type="text" id="id_atv_ramal_cont" name="atv_ramal_cont" maxlength="4" style="text-align:right;width:40px" size="4" value="<?print $atv_ramal_cont;?>"                                      consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[2]?>">
                                                  <?
                                                  if ((($disk_ficha == "S" ||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP"|| $tipo_modelo == "FLW_ATV_S_MAIL") ) {
                                                  ?>
                                                     <input type="button" <?print $status_lig?> name="liga_cont" id="liga_cont" value="Lig" OnClick="Javascript:mdLiga('liga_cont',document.cadastro.atv_ddd_cont,document.cadastro.atv_num_cont)" style="width:22; background: #008800; color: #FFFFFF; font-weight: bold;">
                                                  <?
                                                  }

                                      }

                                      if (((($disk_ficha == "S"||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP" || $tipo_modelo == "FLW_ATV_S_MAIL")) && ($aux_lista == "S")) {
                                                  ?>
                                                                             Lista:<input type="hidden" name="tel_auxilio"  value=""><input type="button" name="busca_tel_auxilio" value="Aux" style="background:<?print $vermelho?>" OnClick="JavaScript:AbreJanela('cc_auxilio_telefonico.php?formulario=cadastro&campo=tel_auxilio', 'JanelaAuxilio', '500', '400')">
                                                                             <input type="hidden" value="00" name="ddd_aux_lista">
                                                                             <input type="button" id='liga_aux' OnClick="Javascript:if (document.cadastro.tel_auxilio.value) {  mdLiga('liga_aux',document.cadastro.ddd_aux_lista,document.cadastro.tel_auxilio);   } else{   alert('Selecione o Estado de onde será pesquisado'); }  " style="width=22; background=#008800; color=#FFFFFF; font-weight: bold;" value="Lig"><?
                                      }


                                    ?>
                                      </div>
                                  </div>
                                      <?


                                                  if($nro_modelo == "FC"){?><br><font class="txt5"><br>Telefone 4</span>:<input type="text"  name="ddd_4"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_4);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 4 ">
                                                                                                   <input type="text"     name="fone_4"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_4);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 4">
                                                                                                   R:<input type="text"   name="ramal_4" maxlength="4"  style="text-align:right"  size="4"  value=""  onKeyUp="pula(this,4,ddd_5);"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 4">

                                                  Telefone 5</span>:<input type="text"  name="ddd_5"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_5);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 5 ">
                                                                                                   <input type="text"     name="fone_5"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_5);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 5">
                                                                                                   R:<input type="text"   name="ramal_5" maxlength="4"  style="text-align:right"  size="4"  value=""  onKeyUp="pula(this,4,ddd_6);"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 5">

                                                  Telefone 6</span>:<input type="text"  name="ddd_6"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_6);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 6 ">
                                                                                                   <input type="text"     name="fone_6"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_6);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 6">
                                                                                                   R:<input type="text"   name="ramal_6" maxlength="4"  style="text-align:right"  size="4"  value=""   consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 6">

                                                  <?}
                                                  ?>

    </div>
  </div>
<?} else{?>

        <tr bgcolor="<?print $session["td_dado3"]?>" >
          <td align="center">
          <?if($style_fone != "" || $botao_sinc_dac == "S") {?>
             <table id="id_telefones" align="center" width="100%" border="0" cellpadding="2" cellspacing="0">
               <tr bgcolor="<?print $cor_telefone_1?>">
                <td>

                   <table width="100%" border="0" cellspacing="0" cellpadding="0">
                      <tr>
                         <td>
                           <font class="txt5"><font color="<?print $session["f_td_destaque"]?>"><strong><?print $style_fone?>
                         </td>
                         <td width="100%" align="right">
                          <?
                          if ($botao_sinc_dac == "S") {
                            //                           if (!($nro_modelo == "BI" || ($_SESSION["ambiente"] == "teste" && $nro_modelo == "BF"))) {
                          ?>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;<input type="button" style="background:none;color:<?print $session["f_td_destaque"]?>" onclick="Javascript:document.cadastro.sync_dac.value='true';document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1')); if (confereMK(document.cadastro)) {document.cadastro.submit()};" value="ATUALIZAR TELEFONE DE ORIGEM">
                          <?
                          //                           }
                          }
                          ?>
                         </td>
                      </tr>
                   </table>
                </td>
               </tr>
            <?}else{?>
            <table id="id_telefones" align="center" width="100%" border="0" cellpadding="2" cellspacing="0">
            <?}?>
               <tr bgcolor="<?print $cor_telefone_2?>" >
                 <td align="center" nowrap>
                     <label id="id_telefones_enriquecimento"></label>
                     <input type="hidden" name="ja_ligou" value="<?print $ja_ligou?>" <?if ($disk_ficha == "O") {print "consistencia='sempre' consistencia2='pre' msg='Não é possivel finalizar a ficha sem fazer ligação' tipo='hidden' ";}?>>
                     <input type="hidden" name="ligou_na_ficha" value="<?print $ligou_na_ficha;?>">
                     <font class="txt5">
                     <?
                     if(!$consistir_atv_ddd_num_tel){
                       $consistir_atv_ddd_num_tel = "sempre";
                     }

                     //******************************************************************************************************************
                     //**ESPECIFICO PARA OUVIDORIA PARA ENTRADAS DIFERENTE DE 0800(TELEFONIA) NÃO OBRIGAR O PREENCHIMENTO DO TELEFONE 1**
                     //******************************************************************************************************************
                     if ((isset($ouv_origem) === true && empty($ouv_origem) === false && $ouv_origem != "01") || (substr($lead_grupo, 0, 1) === "W") || (substr($lead_grupo, 0, 1) === "E")) {
                       $consistir_atv_ddd_num_tel = "sopreenchido";
                     }
                     //******************************************************************************************************************
                     //******************************************************************************************************************
                     //******************************************************************************************************************
                     //teleton mostra a bina
                     if($nro_modelo == "TL") {
                       print "Bina: ".FormataFone($bina_cliente)."&nbsp;&nbsp;";
                     }
                     ?>
                      <span id="span_desc_atv_dd_tel"><?print $arr_desc_tel[0]?></span>:
                                                 <input type="text"    id="id_atv_ddd_tel"   name="atv_ddd_tel"   maxlength="2" style="text-align:right" size="1"  value="<?print $atv_ddd_tel;?>"    onKeyUp="pula(this,2,atv_num_tel);"        consistencia="<?print $consistir_atv_ddd_num_tel;?>" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[0]?> " <?= $readOnly_telef?>>
                                                 <input type="text"    id="id_atv_num_tel"   name="atv_num_tel"                 style="text-align:right" size="10"  value="<?print substr($atv_num_tel, 0, 9);?>"    onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_tel', 'id_atv_num_tel', 'id_atv_ramal_tel');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_tel', 'id_atv_num_tel', 'id_atv_ramal_tel');"     consistencia="<?print $consistir_atv_ddd_num_tel;?>" consistencia1="pre" consistencia2=2 consistencia3="<?if ($nro_modelo != "SR") {print "telefone";} else {print "celular";}?>" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[0]?>" <?= $readOnly_telef?>>
                                                 R:<input type="text"  id="id_atv_ramal_tel" name="atv_ramal_tel" maxlength="4" style="text-align:right"  size="4"  value="<?print $atv_ramal_tel;?>"  onKeyUp="<?if ($arr_desc_tel[1] != "") {?>pula(this,4,atv_ddd_comercial);<?}?>"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[0]?>" <?= $readOnly_telef?>>
<?
if ((($disk_ficha == "S" || $disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP" || $tipo_modelo == "FLW_ATV_S_MAIL") ) { /****$classe_agenda****/


?>
                        <input type="button" <?print $status_lig?> name="liga_res" id="liga_res" value="Lig" OnClick="Javascript:<?if($ocorrencia_md == "S"){?>EnviaLigacao('liga_res',document.cadastro.atv_ddd_tel,document.cadastro.atv_num_tel,'document.cadastro.atv_ddd_tel','document.cadastro.atv_num_tel');<?}else{?>mdLiga('liga_res',document.cadastro.atv_ddd_tel,document.cadastro.atv_num_tel);<?}?>" style="width:22; background: #008800; color: #FFFFFF; font-weight: bold;">
<?
}

// Se tiver descrição do segundo telefone
if ($arr_desc_tel[1] != "") {
  if(!$consistir_atv_ddd_comercial){
    $consistir_atv_ddd_comercial = "sopreenchido";
  }

                       ?><span id="span_desc_atv_ddd_comercial"><?print $arr_desc_tel[1]?></span>:<input type="text"   id="id_atv_ddd_comercial"   name="atv_ddd_comercial"   maxlength="2" style="text-align:right" size="1"  value="<?print $atv_ddd_comercial;?>"   onKeyUp="pula(this,2,atv_fone_comercial);" anteriorConsistencia="<?print $consistir_atv_ddd_comercial?>"  consistencia="<?print $consistir_atv_ddd_comercial?>" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[1]?>">
                         <input type="text"   id="id_atv_fone_comercial"  name="atv_fone_comercial"                style="text-align:right" size="10"  value="<?print substr($atv_fone_comercial, 0, 9);?>"  onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_comercial', 'id_atv_fone_comercial', 'id_atv_ramal_comercial');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_comercial', 'id_atv_fone_comercial', 'id_atv_ramal_comercial');" anteriorConsistencia="<?print $consistir_atv_ddd_comercial?>" consistencia="<?print $consistir_atv_ddd_comercial?>" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[1]?>">
                         R:<input type="text" id="id_atv_ramal_comercial" name="atv_ramal_comercial" maxlength="4" size="4"  value="<?print $atv_ramal_comercial;?>" onKeyUp="<?if ($arr_desc_tel[2] != "") {?>pula(this,4,atv_ddd_cont);<?}?>"        consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[1]?>">
<?
if ((($disk_ficha == "S" ||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP"|| $tipo_modelo == "FLW_ATV_S_MAIL") ) {
?>
                        <input type="button" <?print $status_lig?> name="liga_com" id="liga_com"  value="Lig" OnClick="Javascript:<?if($ocorrencia_md == "S"){?>EnviaLigacao('liga_com',document.cadastro.atv_ddd_comercial,document.cadastro.atv_fone_comercial,'document.cadastro.atv_ddd_comercial','document.cadastro.atv_fone_comercial');<?}else{?>mdLiga('liga_com',document.cadastro.atv_ddd_comercial,document.cadastro.atv_fone_comercial);<?}?>" style="width: 22; background: #008800; color: #FFFFFF; font-weight: bold;">
<?
}
} else {
?>
                        <input type="hidden"    name="atv_ddd_comercial"   maxlength="2" size="1" value="<?print $atv_ddd_comercial;?>"  >
                        <input type="hidden"    name="atv_fone_comercial"  maxlength="9" size="9" value="<?print $atv_fone_comercial;?>" >
                        <input type="hidden"    name="atv_ramal_comercial" maxlength="3" size="4" value="<?print $atv_ramal_comercial;?>">
<?
}

// Se tiver descrição do terceiro telefone
if ($arr_desc_tel[2] != "") {
                        ?><span id="span_desc_atv_ddd_cont"><?print $arr_desc_tel[2]?></span>:<input type="text" id="id_atv_ddd_cont"   name="atv_ddd_cont"   maxlength="2" style="text-align:right" size="1" value="<?print $atv_ddd_cont;?>"   onKeyUp="pula(this,2,atv_num_cont);" anteriorConsistencia="sopreenchido" consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone <?print $arr_desc_tel[2]?>">
                                                   <input type="text" id="id_atv_num_cont"   name="atv_num_cont"                 style="text-align:right" size="10" value="<?print substr($atv_num_cont, 0, 9);?>"  onKeyUp="javascript: limpaTelefoneMK('id_atv_ddd_cont', 'id_atv_num_cont', 'id_atv_ramal_cont');" onblur="javascript: limpaTelefoneMK('id_atv_ddd_cont', 'id_atv_num_cont', 'id_atv_ramal_cont');"  consistencia="sopreenchido" anteriorConsistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone <?print $arr_desc_tel[2]?>">
                                                 R:<input type="text" id="id_atv_ramal_cont" name="atv_ramal_cont" maxlength="4" style="text-align:right" size="4" value="<?print $atv_ramal_cont;?>"                                      consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone <?print $arr_desc_tel[2]?>">
<?
if ((($disk_ficha == "S" ||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP"|| $tipo_modelo == "FLW_ATV_S_MAIL") ) {
?>
   <input type="button" <?print $status_lig?> name="liga_cont" id="liga_cont" value="Lig" OnClick="Javascript:mdLiga('liga_cont',document.cadastro.atv_ddd_cont,document.cadastro.atv_num_cont)" style="width=22; background=#008800; color=#FFFFFF; font-weight: bold;">
<?
}

}

if (((($disk_ficha == "S"||$disk_ficha == "O") && $tipo_modelo == "RECEPTIVO" && $tipo_atendimento == "A") || ($disk_ficha == "S" ||$disk_ficha == "O") && ($tipo_modelo == "ATIVO" || $tipo_modelo == "ATIVO_DISCAR" || $tipo_modelo == "AGENDA_RETORNO" || $tipo_modelo == "FOLLOWUP" || $tipo_modelo == "FLW_ATV_S_MAIL")) && ($aux_lista == "S")) {
?>
                           Lista:<input type="hidden" name="tel_auxilio"  value=""><input type="button" name="busca_tel_auxilio" value="Aux" style="background:<?print $vermelho?>" OnClick="JavaScript:AbreJanela('cc_auxilio_telefonico.php?formulario=cadastro&campo=tel_auxilio', 'JanelaAuxilio', '500', '400')">
                           <input type="hidden" value="00" name="ddd_aux_lista">
                           <input type="button" id='liga_aux' OnClick="Javascript:if (document.cadastro.tel_auxilio.value) {  mdLiga('liga_aux',document.cadastro.ddd_aux_lista,document.cadastro.tel_auxilio);   } else{   alert('Selecione o Estado de onde será pesquisado'); }  " style="width=22; background=#008800; color=#FFFFFF; font-weight: bold;" value="Lig"><?
}




if($nro_modelo == "FC"){?><br><font class="txt5"><br>Telefone 4</span>:<input type="text"  name="ddd_4"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_4);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 4 ">
                                                 <input type="text"     name="fone_4"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_4);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 4">
                                                 R:<input type="text"   name="ramal_4" maxlength="4"  style="text-align:right"  size="4"  value=""  onKeyUp="pula(this,4,ddd_5);"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 4">

Telefone 5</span>:<input type="text"  name="ddd_5"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_5);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 5 ">
                                                 <input type="text"     name="fone_5"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_5);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 5">
                                                 R:<input type="text"   name="ramal_5" maxlength="4"  style="text-align:right"  size="4"  value=""  onKeyUp="pula(this,4,ddd_6);"  consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 5">

Telefone 6</span>:<input type="text"  name="ddd_6"   maxlength="2" style="text-align:right" size="1"  value=""    onKeyUp="pula(this,2,fone_6);"        consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="ddd" msg="Preencha corretamente o DDD do Telefone Telefone 6 ">
                                                 <input type="text"     name="fone_6"   maxlength="9"  style="text-align:right" size="10"  value=""    onKeyUp="pula(this,8,ramal_6);"      consistencia="sopreenchido" consistencia1="pre" consistencia2=2 consistencia3="telefone" msg="Preencha corretamente o Numero do Telefone Telefone 6">
                                                 R:<input type="text"   name="ramal_6" maxlength="4"  style="text-align:right"  size="4"  value=""   consistencia="sopreenchido" consistencia2="numeros" msg="Preencha corretamente o Ramal do Telefone Telefone 6">

<?}
?>


                  </td>
                </tr>
<?}?>


<?

/*
if($usa_omnivision == "S"){

		$params_omni_decode = json_decode($omnivision_params,true);

		if(!is_array($params_omni_decode)){
			print "ERROP AO CARREGAR PARAMETROS->>".$omnivision_params;
			$omnivision_params;
			Exit;
		}

		require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/ctr/OmniVision.php");
	  $vision = new OmniVision($params_omni_decode);




	?>
	<div class='row pad0 gap0'>
		<div class='col-xs-12 pad5 gap0'>

			<?

			echo $vision->getOmniOptin('cpf_cnpj', '56336215229');
			/*
			if(!$omni_id && $conProp->result["omni_id"] != ""){$omni_id = $conProp->result["omni_id"];}
			if($omni_id){
				echo $vision->getOmniOptin('omni_id', $omni_id);
			}else{
				if($cpf_cnpj){
					echo $vision->getOmniOptin('cpf_cnpj', $cpf_cnpj);
				}else{
					echo $vision->getOmniOptin('contato', '5511965499797');
				}

			}
			?>

		</div>
	</div>
	<?

}
*/
?>



                <?
                if(strtoupper($utiliza_callback_raco) == "S" && $mk_ramal_serialize != "SEM_LIGACAO"){?>
                    <tr bgcolor="<?print $cor_telefone_1?>">
                      <td class="txt5"  align='center' colspan='3'>
                      <?//print $mk_ramal_serialize;?>
                        <br><input type='button'  name='btEnvia1' value='CAIU A LIGAÇÃO' OnClick="AbrirCaiuLigacao();" style='width: 510px;height:30px; cursor: pointer;color: #FFFFFF;font-weight: bold;background: #FF5555;' ><br>
                        <?//echo $chave_agrupa_callback."-".${$chave_agrupa_callback};?>
                        <input type="hidden" name="chave_agrupa_callback" id="chave_agrupa_callback" value="<?print ${$chave_agrupa_callback};?>">
                      </td>
                    </tr>
                <?}else if ($mk_ramal_serialize == "SEM_LIGACAO" && strtoupper($utiliza_callback_raco) == "S"){?>
                    <tr bgcolor="<?print $cor_telefone_1?>">
                      <td class="txt5"  align='center' colspan='3'>
                        <font class="txtvermelho3">ATENÇÃO ATENDIMENTO SEM LIGAÇÃO! <br> NÃO É POSSIVEL REALIZAR CALLBACK</font>
                      </td>
                    </tr>
                <?}?>
                <?
                if($ocorrencia_md == "S") {?>
                   <script type="text/javascript" src="/js/<?=$montaDivPopUp?>.js"></script>
                   <script type="text/javascript">
                   function EnviaLigacao(id_botao_liga,ddd,tel,ddd_txt,tel_txt){
                     if(consisteCampo(ddd) && consisteCampo(tel)){
                       ddd_num = ddd.value;
                       tel_num = tel.value;
                       $.ajax({
                         url: 'md_cad_prop_ocorrecia_lig_ajax.php',
                         type: 'POST',
                         data: {
                           nro_modelo:'<?print $nro_modelo?>',
                           classe_agenda:'<?print $classe_agenda?>',
                           repre_vendedor:'<?print $repre_vendedor?>',
                           usa_repre_vendedor:'<?print $usa_repre_vendedor?>',
                           id_botao_liga:id_botao_liga,
                           ddd_num:ddd_num,
                           tel_num:tel_num,
                           ddd:ddd_txt,
                           tel:tel_txt
                         },
                         dataType: 'text',
                         timeout: 10000,
                         contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
                         beforeSend: function() {
                           $('#black_div'  ).show();
                           $('#loading_div').show();
                         },
                         error: function(erro) {
                           $('#black_div'  ).hide();
                           $('#loading_div').hide();
                           alert('erro ajax:'+erro);
                         },
                         success: function(xml) {
                           $('#black_div'  ).hide();
                           $('#loading_div').hide();
                           array_acao = xml.split('|');
                           if(array_acao[1] == "OK"){
                             mdLiga(id_botao_liga,ddd,tel);
                           }else{
                             montaDivPopUp(1,"","JanelaOcoAjax",400,150,"OCORRÊNCIA TELEFONICA","CC","<?print $session["td_destaque"]?>","N","","S",xml);
                           }
                         }
                       });
                     }
                   }

                   function ListaOcorrenciasAjax(n_ocorrencia){
                     if(n_ocorrencia != ""){
                       $.ajax({
                         url: 'md_cad_prop_ocorrecia_lig_ajax.php',
                         type: 'POST',
                         data: {
                           tipo_ajax:    'LISTA_OCORRENCIA',
                           nro_modelo:   '<?print $nro_modelo?>',
                           classe_agenda:'<?print $classe_agenda?>',
                           n_ocorrencia  :n_ocorrencia
                         },
                         dataType: 'text',
                         timeout: 10000,
                         contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
                         beforeSend: function() {
                           //////
                         },
                         error: function(erro) {
                           alert('erro ajax:'+erro);
                         },
                         success: function(xml) {
                           $('#txt_ocorrencias' ).html(xml);
                         }
                       });
                     }else{
                       $('#id_n_ocorrencia').val('');
                       $('#txt_ocorrencias' ).html('');
                     }
                   }
                   </script>
                   <input type="hidden" name="n_ocorrencia" id="id_n_ocorrencia" value="<?print $n_ocorrencia;?>"  >
                   <tr bgcolor="<?print $cor_telefone_2?>" >
                     <td align="center" id='txt_ocorrencias'>
                        <?if($n_ocorrencia){?>
                            <script type="text/javascript">
                            ListaOcorrenciasAjax('<?print $n_ocorrencia;?>');
                            </script>
                        <?}?>
                     </td>
                   </tr>
                <?}?>
              </table>
          </td>
        </tr>



<?
} else {
?>
      <input type="hidden"    name="atv_ddd_tel"         maxlength="2" size="1" value="<?print $atv_ddd_tel;?>"        >
      <input type="hidden"    name="atv_num_tel"         maxlength="9" size="9" value="<?print $atv_num_tel;?>"        >
      <input type="hidden"    name="atv_ramal_tel"       maxlength="4" size="3" value="<?print $atv_ramal_tel;?>"      >
      <input type="hidden"    name="atv_ddd_comercial"   maxlength="2" size="1" value="<?print $atv_ddd_comercial;?>"  >
      <input type="hidden"    name="atv_fone_comercial"  maxlength="9" size="9" value="<?print $atv_fone_comercial;?>" >
      <input type="hidden"    name="atv_ramal_comercial" maxlength="3" size="4" value="<?print $atv_ramal_comercial;?>">
      <input type="hidden"    name="atv_ddd_cont"        maxlength="2" size="1" value="<?print $atv_ddd_cont;?>"       >
      <input type="hidden"    name="atv_num_cont"        maxlength="9" size="9" value="<?print $atv_num_cont;?>"       >
      <input type="hidden"    name="atv_ramal_cont"      maxlength="4" size="3" value="<?print $atv_ramal_cont;?>"     >
<?
}
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//******************************************** TELEFONES ***************************************************
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/
//**********************************************************************************************************/


if (file_exists($prg_include_conteudo)) {
  ?>
  <tr bgcolor="<?print $session["td_dado3"]?>">
    <td><?require_once($prg_include_conteudo);?></td>
  </tr>
  <?
}

//*******************************************************************************************************************************
//*******************************************************************************************************************************
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************<br>
//*                  ENRIQUECIMENTO
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************
//*******************************************************************************************************************************
if ($bd_enriquecimento) {
  if ($usa_repre_vendedor == "S") {
    $repre_form = $repre_vendedor;
  } else {
    $repre_form = $session["representante"];
  }

  //******************************************************************************************\\
  //* PARÂMETRO $isEnriqEspecifico CRIADO PARA CASOS ONDE APENAS O PARÂMETRO DO ENRIQUECIMENTO SERÁ UTILIZADO
  //* NÃO SENDO NECESSÁRIO UTILIZAR A FUNCIONALIDADE EM SUA TOTALIDADE
  //******************************************************************************************\\
  //* OBSERVAÇÕES:
  //* ASSIM QUE POSSÍVEL CRIAR UM PARÂMETRO DENTRO DO MK-PARAMETROS E PASSAR A LER ESTA FLAG DE LÁ
  //* ISTO CASO O CONCEITO DE ENRIQUECIMENTO ESPECIFICO SEJA ADOTADO (QUANDO UTILIZA-SE REGRAS CONDICIONAIS PARECIDAS COM A AÇÃO INTELIGENTE)
  //******************************************************************************************\\
  $isEnriqEspecifico = (boolean)(preg_match("/^(HONDA)/", $repre_form));

  if ($isEnriqEspecifico === false) {
    require_once("funcoes/BuscaFormulario.php");
    $ListaFormularioEnriq = BuscaListaFormulario($repre_form, "9999", "MD".$nro_modelo, "S");
    #----------------------------------------------------
    #---------------- TABELA FORMULÁRIO -----------------
    #----------------------------------------------------
    if ($ListaFormularioEnriq) {
      $multiploForm = ValorClasseForm("ALCPQ","PESQUISA_MULTIPLA",$repre_form);

      if(count($ListaFormularioEnriq) >= 2 || $multiploForm == "S") {
        $in_form_enrique = "";
        foreach ($ListaFormularioEnriq as $valor) {
          $in_form_enrique .= "'".$valor."',";
        }
        $in_form_enrique         = " AND vlr_classe IN (".substr($in_form_enrique,0,-1).") ";
        $combo_numero_formulario = MontaComboForm("PQCAM",$numero_formulario_aux,$repre_form,"A",$in_form_enrique);
        $titulo_enrique          = $titClasse;
        ?>
        <script type="text/javascript">
        function PreencherFormEnriq(cod_formulario,titulo) {
          if(titulo == "") {
            titulo = $("#id_numero_formulario_aux option:selected").text();
          }
          $("#id_numero_formulario_aux").val('');
          montaDivPopUp("1", "md_cad_prop_2_multi_formulario.php?repre_form=<?print $repre_form?>&numero_formulario="+cod_formulario, "JanelaSistemaOrigem", "99%", "99%", titulo, "CC", "<?print $session["td_destaque"];?>", "N", "", "S", "", "N");
        }

        function ExcluirFormEnriq(cod_formulario) {
          formulario     = $('#id_formularios_preenchido').val();
          array          = formulario.split("=|PERG_FORM|=");
          formulario_aux = "";

          x=0;
          while(array[x] != "") {
            array_2        = array[x].split("=|RESP_FORM|=");
            if(cod_formulario != array_2[0]) {
              formulario_aux = formulario_aux+array[x]+"=|PERG_FORM|=";
            }
            x++;
          }
          $('#id_formularios_preenchido').val(formulario_aux);
          atualizaMK();
        }
        </script>

        <input type="hidden" name="abriu_formulario"  value="S">
        <?if($IntergrAllHeader) {?>
          <div class='simple-panel' >
            <div class='simple-panel-heading'>
              <h4 class='simple-panel-title'><i class='icon10 i-clipboard-2'></i><?print $titulo_enrique?></h4>
              <a href='#' class='minimize'></a>
            </div>
            <!-- End .panel-heading -->
            <div class='simple-panel-body'>
              <div class='row pad-top5' style="margin-right: 0px;">
                <select name="numero_formulario_aux" id="id_numero_formulario_aux" consistencia="sopreenchido" consistencia1="pre" msg="Selecione <?print $titulo_enrique?>" onchange="PreencherFormEnriq(this.value,'');" class="form-control col-xs-7">
                  <?print $combo_numero_formulario?>
                </select>
              </div>
              <div class='row pad-top5'>
                <input type="hidden" name="formularios_preenchido" id="id_formularios_preenchido" value="<?print $formularios_preenchido?>" consistir="sempre" tipodado="preenchido" msg="Preencha o <?print $titulo_enrique?> Corretamente!"><?
                if($formularios_preenchido) {
                  $formularios_preenchido = str_replace("'","\"",$formularios_preenchido);
                  $array_form             = explode("=|PERG_FORM|=",$formularios_preenchido);
                  if(is_array($array_form)) {?>
                    <div class="panel-body">
                      <table class="table table-bordered table-hover table-striped">
                        <?
                        foreach ($array_form as $valor_form) {
                          if($valor_form) {
                            $array_form_resp = explode("=|RESP_FORM|=",$valor_form);?>
                            <tr bgcolor="<?print $session["td_dado3"]?>" onMouseOver="javascript:style.background='<?print $session["td_dado1"]?>';"       onMouseOut="javascript:style.background='<?print $session["td_dado3"]?>';">
                              <td class="text-left hidden-xs" >&nbsp;<i><strong><?print ValorClasseForm("PQCAM",$array_form_resp[0],$repre_form)?></strong></i></td>
                              <td class="text-right hidden-xs" width="30px" align="center"><img src='imagens/lupa_transparente_2.gif'     style='cursor: pointer;' onclick="PreencherFormEnriq('<?print $array_form_resp[0]?>','<?print ValorClasseForm("PQCAM",$array_form_resp[0],$repre_form)?>');"></td>
                              <td class="text-right hidden-xs" width="30px" align="center"><img src="imagens/lixeira.gif" title="Excluir" style="cursor: pointer;" onclick="ExcluirFormEnriq('<?print $array_form_resp[0]?>');"></td>
                            </tr><?
                          }
                        }
                        ?>
                      </table>
                    </div><?
                  }
                }?>
              </div>
            </div><!-- End .panel-body -->
          </div>
        <?} else {?>
            <tr bgcolor="<?print $session["td_dado3"]?>"  id="id_tr_pesq1">
              <td bgcolor="<?print $session["td_destaque"]?>"><a name="dados_formulario"></a>
                <a name="dados_form"></a>
                <table width="100%" cellpadding="2" cellspacing="0">
                  <tr>
                    <td class="txt6" width="10%" nowrap>&nbsp;&nbsp;<strong><label title="Formulário Enriquecimento"><?print $titulo_enrique?>:</label> </td>
                    <td>
                      <select name="numero_formulario_aux" id="id_numero_formulario_aux" consistencia="sopreenchido" consistencia1="pre" msg="Selecione <?print $titulo_enrique?>" style="width: 97%;" onchange="PreencherFormEnriq(this.value,'');">
                        <?print $combo_numero_formulario?>
                      </select>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr bgcolor="<?print $session["td_dado3"]?>"  id="id_tr_pesq2">
              <input type="hidden" name="formularios_preenchido" id="id_formularios_preenchido" value="<?print $formularios_preenchido?>" consistir="sempre" tipodado="preenchido" msg="Preencha o <?print $titulo_enrique?> Corretamente!">
              <td align="center" id="id_td_pesq2">
                <?
                if($formularios_preenchido) {
                  $formularios_preenchido = str_replace("'","\"",$formularios_preenchido);
                  $array_form             = explode("=|PERG_FORM|=",$formularios_preenchido);
                  if(is_array($array_form)) {?>
                    <table width="100%" cellpadding="2" cellspacing="0" border="1" style='border-collapse=collapse'>
                      <?
                      $x_form_enriq = 0;
                      foreach ($array_form as $valor_form) {
                        if($valor_form) {
                          $array_form_resp = explode("=|RESP_FORM|=",$valor_form);?>
                          <tr <?if(($x_form_enriq % 2) == 0) {?>bgcolor="<?print $session["td_dado2"]?>"<?} else {?>bgcolor="<?print $session["td_dado3"]?>"<?}?>>
                            <td class="txt5azul">&nbsp;<i><strong><?print ValorClasseForm("PQCAM",$array_form_resp[0],$repre_form)?></strong></i></td>
                            <td class="txt5" width="30px" align="center"><img src='imagens/lupa_transparente_2.gif'       style='cursor: pointer;' onclick="PreencherFormEnriq('<?print $array_form_resp[0]?>','<?print ValorClasseForm("PQCAM",$array_form_resp[0],$repre_form)?>');"></td>
                            <td class="txt5" width="30px" align="center"><img src="imagens/lixeira.gif" title="Excluir" style="cursor: pointer;" onclick="ExcluirFormEnriq('<?print $array_form_resp[0]?>');"></td>
                          </tr><?
                        }
                      }
                      ?>
                    </table><?
                  }
                } else {
                  print "<font class='txt'>Preencha ".$titulo_enrique."!</font>";
                }
                ?>
              </td>
            </tr>
        <?}
      } elseif($ListaFormularioEnriq[0]) {
        $numero_formulario = $ListaFormularioEnriq[0];?>
        <input type="hidden" name="abriu_formulario" value="S">
        <tr bgcolor="<?print $session["td_dado3"]?>"  id="id_tr_pesq1">
          <td bgcolor="<?print $session["td_destaque"]?>"><a name="dados_formulario"></a>
            <a name="dados_form"></a>
            <table width="100%" cellpadding="0" cellspacing="0">
              <tr>
                <td><font class="txt6">&nbsp;&nbsp;<strong><label title="Formulário Enriquecimento"><?print ValorClasseForm("PQCAM",$numero_formulario,$repre_form)?>:</label> </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr bgcolor="<?print $session["td_dado3"]?>"  id="id_tr_pesq2">
          <td align="center">
            <table border="1" style='border-collapse: collapse' bordercolor="<?print $amarelo_escuro?>" width="100%" cellpadding="2" cellspacing="0" align="center">
              <tr bgcolor="<?print $amarelo?>">
                <td width="100%" colspan="3">
                  <?require_once("dk_cad_prop_2_dados_form_inteligente.php");?>
                </td>
              </tr>
            </table>
          </td>
        </tr>
    <?
      }
    } else {
    ?>
      <tr bgcolor="<?print $session["td_dado3"]?>"  id="id_tr_pesq1">
        <td align="center">
          <table border="1" style='border-collapse: collapse' bordercolor="<?print $amarelo_escuro?>" width="100%" cellpadding="2" cellspacing="0" align="center">
            <tr bgcolor="<?print $amarelo?>">
              <td width="100%" colspan="3">
                <tr bgcolor="<?print $session["td_dado3"]?>">
                  <td align="center">
                    <table border="0" style='border-collapse: collapse' width="97%" cellpadding="2" cellspacing="0" align="center">
                      <tr bgcolor="<?print $session["td_dado2"]?>">
                        <td align="center" class="txtvermelho2"><strong>Enriquecimento não Foi Alocada Entre em Contato com seu Supervisor</strong></td>
                      </tr>
                    </table>
                  </td>
                  <input type="hidden" id="id_checa_pesquisa" name="checa_pesquisa" value="S">
                </tr>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    <?
    exit;
    }
  }
}


//*******************************************************************************************************************************
//*******************************************************************************************************************************
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************<br>
//*                FIM DO  ENRIQUECIMENTO
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************<br>
//*******************************************************************************************************************************
//*******************************************************************************************************************************

switch($tipo_modelo) {
  case "FLW_ATV_S_MAIL":
  case "FOLLOWUP_ATV":
  case "FOLLOWUP":
?>

        <tr>
          <td align="center">
<?
require_once($_SERVER["DOCUMENT_ROOT"]."/libs/func/FollowUp.php");
?>
    <input type="hidden" id="anexo_obrigatorio"  name="anexo_obrigatorio" value="<?print $anexo_obrigatorio?>">
    <input type="hidden" name="prp_seq" value="<?print $prp_seq?>">
    <input type="hidden" name="prp_midia" value="<?print $prp_midia?>">
    <input type="hidden" name="tipo_atend_co" value="1" consistencia="sempre" consistencia1="pre" msg="Clique em um tipo de conclusão para o atendimento." tipo="hidden">
    <input type="hidden" name="salv_agenda" value="S">
    <input type="hidden" name="flw_user_nivel_acesso" value="<?print $flw_user_nivel_acesso?>">
  </table>
<?
// ----- INCLUDE DE TODO O ESQUEMA DO FORMULÁRIO -----
include $prg_include_dados;
// ---------------------------------------------------
?>
  <br>
<?

$utilizaRechamado      = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "UTILIZA_RECHAMADO", $repre_flw));
$utilizaReincidencia   = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "UTILIZA_REINCIDENCIA", $repre_flw));
$utilizaConclusaoFLW   = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "UTILIZA_CONCLUSAO", $repre_flw));

$podeAbrirRechamado    = (((empty($utilizaRechamado) === FALSE) && ($utilizaRechamado != '--') && ($utilizaRechamado != 'N')) && ((preg_match("/^(BF|OI)$/", $nro_modelo) != 1) || ((preg_match("/^(BF|OI)$/", $nro_modelo) == 1) && (preg_match("/\bRH\b/", $flw_user_permissoes) == 1))));
$podeAbrirReincidencia = (((empty($utilizaReincidencia) === FALSE) && ($utilizaReincidencia != '--') && ($utilizaReincidencia != 'N')) && (preg_match("/\bRX\b/", $flw_user_permissoes) == 1));

if(!$flw_opcao_click_final) {
  $flw_opcao_click_final = "mostra";
}



$registra_n_contato = trim(ValorClasse("MD".$nro_modelo."L", "REGISTRA_N_CONTATO", $repre_flw));

if($atv_st_venda_cartao == "3" && $registra_n_contato != "--") {
  $mostra_reg_lig = "R";
  $mostra_reg_lig_texto_botao = $registra_n_contato;
  $flw_opcao_click_final = "mostra_n_contato";
} elseif ($registra_n_contato != "--") {
  $mostra_reg_lig = "R";
  $mostra_reg_lig_texto_botao = $registra_n_contato;
}

if ($utilizaConclusaoFLW != "S" && ((substr($botao_finaliza_cliente, 0, 1) == "A") || ($mostra_reg_lig == "R") || ($podeAbrirRechamado === TRUE))) {
  if((($mostra_reg_lig == "R") || ($podeAbrirRechamado === TRUE)) && (!$flw_opcao_click_final)) {
    $flw_opcao_click_final = "mostra";
  }
?>
  <input type="hidden" name="flw_gerou_ocorrencia" id="id_flw_gerou_ocorrencia" value="">

  <script type="text/javascript">
  function flwBotaoFinalRegAtd() {
    mostraEscondeFinalFlw('envia');
  }

  function flwBotaoFinalOcorrencia() {
    mostraEscondeFinalFlw('mostra');
  }

  function mostraEscondeFinalFlw(tipo) {
    switch(tipo) {
      case "esconde":
      $("#id_follow_atendimento").hide();
      $("#id_bt_enviar").hide();
      $("#id_flw_opcao_click_final").val(tipo);
      break;

      case "mostra":
      case "mostra_n_contato":
      $("#id_follow_atendimento").show();
      $("#id_bt_enviar").show();
      $("#id_flw_opcao_click_final").val(tipo);
      break;

      case "envia":
      <?
      if ($arr_campos_volta["cliente"] && $arr_campos_volta["cliente"] == "N") {
        $flw_st_venda_cartao_fixo = "0";
      } else {
        $flw_st_venda_cartao_fixo = "1";
      }
      ?>

      if (confereRegAtd(document.cadastro)) {
        $("#id_flw_opcao_click_final").val('');
        $("#id_flw_gerou_ocorrencia").val('N');
        document.cadastro.atv_st_venda_cartao.value = '<?print $flw_st_venda_cartao_fixo;?>';
        document.cadastro.setAttribute('action','md_cad_prop_conf.php');
        if (confereMK(document.cadastro)) {
          document.cadastro.submit();
        }
      }
      break;
    }
  }
  </script>
  <div align="center" id="id_flw_btn_final">
    <?
    if(!$pesqRechamado) {
      $trazClickRechamadoDefault = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "UTILIZA_RECHAMADO_DEFAULT", $repre_flw));
      if($trazClickRechamadoDefault == "S") {
        $pesqRechamado = "S";
      } else {
        $pesqRechamado = "N";
      }
    }
    if((substr($botao_finaliza_cliente, 0, 1) == "A") && $atv_st_venda_cartao != "3") {
    ?>
      <input type="button" name="btn_final_reg_atd"     id="btn_final_reg_atd"    value="Registro de Atendimento" <?if($usa_bootstrap == "S"){?> class="btn btn-primary" <?}else{?> style="width: 150px; background: #CCCCFF; cursor: pointer;" <?}?> onClick="javascript: flwBotaoFinalRegAtd();">&nbsp;&nbsp;&nbsp;
    <?
    }
    if($atv_st_venda_cartao != "3") {
    ?>

      <input type="button" name="btn_final_ocorrencia"  id="btn_final_ocorrencia" value="<?if($nro_modelo == "Y4"){?>Registro Completo<?}else{?>Abrir <?print $desc_pedido;?><?}?>" <?if($usa_bootstrap == "S"){?> class="btn btn-primary <?if(!($flw_opcao_click_final == "mostra" && $pesqRechamado != "S" && $pesqRechamado != "J")){?>bg-silver-darker<?}?>" <?}else{?>   style="width: 150px; font-weight: bold; color: white; background: <?if($flw_opcao_click_final == "mostra" && $pesqRechamado != "S" && $pesqRechamado != "J"){?>darkgreen<?}else{?>green<?}?>; cursor: pointer;" <?}?> onClick="javascript: if($('#flw_tema_pai')[0]){$('#flw_tema_pai').val('');} if($('#flw_tema')[0]){$('#flw_tema').val('');} flwBotaoFinalOcorrencia();<?if($podeAbrirRechamado === TRUE) {?> $('#pesqRechamado').val('N'); $('#flagSelRechamado').val(''); $('#ativNumRechamado').val(''); $('#npedidoRechamado').val(''); atualizaMK();<?}?><?if($mostra_reg_lig == "R") {?> atualizaMK();<?}?>">&nbsp;&nbsp;&nbsp;
    <?
    }
    if($mostra_reg_lig == "R") {
    ?>
      <input type="button" name="btn_final_n_contato"  id="btn_final_n_contato" value="<?print $mostra_reg_lig_texto_botao;?>" <?if($usa_bootstrap == "S"){?> class="btn btn-warning" <?}else{?>  style="width: 150px;  font-weight: bold;color: white; background: <?if($flw_opcao_click_final == "mostra_n_contato" && $pesqRechamado != "S" && $pesqRechamado != "J"){?>darkorange<?}else{?>orange<?}?>; cursor: pointer;" <?}?> onClick="javascript: if($('#flw_tema_pai')[0]){$('#flw_tema_pai').val('');} if($('#flw_tema')[0]){$('#flw_tema').val('');} mostraEscondeFinalFlw('mostra_n_contato');<?if($podeAbrirRechamado === TRUE) {?> $('#pesqRechamado').val('N'); $('#flagSelRechamado').val(''); $('#ativNumRechamado').val(''); $('#npedidoRechamado').val('');<?}?> atualizaMK();">&nbsp;&nbsp;&nbsp;
    <?
    }
    if (($podeAbrirRechamado === TRUE) && $atv_st_venda_cartao != "3") {
      $titRechamado = ValorClasse("FM".$nro_modelo."P", "RH", $repre_flw);
		?>
      <input type="button" name="btn_final_rechamado"   id="btn_final_rechamado"  value="<?print $titRechamado?>"                                                                   <?if($usa_bootstrap == "S"){?> class="btn btn-primary <?if(!($flw_opcao_click_final == "mostra" && $pesqRechamado == "S")){?>bg-silver-darker<?}?>" <?}else{?> style="width: 150px; font-weight: bold; background: <?if($flw_opcao_click_final == "mostra" && $pesqRechamado == "S"){?>#8181F7<?}else{?>#CCCCFF<?}?>; cursor: pointer;" <?}?> onClick="javascript: flwBotaoFinalOcorrencia(); $('#pesqRechamado').val('S'); $('#tbRechamado').css('display', 'block'); if($('#flagSelRechamado').checked == true){$('#ativNumRechamado').attr('consistir','sempre');}else{$('#ativNumRechamado').attr('consistir','sopreenchido');} atualizaMK();">&nbsp;&nbsp;&nbsp;
    <?
    }
    if($podeAbrirReincidencia === TRUE) {
      $descReincidencia = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."P", "RX", $repre_flw));
    ?>
      <input type="button" name="btn_final_reincidencia"   id="btn_final_reincidencia"  value="<?print $descReincidencia?>"                                                         <?if($usa_bootstrap == "S"){?> class="btn btn-primary <?if(!($flw_opcao_click_final == "mostra" && $pesqRechamado == "J")){?>bg-silver-darker<?}?>" <?}else{?> style="width: 150px; font-weight: bold; background: <?if($flw_opcao_click_final == "mostra" && $pesqRechamado == "J"){?>#8181F7<?}else{?>#CCCCFF<?}?>; cursor: pointer;" <?}?> onClick="javascript: flwBotaoFinalOcorrencia(); $('#pesqRechamado').val('J'); $('#tbRechamado').css('display', 'block'); if($('#flagSelRechamado').checked == true){$('#ativNumRechamado').attr('consistir','sempre');}else{$('#ativNumRechamado').attr('consistir','sopreenchido');} $('#ativNumRechamado').val(''); $('#npedidoRechamado').val(''); atualizaMK();">
    <?
    }
    ?>
  </div>
<?
}
?>
<input type="hidden" name="flw_opcao_click_final" id="id_flw_opcao_click_final"  value="<?print $flw_opcao_click_final;?>">
<input type="hidden" name="mostra_reg_lig" id="mostra_reg_lig"  value="<?print $mostra_reg_lig;?>">
<input type="hidden" name="classe_reg_lig" id="classe_reg_lig"  value="<?print $classe_reg_lig;?>">
<br>
<div class="container">
<?
if($utilizaConclusaoFLW == "S") {
  if(strtoupper($usa_bootstrap) == "S") {
?>
    <script language="javascript">

    /*
    function conclusaoBootstrap(st_venda){
    if(document.getElementById('tipo_atend_'+st_venda).disabled == false){
    $("#tipo_atend_"+st_venda).attr("checked", true);
    $("#tipo_atend_"+st_venda).click();
    }
    }

    $("#li_md_1").removeClass("active");$("#Aba1").removeClass("in active");  $("#teste1bs").prop("aria-expanded", false);
    $("#li_md_2").removeClass("active");$("#Aba2").removeClass("in active");  $("#teste2bs").prop("aria-expanded", false);
    $("#li_md_3").removeClass("active");$("#Aba3").removeClass("in active");  $("#teste3bs").prop("aria-expanded", false);
    $("#li_md_4").removeClass("active");$("#Aba4").removeClass("in active");  $("#teste4bs").prop("aria-expanded", false);

    <?if($flw_opcao_click_final == "mostra") {?>
    $("#li_md_1").addClass("active"); $("#teste1bs").prop("aria-expanded", true);$("#Aba1").addClass("in active");
    <?}?>

    <?if($flw_opcao_click_final == "mostra_n_contato") {?>
    $("#li_md_2").addClass("active"); $("#teste2bs").prop("aria-expanded", true);$("#Aba2").addClass("in active");
    <?}?>

    if(conclusao == "3") { $("#li_md_3").addClass("active"); $("#teste3bs").prop("aria-expanded", true);$("#Aba3").addClass("in active");}
    if(conclusao == "4") { $("#li_md_4").addClass("active"); $("#teste4bs").prop("aria-expanded", true);$("#Aba4").addClass("in active");}
    */
    </script>
<?
  }
?>
  <div class="row" style="background:#CFCFCF; margin-right:0px !important; margin-left:0px !important;">
    <div class="col-md-4 text-center pad-top5">
      <a name="dados_conclu"></a><a name="dados_con"></a>
      <i class='icon20 i-pencil-3' title='<?print $arr_conclusao[0]?>'> <?print $arr_conclusao[0]?>:</i>
    </div>
    <div id="idDivConclusao" class="col-md-8 text-center">
       <ul id="myTab" class="nav nav-tabs">
         <?if($arr_conclusao[1]){?>
            <li id='li_md_1' class="<?if($flw_opcao_click_final == "mostra" && $pesqRechamado != "S"){?>active<?}?>"><a href="#Aba1" data-toggle="tab"  onClick="javascript: if($('#flw_tema_pai')[0]){$('#flw_tema_pai').val('');} if($('#flw_tema')[0]){$('#flw_tema').val('');} $('#id_flw_opcao_click_final').val('mostra'); <?if($podeAbrirRechamado === TRUE) {?> $('#pesqRechamado').val('N'); $('#flagSelRechamado').val(''); $('#ativNumRechamado').val(''); $('#npedidoRechamado').val(''); atualizaMK();<?}else{?> atualizaMK();<?}?>"><i class="i-thumbs-up green" id='teste1bs'></i><?print $arr_conclusao[1]?></a></li>
         <?}?>
         <?if($arr_conclusao[2]){?>
            <li id='li_md_2' class="<?if($flw_opcao_click_final == "mostra_n_contato"){?>active<?}?>"><a id="idAba2" href="#Aba2" data-toggle="tab" onClick="javascript: if($('#flw_tema_pai')[0]){$('#flw_tema_pai').val('');} if($('#flw_tema')[0]){$('#flw_tema').val('');} $('#id_flw_opcao_click_final').val('mostra_n_contato'); <?if($podeAbrirRechamado === TRUE) {?> $('#pesqRechamado').val('N'); $('#flagSelRechamado').val(''); $('#ativNumRechamado').val(''); $('#npedidoRechamado').val(''); atualizaMK();<?}else{?> atualizaMK();<?}?>"><i class="i-thumbs-down red" id='teste2bs'></i><?print $arr_conclusao[2]?></a></li>
         <?}?>
         <?
         if ($podeAbrirRechamado === TRUE) {
           $titRechamado = ValorClasse("FM".$nro_modelo."P", "RH", $repre_flw);
         ?>
            <li id='li_md_3' class="<?if($flw_opcao_click_final == "mostra" && $pesqRechamado == "S"){?>active<?}?>"><a href="#Aba3" data-toggle="tab" onClick="javascript: $('#id_flw_opcao_click_final').val('mostra'); $('#pesqRechamado').val('S'); $('#tbRechamado').css('display', 'block'); if($('#flagSelRechamado').checked == true){$('#ativNumRechamado').attr('consistir','sempre');}else{$('#ativNumRechamado').attr('consistir','sopreenchido');} atualizaMK();"><i class="i-contact-remove-2 orange" id='teste3bs'></i><?print $titRechamado?></a></li>
         <?
         }
         ?>
       </ul>
    </div>
  </div>
<?
}

// Temporário - Criar parâmetro
$nao_foca = array('YB', 'OP', 'WJ', 'FX', 'OR', 'KA', 'XH', 'CQ', 'L4');

if($usa_bootstrap == "S" && !in_array($nro_modelo, $nao_foca)) {
?>
<script type="text/javascript">
$(document).ready(function() {
  $("#idAncora").focus();
});
</script>
<?
}
?>
<input type="hidden" name="pesqRechamado" id="pesqRechamado" value="<?print $pesqRechamado?>">
<?
if(($podeAbrirRechamado === TRUE || $podeAbrirReincidencia === TRUE) && ($flw_opcao_click_final == "mostra" && ($pesqRechamado == "S" || $pesqRechamado == "J"))) {
  require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/CalcNunDias.php");
  $arr_campos_historico = explode("§",ValorClasse("MD".$nro_modelo."B","CAMPOS_HISTORICO","URANET"));
  if(is_array($arr_campos_historico) === true) {
    foreach($arr_campos_historico as $key=>$valor) {
      if (!$campo_consulta) {
        $campo_consulta = $valor;
      }
      $arr_aux_campos_historico= explode("¢", $valor);
      $desc_campo  = $arr_aux_campos_historico[0];
      $nome_campo  = $arr_aux_campos_historico[1];
      $like        = $arr_aux_campos_historico[2];

      if ($campo_consulta == $valor) {
        $select = 'selected';
      } else {
        $select = '';
      }
      if ($valor != " -- " && $valor != "" ) {
        $option_combo .= "<option value='".$valor."' ".$select." >".$desc_campo."</option>";
      }
    }
  }
  if(!$valor_consulta && strpos("**".$campo_consulta, "cpf") > 0) {
    $valor_consulta = $cpf_cnpj;
  }
?>
  <input type="hidden" name="flagSelRechamado" id="flagSelRechamado" value="<?print $flagSelRechamado?>">
  <input type="hidden" name="npedidoRechamado" id="npedidoRechamado" value="<?print $npedidoRechamado?>">
  <input type="hidden" name="ativNumRechamado" id="ativNumRechamado" value="<?print $ativNumRechamado?>" consistir="sopreenchido" tipodado="todos" msg="Selecione um <?print $desc_pedido?>!">
<?
if(!$sacura_prioridade && ($pesqRechamado == "S" || $pesqRechamado == "J")) {
?>
    <input type="hidden" name="sacura_prioridade" id="sacura_prioridade" value="<?print $sacura_prioridade?>">
<?}?>
  <table <?if($usa_bootstrap == "S"){?> class="table table-bordered" <?}else{?> width="650" align="center" border="0" style='border-collapse: collapse;' cellspacing="0" cellpadding="2" <?}?>>
    <tr>
      <td align="center" colspan="2">
        <table id="tbRechamado" <?if($usa_bootstrap == "S"){?> class="table table-bordered" <?}else{?> bgcolor="<?print $session["td_dado3"]?>" width="100%" align="center" border="1" style='border-collapse: collapse; display: <?if($pesqRechamado == "S" || $pesqRechamado == "J"){?>block<?}else{?>none<?}?>;' cellspacing="0" cellpadding="2" <?}?>>
          <thead>
            <tr <?if($usa_bootstrap != "S"){?> class="txt6" <?}?>>
              <td <?if($usa_bootstrap == "S"){?> class="text-left" <?}else{?> align="left" bgcolor="<?print $session["td_destaque"]?>" <?}?> colspan="2">
                <label for="flagSelRechamado"><b><?($pesqRechamado == "S"? print $titRechamado : print $descReincidencia)?></b></label>
              </td>
            </tr>
          </thead>
          <tr>
             <td align="left"><font class='txt5'><b>
                <select name="campo_consulta" id="campo_consulta" onchange="if ($('#campo_consulta').val().indexOf('cpf') > 0) {$('#valor_consulta').attr('maxlength', '18'); document.getElementById('valor_consulta').value = montaMascara('##############', document.getElementById('valor_consulta').value); DescLengthCPFCNPJ(document.getElementById('valor_consulta'), document.getElementById('tamCpfCnpj'));} else { $('#valor_consulta').attr('maxlength', '100');  $('#tamCpfCnpj').html('');}">
                  <?print $option_combo;?>
                </select>:
                <input type="hidden" name="escolha_tipo" value="<?print $escolha_tipo?>">
                <input type="text"   name="valor_consulta" id="valor_consulta" value="<?print $valor_consulta?>" consistencia="sopreenchido" consistencia1="todos" msg="Preencha corretamente o campo de consulta" onkeyup="if ($('#campo_consulta').val().indexOf('cpf') > 0) {this.value = montaMascara('##############', this.value); DescLengthCPFCNPJ(this, document.getElementById('tamCpfCnpj'));}" maxlength="100" maxlength="1">
                <span id="tamCpfCnpj" class="txt5" style="padding-left: 3px; width: 27px; border: none; background: none; color: #DD0000;"></span>
                <?
                if (strpos("**".$campo_consulta, "cpf") > 0) {
                ?>
                  <script>
                  javascript: document.getElementById('valor_consulta').value=montaMascara('##############', document.getElementById('valor_consulta').value); DescLengthCPFCNPJ(document.getElementById('valor_consulta'), document.getElementById('tamCpfCnpj'));
                  </script>
                <?
                }
                ?>
                <input type="image" src="imagens/lupa_transparente.gif" width="14" value="OK" onclick="if($('#valor_consulta').val() == ''){alert('Preencha a pesquisa Corretamente!'); $('#valor_consulta').focus(); return false;} $('#ativNumRechamado').val(''); $('#npedidoRechamado').val(''); $('#pesqRechamado').val('S'); atualizaMK();">
                <?
                require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/DateTime.php");
                $qtdDiasRechamado     = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "QTD_DIAS_RECHAMADO", $repre_flw));
                //$data_limit_rechamado = CalculaDiasUteis(date("Y-m-d"),$repre_flw,($qtdDiasRechamado+30)*-1);//REMOVENDO OS 30 DIAS
                $data_limit_rechamado = CalculaDiasUteis(date("Y-m-d"),$repre_flw,($qtdDiasRechamado)*-1);
                if($pesqRechamado == "S") {
                ?>
                  &nbsp;&nbsp;<font class='txt5azul'>*Somente <?print $titRechamado?> Atualizado a partir de <?print BrDate($data_limit_rechamado)?> (<?print ($qtdDiasRechamado)?> Dias Úteis)</font>
                <?
                }
                ?>
             </td>
          </tr>
          <tr>
            <td align="center">
              <table <?if($usa_bootstrap == "S"){?> class="table table-bordered" <?}else{?> bgcolor="<?print $session["td_dado3"]?>" width="100%" align="center" border="1" style='border-collapse: collapse' cellspacing="0" cellpadding="2" <?}?>>
                <thead>
                  <tr <?if($usa_bootstrap != "S"){?> bgcolor="<?print $session["td_destaque"]?>" class="txt6" <?}?>>
                    <td align="center"><b></b></td>
                    <? if($nro_modelo == "6I"){?>
                        <td align="center"><b>Etapa do Processo</b></td>
                        <td align="center"><b>Protocolo BV</b></td>
                    <? } else {?>
                        <td align="center"><b><?print $desc_pedido;?></b></td>
                        <td align="center"><b>Ocorrência</b></td>
                    <? }?>
                    <td align="center"><b>Registro </b></td>
                    <? if($nro_modelo != "6I"){?>
                        <td align="center"><b>Situação</b></td>
                    <? } ?>
                    <td align="center"><b><?print $titTema_pai;?></b></td>
                    <td align="center"><b><?print $titTema;?></b></td>
                    <td align="center"><b><?print $titResponsavel;?></b></td>
                  </tr>
                </thead>
                <tbody>
                <?
                if($pesqRechamado == "S" || $pesqRechamado == "J") {
                  if(!$campo_consulta) {
                    $campo_consulta = "xxxx";
                  }
                  if(!$valor_consulta ) {
                    $valor_consulta = "xxxx";
                  }
                  $arr_aux_campos_historico= explode("¢", $campo_consulta);
                  $desc_campo_rechamado  = $arr_aux_campos_historico[0];
                  $nome_campo_rechamado  = $arr_aux_campos_historico[1];
                  $like_rechamado        = $arr_aux_campos_historico[2];
                  if($like_rechamado == "igual" || !$like_rechamado) {
                    $comparado_rechamado = " = "."'".$valor_consulta."'";
                  } else {
                    $comparado_rechamado = " like "."'%".$valor_consulta."%'";
                  }

                  if(!$param_tabela_proposta) {
                    $param_tabela_proposta = ValorClasse("MD".achaNroModelo($nro_modelo,$tipo_abertura)."A", "TABELA_PROPOSTA", $repre_flw);
                  }

                  $where_rechamado   = " AND ".$nome_campo_rechamado.$comparado_rechamado;
                  if($pesqRechamado == "S") {
                    $where_rechamado  .= " AND ((rechamado_destino = 'S' AND data_cri <> ativ_data_vecto) OR (rechamado_destino = 'N')) ";
                    $where_rechamado  .= " AND ((data_atualiza > '".$data_limit_rechamado."' AND status = 'F') OR (status IN ('P','A'))) ";
                  }

                  $q_rechamado       = "SELECT * FROM ".$param_tabela_proposta." WHERE mk_flag = 'MD' AND mk_numero = '".$nro_modelo."' AND grupo_acesso = '1' ".$where_rechamado;
                  $query_rechamado   = DescExecQuery($q_rechamado, $connectHOST);
                  if($rec_rechamado  = mysql_fetch_assoc($query_rechamado)) {

                    do{
                      $arrKeyQuery[$rec_rechamado["ativ_num"]] = $rec_rechamado;
                      $mtzRechamado[$rec_rechamado["ativ_num"]]["tema_pai"] = $rec_rechamado["tema_pai"];
                      $mtzRechamado[$rec_rechamado["ativ_num"]]["tema"    ] = $rec_rechamado["tema"];
                      $mtzRechamado[$rec_rechamado["ativ_num"]]["status"  ] = $rec_rechamado["status"];
                      $programa = "javascript: AbreJanela2('flw_pendencias_2.php?tipo_popup=AJ&ficha_hist=S&mostra_ficha_cliente=HISTMK&repre=".$repre_flw."&mk_numero=".$rec_rechamado["mk_numero"]."&grupo_acesso=".$rec_rechamado["grupo_acesso"]."&ativ_num=".$rec_rechamado["ativ_num"]."', 'HistCliente', '98%', '90%', 'Histórico do Cliente', 'TC');";
                ?>
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][tema_pai]" value="<?print $mtzRechamado[$rec_rechamado["ativ_num"]]["tema_pai"]?>">
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][tema]"     value="<?print $mtzRechamado[$rec_rechamado["ativ_num"]]["tema"]?>">
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][status]"   value="<?print $mtzRechamado[$rec_rechamado["ativ_num"]]["status"]?>">
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][ativ_num]" value="<?print $rec_rechamado["ativ_num"]?>">
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][n_pedido]" value="<?print $rec_rechamado["n_pedido"]?>">
                      <input type="hidden" name="mtzRechamado[<?print $rec_rechamado["ativ_num"]?>][email]"    value="<?print $rec_rechamado["email"]?>">
                      <tr class="txt5" bgcolor="<?if($rec_rechamado["ativ_num"] == $ativNumRechamado){print $verde_claro;}else{print $amarelo;}?>">
                        <td align="center">
                          <?
                          $qtdDiasProtocoloFinalizado = CalcNunDias(date("Y-m-d", mktime("00","00","00",substr($rec_rechamado["data_atualiza"],5,2), substr($rec_rechamado["data_atualiza"],-2)+1, substr($rec_rechamado["data_atualiza"],0,4))));
                          $qtdDiasAtualRechamado      = CalcNunDias(date("Y-m-d", mktime("00","00","00",substr($data_limit_rechamado,5,2), substr($data_limit_rechamado,-2)+1, substr($data_limit_rechamado,0,4))));

                          if(
                            (($rec_rechamado["status"] != "F" && $rec_rechamado["status"] != "C") || (($rec_rechamado["status"] == "F" || $rec_rechamado["status"] == "C") && ($qtdDiasAtualRechamado>$qtdDiasProtocoloFinalizado))) || // Rechamado
                            ($pesqRechamado == "J") // Reincidencia
                            ) {
                          ?>
                            <input type="radio" name="checkRechamado" id="checkRechamado<?print $rec_rechamado["ativ_num"]?>" style="cursor: pointer;" <?if($ativNumRechamado == $rec_rechamado["ativ_num"]){print "checked";}?> onclick="javascript: $('#ativNumRechamado').val('<?print $rec_rechamado["ativ_num"];?>'); $('#npedidoRechamado').val('<?print $rec_rechamado["n_pedido"];?>'); document.cadastro.sacura_prioridade.value = '<?print $rec_rechamado["sacura_prioridade"];?>'; <?if($pesqRechamado == "S") {?> atualizaMK(); <?}?>">
                          <?
                          }elseif ($rec_rechamado["rechamado_origem"] == "S") {
                            print exibeRiscoRel("N",achaNroModelo($nro_modelo,$tipo_abertura),"MD",$rec_rechamado["ativ_num"], $rec_rechamado["ouv_mk_numero"], $rec_rechamado["ouv_ativ_num"], $rec_rechamado["ouv_grupo_acesso"], $flw_user_nivel_acesso, "", "", $rec_rechamado["rechamado_origem"], $rec_rechamado["rechamado_destino"], $rec_rechamado["rechamado_origem_ativ_num"], DefineRepre($repre));//EXIBERECHAMADO
                          }
                          ?>
                        </td>
                        <? if($nro_modelo == "6I") {?>
                            <td align="left"   onclick="<?print $programa;?>" style="cursor: pointer;">
                            <? if($rec_rechamado["classifica_codigo"] == ""){
                              print ValorClasse("FM".$nro_modelo."Q", "classifica_codigo", $repre_flw, true);
                            } else {
                              print ValorClasse($rec_rechamado["classifica_classe"], $rec_rechamado["classifica_codigo"], $repre_flw, true);
                            }
                            ?>
                            </td>
                            <td align="right"  onclick="<?print $programa;?>" style="cursor: pointer;"><?print $rec_rechamado["campo_extra_6"];?></td>
                        <? } else {?>
                            <td align="right"  onclick="<?print $programa;?>" style="cursor: pointer;"><?print $rec_rechamado["n_pedido"];?></td>
                            <td align="right"  onclick="<?print $programa;?>" style="cursor: pointer;"><?print $rec_rechamado["ativ_num"];?></td>
                        <? }?>
                        <td align="center" onclick="<?print $programa;?>" style="cursor: pointer;"><?print BRDate($rec_rechamado["data_cri"]);?></td>
                        <? if($nro_modelo != "6I"){?>
                            <td align="left"   onclick="<?print $programa;?>" style="cursor: pointer;"><?print ValorClassePrint("FM".$nro_modelo."S", $rec_rechamado["status"], $repre_flw, true);?></td>
                        <? }?>
                        <td align="left"   onclick="<?print $programa;?>" style="cursor: pointer;"><?print ValorClasse("FM".$nro_modelo."T", $rec_rechamado["tema_pai"], $repre_flw, true);?></td>
                        <td align="left"   onclick="<?print $programa;?>" style="cursor: pointer;"><?print ValorClasse($rec_rechamado["tema_pai"], $rec_rechamado["tema"], $repre_flw, true);?></td>
                        <td align="left"   onclick="<?print $programa;?>" style="cursor: pointer;"><?print NomeResumido($rec_rechamado["pend_login_operador"])." (".ValorClasse("FM".$nro_modelo."N", $rec_rechamado["pend_nivel_acesso"], $repre_flw, true).")";?></td>
                      </tr>
                <?
                    } while ($rec_rechamado = mysql_fetch_assoc($query_rechamado));
                    if(is_array($arrKeyQuery[$ativNumRechamado])){
                      foreach ($arrKeyQuery[$ativNumRechamado] as $camposTb => $vlrCamposTb ){
                        ${"FLWEXTRA".$arrKeyQuery[$ativNumRechamado]["tema_pai"].$arrKeyQuery[$ativNumRechamado]["tema"]."_".$camposTb} = $vlrCamposTb;
                        ${"FLWEXTRAPAI".$arrKeyQuery[$ativNumRechamado]["tema_pai"]."_".$camposTb} = $vlrCamposTb;
                      }
                    }
                  } else {
                ?>
                    <tr class="txt5">
                      <td align="center" colspan="8"><font class="txtvermelho2">Nenhum <?print $desc_pedido;?> Encontrado!</font></td>
                    </tr>
                <?
                  }
                }
                ?>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <br>
<?
}

?>
  <a name="Tema"></a>

  <table id="id_follow_atendimento" <?if($usa_bootstrap == "S") {?> class="table table-bordered" <?} else {?> bgcolor="<?print $amarelo?>" width="650" align="center" border="1" style='border-collapse: collapse;<?if($usa_bootstrap == "S") {?>background: white;<?}?>' cellspacing="0" cellpadding="2" <?}?>>
<?

if ($mkFlwParam["grava_solicitante"] == "S") {
    if (
    (empty($solicitante_nome) === true)
    && (empty($solicitante_relacionamento) === true)
    && (empty($solicitante_ddd) === true)
    && (empty($solicitante_num_tel) === true)
    && (empty($solicitante_email) === true)
    ) {
      $solicitante_nome = $arr_campos_volta['solicitante_nome'];
      $solicitante_relacionamento = $arr_campos_volta['solicitante_relacionamento'];
      $solicitante_ddd = $arr_campos_volta['solicitante_ddd'];
      $solicitante_num_tel = $arr_campos_volta['solicitante_num_tel'];
      $solicitante_email  = $arr_campos_volta['solicitante_email'];
    }

    $solicitante_nome = htmlspecialchars($solicitante_nome);
    $solicitante_email_ctr = ((empty($solicitante_email_ctr) === true) ? "S" : $solicitante_email_ctr);
    $solicitante_celular_ctr = ((empty($solicitante_celular_ctr) === true) ? "S" : $solicitante_celular_ctr);

  ?>
      <tr bgcolor="<?print $session["td_destaque"]?>" id="id_solic_tit">
        <td align="center" colspan="2"><font class="txt6"><strong>Solicitante</strong></font></td>
      </tr>

      <tr id="id_solic_nome">
        <td class="txt5"><strong>Nome:</strong></td>
        <td class="txt5">
          <input type="text" name="solicitante_nome" id="solicitante_nome" value="<?= $solicitante_nome;?>" size="50" maxlength="60" minlength="3" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o nome do solicitante.">
          <input type="hidden" name="solicitante_relacionamento" id="solicitante_relacionamento" value="<?= $solicitante_relacionamento;?>">
          <input type="button" id="flwBtnCpSolNome" value="O Mesmo">
          <?
          if ($mkFlwParam['grava_solicitante_tipo'] != 'DK') {
          ?>
          <strong>Telefone:</strong>
          <input type="text" name="solicitante_ddd" id="solicitante_ddd" value="<?print $solicitante_ddd;?>" size="2" maxlength="2" minlength="2" consistir="sempre" tipodado="ddd" msg="Preencha corretamente o DDD do telefone do solicitante." onkeyup="javascript:pula(this, this.maxLength, document.cadastro.solicitante_num_tel);">
          <input type="text" name="solicitante_num_tel" id="solicitante_num_tel" value="<?print $solicitante_num_tel;?>" size="10" maxlength="9" minlength="7" consistir="sempre" tipodado="telefone" msg="Preencha corretamente o telefone do solicitante.">
          <?
            if (($session["marca_ponto"] == "S") && ($mk_origem_atd != "H")) {
          ?>
          <input type="button" id="flwBtnCpBINA" value="BINA">
          <?
            }
          }
          ?>
        </td>
      </tr>
      <?

      if ($mkFlwParam['grava_solicitante_tipo'] == 'DK') {
        //QUANDO ESTE PARAMETRO ESTÁ ATIVO EXIBIMOS 03 CAMPOS DE TELEFONE DISPONÍVEIS PARA PREENCHIMENTO
        //DESTES APENAS O PRIMEIRO É DE PRENCHIMENTO OBRIGATÓRIO (OPÇÃO 1)
        ?>
      <tr id="id_solic_nome">
        <td class="txt5">
          <strong>Telefone:</strong>
        </td>
        <td class="txt5">
          <div class="padding-5px" style="position:relative; float:left; background-colorx:#80b3ff; width:65%;">
          <?
          for ($maxTel = 3, $i=1, $x=0, $celSolicitantePreenchido = false, $telSolicitantePreenchido = false; $i <= $maxTel; $i++, $x++) {
            //DEFININDO OS VALORES DO CAMPO
            //DDD e TELEFONE
  //          if ($i == 1) {
  //            $strOnKeyUpOpc1 = 'javascript:document.cadastro.solicitante_ddd.value=document.cadastro.ddd_1.value; document.cadastro.solicitante_num_tel.value=document.cadastro.fone_1.value;';
  //          } else {
  //            unset($strOnKeyUpOpc1);
  //          }

            $tmpDDD = $_POST["ddd_{$i}"];
            $tmpFone = $_POST["fone_{$i}"];
            $tmpConsistir = 'sopreenchido';

            switch ($i) {
              case 1:
                $tipoDadoFone = 'celular';
                $celSolicitantePreenchido = ((empty($tmpDDD) === false) && (empty($tmpFone) === false));

                $flagFoneSolicDisabled = (($solicitante_celular_ctr == 'N') ? 'disabled' : '');

                for ($z = 2; $z <= $maxTel; $z++) {
                  if ($telSolicitantePreenchido === true) {
                    break;
                  }
                  $telSolicitantePreenchido = ((empty($_POST["ddd_{$z}"]) === false) && (empty($_POST["fone_{$z}"]) === false));
                }
                break;

              default:
                $tipoDadoFone = 'telefone';

                $flagFoneSolicDisabled = ((($solicitante_celular_ctr == 'N') || ($celSolicitantePreenchido === true) || ($telSolicitantePreenchido === true)) ? '' : 'disabled');
                break;
            }
            unset($strOnKeyUpOpc1);

            ?>
              <div style="position:relative; background-colorx:#99ebff; height:18px; width:25%; float:left;">
                <strong>
                  <?print $arr_desc_tel[$x]?>:
                </strong>
              </div>
              <div style="position:relative; background-colorx:#ccccff; width:70%; float:left;">
                <input type="text" tipofone="<?=$tipoDadoFone?>" name="ddd_<?print $i?>" id="id_ddd_<?print $i?>" value="<?print $tmpDDD;?>" size="2" maxlength="2" minlength="2" consistir="<?print $tmpConsistir?>" tipodado="ddd" msg="Preencha corretamente o DDD do telefone '<?print $arr_desc_tel[$x]?>'." <?=$flagFoneSolicDisabled?>>
                <input type="text" tipofone="<?=$tipoDadoFone?>" name="fone_<?print $i?>" id="id_fone_<?print $i?>" value="<?print $tmpFone;?>" size="10" maxlength="9" minlength="7" consistir="<?print $tmpConsistir?>" tipodado="<?print $tipoDadoFone?>" msg="Preencha corretamente o telefone '<?print $arr_desc_tel[$x]?>'." <?=$flagFoneSolicDisabled?>>
                <input type="hidden" name="fone_<?print $i?>_completo" id="id_fone_<?print $i?>_completo" value="<?print $tmpDDD.$tmpFone;?>" consistir="sopreenchido" tipodado="ddd_telefone" msg="Preencha corretamente o telefone completo '<?print $arr_desc_tel[$x]?>'. (ddd + número)">
                <?
                if ($tipoDadoFone == 'celular') {
                ?>
                  <input type="hidden" name="solicitante_celular_ctr" id="id_solicitante_celular_ctr" value="<?=$solicitante_celular_ctr?>" style="width:25px;">
                  <input type="button" name="flwbtnativdescel" id="id_flwbtnativdescel" value="<?=(($solicitante_celular_ctr == 'S')? 'Não possui celular' : 'Possui celular')?>" style="background-color:<?=$verde_claro?>; width:120px;">
                  <script type="text/javascript">
                  //FUNÇÃO RESPONSÁVEL POR HABILITAR OS DEMAIS FONES DE CONTATO COM O SOLICITANTE ASSIM QUE O CELULAR ESTIVER PREENCHIDO
                  $("input[tipofone='celular']").bind('keyup', function(event) {
                    if (event.isDefaultPrevented() == true) {
                      return false;
                    }

                    //UTILIZANDO FUNÇÃO "PULA" NO DDD
                    if ($(this).attr('id') == 'id_ddd_<?print $i?>') {
                      if ($("#id_ddd_<?print $i?>").val().length == $("#id_ddd_<?print $i?>").attr('maxLength')) {
                        $("#id_fone_<?print $i?>").focus();
                      }
                    }

                    //VERIFICANDO SE O DDD E O NÚMERO DE CELULAR ESTÃO COMPLETAMENTE DIGITADOS
                    if (
                      ($("input[tipofone='celular'][name^='ddd_']").val().length == $("input[tipofone='celular'][name^='ddd_']").attr('maxLength'))
                      &&
                      ($("input[tipofone='celular'][name^='fone_']").val().length == $("input[tipofone='celular'][name^='fone_']").attr('maxLength'))
                    ) {
                      if ((consisteCampo($("input[tipofone='celular'][name^='ddd_']")[0])) && (consisteCampo($("input[tipofone='celular'][name^='fone_']")[0]))) {
                        //COMO OS CAMPOS DE DDD+NUMERO DE CELULAR ESTÃO DEVIDAMENTE PREENCHIDOS:
                        //DEVEMOS COMPLETAR O CAMPO "COMPLETO", QUE É ONDE SERÁ FEITA A CONSISTÊNCIA
                        $("#id_fone_<?print $i?>_completo").val($("#id_ddd_<?print $i?>").val() + $("#id_fone_<?print $i?>").val());

                        //DEVEMOS PREENCHER OS CAMPOS DE CONTATO COM O SOLICITANTE
                        $("input[name='solicitante_ddd']").val($("#id_ddd_<?print $i?>").val());
                        $("input[name='solicitante_num_tel']").val($("#id_fone_<?print $i?>").val());

                        //HABILITANDO O PREENCHIMENTO DOS DEMAIS TELEFONES DO SOLICITANTE
                        $("input[tipofone='telefone']").attr("disabled", false);
                        $("input[tipofone='telefone']:first").focus();

                      } else {
                        event.preventDefault();
                      }
                    } else {
                      event.preventDefault();
                    }
                  });

                  $("#id_flwbtnativdescel").click(function(event) {
                    if (event.isDefaultPrevented() == true) {
                      return false;
                    }
                    <?
                    /*
                      * @CAMPO: solicitante_email
                      */
                      $emailsms_condicao = VerificaGravaSolicitanteFiltroObrigatorioEmailsms($nro_modelo);
                      if ($emailsms_condicao != "")
                      {
                    ?>
                        if(<?=$emailsms_condicao?>)
                        {
                          var campoEmail =  $("input[name=solicitante_email]", "form[name=cadastro]");
                          if (campoEmail.is(":disabled"))
                          {
                            alert("Não é possível desabilitar o campo CELULAR e E-MAIL juntos.");
                            return false;
                          }
                        }
                  <? } //FIM SU-88698 2/4 ?>
                    //AÇÃO DE ACORDO COM A FLAG DE CONTROLE
                    if ($("#id_solicitante_celular_ctr").val() == 'N') {
                      //NÃO POSSUI -> POSSUI CELULAR
                      $("#id_solicitante_celular_ctr").val('S');
                      $("#id_flwbtnativdescel").val("Não possui celular");
                      $("input[tipofone='celular']")
                      .attr("disabled", false)
                      .css('background-color', '#FFFFFF');
                      $("input[tipofone='celular']:first").focus();

                    } else {
                      //NÃO POSSUI CELULAR -> POSSUI CELULAR
                      $("#id_solicitante_celular_ctr").val('N');
                      $("#id_flwbtnativdescel").val("Possui celular");
                      $("input[tipofone='celular']")
                      .blur()
                      .val('')
                      .attr("disabled", true)
                      .css('background-color', '#CCCCCC');

                      //DESTRAVA OS CAMPOS DE TELEFONE FIXO PARA ALTERAÇÃO
                      $("input[tipofone='telefone']").attr("disabled", false);
                      $("input[tipofone='telefone']:first").focus();
                    }
                    event.preventDefault();
                  });
                  </script>
                <?
                }
                ?>
              </div>
              <div style="clear:both;"></div>
            <?
          }
          ?>
          </div>
          <div class="padding-5px" style="position:relative; float:left; background-colorx:#ff99dd; width:30%; margin-top:10px; text-align:center;">
          <div id="melhor_horario_contatar_cliente">
            <strong>Melhor horário <br />para Contato:</strong>
            <?
            if (is_array($retParamMotivo) === true) {

                foreach ($retParamMotivo as $key => $value) {
                  if(is_array($value)){
                    $hora_contato[] = $value['hora_contato'];
                  }
                }
              }

              //Retirado o count que verificava se a variavel tinha algo, trocado pelo empty ass: Isaac (re030028)
              $hora_contato = ((empty($hora_contato)) ? "" : $hora_contato[0]);

              $hora_con = substr($hora_contato, 0,2);

              $min_con = substr($hora_contato,-5,-3);

              if(!empty($hora_contato) && $hora_contato != "00:00:00"){
              print("<strong>".substr($hora_contato,0,5)."</strong>");
              ?>
              <input type="hidden" name="hora_melhor_horario" value="<?=$hora_con?>">
              <input type="hidden" name="min_melhor_horario" value="<?=$min_con?>">
              <?
            }else{
              ?>
              <div class="box_melhor_horario">
                <select name="hora_melhor_horario" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o melhor horário de contato. (Hora)">
                  <option value=""></option>
                  <?
                  for ($i=9; $i <= 19; $i++) {
                    $tmpHora = str_pad($i, 2, '0', STR_PAD_LEFT);
                    $tmpSelected = ($tmpHora == $_POST['hora_melhor_horario'])? 'SELECTED' : '';
                    ?>
                    <option value="<?=$tmpHora?>" <?=$tmpSelected?>><?=$tmpHora?></option>
                    <?
                  }
                  ?>
                </select>
                <select name="min_melhor_horario" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente o melhor horário de contato. (Minuto)">
                  <option value=""></option>
                  <?
                            //MONTANDO OPTIONS DE MINUTOS: 00, 15, 30 E 45
                  for ($i=0; $i <= 55; $i += 5) {
                    $tmpMinuto = str_pad($i, 2, '0', STR_PAD_LEFT);
                    $tmpSelected = ($tmpMinuto == $_POST['min_melhor_horario'])? 'SELECTED' : '';
                    ?>
                    <option value="<?=$tmpMinuto?>" <?=$tmpSelected?>><?=$tmpMinuto?></option>
                    <?
                  }
                  ?>
                </select>
              </div>
              <?
            }
            ?>
          </div>
          </div>
            <input type="hidden" name="solicitante_ddd" id="solicitante_ddd" value="<?print (empty($_POST['ddd_1']))? $solicitante_ddd : $_POST['ddd_1'];?>">
            <input type="hidden" name="solicitante_num_tel" id="solicitante_num_tel" value="<?print (empty($_POST['fone_1']))? $solicitante_num_tel : $_POST['fone_1'];?>">
          <div style="clear:both;"></div>
        </td>
      </tr>
      <?
      }
      ?>
      <tr id="id_solic_email">
        <td class="txt5">
          <strong>E-mail:</strong>
        </td>
        <td class="txt5">
          <input type="text" name="solicitante_email" id="solicitante_email" value="<?print $solicitante_email;?>" size="50" maxlength="60" consistir="sempre" tipodado="email" msg="Preencha corretamente o e-mail do solicitante." <?
          if ($solicitante_email_ctr == "N") {?> disabled style="background-color:#CCCCCC;"<?}
          ?>>
          <input type="hidden" name="solicitante_email_ctr" id="solicitante_email_ctr" value="<?print $solicitante_email_ctr;?>">
          <input type="button" name="btnflwBtnAtvDesEmail" id="flwBtnAtvDesEmail" value="<?
          if ($solicitante_email_ctr == "S") {?>Não possui e-mail<?} else {?>Possui e-mail<?}
          ?>" style="width:120px;">
        </td>
      </tr>
      <script type="text/javascript">
      $("#solicitante_num_tel").keyup(function() {
        if ($("#solicitante_email").attr('disabled') == false) {
          pula($(this)[0], $(this)[0].maxLength, document.cadastro.solicitante_email);
        }
      });

      $("#flwBtnCpSolNome").click(function() {
        $('#solicitante_nome').val($('#nome_razao').val());
      }).css('background-color', '<?print $verde_claro;?>');

      $("#flwBtnCpBINA").click(function() {
        $('#solicitante_ddd').val($('input[name=bina_cliente]', 'form[name=cadastro]').val().substr(0, 2));
        $('#solicitante_num_tel').val($('input[name=bina_cliente]', 'form[name=cadastro]').val().substr(2));
      }).css('background-color', '<?print $verde_claro;?>');

      $("#solicitante_email").blur(function() {
        $(this).val($(this).val().toLowerCase());
      }).trigger('blur');

      $("input[name=btnflwBtnAtvDesEmail]").click(function(event) {
        if (event.isDefaultPrevented() == true) {
          return false;
        }

          <?
          /*
            * @CAMPO: fone_1
            */
            $emailsms_condicao = VerificaGravaSolicitanteFiltroObrigatorioEmailsms($nro_modelo);
            if ($emailsms_condicao != "")
            {
          ?>
              if(<?=$emailsms_condicao?>) {
                  var campoCelular = $("input[name=fone_1]", "form[name=cadastro]");
                  if(campoCelular.is(":disabled"))
                  {
                    alert("Não é possível desabilitar o campo CELULAR e E-MAIL juntos.");
                    return false;
                  }
              }
        <? } //FIM SU-88698 3/4 ?>
        $solicitante_email = $("input[name=solicitante_email]", "form[name=cadastro]");
        $solicitante_email_ctr = $("input[name=solicitante_email_ctr]", "form[name=cadastro]");
        if ($solicitante_email_ctr.val() == 'N') {
          $solicitante_email_ctr.val('S');
          $solicitante_email.attr("disabled", false).css('background-color', '#FFFFFF').focus();
          $(this).val("Não possui e-mail");

        } else {
          $solicitante_email_ctr.val('N');
          $solicitante_email.blur().attr("disabled", true).css('background-color', '#CCCCCC');
          $(this).val("Possui e-mail");
        }

        event.preventDefault();
      }).css('background-color', '<?print $verde_claro;?>');
      </script>
  <?
}
?>

    <tr <?if($usa_bootstrap != "S"){?> bgcolor="<?print $session["td_destaque"]?>" <?}?>>
      <td align="<?if ($mkFlwParam["grava_solicitante"] == "S") {?>center<?} else {?>left<?}?>" colspan="2"><font <?if($usa_bootstrap!="S"){?> class="txt6" <?}?>><strong><?print $titAtendimento;?></strong></font></td>
    </tr>
<?

if ($arr_conclusao[5]) {
    ?>
        <script type="text/javascript">
        function countOnkeypress(valor, max) {
          max = parseInt(max);
          valor = parseInt(valor);
          if (valor == max) {
            document.getElementById('sizer_desc').innerHTML = "0";
          }
          if (valor < max) {
            document.getElementById('sizer_desc').innerHTML = max - valor;
          }
          if (valor > max) {
            document.getElementById('sizer_desc').innerHTML = '-'+ (valor - max);
          }
          if (valor == 0) {
            document.getElementById('sizer_desc').innerHTML = max;
          }
        }
        </script>
    <?

  if (empty($observacao_receptivo) === true) {
    ?>
        <tr>
          <td><font class="txt5"><strong>Descrição:</strong></font></td>
          <td><font class="txt5">
            <textarea name="flw_descricao" cols="80" rows="3" consistir="sempre" tipodado="<?
            if (achaNroModelo($nro_modelo,$tipo_abertura) == "M4" || (substr($repre,0,9) == "BOLSANOVA" || substr($repre,0,7) == "BOVESPA")) {
              ?>preenchido<?
            } else {
              ?>todosbarra<?
            }
            ?>" minlength="10" msg="Preencha corretamente o campo Descrição." OnKeyUp="javascript:countOnkeypress(this.value.length, '6000');if (this.value.length > 6000) {alert('Tamanho limite do campo atingido, qualquer caracter digitado apartir deste será excluído.');document.getElementById('sizer_desc').innerHTML = '0'; this.value = this.value.substring(0, 6000); this.blur();}"><?print $flw_descricao;?></textarea>
            <span id="sizer_desc" class="txtvermelho3" style="width:25;color:#DD0000;text-align:right;"><?print (6000 - strlen($flw_descricao));?></span>
          </td>
        </tr>
    <?
  } else {
    if ($observacao_receptivo != "N" && $observacao_receptivo_local_flw != "D") {
      $arr_observacao_receptivo = explode("¢",$observacao_receptivo);
      if (empty($arr_observacao_receptivo[0]) === true) {
        $arr_observacao_receptivo[0] = $arr_conclusao[5].":";
      }

      if(!$observacao_receptivo_width) {
        $obs_width = "500";
      } else {
        $obs_width = $observacao_receptivo_width;
      }

      if(!$observacao_receptivo_height) {
        $obs_height = "50";
      } else {
        $obs_height = $observacao_receptivo_height;
      }

      if($arr_observacao_receptivo[1] == "N" || $arr_observacao_receptivo[1] == "" || achaNroModelo($nro_modelo,$tipo_abertura) == "BH") {
        $consiste_obs_recep = "sopreenchido";
      } else {
        $consiste_obs_recep = "sempre";
      }

      if($observacao_rec_especial == "S" || achaNroModelo($nro_modelo,$tipo_abertura) == "M4" || (substr($repre,0,9) == "BOLSANOVA" || substr($repre,0,7) == "BOVESPA")){
        $consiste_obs_tipodado = "preenchido";
      }else{
        $consiste_obs_tipodado = "todosbarra";
      }
    ?>
        <tr>
          <td><font class="txt5"><strong><?print $arr_observacao_receptivo[0];?>:</strong></font></td>
          <td nowrap><font class="txt5">
            <textarea name="flw_descricao" style="white-space: pre-wrap;width: <?print $obs_width?>px; height: <?print $obs_height?>px;" consistir="<?print $consiste_obs_recep;?>" tipodado="<?print $consiste_obs_tipodado;?>" minlength=10 msg="Preencha corretamente o campo <?print $arr_observacao_receptivo[0];?>." OnKeyUp="javascript:countOnkeypress(this.value.length, '<?print $arr_observacao_receptivo[2];?>');if (this.value.length > <?print $arr_observacao_receptivo[2];?>) {alert('Tamanho limite do campo atingido, qualquer caracter digitado apartir deste será excluído.');document.getElementById('sizer_desc').innerHTML = '0'; this.value = this.value.substring(0,<?print $arr_observacao_receptivo[2];?>); this.blur();}"><?print $flw_descricao;?></textarea>
            <span id="sizer_desc" class="txtvermelho3" style="width:25;color:#DD0000;text-align:right;"><?print ($arr_observacao_receptivo[2] - strlen($flw_descricao));?></span>
          </td>
        </tr>
    <?
    }
  }
}

if (empty($filtro_classe_campo_extra) === false) {
  $filtro_classe_flw = $filtro_classe_campo_extra;
} else {
  $filtro_classe_flw = "ZZ";
}

$usa_flw_conclusao_ajax = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","usa_flw_conclusao_ajax",$repre_flw));
if ($usa_flw_conclusao_ajax == "--") {
  unset($usa_flw_conclusao_ajax);
}

if ($nro_modelo == "H2" || $nro_modelo == "BH" || $nro_modelo == "BT" || $nro_modelo == "TR"  || $nro_modelo == "YB" || $nro_modelo == "Y3" || $nro_modelo == "ZU" || $nro_modelo == "5E" || $nro_modelo == "YQ" || $nro_modelo == "SB"|| $nro_modelo == "TU" || $nro_modelo == "4W" || $nro_modelo == "BIx" || $nro_modelo == "SA" || $nro_modelo == "3K" || $nro_modelo == "SO" || $nro_modelo == "B9" || $nro_modelo == "4V") {
  $usa_flw_conclusao_ajax = "S";
}

if ($_SESSION["ambiente"] == "teste" && $nro_modelo == "BF") {
  //if ($_SESSION["ambiente"] == "teste" && ($nro_modelo == "BF" || $nro_modelo == "BI")) {
  $usa_flw_conclusao_ajax = "S";
}



if ($usa_flw_conclusao_ajax == "S") {

  print rotinaFlwHierarquiaAjax($nro_modelo, $repre_flw, $flw_grupo_acesso, $filtro_classe_flw);

  if ($observacao_receptivo != "N" && $observacao_receptivo_local_flw == "D") {
    $arr_observacao_receptivo = explode("¢",$observacao_receptivo);
    if (empty($arr_observacao_receptivo[0]) === true) {
      $arr_observacao_receptivo[0] = $arr_conclusao[5].":";
    }

    if(!$observacao_receptivo_width) {
      $obs_width = "500";
    } else {
      $obs_width = $observacao_receptivo_width;
    }

    if(!$observacao_receptivo_height) {
      $obs_height = "50";
    } else {
      $obs_height = $observacao_receptivo_height;
    }

    if($arr_observacao_receptivo[1] == "N" || $arr_observacao_receptivo[1] == "" || achaNroModelo($nro_modelo,$tipo_abertura) == "BH") {
      $consiste_obs_recep = "sopreenchido";
    } else {
      $consiste_obs_recep = "sempre";
    }

    if($observacao_rec_especial == "S" || achaNroModelo($nro_modelo,$tipo_abertura) == "M4" || achaNroModelo($nro_modelo,$tipo_abertura) == "78" || (substr($repre,0,9) == "BOLSANOVA" || substr($repre,0,7) == "BOVESPA" || achaNroModelo($nro_modelo,$tipo_abertura) == "HS")){
      $consiste_obs_tipodado = "preenchido";
    }else{
      $consiste_obs_tipodado = "todosbarra";
    }
    ?>
    <tr id="tr_obs_receptivox">
      <td><font class="txt5"><strong><?print $arr_observacao_receptivo[0];?>:</strong></font></td>
      <td nowrap><font class="txt5">
        <textarea name="flw_descricao" style="white-space: pre-wrap;width: <?print $obs_width?>px; height: <?print $obs_height?>px;" consistir="<?print $consiste_obs_recep;?>" tipodado="<?print $consiste_obs_tipodado;?>" minlength=10 msg="Preencha corretamente o campo <?print $arr_observacao_receptivo[0];?>." OnKeyUp="javascript:countOnkeypress(this.value.length, '<?print $arr_observacao_receptivo[2];?>');if (this.value.length > <?print $arr_observacao_receptivo[2];?>) {alert('Tamanho limite do campo atingido, qualquer caracter digitado apartir deste será excluído.');document.getElementById('sizer_desc').innerHTML = '0'; this.value = this.value.substring(0,<?print $arr_observacao_receptivo[2];?>); this.blur();}"><?print $flw_descricao;?></textarea>
        <span id="sizer_desc" class="txtvermelho3" style="width:25;color:#DD0000;text-align:right;"><?print ($arr_observacao_receptivo[2] - strlen($flw_descricao));?></span>
      </td>
    </tr><?
  }
} else {
  $tem_tema_pai = true;
  $tem_tema = false;
  //TEMA PAI
  if ($vlrClasseTemaPai == "S") {
    switch (achaNroModelo($nro_modelo,$tipo_abertura)) {
      case "SP"://SU?>
        <tr>
          <td width="10%" nowrap valign="top" class="txt5">
            <b>Solicitação:</b>
          </td>
          <td nowrap class="txt5"><?
          switch ($qtdTipoSol) {
            case "1":
              if($filtro_cond_classe == "ZZ") {
                print "Cliente";
              } else {
                print ValorClasse("CLACD", $filtro_cond_classe,  $repre, true);
                }?>
                <input type="hidden" name="filtro_cond_classe" value="<?print $filtro_cond_classe?>"><?
                break;

              default:?>

                <select name="filtro_cond_classe" onchange="javascript: $('#flw_tema').val(''); $('#flw_tema_pai').val('');atualizaMK();">
                  <?print MontaCombo("CLACD", $filtro_cond_classe,  $repre, "A", $clacd_filtro_classe_flw_tema." AND vlr_classe <> 'ZZ' ")?>
                  <?if(strpos("xxx".$clacd_filtro_classe_flw_tema, "'ZZ'") > 0) {?>
                    <option value="ZZ" <?if($filtro_cond_classe == "ZZ"){print "SELECTED";}?>>Cliente</option>
                  <?}?>
                  <option value="TODOS" <?if($filtro_cond_classe == "TODOS"){print "SELECTED";}?>>Todos</option>
                </select><?
                break;
            }?>
          </td>
        </tr>
<?
break;
      case "HS"://SACURA
      /*
      ?>
      <tr>
      <td width="10%" nowrap valign="top" class="txt5">
      <b>Categoria:</b>
      </td>
      <td nowrap class="txt5">
      <select name="filtro_cond_classe" onchange="javascript: $('#flw_tema').val(''); $('#flw_tema_pai').val('');atualizaMK();">
      <?print MontaCombo("CLACD", $filtro_cond_classe,  $repre, "A")?>
      </select>
      </td>
      </tr>
      <?
      */
      break;
    }
?>
    <tr>
      <td align="left" class="txt5"><strong><span id="tit_flw_tema_pai"><?print $titTema_pai;?></span>: </strong></td>
      <td align="left" class="txt5">
        <span id="td_muda_flw_tema_pai">
<?
//PARA FUNCIONAR O FILTRO DA CLASSE COM IN (TRATANDO DA MESMA FORMA QUE A FUNÇÃO GETARRAYCLASSE)
if ($filtro_classe_flw_tema_pai) {
  $filtro_classe_flw = $filtro_classe_flw_tema_pai;
}

if (($filtro_classe_flw == "ZD") || ($filtro_classe_flw == "ZZ")) {
  $where_condicao = "";
} else {
  if (strlen($filtro_classe_flw) == 2) {
    $where_condicao = " AND filtro_classe = '".$filtro_classe_flw."'";
  } else {
    if (empty($filtro_classe_flw) === false) {
      $where_condicao = $filtro_classe_flw;
    } else {
      $where_condicao = "";
    }
  }
}

$utilizaFiltroTemaPai = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "FILTRA_TEMA_PAI", $repre_flw));
if(empty($utilizaFiltroTemaPai) === false && $utilizaFiltroTemaPai != "--" && $utilizaFiltroTemaPai != "N") {
  $arrFiltroTemaiPai = getArrayClasse("tb_classe", $connect, "descricao", $utilizaFiltroTemaPai, $repre_flw, "A", "ZZ");
  if(is_array($arrFiltroTemaiPai["itens"]) === true) {
    foreach ($arrFiltroTemaiPai["itens"] as $arrChave => $arrValores) {
      $inFiltro .= ",'".$arrValores["valor"]."'";
    }
    $where_condicao = " AND filtro_classe IN (".substr($inFiltro,1).",'ZZ')";
  } else {
    $where_condicao = " AND filtro_classe = 'ZZ'";
  }
}

if(empty($ativNumRechamado) === false) {
  $where_condicao = " AND vlr_classe = '".$mtzRechamado[$ativNumRechamado]["tema_pai"]."' ";
  $whereRechamado = " AND vlr_classe = '".$mtzRechamado[$ativNumRechamado]["tema"]."' ";
} elseif($mostra_reg_lig == "R") {
  list($vlrCmbTemaPai, $varTemaPai) = explode("§", $classe_reg_lig);
  if($flw_opcao_click_final == "mostra_n_contato") {
    $where_condicao = " AND filtro_classe = 'ST' ";
  } elseif($flw_opcao_click_final == "mostra") {
    $where_condicao = " AND filtro_classe <> 'ST' ";
  }
}
$tem_especial = "N";
$where_condicao_ant = $where_condicao;
if(representanteRH($session["operador"]) == "URANET" && achaNroModelo($nro_modelo,$tipo_abertura) == "SP"){
  $arr_tuse5 = getArrayClasse("tb_classe",$connect,"descricao","TUSE5",$session["representante"],"A"," AND vlr_classe like '".$session["tp_user"]."%'");
  for($count_aux = 0; $count_aux < count((array)$arr_tuse5["itens"]); $count_aux++) {
    if(array_search($session["tp_user"],$arr_tuse5["itens"][$count_aux])) {
      $where_condicao .= " AND vlr_classe IN ('".str_replace(",","','",substr($arr_tuse5["itens"][$count_aux]["descricao"],0,-1))."')";
    }else{
      $where_condicao .= "";
    }
    if(($arr_tuse5["itens"][$count_aux]["valor"] == strtoupper($session["tp_user"])."_ESP") && (strpos("xxx".$arr_tuse5["itens"][$count_aux]["descricao"], $session["operador"]) > 0)) {
      $tem_especial = "S";
    }
  }
}

if($tem_especial == "S") {
  $where_condicao = $where_condicao_ant;
}

$repre_busca_1 = $session["representante"];
$q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$session["representante"]."' AND tipo_reg = 'I' AND status = 'A' ".$where_condicao, $connect);
$r_flw = mysql_fetch_assoc($q_flw);

if ($r_flw["qtd"] < 1) {
  $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$repre_flw."' AND tipo_reg = 'I' AND status = 'A' ".$where_condicao, $connect);
  $r_flw = mysql_fetch_assoc($q_flw);
  $repre_busca_1 = $repre_flw;
}
if ($r_flw["qtd"] == 1) {
  $q_flw = DescExecQuery("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$repre_busca_1."' AND tipo_reg = 'I' AND status = 'A' ".$where_condicao, $connect);
  $r_flw = mysql_fetch_assoc($q_flw);
  $flw_tema_pai = $r_flw["vlr_classe"];
  print $r_flw["desc_classe"];
  print "<input type='hidden' name='flw_tema_pai' id='flw_tema_pai' value='".$flw_tema_pai."'>";
} elseif ($r_flw["qtd"] > 1) {
?>

          <select id="flw_tema_pai" name="flw_tema_pai" consistencia="sempre" consistencia1="pre" msg="Selecione o <?print $titTema_pai;?>."  OnChange="if (document.cadastro.flw_tema) {document.cadastro.flw_tema.value = '';}; atualizaMK();" >
            <?print MontaCombo("FM".achaNroModelo($nro_modelo,$tipo_abertura)."T", $flw_tema_pai, $repre_busca_1, "A", $where_condicao);?>
          </select>
<?
} else {
  print "Nenhum ".$titTema_pai." cadastrado (FM".achaNroModelo($nro_modelo,$tipo_abertura)."T).";
  $tem_tema_pai = false;
}
?>
        </span>
      </td>
    </tr><?

    if($mkFlwParam["campo_extra_apos_motivo"] == "S") {

      $mk_cextra_sigla      = "FLWEXTRAPAI".$flw_tema_pai;
      $mk_cextra_classe     = "FM".achaNroModelo($nro_modelo,$tipo_abertura)."C";
      $mk_cextra_sistema_bd = "CC";
      if($flw_tema_pai && $campo_extra_tipo_rotina == "N") {// VERIFICA SE O MODELO/DISCADOR UTILIZA A ROTINA NOVA DO CAMPO EXTRA
      ?>
        <tr>
          <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
        </tr>
      <?
      }
    }
  }

  if ($tem_tema_pai === true) {
    //TEMA
    $tem_tema = true;
    if (($vlrClasseTemaPai != "S") || (($vlrClasseTemaPai == "S") && ($flw_tema_pai))) {
?>
    <tr>
      <td align="left" class="txt5"><strong><?
      //UTILIZA SOMENTE O PRIMEIRO NÍVEL
      if ($vlrClasseTemaPai != "S") {
        ?><span id="tit_flw_tema_pai"><?
      }

      print $titTema;

      //UTILIZA SOMENTE O PRIMEIRO NÍVEL
      if ($vlrClasseTemaPai != "S") {
        ?></span><?
      }
?>: </strong>
      <td align="left" class="txt5" id="id_celula_tema">
<?
//UTILIZA SOMENTE O PRIMEIRO NÍVEL
if ($vlrClasseTemaPai != "S") {
?>
        <span id="td_muda_flw_tema_pai">
<?
}

if ($filtro_classe_flw_tema == 'ZZ') {
  $filtro_classe_flw_tema = '';
}
if (!$filtro_classe_flw_tema) {
  $filtro_classe_flw_tema = '';
}

if (($nro_modelo == "SP") && ($filtro_classe_flw_tema == $filtro_classe_flw_tema_pai)) {
  $filtro_classe_flw_tema = "";
}

if ($vlrClasseTemaPai == "S") {
  $repre_busca_1 = $session["representante"];
  $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '".$flw_tema_pai."' AND representante = '".$session["representante"]."' AND tipo_reg = 'I' and status = 'A' ".$filtro_classe_flw_tema." ".$whereRechamado, $connect);
  $r_flw = mysql_fetch_assoc($q_flw);
  if ($r_flw["qtd"] < 1) {
    $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '".$flw_tema_pai."' AND representante = '".$repre_flw."' AND tipo_reg = 'I' and status = 'A' ".$filtro_classe_flw_tema." ".$whereRechamado, $connect);
    $r_flw = mysql_fetch_assoc($q_flw);
    $repre_busca_1 = $repre_flw;
  }

  if ($r_flw["qtd"] == 1) {
    $q_flw = DescExecQuery("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '".$flw_tema_pai."' AND representante = '".$repre_busca_1."' AND tipo_reg = 'I' AND status = 'A' ".$filtro_classe_flw_tema." ".$whereRechamado, $connect);
    $r_flw = mysql_fetch_assoc($q_flw);
    if (!$flw_tema) {
      $flw_faz_submit = "S";
    }
    $flw_tema = $r_flw["vlr_classe"];
    $flw_tema_desc = $r_flw["desc_classe"];
    print $r_flw["desc_classe"];
    print "<input type='hidden' name='flw_tema' id='flw_tema' value='".$flw_tema."'>";
  } elseif ($r_flw["qtd"] > 1) {
    if ($flw_tema && $flw_tema_pai) {
      $flw_tema_desc = ValorClasse($flw_tema_pai, $flw_tema, $repre_busca_1);
    }

    //PARA WORKFLOWS PARAMETRIZADOS COM A UTILIZAÇÃO DE SUBTEMA
    if ($vlrClasseTemaPai == 'S') {
      $utiliza_filtro_por_equipe     = ValorClasse("FM{$nro_modelo}K", 'UTILIZA_FILTRO_POR_EQUIPE', $repre_flw);
      $arr_utiliza_filtro_por_equipe = explode('¢', $utiliza_filtro_por_equipe);
      list($utiliza_filtro_flag, $utiliza_filtro_classe, $utiliza_filtro_campo) = $arr_utiliza_filtro_por_equipe;

      if ($utiliza_filtro_flag == 'S') {
        if (strpos($utiliza_filtro_campo, 'session') !== false) {
          $arr_var = explode("[", $utiliza_filtro_campo);
          $utiliza_filtro_campo = $session[substr($arr_var[1], 0, -1)];
        } else {
          $utiliza_filtro_campo = $$utiliza_filtro_campo;
        }

        require_once("{$_SERVER['DOCUMENT_ROOT']}/libs/bd/ConexaoFollowUp.php");
        $connFlw = new ConexaoFollowUp();
        $connFlw->query("SELECT cod_motivo, cod_sub_motivo FROM tb_follow_equipe_motivo WHERE mk_flag = 'MD' AND mk_numero = '$nro_modelo' AND grupo_acesso = '$flw_grupo_acesso' AND cod_motivo = '$flw_tema_pai' AND cod_equipe = '$utiliza_filtro_campo'");
        if ($connFlw->status === true) {
          if ($connFlw->count > 0) {
            $filtro_classe_flw_tema .= ' AND vlr_classe IN (';
            do {
              $filtro_classe_flw_tema .= "'{$connFlw->result['cod_sub_motivo']}',";
            } while ($connFlw->getFetchAssoc());
            $filtro_classe_flw_tema = substr($filtro_classe_flw_tema, 0, -1).')';
          }
        }
      }
    }

    if ($utiliza_filtro_flag == 'S' && empty($filtro_classe_flw_tema)) {
      print "<span class='txtvermelho'>Nenhum <span style='font-weight:bold;'>$titTema</span> Relacionado ao filtro de <span style='font-weight:bold;'>".ValorClasse($utiliza_filtro_classe, $utiliza_filtro_campo, $_SESSION['session']['representante'])."!</span></span>";
    } else {
      //UTILIZA TEMA_PAI E TEMA PARA ABERTURA DE OCORRÊNCIAS
?>

        <select name="flw_tema" id="flw_tema" consistencia="sempre" consistencia1="pre" msg="Selecione o <?print $titTema;?>."  OnChange="atualizaMK();">
          <?print MontaCombo($flw_tema_pai, $flw_tema, $repre_busca_1, 'A', $filtro_classe_flw_tema);?>
        </select>
<?
      if ($flw_tema == "001" && $flw_tema_pai == "FSP54") {
?>
        <span onclick="popupWindow('/callcenter/ge_cf_sal_faixa.php?deonde=CONSULTA_SU&tipo_popup=AJ2','', window, 1050, 600);" class="btn btn-info btn-sm">
          ABRIR SIMULADOR
        </span>
        <script>
          function popupWindow(url, title, win, w, h) {
              const y = win.top.outerHeight / 2 + win.top.screenY - ( h / 2);
              const x = win.top.outerWidth / 2 + win.top.screenX - ( w / 2);
              return win.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+y+', left='+x);
          }
        </script>
<?
      }
    }
  } else {
    print "Nenhum ".$titTema." cadastrado (".$flw_tema_pai.").";
    $tem_tema = false;
  }
} else {
  //UTILIZA SOMENTE O PRIMEIRO NÍVEL
  $repre_busca_1 = $session["representante"];
  $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$session["representante"]."' AND tipo_reg = 'I' AND status = 'A' ".$filtro_classe_flw_tema, $connect, "N");
  $r_flw = mysql_fetch_assoc($q_flw);
  if ($r_flw["qtd"] < 1) {
    $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$repre_flw."' AND tipo_reg = 'I' AND status = 'A' ".$filtro_classe_flw_tema, $connect, "N");
    $r_flw = mysql_fetch_assoc($q_flw);
    $repre_busca_1 = $repre_flw;
  }

  if ($r_flw["qtd"] == 1) {
    $q_flw = DescExecQuery("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."T"."' AND representante = '".$repre_busca_1."' AND tipo_reg = 'I' AND status = 'A' ".$filtro_classe_flw_tema, $connect, "N");
    $r_flw = mysql_fetch_assoc($q_flw);
    if (!$flw_tema) {
      $flw_faz_submit = "S";
    }
    $flw_tema = $r_flw["vlr_classe"];
    print $r_flw["desc_classe"];
    $flw_tema_desc = $r_flw["desc_classe"];
    print "<input type='hidden' name='flw_tema' value='".$flw_tema."'>";
  } elseif ($r_flw["qtd"] > 1) {
    if ($flw_tema) {
      $flw_tema_desc = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."T", $flw_tema, $repre_busca_1);
    }
    //UTILIZA SOMENTE O TEMA PARA ABERTURA DE OCORRÊNCIAS
?>
          <select name="flw_tema" consistencia="sempre" consistencia1="pre" msg="Selecione o <?print $titTema;?>."  OnChange="<?/*if (achaNroModelo($nro_modelo,$tipo_abertura) == "SP") {?>document.cadastro.focus.value = 'contentWindow';}*/?> atualizaMK();" >
            <?print MontaCombo("FM".achaNroModelo($nro_modelo,$tipo_abertura)."T", $flw_tema, $repre_busca_1,"A",$filtro_classe_flw_tema);?>
          </select>
<?
  } else {
    print "Nenhum ".$titTema." cadastrado (FM".achaNroModelo($nro_modelo,$tipo_abertura)."T).";
    $tem_tema = false;
  }
}

//UTILIZA SOMENTE O PRIMEIRO NÍVEL
if ($vlrClasseTemaPai != "S") {
?>
        </span>
<?
}
?>
      </td>
    </tr>
    <?
    if($mkFlwParam["campo_extra_apos_motivo"] == "S") {
      $mk_cextra_sigla      = "FLWEXTRA".$flw_tema_pai.$flw_tema;
      $mk_cextra_classe     = "FM".achaNroModelo($nro_modelo,$tipo_abertura)."C";
      $mk_cextra_sistema_bd = "CC";
      if($flw_tema_pai && $flw_tema && $campo_extra_tipo_rotina == "N") {// VERIFICA SE O MODELO/DISCADOR UTILIZA A ROTINA NOVA DO CAMPO EXTRA
      ?>
        <tr>
          <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
        </tr>
      <?
      }
    }

    }

    if (($tem_tema === true) && ($flw_tema)) {
      if ($nro_modelo == "TU" || $nro_modelo == "4W") {
        $flw_faz_submit = "";
      }
?>
    <script type="text/javascript">
    <?print $javascript_fixo_flw_honda;?>
    </script>
<?
if ($vlrClasseTemaPai == "S") {
  $tema_obs_param = $flw_tema_pai.$flw_tema;
} else {
  $tema_obs_param = $flw_tema;
}

/*
NOVA FUNÇÃO QUE PEGA A CLASSE FM__A
*/

$retParamMotivo = getParamMotivo("MD", achaNroModelo($nro_modelo,$tipo_abertura), "", $flw_tema_pai, $flw_tema, $repre_vendedor, $tipo_busca);

if($retParamMotivo["st_ret"] == "OK") {

  if(is_array($retParamMotivo) === true) {
    foreach ($retParamMotivo as $key => $array) {
      if(is_array($array) === true) {
        $descParamMotivo  = "";
        $descParamMotivo .= $array["descricao"];
      }
    }
  }
} else {
  $msg = $retParamMotivo["msg_ret"];
}

if($retParamMotivo["T,".$tema_obs_param]["assunto_dig"] == "S") {
?>
  <tr>
    <td align="left" class='txt5'><b>Descrição Resumida:</b></td>
    <td align="left" class='txt5'>
      <input type='text' name='tema_observacao' value='<?print $tema_observacao?>' size='60' minlength='15' maxlength="60" consistencia='sempre' consistencia1='pre' consistencia2='link' msg='Preencha corretamente o campo Descrição.' onKeyUp="javascript: document.cadastro.sizerExtraTObs.value=this.value.length;">
      <input type='text' name='sizerExtraTObs' size='6' readonly style='width:48px; border:none; background:none; color:#DD0000;'>
    </td>
  </tr>
<?
}
?>
    <tr>
      <td align="left"><font class='txt5'><strong><?
      if (achaNroModelo($nro_modelo, $tipo_abertura) == "SP") {
        ?>Prazo Estimado<?
      } else {
        ?>Vecto da Tarefa<?
      }
?>:</strong></font></td>
      <td align="left"><font class='txt5'>
<?
$tem_param_tema = true;

$q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."K"."' and representante = '".$session["representante"]."' and tipo_reg = 'I' and status = 'A' ", $connect);
$r_flw = mysql_fetch_assoc($q_flw);
if (intval($r_flw["qtd"], 10) == 0) {
  $q_flw = DescExecQuery("SELECT COUNT(*) AS qtd FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."K"."' and representante = '".$repre_vendedor."' and tipo_reg = 'I' and status = 'A' ", $connect);
  $r_flw = mysql_fetch_assoc($q_flw);
  if (intval($r_flw["qtd"], 10) == 0) {
    print "Atenção, nenhum parâmetro cadastrado para o tempo de vencimento da atividade. (FM".achaNroModelo($nro_modelo,$tipo_abertura)."K)";
    $tem_param_tema = false;
  } else {
    $repre_usar = $repre_vendedor;
  }
}

if (!$repre_usar) {
  $repre_usar = $session["representante"];
}

if ($tem_param_tema === true) {
  //*****************************************//
  //PEGAR $PARAM_ATIV_DT_VECTO
  //*****************************************//
  $tipo_sla_tema = str_replace("¢", "", $mkFlwParam["sla_param"]);

  if ($tipo_sla_tema) {
    //$tipo_sla_tema
    //GERAL
    //SUB-CATEGORIA
    //ÁREA
    $array_data_hora_ativ_vecto = explode("|", getDataHoraVecto(achaNroModelo($nro_modelo,$tipo_abertura),$flw_grupo_acesso,$flw_tema_pai,$flw_tema,$repre_vendedor,$repre_vendedor,$tipo_sla_tema,$param_ativ_dt_vecto,$flw_nivel_acesso,"ATIVIDADE", ""));
  } else {
    print "<font class='txtvermelho'><strong>ERRO: FALTA PARAMETRO SLA_PARAM</strong></font><br>";
  }

  $param_ativ_dt_vecto = $array_data_hora_ativ_vecto[2];
?>
  <input type="hidden" name="param_ativ_dt_vecto" value="<?print $param_ativ_dt_vecto;?>">
<?
if (empty($param_ativ_acao_inteligente) === false && empty($param_ativ_tipo_acao_inteligente) === false) {
  $agrupamento = $param_ativ_acao_inteligente;

  if ($param_ativ_tipo_acao_inteligente == "POPUP") {
    require_once("funcoes/ScriptInteligente.php");//Include do Ação Inteligente
    $mk_numero = achaNroModelo($nro_modelo,$tipo_abertura);//Variável contendo Discador/Modelo+Nro
    if ($flw_tema_pai) {
      $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
    } else {
      $flw_tema_pai = "FM".$mk_numero."T";
      $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
    }
    $info_script_motivo = "";

    if (is_array($array_retorno_AI)) {
      foreach ($array_retorno_AI as $key => $value) {
        $info_script_motivo .= $value;
      }
?>
        <script type="text/javascript">
        function abrePopUp() {
          vars = '&flw_tema_pai=<?print $flw_tema_pai?>&flw_tema=<?print $flw_tema?>';//Variáveis cadastradas no agrupamento do Ação Inteligente e seus valores
          programa = 'scri_regra_pop_inteligente.php?repre=<?print DefineRepre($repre_vendedor);?>&agrupamento=<?print $agrupamento;?>&tipo=ARR&mk_numero=<?print $mk_numero;?>';
          AbreJanela2(programa+vars, 'janFlwEven', '750', '400','<?print $arraySIassunto[0];?>');
          //          ExecAcaoInteligente('<?print DefineRepre($repre);?>', '<?print $agrupamento;?>', 'EXEC_ACAO', vars );
        }
        abrePopUp();
        </script>
<?
    }
  }
}

$tem_param_vecto = true;
if (($array_data_hora_ativ_vecto[0] == "") || ($array_data_hora_ativ_vecto[1] == "")) {
  print "Vencimento não definido para este assunto. ".$flw_tema_pai.$flw_tema;
  $tem_param_vecto = false;
} else {
  $ativ_data_vecto = $array_data_hora_ativ_vecto[0];
  $ativ_hora_vecto = $array_data_hora_ativ_vecto[1];
}

if ($tem_param_vecto === true) {
  $dia_vecto_ativ = "";
  $mes_vecto_ativ = "";
  $ano_vecto_ativ = "";

  // VERIFICA SE O VECTO PODE SER ALTERADO NO ATENDIMENTO
  // PARAMETRO QUE FICA NA CLASSE FM__A. VINICIUS(RE006200).
  $arr_permissao_altera_vecto = explode("¢", $descParamMotivo);

  print "Data:";
  if ($arr_permissao_altera_vecto[7] == "S") {
    print DataCalendarioNovoSimples("dia_vecto_ativ", "mes_vecto_ativ", "ano_vecto_ativ", $ativ_data_vecto, "", "", "cadastro");
?>
                           &nbsp;&nbsp;&nbsp;Hora:
        <select name="hora_vecto_ativ"><?print ComboData("H",  substr($ativ_hora_vecto,0,2), "")?></select>
        <select name="min_vecto_ativ" ><?print ComboData("MI", substr($ativ_hora_vecto,3,2), "")?></select>
<?
  } else {
    print BrDate($ativ_data_vecto)."&nbsp;&nbsp;&nbsp;&nbsp;Hora: ".substr($ativ_hora_vecto,0,5);
    print "<input type='hidden' name='hora_vecto_ativ' value='".substr($ativ_hora_vecto,0,2)."'>";
    print "<input type='hidden' name='min_vecto_ativ'  value='".substr($ativ_hora_vecto,3,2)."'>";
    print "<input type='hidden' name='dia_vecto_ativ'  value='".substr($ativ_data_vecto,8,2)."'>";
    print "<input type='hidden' name='mes_vecto_ativ'  value='".substr($ativ_data_vecto,5,2)."'>";
    print "<input type='hidden' name='ano_vecto_ativ'  value='".substr($ativ_data_vecto,0,4)."'>";
  }
  print "&nbsp;<font color='red'><strong>".CalcTime($param_ativ_dt_vecto,1)."</strong></font>";

  if ($arr_param_ativ_tipo_anexo[0] == "ANEXO" && empty($arr_param_ativ_tipo_anexo[2]) === false) {
    $classe_ativ_tipo_anexo    = $arr_param_ativ_tipo_anexo[1];
    $itens_ativ_tipo_anexo     = $arr_param_ativ_tipo_anexo[2];
    $arr_itens_ativ_tipo_anexo = explode(",",$itens_ativ_tipo_anexo);

    //    print "<pre>";
    //    print_r($arr_itens_ativ_tipo_anexo);

    foreach ($arr_itens_ativ_tipo_anexo as $key => $value) {
      $arr_aux_op = explode("|",$value);
      $arr_itens_ativ_tipo_anexo_op[$arr_aux_op[0]] = $arr_aux_op[1];
      $arr_itens_ativ_tipo_anexo[$key] = $arr_aux_op[0];
    }

    //ANEXO DO CHAT (TRIBANCO)
    if ($nro_modelo == "F9") {
      if (empty($chat_anexo_id) === false && intval($chat_anexo_id, 10) > 0) {
        require_once($_SERVER['DOCUMENT_ROOT']."/libs/bd/Conexao.php");
        $connDocumentos = new Conexao($host_documentos, $bd_documentos, $user_documentos, $senha_documentos);
        $connDocumentos->query("SELECT nome, data_cri, hora_cri, login_cri, arq_size FROM ".$tabela_documentos." WHERE num = '".$chat_anexo_id."'");
        $connDocumentos->close();

        $tmp_pos = stripos($connDocumentos->result["nome"], ".");
        if ($tmp_pos !== false) {
          $tmp_anexo_nome = substr($connDocumentos->result["nome"], 0, $tmp_pos);
          $tmp_anexo_ext = substr($connDocumentos->result["nome"], $tmp_pos + 1);
        } else {
          $tmp_anexo_nome = $connDocumentos->result["nome"];
          $tmp_anexo_ext = "";
        }
        $chat_anexo_associado = "DocMK*".$tmp_anexo_nome."|".$tmp_anexo_ext."|".$connDocumentos->result["arq_size"]."|MD|".$nro_modelo."|".$chat_anexo_id."|".$connDocumentos->result["login"]."|".$connDocumentos->result["data_cri"]."|".str_replace(":", "-", $connDocumentos->result["hora_cri"]);
        print "<span title=\"Visualizar documento recebido\">".getAnexos($chat_anexo_associado, $nro_modelo, "MD")."</span>";
        ?>
        <input type="hidden" name="chat_anexo_id" value="<?print $chat_anexo_id;?>">
        <input type="hidden" name="chat_anexo_associado" value="<?print $chat_anexo_associado;?>">
        <?
      } else {
?>
    &nbsp;&nbsp;&nbsp;<img src='imagens/farol_verde.gif' border='0' width='12px' height='12px'><img src='imagens/anexo.gif' border='0' width='16px' height='16px'>
<?
      }
    } else {
?>
    &nbsp;&nbsp;&nbsp;<img src='imagens/farol_verde.gif' border='0' width='12px' height='12px'><img src='imagens/anexo.gif' border='0' width='16px' height='16px'>
<?
    }
    foreach ($arr_itens_ativ_tipo_anexo as $key_anexo => $value_anexo) {
      if ($arr_itens_ativ_tipo_anexo_op[$value_anexo] == "O") {
        $str_print_itens_ativ_tipo_anexo_hidden .= $value_anexo."=O¢";
      } else {
        $str_print_itens_ativ_tipo_anexo .= ValorClasse($classe_ativ_tipo_anexo,$value_anexo,$repre).", ";
        $str_print_itens_ativ_tipo_anexo_hidden .= $value_anexo."=P¢";
      }
    }
    $str_print_itens_ativ_tipo_anexo        = substr(trim($str_print_itens_ativ_tipo_anexo),0,-1);
    $str_print_itens_ativ_tipo_anexo_hidden = substr(trim($str_print_itens_ativ_tipo_anexo_hidden),0,-1);
    print "<font class=\"txtazul\" style='font-size:10px;'>".$str_print_itens_ativ_tipo_anexo."</font>\n";
    print "<input type='hidden' name='anexo_solicitado' id='id_anexo_solicitado' value='".$classe_ativ_tipo_anexo."-".$str_print_itens_ativ_tipo_anexo_hidden."'>\n";
?>
        <input type="hidden" name="itens_ativ_tipo_anexo" value="<?print $str_print_itens_ativ_tipo_anexo;?>">
<?
  }

  if(($flw_tema_pai == "FM412" && $flw_tema == "008") && $param_ativ_dt_vecto < 100) {
    print "<br><font class='txtvermelho'><strong>ERRO: NÃO FOI POSSÍVEL CARREGAR SLA, FAVOR ENVIAR PRINT DA TELA PARA O E-MAIL: sac@uranet.com.br</strong></font><br>";
    exit;
  }

}
}
?>
      </td>
    </tr>
<?
if ((empty($flw_tema) === false) && ($tem_param_tema === true) && ($tem_param_vecto === true)) {

  // ****************************************************************************** //
  // ******* Rotina que trata o campo da tela e determina a área de destino ******* //
  // ****************************************************************************** //
  $desc_campos_tela_area   =  ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "DIRECIONAMENTO_REGRA_DESC", $repre_vendedor);

  if(trim($desc_campos_tela_area) != "--"){
    $utliza_campos_tela_area = "S";
  }
  $arr_campos_tela = explode(",", ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "DIRECIONAMENTO_REGRA_CAMPO", $repre_vendedor));

  if ($arr_campos_tela[0] == "UNICO") {
    $valor_campo_flw_cod_classe = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "DIRECIONAMENTO_REGRA_CLASSE", $repre_vendedor);
  } else {
    global ${$arr_campos_tela[0]};
    $valor_campo_flw_cod_classe = ${$arr_campos_tela[0]};
  }

  $valor_campo_flw_vlr_classe = ${$arr_campos_tela[1]};

  if($utliza_campos_tela_area == "S") {
    $where_in_area  = " AND (direcionamento_regra = 'TODOS'";
    $where_in_area .= " OR direcionamento_regra = '".$valor_campo_flw_vlr_classe."' ";
    $where_in_area .= " OR direcionamento_regra LIKE '%¢".$valor_campo_flw_vlr_classe."¢%' ";
    $where_in_area .= " OR direcionamento_regra LIKE '".$valor_campo_flw_vlr_classe."¢%' ";
    $where_in_area .= " OR direcionamento_regra LIKE '%¢".$valor_campo_flw_vlr_classe."' ";
    $where_in_area .= ")";
  }


  // ****************************************************************************** //
  // ****************************************************************************** //
  // ****************************************************************************** //

  $sql_direcionamento = "SELECT nivel_acesso, login_distribui, login_adm_projeto FROM tb_follow_distribuicao WHERE mk_flag = 'MD' and mk_numero = '".achaNroModelo($nro_modelo,$tipo_abertura)."' and grupo_acesso = '".$flw_grupo_acesso."' and tema = '".$flw_tema."' AND tema_pai='".$flw_tema_pai."' ".$where_in_area." order by login_distribui ";
  $q_direciona = DescExecQuery($sql_direcionamento, ConnectFLW(),"N");
  $x_areas = 1;
  while($r_direciona = mysql_fetch_assoc($q_direciona)) {
    $direcionar = "S";
    $matriz_nivel_acesso  [$r_direciona["nivel_acesso"]                                 ]   = $r_direciona["nivel_acesso"];
    $matriz_login_operador[$r_direciona["nivel_acesso"]][$r_direciona["login_distribui"]]   = $r_direciona["login_distribui"];
    //              $matriz_login_operador[$r_direciona["nivel_acesso"]][$r_direciona["login_adm_projeto"]] = $r_direciona["login_adm_projeto"];

    $flw_nivel_acesso_aux   = $r_direciona["nivel_acesso"   ];
    $flw_login_operador_aux = $r_direciona["login_distribui"];

    $x_areas++;
  }
  if (count((array)$matriz_nivel_acesso) == 1) {
    $flw_nivel_acesso   = $flw_nivel_acesso_aux;
    unset($matriz_nivel_acesso);
    if (count($matriz_login_operador, 1) <= 2) {
      $flw_login_operador = $flw_login_operador_aux;
      unset($matriz_login_operador);
    }
  }


  if (empty($param_ativ_acao_inteligente) === false && empty($param_ativ_tipo_acao_inteligente) === false) {
    $agrupamento = $param_ativ_acao_inteligente;
    if ($param_ativ_tipo_acao_inteligente == "ARR") {

      require_once("funcoes/ScriptInteligente.php");//Include do Ação Inteligente
      $mk_numero = achaNroModelo($nro_modelo,$tipo_abertura);//Variável contendo Discador/Modelo+Nro

      if ($flw_tema_pai) {
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      } else {
        $flw_tema_pai = "FM".$mk_numero."T";
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      }

      if (is_array($array_retorno_AI)) {
?>
    <tr>
      <td colspan="2">
        <div id="id_msg_acao_inteligente" align="left" class="txt5" style="width:650px;">
<?
print "<div style='width:500px; margin:0 auto 0 auto;'><font class='tit'><img src='imagens/farol_verde.gif' border='0' width='12px' height='12px'>&nbsp;".$arraySIassunto[0]."</font><br></div>";
print "<font style='font-size: 100%'>";
$info_script_motivo = "";
foreach ($array_retorno_AI as $key => $value) {
  print $value;
  $info_script_motivo .= $value;
}

print "</font>";
?>
        </div>
      </td>
    </tr>
<?
      }
    }

    if ($param_ativ_tipo_acao_inteligente == "MANUAL") {
      require_once("funcoes/ScriptInteligente.php");//Include do Ação Inteligente
      $mk_numero = achaNroModelo($nro_modelo,$tipo_abertura);//Variável contendo Discador/Modelo+Nro

      if ($flw_tema_pai) {
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      } else {
        $flw_tema_pai = "FM".$mk_numero."T";
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      }

      if (is_array($array_retorno_AI)) {
?>
    <script type="text/javascript">
    function abrePopUpAIAssunto()     {
      vars = '&flw_tema_pai=<?print $flw_tema_pai;?>&flw_tema=<?print $flw_tema;?>';//Variáveis cadastradas no agrupamento do Ação Inteligente e seus valores
      programa = 'scri_regra_pop_inteligente.php?repre=<?print DefineRepre($repre_vendedor);?>&agrupamento=FLWI&tipo=ARR&mk_numero=<?print $mk_numero;?>'    ;
      AbreJanela2(programa+vars, 'janFlwEven', '750', '400','<?print $arraySIassunto[0];?>');
    }
    $("#id_celula_tema").append("<img src=\"imagens/lupa_transparente.gif\" title='<?print $arraySIassunto[0];?>' onclick=\"javascript:abrePopUpAIAssunto();\" width=\"15px\" style=\"cursor:pointer;\">");
    </script>
<?
      }
    }
  }

  if ($arr_permissao_altera_vecto[10] == "MANUAL") {
    require_once("funcoes/ScriptInteligente.php");//Include do Ação Inteligente
    $mk_numero = achaNroModelo($nro_modelo,$tipo_abertura);//Variável contendo Discador/Modelo+Nro

    // Cliente
    if ($flw_tema_pai) {
      $array_retorno_AI_cli = mostraRegraScript(DefineRepre($repre_vendedor), $arr_permissao_altera_vecto[9]."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
    } else {
      $flw_tema_pai = "FM".$mk_numero."T";
      $array_retorno_AI_cli = mostraRegraScript(DefineRepre($repre_vendedor), $arr_permissao_altera_vecto[9]."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
    }

    if (is_array($array_retorno_AI_cli)) {
?>
    <script type="text/javascript">
    function abrePopUpAIAssunto() {
      vars = '&flw_tema_pai=<?print $flw_tema_pai;?>&flw_tema=<?print $flw_tema;?>';//Variáveis cadastradas no agrupamento do Ação Inteligente e seus valores
      programa = 'scri_regra_pop_inteligente.php?repre=<?print DefineRepre($repre_vendedor);?>&agrupamento=<?print $arr_permissao_altera_vecto[9]?>&tipo=ARR&mk_numero=<?print $mk_numero;?>';
      AbreJanela2(programa+vars, 'janFlwEven', '750', '400','<?print $arraySIassunto[0];?>');
    }
    $("#id_celula_tema").append("<img src=\"imagens/info_peq.gif\" title='<?print $arraySIassunto[0];?>' onclick=\"javascript:abrePopUpAIAssunto();\"   style=\"cursor:pointer;\">");
    </script>
<?
$info_script_motivo_cliente = $array_retorno_AI_cli[0];
    }
  }

  //*********************************************************************************************\\
  //* INI - CONSISTÊNCIA PARA IMPEDIR QUE SEJAM FEITOS REDIRECIONAMENTOS PARA SETORES SUSPENSOS *\\
  //*********************************************************************************************\\
  try {
    $connCallcenter = new ConexaoCallCenter();//CRIANDO CONEXÃO COM O BD NO PADRÃO NOVO
    //BUSCANDO LISTA DE SETORES ATIVOS
    $connCallcenter->query("SELECT group_concat(vlr_classe) AS lista_area_ativa FROM tb_classe  WHERE cod_classe = 'FM{$mk_numero}N' AND representante = '{$repre_vendedor}' AND idioma = '1' AND tipo_reg = 'I' AND status IN ('A', 'U')");
    if ($connCallcenter->status === false) {
      throw new Exception($connCallcenter->getDescRetorno());
    }

    if($connCallcenter->count == 0) {
      throw new Exception("<strong class='txtvermelho'>Erro: Nenhuma regra parametrizada. Entrar em contato com SAC URANET.</strong>");
    }

    //ARMAZENANDO LISTA DE SETORES ATIVOS
    $lista_area_ativa = $connCallcenter->result['lista_area_ativa'];


    //CONTABILIZANDO DENTRE OS SETORES PARAMETRIZADOS QUAIS ESTÃO ATIVOS NA CLASSE
    if ((empty($flw_nivel_acesso) === false) && strpos($lista_area_ativa, $flw_nivel_acesso) !== false) {
      $qtd_ida++;
    }

    //SÓ FAZ A CONSISTÊNCIA SE O SETOR DESTINO FOR INFORMADO, ISTO É, DIFERENTE DE VAZIO
    if ((empty($flw_nivel_acesso) === false) && ($qtd_ida < 1)) {
      throw new Exception('O setor de destino desta ocorrência está suspenso.', 1);
    }

  } catch (Exception $e) {
    $flagSetorDesativado = true;
  ?>
<div class="txt6" style="margin:10px auto; background-color:#e60000; width:80%; padding:5px; text-align:center; border-radius:5px;color:white;">
<strong>
  <?="{$e->getMessage()} (E{$e->getCode()} - L{$e->getLine()})"?>
  <div style="font-size:12px;">Entre em contato com o responsável e informe o erro.</div>
</strong>
</div><!-- DIV ROW ERRO 1-->
<script type="text/javascript">
  //DESATIVANDO E INIBINDO A EXIBIÇÃO DO BOTÃO DE ENVIO DO FORMULÁRIO
  $("#id_bt_enviar").attr('disabled', true).hide();
</script>
<?
  }
  //*********************************************************************************************\\
  //* FIM - CONSISTÊNCIA PARA IMPEDIR QUE SEJAM FEITOS REDIRECIONAMENTOS PARA SETORES SUSPENSOS *\\
  //*********************************************************************************************\\
?>
    <input type="hidden" name="info_script_motivo" value="<?print base64_encode(urlencode($info_script_motivo));?>">
    <input type="hidden" name="info_script_motivo_cliente" value="<?print base64_encode(urlencode($info_script_motivo_cliente));?>">
    <tr id="tr_destino_workflow">
      <td align="left" class='txt5'><strong><?print $titNivel;?>:</strong></td>
      <td align="left" class='txt5'>
<?
//                        $n_ida = explode(",",$flw_user_acesso_ida);
//                        $qtd_ida=0;
//
//                        while($n_ida[$qtd_ida]) $qtd_ida++;
//                        if ($qtd_ida == "1" && !$permissoes["FA"]) {
//                          if ($direcionar != "S") {
//                            $flw_nivel_acesso = $n_ida[0];
//                          }
?>
<!--                            <input type="hidden" name="flw_nivel_acesso" value="<?print $flw_nivel_acesso?>">-->
<?
//                            print ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."N", $flw_nivel_acesso, $repre_usar)."&nbsp;&nbsp;&nbsp;";
//                        } else {

if ($direcionar == "S") {
  if ($matriz_nivel_acesso) {
?>
        <select name="flw_nivel_acesso" consistencia="sempre" consistencia1="pre" msg="Selecione o <?print $titNivel;?>." OnChange="document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1')); if (confereMK(document.cadastro)) {document.cadastro.submit();}">
<?
print "<option value=''> -- Selecione -- </option>";

foreach($matriz_nivel_acesso as $chave_setor => $valor_setor) {
  $sel="";
  if ($flw_nivel_acesso == $matriz_nivel_acesso[$chave_setor])
  $sel = "SELECTED";
  print "<option value='".$matriz_nivel_acesso[$chave_setor]."' ".$sel." >".ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."N", $matriz_nivel_acesso[$chave_setor], $repre_usar)."</option>";
}

if ($permissoes["FA"]) {
  $sel="";
  if ($flw_nivel_acesso == "FA")
  $sel = "SELECTED";
  print "<option value='FA' style='background:#FF8888' ".$sel." >Finalizar</option>";
}
?>
        </select>
<?
  } else {
?>
        <input type="hidden" name="flw_nivel_acesso" value="<?print $flw_nivel_acesso?>">
<?
print ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."N", $flw_nivel_acesso, $repre_usar)."&nbsp;&nbsp;&nbsp;";
  }
} elseif($utliza_campos_tela_area == "S") {
  print "<div align='center'><font class='txtvermelho'>Nenhum(a) ".$titNivel." Direcionada para o ".$desc_campos_tela_area.": ".ValorClasse($valor_campo_flw_cod_classe,$valor_campo_flw_vlr_classe,$repre_vendedor)."!</font></div>";
  exit;
} else {
?>
        <select name="flw_nivel_acesso" consistencia="sempre" consistencia1="pre" msg="Selecione o <?print $titNivel;?>." OnChange="document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1')); if (confereMK(document.cadastro)) {document.cadastro.submit();}">
<?
print flwMontaComboNA("FM".achaNroModelo($nro_modelo,$tipo_abertura)."N", $repre_usar, $flw_nivel_acesso, "",  $flw_user_acesso_ida);
if ($permissoes["FA"]) {
  $sel="";
  if ($flw_nivel_acesso == "FA")
  $sel = "SELECTED";
  print "<option value='FA' style='background:#FF8888' ".$sel." >Finalizar</option>";
}
?>
        </select>
<?
}
//                          }
if ($flw_nivel_acesso == "FA") {
?>
        <input type="hidden" name="flw_login_operador" value="SOLICITANTE">
<?
} else {
  if ($direcionar == "S") {
    if ($matriz_login_operador) {
      if (!$flw_nivel_acesso) {
?>
        <input type="hidden" name="flw_login_operador" value="TODOS">
        <font class='txt5'><strong><?print $titResponsavel;?>:</strong>
<?
print "&nbsp;&nbsp;Todos ";
      } else {
?>
        <font class='txt5'><strong><?print $titResponsavel;?>:</strong>
        <select name="flw_login_operador">
<?
foreach($matriz_login_operador[$flw_nivel_acesso] as $chave_login => $valor_login) {
  $sel="";
  if ($flw_nivel_acesso == $matriz_login_operador[$flw_nivel_acesso][$chave_login]) {
    $sel = "SELECTED";
  }
  if ($matriz_login_operador[$flw_nivel_acesso][$chave_login] == "TODOS") {
    print "<option value='".$matriz_login_operador[$flw_nivel_acesso][$chave_login]."' ".$sel." >TODOS</option>";
  } else {
    print "<option value='".$matriz_login_operador[$flw_nivel_acesso][$chave_login]."' ".$sel." >".NomeResumido($matriz_login_operador[$flw_nivel_acesso][$chave_login])."</option>";
  }
}
?>
        </select>
<?
      }
    } else {
?>
        <input type="hidden" name="flw_login_operador" value="<?print $flw_login_operador?>">
        <font class='txt5'><strong><?print $titResponsavel;?>:</strong>
<?
if ($flw_login_operador == "TODOS") {
  print "&nbsp;&nbsp;Todos ";
} else {
  print "&nbsp;&nbsp;".NomeResumido($flw_login_operador);
}
    }
  } else {
?>
        <font class='txt5'><strong><?print $titResponsavel;?>:</strong>
        <select name="flw_login_operador">
<?
if (achaNroModelo($nro_modelo,$tipo_abertura) == "SP") {
?>
          <option value="TODOS"> TODOS </option>
<?
} else {
  print flwMontaComboAGENTE("MD", achaNroModelo($nro_modelo,$tipo_abertura), $flw_grupo_acesso, $flw_nivel_acesso, $flw_login_operador);
}
?>
        </select>
<?
  }
}
if ($flw_nivel_acesso == "999") {
  $check_atd_fim = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."U","Z",$repre_usar));

  if($check_atd_fim == "" || $check_atd_fim == "--"){
    $param_flw_resultado = $mkFlwParam["flw_resultado"];
    if ($param_flw_resultado && $param_flw_resultado != "N") {
      $opt_combo_status_ouvidoria = MontaCombo("FM".achaNroModelo($nro_modelo,$tipo_abertura)."U",$status_ouvidoria,$repre_usar);
?>
        <strong><?print $titClasse;?>:</strong>
        <select name="status_ouvidoria" consistir="sempre" tipodado="preenchido" msg="Selecione o <?print $titClasse;?>">
          <?print $opt_combo_status_ouvidoria;?>
        </select>
<?
    }
  } else {
    print "<input type='hidden' name='status_ouvidoria' value='Z'>";
  }
}
?>

      </td>
    </tr>
<?
if ($mkFlwParam["define_adm_projeto_motivo"] == "S") {
?>
    <tr>
      <td align="left" class='txt5'><strong>Administrador:</strong></td>
      <td align="left" class='txt5' colspan="3">
<?




$sql_dire = "SELECT login_adm_projeto FROM tb_follow_distribuicao WHERE mk_flag = 'MD' and mk_numero = '".achaNroModelo($nro_modelo,$tipo_abertura)."' and grupo_acesso = '".$flw_grupo_acesso."' and tema = '".$flw_tema."' AND tema_pai='".$flw_tema_pai."' AND nivel_acesso='".$flw_nivel_acesso."' AND login_distribui='".$flw_login_operador."' order by login_distribui ";
$q_dire = DescExecQuery($sql_dire, ConnectFLW(),"N");
$r_dire = mysql_fetch_assoc($q_dire);
if($r_dire["login_adm_projeto"]) {
  print NomeResumido($r_dire["login_adm_projeto"]);
  ?><input type="hidden" name="login_adm_projeto" value="<?=$r_dire["login_adm_projeto"]?>"><?
} else {
  $flwArrCtr = getArrContratoFLW("MD", $nro_modelo, $repre);
  if ($flwArrCtr["login_adm_projeto"] != "") {
    print NomeResumido($flwArrCtr["login_adm_projeto"])." (".$flwArrCtr["login_adm_projeto"].")";
    ?><input type="hidden" name="login_adm_projeto" value="<?=$flwArrCtr["login_adm_projeto"]?>"><?
  }else{
    print "Indefinido";
  }
}
?>
      </td>
    </tr>
<?
}

$tem_param_prioridade = true;
$vlrClassePrioridade = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","PRIORIDADE",$repre);
if (trim($vlrClassePrioridade) == "--") {
  $vlrClassePrioridade = ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K","PRIORIDADE","URANET");
  if (trim($vlrClassePrioridade) == "--") {
?>
    <tr>
      <td align="center"><font class="txtvermelho"><strong>Prioridade da classe <?print "FM".achaNroModelo($nro_modelo,$tipo_abertura)."N"?> (Valor->S ou N) não definida, favor contatar SAC.</strong></font></td>
    </tr>
<?
$tem_param_prioridade = false;
  }
}

if ($tem_param_prioridade === true) {
  if ((achaNroModelo($nro_modelo,$tipo_abertura) == "SP") || (preg_match("/^(BI|BT|H2)$/", $nro_modelo))) {
    $vlrClassePrioridade = "N";
  }
  if ($vlrClassePrioridade != "N") {
?>
    <tr>
      <td align="left"><font class='txt5'><strong>Prioridade:</strong></td>
      <td align="left"><font class='txt5'>
<?
$q_flw = DescExecQuery("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."I"."' and representante = '".$session["representante"]."' and tipo_reg = 'I' and status = 'A' order by vlr_classe ", $connect, "N");
$r_flw = mysql_fetch_assoc($q_flw);
if (!$r_flw["vlr_classe"]) {
  $q_flw = DescExecQuery("SELECT vlr_classe, desc_classe FROM tb_classe WHERE cod_classe = '"."FM".achaNroModelo($nro_modelo,$tipo_abertura)."I"."' and representante = 'URANET' and tipo_reg = 'I' and status = 'A' order by vlr_classe ", $connect, "N");
  $r_flw = mysql_fetch_assoc($q_flw);
}
if ($r_flw["vlr_classe"]) {
  do{
    if ($flw_prioridade == $r_flw["vlr_classe"]) {
      $check_flw = " checked ";
    } else {
      $check_flw = "";
    }
    print "<input type='radio' name='radio_flw_prioridade' value='".$r_flw["vlr_classe"]."' ".$check_flw."  onclick='document.cadastro.flw_prioridade.value=this.value' >".$r_flw["desc_classe"];
    $vlr_prioridade = $r_flw["vlr_classe"];
  }while($r_flw = mysql_fetch_assoc($q_flw));
  if (!$flw_prioridade) {//pega a prioridade mais baixa
    $flw_prioridade = $vlr_prioridade;
  }
  print "<input type='hidden' name='flw_prioridade' value='".$flw_prioridade."' consistencia='sempre' consistencia2='pre' msg='Selecione uma prioridade' tipo='hidden' >";
} else {
  print "CLASSE FM".achaNroModelo($nro_modelo,$tipo_abertura)."I não cadastrada<br> Contate um analista da URANET";
  $tem_param_prioridade = false;
}
?>
      </td>
    </tr>
<?
  }
}
}
    }
  }

  /*******************************************************
*****************A VALIAÇÃO OUVIDORIA BACEN MARCELO******
**********************************************************/
$arrParamFLW['OUVE_AVA_BACEM_USA'] = 'OUVE_AVA_BACEM_USA';
$mkFlwParam = carregaArrParamFLW(achaNroModelo($nro_modelo, $tipo_abertura), $repre_vendedor, $arrParamFLW);
if ($usa_flw_conclusao_ajax != "S" && $mkFlwParam["ouve_ava_bacem_usa"] == "S" && empty($flw_tema) === false && $flw_nivel_acesso == "999") {
  ?>
  <tr>
    <td colspan="2">
       <?print montaModuloBacen("MD", $nro_modelo, $repre_vendedor, $flw_tema_pai, $flw_nivel_acesso, $ouve_ava_bacem_tipo_solucao, $ouve_ava_bacem_tipo_pesquisa, false, '', $_REQUEST);?>
    </td>
  </tr>
  <?
}
/*******************************************************
*****************A VALIAÇÃO OUVIDORIA BACEN MARCELO******
**********************************************************/


/********************************************************************/
/****************************** ANEXOS ******************************/
/********************************************************************/

  # Vinicius Cunha
require_once($_SERVER["DOCUMENT_ROOT"]."/callcenter/flw_manu_anexo.php");

/********************************************************************/
/**************************** FIM ANEXOS ****************************/
/********************************************************************/



  if($mkFlwParam["campo_extra_apos_motivo"] != "S") {

    $mk_cextra_sigla      = "FLWEXTRAPAI".$flw_tema_pai;
    $mk_cextra_classe     = "FM".achaNroModelo($nro_modelo,$tipo_abertura)."C";
    $mk_cextra_sistema_bd = "CC";
    if($flw_tema_pai && $campo_extra_tipo_rotina == "N") {// VERIFICA SE O MODELO/DISCADOR UTILIZA A ROTINA NOVA DO CAMPO EXTRA
    ?>
      <tr>
        <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
      </tr>
    <?
    }
    $mk_cextra_sigla      = "FLWEXTRA".$flw_tema_pai.$flw_tema;
    $mk_cextra_classe     = "FM".achaNroModelo($nro_modelo,$tipo_abertura)."C";
    $mk_cextra_sistema_bd = "CC";
    if($flw_tema_pai && $flw_tema && $campo_extra_tipo_rotina == "N") {// VERIFICA SE O MODELO/DISCADOR UTILIZA A ROTINA NOVA DO CAMPO EXTRA
    ?>
      <tr>
        <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
      </tr>
    <?
    }
  }

  if($vlrClasseTemaPai == "S") {
    if ($flw_tema) {
      if ($flw_tema_pai) {

        ksort($retParamMotivo);
        if (is_array($retParamMotivo) === true) {
          foreach ($retParamMotivo as $indice => $classe_FM_A) {
            if (strpos("xxx".$indice, "COLETA_CPO,".$flw_tema_pai.$flw_tema) > 0) {
              $campos_update .= $classe_FM_A["descricao"];
            }
          }
        }

        if ($campos_update != "") {
  ?>

      <input type="hidden" name="mk_campos_update" value="<?print $campos_update?>">
      <tr><td colspan="2">

      <table border="0" width="100%" style="background-color:#FFFACD;" >
      <tr class="txt6" bgcolor="<?print $session["td_destaque"]?>">
        <td colspan="2"><strong>Dados Complementares</strong></td>
      </tr>
      <?
      $arrCamposUpdateSA = explode("§",$campos_update);
      if (is_array($arrCamposUpdateSA)) {
        foreach ($arrCamposUpdateSA as $key => $value) {
          if ($value) {
            $arrAtributosCamposUpdateSA = explode("¢",$value);
            if($arrAtributosCamposUpdateSA[5] == "consistir"){
              $arrAtributosCamposUpdateSA[5] = "sempre";
            }else{
              $arrAtributosCamposUpdateSA[5] = "sopreenchido";
            }

            ?>
            <tr class="txt5">
              <td><strong><?print $arrAtributosCamposUpdateSA[0];?>:</strong></td>
              <td>
            <?
            switch ($arrAtributosCamposUpdateSA[3]) {
              case "V":
                   ?>
                   <font class="txt5">
                   <script language="javascript" type="text/javascript" src="/js/montaMascara.js"></script>
                   <font class="txt5"><input type="text" name="<?print $arrAtributosCamposUpdateSA[1]?>"  size="12"  value="<?print number_format(${$arrAtributosCamposUpdateSA[1]},"2",",",".")?>"  maxlength="12" consistir="<?print $arrAtributosCamposUpdateSA[5]?>"  tipodado="moeda" msg="Preencha corretamente o campo <?print $arrAtributosCamposUpdateSA[0];?>!" onkeyup="this.value=montaMascara('[###.]###,##',this.value)">
                   <?
                   break;
              case "D":
                $cup_dia_aux = $arrAtributosCamposUpdateSA[1]."_dia";
                $cup_mes_aux = $arrAtributosCamposUpdateSA[1]."_mes";
                $cup_ano_aux = $arrAtributosCamposUpdateSA[1]."_ano";



                if(!$$cup_dia_aux){$$cup_dia_aux = substr(${$arrAtributosCamposUpdateSA[1]},8,2);};
                if(!$$cup_mes_aux){$$cup_mes_aux = substr(${$arrAtributosCamposUpdateSA[1]},5,2);};
                if(!$$cup_ano_aux){$$cup_ano_aux = substr(${$arrAtributosCamposUpdateSA[1]},0,4);};

                if (($$dia_aux == "11") && ($$mes_aux == "11") && ($$ano_aux == "1111")) {
                  $$cup_dia_aux = "";
                  $$cup_mes_aux = "";
                  $$cup_ano_aux = "";
                }
                if (($$dia_aux == "00") && ($$mes_aux == "00") && ($$ano_aux == "0000")) {
                  $$cup_dia_aux = "";
                  $$cup_mes_aux = "";
                  $$cup_ano_aux = "";
                }

                print dataCalendarioNovoSimples($cup_dia_aux,$cup_mes_aux,$cup_ano_aux ,"", "", "vazio_2".$arrAtributosCamposUpdateSA[1], "cadastro","",$arrAtributosCamposUpdateSA[5]);
                break;
              case "T":
                  ?>
                  <input type="text" name="<?print $arrAtributosCamposUpdateSA[1];?>" value="<?print ${$arrAtributosCamposUpdateSA[1]};?>" consistir="<?print $arrAtributosCamposUpdateSA[5];?>" tipodado="<?print $arrAtributosCamposUpdateSA[6]?>" msg="Preencha corretamente o campo <?print $arrAtributosCamposUpdateSA[0];?>">
                  <?
                  break;
              case "A":
                if (${$arrAtributosCamposUpdateSA[1]."_mes"} == "") {
                  ${$arrAtributosCamposUpdateSA[1]."_mes"} = date(m);
                }
                if (${$arrAtributosCamposUpdateSA[1]."_ano"} == "") {
                  ${$arrAtributosCamposUpdateSA[1]."_ano"} = date(Y);
                }
                    ?>
                    <input type="text" name="<?print $arrAtributosCamposUpdateSA[1];?>_mes" value="<?print ${$arrAtributosCamposUpdateSA[1]."_mes"};?>" size="2" maxlength="2" consistir="<?print $arrAtributosCamposUpdateSA[5];?>" tipodado="<?print $arrAtributosCamposUpdateSA[6]?>" msg="Preencha corretamente o campo <?print $arrAtributosCamposUpdateSA[0];?>">
                    /
                    <input type="text" name="<?print $arrAtributosCamposUpdateSA[1];?>_ano" value="<?print ${$arrAtributosCamposUpdateSA[1]."_ano"};?>" size="4" maxlength="4" consistir="<?print $arrAtributosCamposUpdateSA[5];?>" tipodado="<?print $arrAtributosCamposUpdateSA[6]?>" msg="Preencha corretamente o campo <?print $arrAtributosCamposUpdateSA[0];?>">
                    <?
                    break;
              case "C":
                $optionsSelectAtributosCamposUpdateSa = MontaCombo($arrAtributosCamposUpdateSA[4],${$arrAtributosCamposUpdateSA[1]},$repre_vendedor);
                  ?>
                  <select name="<?print $arrAtributosCamposUpdateSA[1];?>" consistir="<?print $arrAtributosCamposUpdateSA[5];?>" tipodado="<?print $arrAtributosCamposUpdateSA[6];?>" msg="Preencha corretamente o campo <?print $arrAtributosCamposUpdateSA[0];?>">
                  <?
                  print $optionsSelectAtributosCamposUpdateSa;
                  ?>
                  </select>
                  <?
                  break;
            }
            ?>
              </td>
            </tr>
            <?
          }
        }
      }
    ?>
    </table>

    </td></tr>
    <?
        }
        if ($observacao_receptivo != "N" && $observacao_receptivo_local_flw == "D") {
          $arr_observacao_receptivo = explode("¢",$observacao_receptivo);
          if (empty($arr_observacao_receptivo[0]) === true) {
            $arr_observacao_receptivo[0] = $arr_conclusao[5].":";
          }

          if(!$observacao_receptivo_width) {
            $obs_width = "500";
          } else {
            $obs_width = $observacao_receptivo_width;
          }

          if(!$observacao_receptivo_height) {
            $obs_height = "50";
          } else {
            $obs_height = $observacao_receptivo_height;
          }

          if($arr_observacao_receptivo[1] == "N" || $arr_observacao_receptivo[1] == "" || achaNroModelo($nro_modelo,$tipo_abertura) == "BH") {
            $consiste_obs_recep = "sopreenchido";
          } else {
            $consiste_obs_recep = "sempre";
          }

          if($observacao_rec_especial == "S" || achaNroModelo($nro_modelo,$tipo_abertura) == "M4" || achaNroModelo($nro_modelo,$tipo_abertura) == "78" || (substr($repre,0,9) == "BOLSANOVA" || substr($repre,0,7) == "BOVESPA" || achaNroModelo($nro_modelo,$tipo_abertura) == "HS")){
            $consiste_obs_tipodado = "preenchido";
          }else{
            $consiste_obs_tipodado = "todosbarra";
          }

          if($usa_bootstrap == "S" && !(strpos($_SERVER['HTTP_USER_AGENT'], "Chrome") || strpos($_SERVER['HTTP_USER_AGENT'], "Firefox"))) {
            ?>
            </table>
            <div class="col-md-4 table-bordered" style="padding-bottom:73px; width: 315px;">
              <strong><?print $arr_observacao_receptivo[0];?>:</strong>
            </div>
            <div class="col-md-8 table-bordered pad-top20 pad-bottom20" style="width: 823px;">
              <textarea name="flw_descricao" style="white-space: pre-wrap;width: <?print $obs_width?>px; height: <?print $obs_height?>px;" consistir="<?print $consiste_obs_recep;?>" tipodado="<?print $consiste_obs_tipodado;?>" minlength=10 msg="Preencha corretamente o campo <?print $arr_observacao_receptivo[0];?>." OnKeyUp="javascript:countOnkeypress(this.value.length, '<?print $arr_observacao_receptivo[2];?>');if (this.value.length > <?print $arr_observacao_receptivo[2];?>) {alert('Tamanho limite do campo atingido, qualquer caracter digitado apartir deste será excluído.');document.getElementById('sizer_desc').innerHTML = '0'; this.value = this.value.substring(0,<?print $arr_observacao_receptivo[2];?>); this.blur();}"><?print $flw_descricao;?></textarea>
              <span id="sizer_desc" class="txtvermelho3" style="width: 25;color: #DD0000;text-align: right;"><?print ($arr_observacao_receptivo[2] - strlen($flw_descricao));?></span>
            </div>
            <table class="table table-bordered">
            <?
          } else {
            ?>
              <tr id="tr_obs_receptivox">
                <td><font class="txt5"><strong><?print $arr_observacao_receptivo[0];?>:</strong></font></td>
                <td nowrap><font class="txt5">
                  <textarea name="flw_descricao" style="white-space: pre-wrap;width: <?print $obs_width?>px; height: <?print $obs_height?>px;" consistir="<?print $consiste_obs_recep;?>" tipodado="<?print $consiste_obs_tipodado;?>" minlength=10 msg="Preencha corretamente o campo <?print $arr_observacao_receptivo[0];?>." OnKeyUp="javascript:countOnkeypress(this.value.length, '<?print $arr_observacao_receptivo[2];?>');if (this.value.length > <?print $arr_observacao_receptivo[2];?>) {alert('Tamanho limite do campo atingido, qualquer caracter digitado apartir deste será excluído.');document.getElementById('sizer_desc').innerHTML = '0'; this.value = this.value.substring(0,<?print $arr_observacao_receptivo[2];?>); this.blur();}"><?print $flw_descricao;?></textarea>
                  <span id="sizer_desc" class="txtvermelho3" style="width: 25;color: #DD0000;text-align: right;"><?print ($arr_observacao_receptivo[2] - strlen($flw_descricao));?></span>
                </td>
              </tr>
            <?
          }
        }

        ?>
        <?
        // REQUIRE_ONCE VINICIUS
        $file = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_flw_".$include_dados.".php", "N");
        if(file_exists($file)) {
          ?>
          <tr>
            <td colspan="2"><?require_once($file);?></td>
          </tr>
          <?
        }
      }
    }
  } else {
    if ($flw_tema) {
      // REQUIRE_ONCE VINICIUS
      $file = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_flw_".$include_dados.".php", "N");
      if(file_exists($file)) {
        ?>
        <tr>
          <td colspan="2"><?require_once($file);?></td>
        </tr>
        <?
      }
    }
  }
}

if($nro_modelo == "HS" && $flw_tema) {
  ?>
  <tr>
    <td class="txt5"><strong>Prioridade:</strong></td>
    <td class="txt5">
      <?
      if($flw_nivel_acesso == "999") {
        $where_radio = " AND vlr_classe IN ('3','9') ";
      } else {
        $where_radio = "ZZ";
      }
      require_once("funcoes/MontaRadio.php");
      print MontaRadio("cadastro","sacura_prioridade", "S", "4", "EKHS1", $repre_vendedor, $where_radio);
      ?>
    </td>
  </tr>
  <?
}

$utilizaClassificacaoFinal = trim(ValorClasse("FM".achaNroModelo($nro_modelo,$tipo_abertura)."K", "UTILIZA_CLASSIFICACAO_FINAL", $repre_flw));
if($utilizaClassificacaoFinal != "--" && $flw_nivel_acesso != "999") {
  MontaCombo($utilizaClassificacaoFinal, "", $repre_flw);
  ?>
  <tr id="idTrClassificacaoFinal" <?if($usa_flw_conclusao_ajax == "S"){?>style="display: none;"<?}?>>
    <td class="txt5"><strong><?print $titClasse?>:</strong></td>
    <td class="txt5">
      <?
      require_once("funcoes/MontaRadio.php");
      print MontaRadio("cadastro","classificacao_final", "S", "4", $utilizaClassificacaoFinal, $repre_vendedor, $where_radio);
      ?>
    </td>
  </tr>
  <?
}

$exibir_email_fanaliza_atd = ValorClasse("FM".$nro_modelo."K","EXIBIR_EMAIL_FANALIZA_ATD",$repre_flw);
if($exibir_email_fanaliza_atd == "S") {?>
  <tr id="tr_obs_receptivo">
    <?if($flw_descricao_email) {?>
        <input type="hidden" name="flw_descricao_email" value="<?print $flw_descricao_email?>">
    <?}?>
  </tr><?
}

if (($usa_flw_conclusao_ajax == "S") || (($usa_flw_conclusao_ajax != "S") && ((($vlrClasseTemaPai != "S") && ($tem_tema === true) && ($flw_tema)) || (($vlrClasseTemaPai == "S") && ($tem_tema_pai === true) && ($flw_tema_pai) && ($tem_tema === true) && ($flw_tema))) && ($tem_param_tema === true) && ($tem_param_prioridade === true))) {
  //EDUARDO - NÃO REMOVER - FUNCIONA COMO A CONCLUSÃO DO ATD_PADRAO
?>
    <tr>
      <td id="id_follow_include_dados" colspan="2"></td>
    </tr>
<?
/**
       * ROTINA RESPONSÁVEL POR ATRIBUIR UM RESPONSÁVEL POR RESOLVER O ATENDIMENTO. PRECISA SER PARAMETRIZADO NA FM__K O PARAMETRO "USA_ATIV_PLATAFORMA"
       * -QUANDO A ÁREA DESTINO FOR ENCERRADO(999), ELE ABRE UM COMBO PARA SELEÇÃO DA ÁREA
       * -QUANDO A ÁREA DESTINO FOR QUALQUER UMA DA FM__N, FIXA ELA COMO RESPONSÁVEL
       */
if (($usa_flw_conclusao_ajax != "S") && ($mkFlwParam["usa_ativ_plataforma"] && substr($mkFlwParam["usa_ativ_plataforma"], 0, 3) == "ATD")) {
  $arr_param_plataforma = explode("¢", $mkFlwParam["usa_ativ_plataforma"]);

  if ($flw_tema_pai && $flw_tema) {
    $opt_ativ_plataforma = MontaCombo($arr_param_plataforma[1],$ativ_plataforma,$repre);
?>
    <tr>
      <td class="txt5"><strong><?print $titClasse;?>:</strong></td>
      <td class="txt5">
<?
if ($flw_nivel_acesso == "999") {
?>
        <select name="ativ_plataforma" consistir="sempre" tipodado="preenchido" msg="Preencha corretamente a <?print $titClasse;?>">
          <?print $opt_ativ_plataforma;?>
        </select>
<?
} else {
  $ativ_plataforma = $flw_nivel_acesso;
?>
        <input type="hidden" name="ativ_plataforma" value="<?print $ativ_plataforma;?>">
        <?print ValorClasse($arr_param_plataforma[1],$ativ_plataforma,$repre);?>
<?
}
?>
      </td>
    </tr>
<?
  }
}
}
?>
  </table>
  </div>
  <a href="idAncora" id="idAncora"></a>
<?
if (($usa_flw_conclusao_ajax == "S") || (($usa_flw_conclusao_ajax != "S") && ((($vlrClasseTemaPai != "S") && ($tem_tema === true) && ($flw_tema)) || (($vlrClasseTemaPai == "S") && ($tem_tema_pai === true) && ($flw_tema_pai) && ($tem_tema === true) && ($flw_tema))))) {
  // ********************************************************************************************************** //
  // ********************************** TESTE DO ACAO INTELIGENTE FLUTUANTE *********************************** //
  // ********************************************************************************************************** //
  if (empty($param_ativ_acao_inteligente) === false && empty($param_ativ_tipo_acao_inteligente) === false) {
    $agrupamento = $param_ativ_acao_inteligente;
    if ($param_ativ_tipo_acao_inteligente == "FLUTUA") {
      require_once("funcoes/ScriptInteligente.php");//Include do Ação Inteligente
      $mk_numero = achaNroModelo($nro_modelo,$tipo_abertura);//Variável contendo Discador/Modelo+Nro
      if ($flw_tema_pai) {
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      } else {
        $flw_tema_pai = "FM".$mk_numero."T";
        $array_retorno_AI = mostraRegraScript(DefineRepre($repre_vendedor), $agrupamento."¢".$mk_numero."-".$flw_tema_pai."-".$flw_tema, "ARR");
      }
      //********************************************************************
      //**************FUNÇÕES E STYLE SCRIPT FLUTUANTE*********************
      //********************************************************************
?>
  <script type="text/javascript">
  $(document).ready(function() {
    var y_fixo = $("#div_script_flutuante").offset().top;
    $(window).scroll(function () {
      MenuFlutuaPOS();
    }).load(function () {
      MenuFlutuaPOS();
    }).resize(function () {
      MenuFlutuaPOS();
    });
  });


  function scriptOperadorMostraEsconde(id) {
    if ($("#controle_"+id).val() == "E") {
      $("#controle_"+id).val("M");
      $("#"+id).show();
    } else {
      $("#controle_"+id).val("E");
      $("#"+id).hide();
    }
  }

  function MenuFlutuaPOS() {
    var menuLeft, menuTop, telaLeft, telaTop = 0;

    var jObjMenu = $("#div_script_flutuante");
    var jObjCab = $("#gcTable");

    var fimCab = (jObjCab.offset().top);
    menuTop = fimCab;
    if ($(document).scrollTop() >= fimCab) {
      menuTop = $(document).scrollTop();
    }

    jObjMenu.css({
      top: menuTop + "px"
    });
  }
  </script>
  <style type="text/css">
  #div_script_flutuante {
    margin:0;
    padding:0;
    position:absolute;
    z-index: 99999;
    top:1px;
    right:1px;
  }

  #div_script_flutuante_conteudo {
    height:200px;
    width:400px;
    display: "block";
    background-color: #FFFFFF;
    border: 2px solid <?print $session["td_destaque"];?>;
    overflow-x: hidden;
    overflow-y: auto;
    z-index: 10000;
  }
  </style>
<?
//**************************************************************
//**************************************************************
//**************************************************************

//**************************************************************
//**************TRATAMENTO SCRIPT FLUTUANTE*********************
//**************************************************************

$tab .= "<div id=\"div_script_flutuante\" align=\"right\">";
$tab .= "<img src=\"imagens/info_flutuante.gif\" onclick=\"scriptOperadorMostraEsconde('div_script_flutuante_conteudo');\" style=\"cursor: pointer;\" title=\"Ajuda Inteligente.\">";
$tab .= "<div id=\"div_script_flutuante_conteudo\">";
$tab .= "<input type=\"hidden\" name=\"controle_div_script_flutuante_conteudo\" id=\"controle_div_script_flutuante_conteudo\"";
if (empty($controle_div_script_flutuante_conteudo) === true) {
  $tab .= " value='M'";
} else {
  $tab .= " value='".$controle_div_script_flutuante_conteudo."'";
}
$tab .= ">";
$tab .= "<script type=\"text/javascript\">";
$tab .= "if ($('#controle_div_script_flutuante_conteudo').val() == 'E') {";
$tab .= "  $('#div_script_flutuante_conteudo').hide();";
$tab .= "} else {";
$tab .= "  $('#div_script_flutuante_conteudo').show();";
$tab .= "}";
$tab .= "</script>";
$tab .= "<table width=\"100%\">";
if (is_array($arraySIassunto) === true) {
  if (count($arraySIassunto) == 1) {
    $esconde_script_flutuante = "N";
  } else {
    $esconde_script_flutuante = "S";
  }
  foreach ($arraySIassunto as $chave => $valor) {
    $tab .= "<tr>";
    $tab .= "  <td width=\"100%\" bgcolor=\"".$session['td_destaque']."\"";
    if ($esconde_script_flutuante == "S") {
      $tab .= "onclick=\"javascript: scriptOperadorMostraEsconde('tr_script_flutuante_conteudo_".$chave."');\" style=\"cursor: pointer;\"";
    }
    $tab .= "><font class=\"txt6\"><strong><img src='imagens/farol_verde.gif' border='0' width='12px' height='12px'>&nbsp;".$valor."</strong></font></td>";
    $tab .= "</tr>";
    $tab .= "<tr id=\"tr_script_flutuante_conteudo_".$chave."\"";
    if (empty(${"controle_tr_script_flutuante_conteudo_".$chave}) === true) {
      if ($mtr_script_flutuante[4] == "A" || count($arraySIassunto) == 1) {
        $tab .= " style=\"display: 'block';\" ";
      } else {
        $tab .= " style=\"display: 'none';\" ";
      }
    }
    $tab .= ">";
    $tab .= "<input type=\"hidden\" name=\"controle_tr_script_flutuante_conteudo_".$chave."\" id=\"controle_tr_script_flutuante_conteudo_".$chave."\"";
    if (empty(${"controle_tr_script_flutuante_conteudo_".$chave}) === true) {
      if (count($arraySIassunto) == 1) {
        $tab .= " value='M' ";
      } else {
        $tab .= " value='E' ";
      }
    } else {
      $tab .= " value='".${"controle_tr_script_flutuante_conteudo_".$chave}."'";
    }
    $tab .= ">";
    $tab .= "<script type=\"text/javascript\">";
    $tab .= "if ($('#controle_tr_script_flutuante_conteudo_".$chave."').val() == 'E') {";
    $tab .= "  $('#tr_script_flutuante_conteudo_".$chave."').hide();";
    $tab .= "} else {";
    $tab .= "  $('#tr_script_flutuante_conteudo_".$chave."').show();";
    $tab .= "}";
    $tab .= "</script>";
    $tab .= "<td>";
    $tab .= "  <table width=\"100%\">";
    $tab .= "    <tr>";
    $tab .= "      <td bgcolor=\"".$cor_td_arg."\" width=\"100%\">";
    $tab .= "        <font class=\"txt5\">".str_replace("a href", "a target='_blank' href", $array_retorno_AI[$chave])."</font>";
    $tab .= "      </td>";
    $tab .= "    </tr>";
    $tab .= "  </table>";
    $tab .= "</td>";
    $tab .= "</tr>";
  }
} else {
  $tab .= "<tr><td><font class='txtvermelho3'><strong>Nenhum script de ajuda cadastrado.</strong></font></td></tr>";
}
$tab .= "</table>";
$tab .= "</div>";
$tab .= "</div>";
print $tab;
    }
  }
  // ********************************************************************************************************** //
  // ********************************** TESTE DO ACAO INTELIGENTE FLUTUANTE *********************************** //
  // ********************************************************************************************************** //
?>
  <br>
  <script type="text/javascript">
  function enviarPropostaMK() {
      <?
       /*
        * @BOTAO: Enviar
        */
        $emailsms_condicao = VerificaGravaSolicitanteFiltroObrigatorioEmailsms($nro_modelo);
        if ($emailsms_condicao != "")
        {
      ?>
          if(<?=$emailsms_condicao?>)
          {
            var campoCelular = $("input[name=fone_1]", "form[name=cadastro]");
            var campoEmail = $("input[name=solicitante_email]", "form[name=cadastro]");
            if(campoEmail.is(":disabled") && campoCelular.is(":disabled"))
            {
              alert("Erro: Os campos CELULAR e E-MAIL estão desabilitados juntos. Habilite e preencha um dos dois campos para continuar!");
              return false;
            }
          }
      <? }//FIM SU-88698 4/4

    if ($arr_permissao_altera_vecto[7] == "S") {
      ?>
      if (!comparaDataIgual('<?print $ativ_data_vecto?>', document.getElementById('id_ano_vecto_ativ').value+"-"+document.getElementById('id_mes_vecto_ativ').value+"-"+document.getElementById('id_dia_vecto_ativ').value)) {
        alert("Data não pode ser menor que <?print BRDate($ativ_data_vecto)?>");
        return false;
      }
      <?
    }


    //QUANDO ESTIVER UTILIZANDO A ROTINA DE INFOS DO SOLICITANTE IGUAIS AO DK
    //O SISTEMA IRÁ VERIFICAR SE AO MENOS UMA DAS OPÇÕES DE CONTATO FOI PREENCHIDA
    if ($mkFlwParam['grava_solicitante_tipo'] == 'DK') {
      ?>
      var contPreenchido = 0;
      for (var i = 0; i < 5; i++) {
        if (((typeof($("#id_ddd_"+i).val()) != 'undefined') && ($("#id_ddd_"+i).val() != '')) || ((typeof($("#id_fone_"+i).val()) != 'undefined') && ($("#id_fone_"+i).val() != ''))) {
          contPreenchido++;
        }
      }

      if (contPreenchido == 0) {
        alert("Preencha ao menos uma das opções de telefone para que o setor responsável possa entrar em contato.");
        $("#id_ddd_1").focus();
        return false;
      }

      //CONSISTINDO O NÚMERO DE CELULAR CASO O OPERADOR NÃO TENHA CLICADO NO BOTÃO "Não possui celular"
      if ($("#id_solicitante_celular_ctr").val() == 'S') {
        if (($("input[tipofone='celular'][name^='ddd_']").val().length != $("input[tipofone='celular'][name^='ddd_']").attr('maxLength')) || ($("input[tipofone='celular'][name^='fone_']").val().length != $("input[tipofone='celular'][name^='fone_']").attr('maxLength'))) {
          alert("Preencha corretamente o número de celular com DDD ou clique sobre o botão 'Não possui celular'.");
          $("input[tipofone='celular'][name^='ddd_']").focus();
          return false;
        }
      }
      <?
    }

    //ESTAMOS ADICIONANDO ESTA VERIFICAÇAO PARA IMPEDIR QUE A TELA SEJA ENVIADA SEM CONSISTIR OS CAMPOS OBRIGATÓRIOS DO SOLICITANTE EM MODELO DK
    if ($mkFlwParam['grava_solicitante_tipo'] != 'DK') {
    ?>
      var consisteCampoEncerramento="";

      if($('#consisteCampoEncerramento')[0]) {
        consisteCampoEncerramento = $('#consisteCampoEncerramento').val();
      }

     if (("<?print $flw_opcao_click_final?>" == "mostra_n_contato") || (consisteCampoEncerramento && consisteCampoEncerramento != "ZZ")) {
      <?if ($registra_n_contato != "--") {?>
      if (!consisteCampo($("#mk_origem_atd")[0])) {
        return false;
      }
      <?}?>

      document.cadastro.action = "md_cad_prop_bd.php";
      document.cadastro.atv_st_venda_cartao .value = '0';
      if(document.cadastro.tipo_atend_co.value == ''){
        document.cadastro.tipo_atend_co.value = '0';
      }
      passou_dados = confereDadosIncompl(document.cadastro);
      document.cadastro.submit();
      return false;
    }
    <?
    }
//    }

    if (substr($repre_vendedor,0,7) == "TRACKER") {
      ?>
      if(!$('*[name=flw_tema]')[0]) {
        alert("Nenhum <?print $titTema;?> Encontrado, Atualize a Tela e Envie Novamente, Caso o Erro Persista Enviar um Print da Tela ao SAC!");
        return false;
      }
      <?
    }

    if (mb_strtoupper($nro_modelo) === "8A") {
      ?>
      if(typeof consBloqueioProcon === "function") {
        var varConsBloqueioProcon = consBloqueioProcon();

        if(varConsBloqueioProcon !== "OK") {
          alert(varConsBloqueioProcon);
          return false;
        }
      }
      <?
    }
    ?>
    document.getElementById('id_bt_enviar').disabled = true;
    completaReceptivo(document.cadastro);
  } //Fim enviarPropostaMK
  </script>
  <div align="center">
    <?
      //Alteração da condição feito por Vitor Bailon.
      if($IntergrAllHeader){
    ?>
      <button type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-success" style="width: 10%;" onClick="javascript: enviarPropostaMK();">Enviar</button> <!-- ENVIAR O FORM -->
    <?
      }else{
    ?>
      <input type="button" name="bt_enviar" id="id_bt_enviar" value="Enviar" style="width: 150px; background: #CCCCFF;" onClick="javascript: enviarPropostaMK();">
    <?
      }
    ?>
    <input type="hidden" style="border:'none'" readonly size="100" name="desc_botao_env">
  </div>
<?
}

//REGISTRO DE ATENDIMENTO
if (substr($botao_finaliza_cliente, 0, 1) == "A") {
?>
  <script type="text/javascript">
  if ($("#id_flw_opcao_click_final").val() == "") {
    mostraEscondeFinalFlw('esconde');
  } else {
    mostraEscondeFinalFlw($("#id_flw_opcao_click_final").val());
  }
  </script>
<?
}
break;
  case "AGENDA_RETORNO":
  case "ATIVO":
  case "INDICACAO":
  case "INDICACAO_MK":
  case "RECEPTIVO":
  case "ATIVO_DISCAR":
  case "ATIVO_LEADS":
  case "RETORNO":
?>
        <input type="hidden" name="prp_seq" value="<?print $prp_seq?>">
        <input type="hidden" name="prp_midia" value="<?print $prp_midia?>">
        <input type="hidden" name="salv_agenda" value="S">
        <?if($IntergrAllHeader) {
          if(file_exists($prg_include_dados) && $conclusao_receptivo != "S"){
            //INCLUDE DE TODO O ESQUEMA DO FORMULARIO********************
            include $prg_include_dados;
            //***********************************************************
          }
         }else{?>
          <tr>
            <td align="center">
              <?if ($conclusao_receptivo != "S") {
                //INCLUDE DE TODO O ESQUEMA DO FORMULARIO********************
                if($prg_include_dados){
                  include $prg_include_dados;
                }
                //***********************************************************
                  }?>
             </td>
          </tr>
        <?}
        //showvars();
        ?>
  <?if($exibir_email_resposta == "S") {?>
      <!--COLOCAR PARAMETRO NA MAO PARA APARECER-->
      <div class='simple-panel' id='tr_obs_receptivo' style="display: none; border-top-color: <?print $session["td_destaque"]?> !important;">
	    <?if($flw_descricao_email) {?>
          <input type="hidden" name="flw_descricao_email" value="<?print $flw_descricao_email?>">
        <?}?>
	  </div>
      <!--COLOCAR PARAMETRO NA MAO PARA APARECER-->
  <?}?>

<?
if($prefixo_classe_tema_pai) {
?>
<tr bgcolor="<?print $session['td_dado3']?>">
  <td width="100%"><a name="dados_conclu"></a><a name="dados_con"></a>
    <?require_once("md_cad_prop_2_tema_pai.php");?>
   </td>
</tr>
<?}
if ($conclusao_receptivo == "S") {
?>
         <input type="hidden" name="tipo_atend_co" value="<?print $tipo_atend_co?>" consistencia="sempre" consistencia1="pre" msg="Clique em um tipo de conclusão para o atendimento." tipo="hidden">














<?if($IntergrAllHeader === true){?>

    <script language="JavaScript">
    function conclusaoBootstrap(st_venda){
      if(document.getElementById('tipo_atend_'+st_venda).disabled == false){
        $("#tipo_atend_"+st_venda).attr("checked", true);
        $("#tipo_atend_"+st_venda).prop("checked", true);
        $("#tipo_atend_"+st_venda).click();
      }
    }

    </script>

    <!--
    NÃO APAGAR O FECHAMENTO DESSA TAG 'FONT', ELE FOI FEITO PARA RESOLVER UM BUG COM O PLUGIN DE ABAS DO BOOTSTRAP
    -->
    </div></div>

    <div class="row" style="background:#CFCFCF; margin-right:0px; margin-left:0px;">
      <?if(!(achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){?>
        <div class="col-md-4 text-center pad-top5">
          <a name="dados_conclu"></a><a name="dados_con"></a>
          <i class='icon24 i-pencil-3' title='<?print $arr_conclusao[0]?>'> <?print $arr_conclusao[0]?>: </i>
        </div>
      <?}?>
      <div class="col-md-8 text-center">
         <ul id="myTab" class="nav nav-tabs">
         <?
         // Possibilidade de customizar icone alterando o mesmo pelo include.
         // Silvio - 29/11/2016
         if(!$ico_conclusao_1) { $ico_conclusao_1 = "i-thumbs-up  green"; }
         if(!$ico_conclusao_2) { $ico_conclusao_2 = "i-thumbs-down  red"; }
         if(!$ico_conclusao_3) { $ico_conclusao_3 = "i-contact-remove-2  orange"; }
         if(!$ico_conclusao_4) { $ico_conclusao_4 = "i-calendar-4  blue"; }
          ?>
           <?if($arr_conclusao[1] && !(achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){?>
              <li  id='li_dk_1' class="<?if($tipo_atend == "1"){?>active<?}?>"><a href="#Aba1" data-toggle="tab"  onClick="conclusaoBootstrap(1);"><i class="<? print $ico_conclusao_1; ?>" id='teste1bs'></i><?print $arr_conclusao[1]?></a></li>
           <?}?>
           <?if($arr_conclusao[2]){?>
              <li id='li_dk_2' class="<?if($tipo_atend == "2"){?>active<?}?>"><a href="#Aba2" data-toggle="tab" onClick="conclusaoBootstrap(2);"><i class="<? print $ico_conclusao_2; ?>" id='teste2bs'></i><?print $arr_conclusao[2]?></a></li>
           <?}?>
           <?if($arr_conclusao[3]){?>
              <li id='li_dk_3' class="<?if($tipo_atend == "3"){?>active<?}?>"><a href="#Aba3" data-toggle="tab" onClick="conclusaoBootstrap(3);"><i class="<? print $ico_conclusao_3; ?>" id='teste3bs'></i><?print $arr_conclusao[3]?></a></li>
           <?}?>
           <?if($arr_conclusao[4]){?>
              <li id='li_dk_4' class="<?if($tipo_atend == "4"){?>active<?}?>"><a href="#Aba4" data-toggle="tab" onClick="conclusaoBootstrap(4);"><i class="<? print $ico_conclusao_4; ?>" id='teste4bs'></i><?print $arr_conclusao[4]?></a></li>
           <?}?>
         </ul>
      </div>
    </div>

    <div class="tab-content pad-bottom0" <?if((achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){?> style='display:none;'  <?}?>>

    <?}else{?>
        <tr bgcolor="<?print $session["td_dado3"]?>" >
          <td bgcolor="<?print $session["td_destaque"]?>"><a name="dados_conclu"></a><a name="dados_con"></a>
            <table width="100%" cellpadding="0" cellspacing="0">
              <tr>
                <td><font class="txt6">&nbsp;&nbsp;<b><label title="<?print $arr_conclusao[0]?>"><?print $arr_conclusao[0]?>:</label> </td>
              </tr>
            </table>
          </td>
        </tr>
<?}?>








































<?if($IntergrAllHeader === true){?>
      <div class="tab-pane fade in <?if($tipo_atend == "1"){print "active";}?>" id="Aba1">
        <div class="row">
          <div class='col-sm-12'>
<?}else{?>
      <tr bgcolor="<?print $session["td_dado3"]?>" onMouseOver="javascript:style.background='<?print $session["td_dado1"]?>'" OnMouseOut="javascript:style.background='<?print $session["td_dado3"]?>'">
        <td align="center">
          <table border="1" style='border-collapse: collapse' bordercolor="<?print $amarelo_escuro?>" width="100%" cellpadding="2" cellspacing="0" align="center">
                <tr bgcolor="<?print $amarelo?>">
                  <td width="100%" colspan="3" align="left"><font class="txt5"><strong>
<?}?>






<?
if ($arr_conclusao[1]) {
?>

                                          <input type="radio" name="tipo_atend" id="tipo_atend_1" value="1" <?if($IntergrAllHeader){print "style='display:none;'";}?>
<?


if ($tipo_atend == "1") {print "checked";}
?>
                                              OnClick="Javascript:<?if ($ag_qtd == 2) {?>document.cadastro.tipo_agenda_dsp[0].disabled=true;document.cadastro.tipo_agenda_dsp[1].disabled=true;<?}?><?if ($ag_qtd == 1) {?>document.cadastro.tipo_agenda_dsp.disabled=true;<?}?>atv_concl('1');
                                                 if (confereCabecalho(document.cadastro)) {
                                                   document.cadastro.setAttribute('action',document.cadastro.getAttribute('action1'));
                                                   if (confereMK(document.cadastro)) {
                                                   document.cadastro.tipo_atend.value='1';
                                                     document.cadastro.submit();
                                                   }
                                                 }"

                                          <?print $acao_tipo_atend_1?>>
<?
if(!$IntergrAllHeader){
  print "<label for='tipo_atend_1'>".$arr_conclusao[1]."</label>";
}
//print "<li>".$classe_venda;
if ($classe_followup != "" || $classe_venda != "") {
  if ($classe_followup != "") {
    $classe_combo = $classe_followup;
  } else {
    $classe_combo = $classe_venda;
  }
  if($IntergrAllHeader){print "Motivo: ";}
?>
                                    <select name="cod_recusa_1" id="id_cod_recusa_1" style="width:70%" consistencia="sempre" consistencia1="pre" msg="Selecione um Motivo de <?print $arr_conclusao[1]?>" <?print $acao_cod_recusa_1;?>>
<?
print MontaComboMotivoPorGrupo($classe_combo, $cod_recusa_1, $repre, $servico_dac);
//print MontaCombo($classe_combo,$cod_recusa_1,$repre);
?>
                                    </select>
<?
}


if($IntergrAllHeader){

?>
</div></div>
<?

}else{
?>
    </td>
  </tr>
<tr bgcolor="<?print $amarelo?>">
  <td width="50%" align="center" colspan="3">

<?
}
}
?>
<?



$nro_classe   = substr($cod_pesquisa,3);
if ($tipo_atend=="1") {
  if($prg_include_dados){
    include $prg_include_dados;
  }
}


if($possui_campo_extra_stvenda_1 == "S") {
  $mk_cextra_sigla      = "STVENDA_EXTRA_1";
  $mk_cextra_classe     = "MD".achaNroModelo($nro_modelo,$tipo_abertura)."B";
  $mk_cextra_sistema_bd = "MK";

  if($IntergrAllHeader){
    require("rotinas/CamposExtras.php");
  }else{
        ?>
          <tr>
            <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
          </tr>
        <?

  }


}
if($IntergrAllHeader){
	?>
	</div>
	<?
}else{
?>
                          </td>
                        </tr>
<?

}

?>


                        <!-- ---- AGENDA ---- -->


<?
if ($arr_conclusao[4]) {

  if (!$cor_agenda) {
    $cor_agenda = $amarelo;
  }

  if ($size_agenda) {
    $print_size_agenda = "<font size='".$size_agenda."'>";
  }
  if ($cor_fonte_agenda) {
    $print_cor_fonte_agenda = "<font color='".$cor_fonte_agenda."'>";
  }

  if ($IntergrAllHeader) {
    ?>
    <div class="tab-pane fade" id="Aba4">
      <div class="row">
        <div class='col-sm-12'>
    <?
  } else {
    ?>
    <tr bgcolor="<?print $cor_agenda?>">
      <td align="left" height="100%" colspan="2"><font class="txt5"><strong>
    <?
  }
  ?>
  <input type="radio" name="tipo_atend" id="tipo_atend_4" value="4"  <?if($IntergrAllHeader){print "style='display:none;'";}?>  OnClick="atv_concl(this.value);" <?if ($tipo_atend == "4") {print "checked";}?>><?if(!$IntergrAllHeader){print "<label for='tipo_atend_4'>".$print_size_agenda.$print_cor_fonte_agenda.$arr_conclusao[4].":</font></font></label>";}?>
  <?
  if (!$agenda_gravacao_normal) {
    $conteudo_agenda_receptivo = "<input name='btnAgendaRec' type='button' style='cursor:pointer;' onClick=\"AbreJanela('cc_agenda_retorno_inclui_cliente.php?repre=".$repre_vendedor."&campanha_indica=".$dk_campanha."&campo_chave_indica=".$dk_campo_chave."&deonde_md=agenda_receptivo&nro_modelo_passa=".achaNroModelo($nro_modelo,$tipo_abertura)."', 'janRegLig', '750','400','Agenda de Retorno');\" value='Agenda de Retorno' > ";
    //hiddens criado para gravar o motivo da indicação na gravação da proposta no agendamento
    ?>
    <input type="hidden" name="cod_recusa_indicacao"    id="id_cod_recusa_indicacao"    value="<?print $cod_recusa_indicacao;?>">
    <input type="hidden" name="classe_recusa_indicacao" id="id_classe_recusa_indicacao" value="<?print $classe_recusa_indicacao;?>">
    <?
    print $conteudo_agenda_receptivo;
  } else {
    ?>
    <font class="txt5">
    <?
    if ($classe_agenda != "") {
      if ($IntergrAllHeader ) {print "Motivo: ";}
        ?>
        <select name="cod_recusa_4" id="id_cod_recusa_4" style="width:70%" consistencia="sopreenchido" consistencia1="pre" msg="Selecione um Motivo de <?print $arr_conclusao[4]?>" <?print $acao_cod_recusa_4;?>>
          <?
          print MontaComboMotivoPorGrupo($classe_agenda, $cod_recusa_4, $repre, $servico_dac);
          //print MontaCombo($classe_agenda,$cod_recusa_4,$repre);
          ?>
        </select>
      <?
      if(!$IntergrAllHeader) {
        ?>
          </td>
        </tr>
         <tr bgcolor="<?print $cor_agenda?>">
              <td class="txt5" colspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <?
      } else {
        ?>
        </div>
        </div>
        <div class="row">
        <div class="col-xs-12"
        <?
                  }
}
$yr = date("Y");
$mn = date("m");
$dy = date("d");
$offset = $maxdt_agenda;
$day_ag_max = strftime("%Y-%m-%d",mktime(0,0,0,$mn,$dy+$offset,$yr));
    ?>
    <input type="hidden" name="hoje" value="<?print $hoje_ano."-".$hoje_mes."-".$hoje_dia;?>">
    <input type="hidden" name="data_ag_min" value="<?print $day_ag_min;?>">
    <input type="hidden" name="data_ag_max" value="<?print $day_ag_max;?>">
    <?
    if ($IntergrAllHeader) {
    ?>
    <br>Data: <span><input type="text" name="data_agenda" value="<?print date("d/m/Y")?>" min-date="<?print date("Y-m-d");?>" max-date="<?print $day_ag_max?>" class="input_datepicker" consistir="sempre" tipodado="todos" msg="Data de agendamento inválida"></span><br>
    <?
    } else {
      ?>
      <strong>Data:</strong>
      <?

      require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/DataCalendario.php");
      print dataCalendarioV4("dia_agenda", "mes_agenda", "ano_agenda", date("Y-m-d"), $day_ag_max, false, "", "S", "", $param_repre_vendedor, false);
      //                                  "Data:".DataCalendarioNovoSimples("dia_agenda", "mes_agenda", "ano_agenda", date("Y-m-d"), $day_ag_max, "", "cadastro");
      //                                  <input type="hidden" name="data_agenda" value="" consistencia="" consistencia1="pre" consistencia2="data" tipo="hidden" msg="Data de agendamento inválida">
    }
    ?>
    &nbsp;&nbsp;<strong>Hora:</strong>
    <select name="hora_agenda" consistencia="" consistencia1="pre" msg="Selecione o hora de agendamento">
    <option value="<?print date ('H');?>"><?print date ('H');?></option>
  	<?
  	for ($i = 8; $i<= 22; $i++) {
  	  if ($i >$max_hora_trabalho || $i < $min_hora_trabalho) {
  	    $style_hora_agenda = "style='color:#ff0000'";
  	  } else {
  	    $style_hora_agenda= "";
  	  }
  	  if ($i<10) {
  	    $i = "0".$i;
  	  }
  	  ?>
  	  <option value="<?print $i?>" <?print $style_hora_agenda?>><?print $i?></option>
  	  <?
  	}
  	?>
    </select>
    :
    <select name="minu_agenda" consistencia="" consistencia1="pre" msg="Selecione os minutos do agendamento">
      <option value="00">00</option>
      <option value="15">15</option>
      <option value="30">30</option>
      <option value="45">45</option>
    </select>
    <?
    $achou_tipo_agenda = false;
    for ($i=0; $i <=4; $i++) {
      if ($tipo_agenda[$i] != "") {
        $achou_tipo_agenda = true;
        break;
      }
    }
    if ($achou_tipo_agenda == false) {
      print "<font class='txtvermelho'><strong><BR>ERRO NA PARAMETRIZAÇÃO DA AGENDA RETORNO. ENTRE EM CONTATO COM O SAC URANET E INFORME:  NENHUM TIPO DE AGENDA RETORNO FOI PARAMETRIDADO.</strong></font>";
      exit();
    }
    if ((!$tipo_agenda[0])  && ($tipo_agenda[1])) {
      $tipo_agenda_value = "universal";
    }
    if ((!$tipo_agenda[1]) && ($tipo_agenda[0])) {
      $tipo_agenda_value =  "dedicado";
    }
    if ((!$tipo_agenda[1]) && (!$tipo_agenda[0])) {
      $tipo_agenda_value =  "finalmailing";
    }

    $idAlvoTipoAgenda = "";
    $arr_id_agenda_indic[0] = "dedicado";
    $arr_id_agenda_indic[1] = "universal";
    $arr_id_agenda_indic[2] = "finalmailing";
    for ($i=0; $i<=5; $i++) {
      if (empty($tipo_agenda[$i]) === false) {
        if ($idAlvoTipoAgenda == "") {
          $idAlvoTipoAgenda = "idAlvo='".$arr_id_agenda_indic[$i]."'";
        }
        $title_motivo_agenda .= $tipo_agenda[$i]." / ";
      }
    }
    $title_motivo_agenda = substr($title_motivo_agenda, 0, -3);
    //hiddenn tipo agenda
    ?>
    <input type="hidden" name="tipo_agenda" id="tipo_agenda" value="<?print $tipo_agenda_value?>" consistencia="" consistencia1="pre" msg="Selecione se o Agendamento é <?print $title_motivo_agenda;?>" <?print $idAlvoTipoAgenda?>>
    &nbsp;&nbsp;<strong>Tipo:</strong>
    <?

    if ($tipo_agenda[0]) {
      if ($IntergrAllHeader === true) {
        ?>
        <font class="txtazul2"><input type="radio" name="tipo_agenda_dsp"  value="dedicado" id="dedicado" OnClick="$('#tipo_agenda').val(this.value);" <?if (!$tipo_agenda[1]){print "checked";}?>><label for="dedicado"><?print $tipo_agenda[0]?></label>
        <?
      } else {
        ?>
        <input type="radio" name="tipo_agenda_dsp"  value="dedicado" id="dedicado" OnClick="$('#tipo_agenda').val(this.value);" <?if (!$tipo_agenda[1]){print "checked";}?>><label for="dedicado"><?print $tipo_agenda[0]?></font>
        <?
      }
    }
    if ($tipo_agenda[1]) {
      if ($IntergrAllHeader === true) {
        ?>
        <font class="txtazul2"><input type="radio" name="tipo_agenda_dsp" value="universal" id="universal"  OnClick="$('#tipo_agenda').val(this.value);"     <?if (!$tipo_agenda[0]){print "checked";}?>><label for="universal"> <?print $tipo_agenda[1]?></label>
        <?
      } else {
        ?>
        <input type="radio" name="tipo_agenda_dsp" value="universal" id="universal"  OnClick="$('#tipo_agenda').val(this.value);"     <?if (!$tipo_agenda[0]){print "checked";}?>><label for="universal"><?print $tipo_agenda[1]?></label>
        <?
      }
    }
    if ($tipo_agenda[2]) {
      if ($IntergrAllHeader === true) {
        ?>
        <font class="txtazul2"><input type="radio" name="tipo_agenda_dsp" value="finalmailing"  id="finalmailing"   OnClick="$('#tipo_agenda').val(this.value);"     <?if ((!$tipo_agenda[0]) && (!$tipo_agenda[1])){print "checked";}?>><label for="finalmailing"><?print $tipo_agenda[2]?></label>
        <?
      } else {
        ?>
        <input type="radio" name="tipo_agenda_dsp" value="finalmailing"  id="finalmailing"   OnClick="$('#tipo_agenda').val(this.value);"     <?if ((!$tipo_agenda[0]) && (!$tipo_agenda[1])){print "checked";}?>><label for="finalmailing"><?print $tipo_agenda[2]?></label>
        <?
      }
    }
    /*<input type="hiddenn" name="tipo_agenda" value="<?if (!$tipo_agenda[0] && $tipo_agenda[1]) {print "universal";}?><?if (!$tipo_agenda[1] && $tipo_agenda[0]) {print "dedicado";}?>" consistencia="" consistencia1="pre" msg="Selecione se a agenda é <?print $tipo_agenda[0]?> ou <?print $tipo_agenda[1]?>" tipo="hidden">*/
  }

  if ($IntergrAllHeader) {
    ?>
    </div></div>
    <?
  } else {
    ?>
      </font>
      </td>
    </tr>
    <?
  }
  if ($possui_campo_extra_stvenda_4 == "S") {
    $mk_cextra_sigla      = "STVENDA_EXTRA_4";
    $mk_cextra_classe     = "MD".achaNroModelo($nro_modelo,$tipo_abertura)."B";
    $mk_cextra_sistema_bd = "MK";
    if($IntergrAllHeader){
      require("rotinas/CamposExtras.php");
    } else {
      ?>
      <tr>
        <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
      </tr>
      <?
    }
  }
  if ($IntergrAllHeader) {
    ?></div><?
  }
}













if($arr_conclusao[2]){$arr_conclusao_loop[2] = $arr_conclusao[2];}
if($arr_conclusao[3]){$arr_conclusao_loop[3] = $arr_conclusao[3];}
if($arr_conclusao[6]){$arr_conclusao_loop[6] = $arr_conclusao[6];}
if($arr_conclusao[7]){$arr_conclusao_loop[7] = $arr_conclusao[7];}
if($arr_conclusao[8]){$arr_conclusao_loop[8] = $arr_conclusao[8];}
if($arr_conclusao[9]){$arr_conclusao_loop[9] = $arr_conclusao[9];}



if(is_array($arr_conclusao_loop)){
  $marca_jason = 1;
  foreach ($arr_conclusao_loop as $st_venda_loop => $value_loop) {

    if($st_venda_loop == "2"){$classe_aux = $classe_recusa;}
    if($st_venda_loop == "3"){$classe_aux = $classe_c_imp;}
    if($st_venda_loop == "6"){$classe_aux = ${"classe_adic_".$st_venda_loop};}
    if($st_venda_loop == "7"){$classe_aux = ${"classe_adic_".$st_venda_loop};}
    if($st_venda_loop == "8"){$classe_aux = ${"classe_adic_".$st_venda_loop};}
    if($st_venda_loop == "9"){$classe_aux = ${"classe_adic_".$st_venda_loop};}





    if($IntergrAllHeader){


?>
        <!-- Removido a classe fade devido a bug que estava ocorrendo no cod_recusa_2 -->
           <div class="tab-pane" id="Aba<?print $st_venda_loop?>">
              <div class="row" id='row_alvo_tabulacao'>
                <div class='col-sm-12'>

<?

    }else{

?>
                          <tr bgcolor="<?print $amarelo?>">
                            <td colspan="3" nowrap><font class="txt5"><strong>
<?
    }


?>

                              <input type="radio" name="tipo_atend" id="tipo_atend_<?print $st_venda_loop?>" value="<?print $st_venda_loop?>"  <?if($IntergrAllHeader){print "style='display:none;'";}?> OnClick="<?if ($ag_qtd == 2) {?>document.cadastro.tipo_agenda_dsp[0].disabled=true;document.cadastro.tipo_agenda_dsp[1].disabled=true;<?}?><?if ($ag_qtd == 1) {?>document.cadastro.tipo_agenda_dsp.disabled=true;<?}?>atv_concl(this.value);" <?if ($tipo_atend == $st_venda_loop) {print "checked";}?>><?if(!$IntergrAllHeader){print "<label for='tipo_atend_".$st_venda_loop."'>".$arr_conclusao[$st_venda_loop]."</label>:";}?>
                              <?if(!${"usa_classe_venda_".$st_venda_loop} || ${"usa_classe_venda_".$st_venda_loop} == "S") { ?>
                                Motivo:
                                  <select id="id_cod_recusa_<?print $st_venda_loop?>" name="cod_recusa_<?print $st_venda_loop?>" style="width:70%" consistencia="" consistencia1="pre" msg="Selecione o motivo de <?print $arr_conclusao[$st_venda_loop]?>"   <?print ${"acao_cod_recusa_".$st_venda_loop}?>>
                                  <?
                                  if ($classe_recusa_status_bk == "S") {
                                    print MontaComboStatusBK($classe_aux,${"cod_recusa_".$st_venda_loop},$repre_vendedor, $param_empresa_produto, $arrTipoProduto, $connectHOST);
                                  } else {
                                    print MontaComboMotivoPorGrupo($classe_aux, ${"cod_recusa_".$st_venda_loop}, $repre_vendedor, $servico_dac);
                                    //print MontaCombo($classe_aux,${"cod_recusa_".$st_venda_loop},$repre_vendedor);
                                  }
                                  ?>
                                </select>
                              <?}
                              if($IntergrAllHeader){?>
                            </div></div>
                            <?}else{?>
                            </td>
                          </tr>
                          <tr bgcolor="<?print $amarelo?>" >
                            <td colspan="3">
                          <?}?>

                            <div id="tr_inc_st_venda_<?print $st_venda_loop?>">
                             <?
                             if(${"possui_campo_extra_stvenda_".$st_venda_loop} == "S") {
                               $mk_cextra_sigla      = "STVENDA_EXTRA_".$st_venda_loop;
                               $mk_cextra_classe     = "MD".achaNroModelo($nro_modelo,$tipo_abertura)."B";
                               $mk_cextra_sistema_bd = "MK";

                               if($IntergrAllHeader){
                                 require("rotinas/CamposExtras.php");
                               }else{



                                ?>
                                  <tr>
                                    <td colspan="2"><?require("rotinas/CamposExtras.php");?></td>
                                  </tr>
                                <?
                               }
                             }


                             $file = mkFileInclude($include_dados_pasta, $include_dados, "md_cad_prop_2_dados_".$st_venda_loop."_".$include_dados.".php", "N");

                             if(file_exists($file)){
                               if($IntergrAllHeader){
		                             	?>
							              <div class="row">
							                <div class='col-sm-12'>
		                             	<?
		                             	require_once($file);
		                             	?>
		                             	</div></div>
		                             	<?
                               }else{
                                 require_once($file);
                               }
                             }

                             if($IntergrAllHeader){
                               ?></div></div><?
                             }else{
				?>


          		</td>
      		</tr>
 		     <?}

 		     $marca_jason++;
  }
}

if (!$observacao_receptivo) {


  if($IntergrAllHeader) {
?>

<div class="row bg-info gap0 pad-top-10">
   <div class="col-xs-3">
 		  Observações:
   </div>
   <div class="col-xs-9">
        <?if (!$consiste_obs) {$consiste_obs = "sopreenchido";}?>
        <textarea name="prp_observacao" cols="90" rows="4" class='form-control' maxlength="100" consistencia="<?print $consiste_obs?>" consistencia1="pre" consistencia2=10 consistencia3="todos" msg="Preencha corretamente o campo de observações. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');}" OnBlur="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');}" ><?print $prp_observacao;?></textarea>
        <span id="sizer_obs" class="txtvermelho3"><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></font></span>
   </div>
</div>
<?

  }else{



?>
                            <tr>
                              <td align="left"width="1%" nowrap valign="top"><font class="txt5"><strong>Observações:</strong></font>
                                <?if (!$consiste_obs) {$consiste_obs = "sopreenchido";}?>
                                <textarea name="prp_observacao"  class='form-control' cols="90" rows="4" maxlength="100" consistencia="<?print $consiste_obs?>" consistencia1="pre" consistencia2=10 consistencia3="todos" msg="Preencha corretamente o campo de observações. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');}" OnBlur="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');}" ><?print $prp_observacao;?></textarea>
                                <span id="sizer_obs" class="txtvermelho3"><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></font></span>
                              </td>
                            </tr>
<?
  }
} else {
  if ($observacao_receptivo != "N") {
    $arr_observacao_receptivo = explode("¢",$observacao_receptivo);




    if (!$consiste_obs) {
      if ($arr_observacao_receptivo[1] == "S") {
        $consiste_obs = "sempre";
      } else {
        $consiste_obs = "sopreenchido";
      }
    }

    if (!$consiste_obs) {
      $consiste_obs = "sopreenchido";
    }
    if($observacao_rec_especial == "S"){
      $consiste_obs_tipodado = "preenchido";
      $consiste_obs_onblur = "";
    }else{
      $consiste_obs_tipodado = "todos";
      $consiste_obs_onblur = "onblur=\"this.value = this.value.replace(/[']+/g, '');\" ";
    }










    if($IntergrAllHeader) {


        if(!(achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){
        ?>

				<div class="row bg-info gap0 gap-top10 gap-left10 gap-right10 gap-bottom10" style="border-radius: 3px;">
				   <div class="col-xs-3 gap-top10">
				 		  <?print $arr_observacao_receptivo["0"]?>
				   </div>
				   <div class="col-xs-9">
                           <textarea name="prp_observacao"  class='form-control' cols="90" rows="4" maxlength="<?print $arr_observacao_receptivo["2"]?>" consistir="<?print $consiste_obs?>" <?print $consiste_obs_onblur?>  minlenght='10' tipodado="<?print $consiste_obs_tipodado?>" msg="Preencha corretamente o campo de <?print $arr_observacao_receptivo[0]?>. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}javascript:document.getElementById('sizer_obs').innerHTML=(<?print $arr_observacao_receptivo["2"]?>-this.value.length);" OnBlur="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}"><?print $prp_observacao;?></textarea>
                           <span id="sizer_obs" class="txtvermelho3"><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></span>

				   </div>
				</div>
				<?
        }
        } else {
				?>
                       <tr>
                         <td align="left"width="1%"  class='form-control' nowrap valign="top" ><font class="txt5"><strong><?print $arr_observacao_receptivo["0"]?>
                           <textarea name="prp_observacao" cols="90" rows="4" maxlength="<?print $arr_observacao_receptivo["2"]?>" consistir="<?print $consiste_obs?>" <?print $consiste_obs_onblur?>  minlenght='10' tipodado="<?print $consiste_obs_tipodado?>" msg="Preencha corretamente o campo de <?print $arr_observacao_receptivo[0]?>. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}javascript:document.getElementById('sizer_obs').innerHTML=(<?print $arr_observacao_receptivo["2"]?>-this.value.length);" OnBlur="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}"><?print $prp_observacao;?></textarea>
                           <span id="sizer_obs" class="txtvermelho3"><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></span>

                         </td>
                       </tr>
				<?
				}
  }
}
if($IntergrAllHeader) {

}else{

?>
                        </table>
                        </table>
<?
}


} else {
     ?>
        <input type="hidden" name="tipo_atend_co" value="1" consistencia="sempre" consistencia1="pre" msg="Clique em um tipo de conclusão para o atendimento." tipo="hidden">
     <?
     if (!$observacao_receptivo) {
?>
       <tr bgcolor="<?print $session["td_dado3"]?>" >
         <td align="center">
           <table width="100%" border="0">
             <tr>
               <td align="left" width="1%">
                 <table width="100%">
                   <tr>
                     <td align="left"width="1%" nowrap valign="top"><font class="txt5"><strong>Observações:</strong></font></td>
                     <td align="left" width="50%" nowrap valign="top">
                       <?if (!$consiste_obs) {$consiste_obs = "sopreenchido";}
                       if($observacao_rec_especial == "S"){
                         $consiste_obs_tipodado = "preenchido";
                       }else{
                         $consiste_obs_tipodado = "todos";
                       }

                       ?>
                       <textarea name="prp_observacao"  class='form-control' cols="90" rows="4" maxlength="100" consistir="<?print $consiste_obs?>" minlenght='10' tipodado="<?print $consiste_obs_tipodado?>" msg="Preencha corretamente o campo de observações. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');};  document.getElementById('sizer_obs').innerHTML=(<?print $prp_observacao;?>-this.value.length);" OnBlur="javascript:if (this.value.length > 99) {this.value=this.value.substring(0,99);alert('Limite de campo (100 caracteres) atingido.');}"><?print $prp_observacao;?></textarea>
                       <div id="sizer_obs" class="txtvermelho3"><?print (100-strlen($prp_observacao))?></div>
                     </td>
                   </tr>
                 </table>
               </td>
             </tr>
           </table>
         </td>
       </tr>
<?
     } else {
       if ($observacao_receptivo != "N") {
         $arr_observacao_receptivo = explode("¢",$observacao_receptivo);
         if (!$consiste_obs) {
           if ($arr_observacao_receptivo[1] == "S") {
             $consiste_obs = "sempre";
           } else {
             $consiste_obs = "sopreenchido";
           }
         }

         if (!$consiste_obs) {
           $consiste_obs = "sopreenchido";
         }
         if ($prefixo_classe_tema_pai) {
           $cor_td_dado3 = $amarelo;
           $cor_td_dado1 = $amarelo;
         } else {
           $cor_td_dado3 = $session["td_dado3"];
           $cor_td_dado1 = $session["td_dado1"];
         }


         if($IntergrAllHeader){
           ?>
      <div class='simple-panel' >
        <div class='simple-panel-heading'>
          <h4 class='simple-panel-title'><i class='icon10 i-quotes-left'></i><?print $objTradutor->Traduzir($arr_observacao_receptivo["0"])?>:</h4>
          <a class='minimize'></a>
        </div><!-- End .panel-heading -->

        <div class='simple-panel-body'>
              <div class="row">
                  <div class="col-sm-11">
                    <?if (!$consiste_obs) {$consiste_obs = "sopreenchido";}?>
                    <?
                    if($observacao_rec_especial == "S"){
                      $consiste_obs_tipodado = "preenchido";
                    }else{
                      $consiste_obs_tipodado = "todos";
                    }
                    ?>
                    <textarea name="prp_observacao" class="form-control" rows="4" maxlength="<?print $arr_observacao_receptivo["2"]?>" consistir="<?print $consiste_obs?>"  minlenght='10' tipodado="<?print $consiste_obs_tipodado?>" msg="Preencha corretamente o campo de <?print $arr_observacao_receptivo[0]?>. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}document.getElementById('sizer_obs').innerHTML=(<?print $arr_observacao_receptivo["2"];?>-this.value.length);" OnBlur="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}" style="float:left;"><?print $prp_observacao;?></textarea>
                  </div>
                  <div class="red col-sm-1" id="sizer_obs" ><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></div>
             </div>
        </div>
        </div>

           <?
         }else{
?>
        <tr id="tr_md_observacoes" bgcolor="<?print $cor_td_dado3?>" >
           <td align="center">
             <table width="100%" border="0">
                <tr>
                   <td align="left" width="1%">
                      <table width="100%">

                        <tr>
                          <td align="left"width="1%" nowrap valign="top" ><font class="txt5"><strong><?print $objTradutor->Traduzir($arr_observacao_receptivo["0"])?>:</td>
                          <td align="left" width="50%" nowrap valign="top">
                            <?if (!$consiste_obs) {$consiste_obs = "sopreenchido";}?>
                            <?if($observacao_rec_especial == "S"){
                              $consiste_obs_tipodado = "preenchido";
                            }else{
                              $consiste_obs_tipodado = "todos";
                            }?>

                            <textarea name="prp_observacao" cols="90" rows="4" maxlength="<?print $arr_observacao_receptivo["2"]?>" consistir="<?print $consiste_obs?>" minlenght='10' tipodado="<?print $consiste_obs_tipodado?>" msg="Preencha corretamente o campo de <?print $arr_observacao_receptivo[0]?>. Digite somente caracteres simples e <enter> não é permitido." OnKeyUp="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}document.getElementById('sizer_obs').innerHTML=(<?print $arr_observacao_receptivo["2"];?>-this.value.length);" OnBlur="javascript:if (this.value.length > <?print $arr_observacao_receptivo["2"]?>) {this.value=this.value.substring(0,<?print $arr_observacao_receptivo["2"]?>);alert('Limite de campo (<?print $arr_observacao_receptivo["2"]?> caracteres) atingido.');}" style="float:left;"><?print $prp_observacao;?></textarea>
                            <div id="sizer_obs" style="color:#FF0000;" class="txtvermelho3"><?print ($arr_observacao_receptivo["2"]-strlen($prp_observacao))?></div>
                           </td>
                         </tr>



                           </td>
                         </tr>
                      </table>
                   </td>
                </tr>
             </table>
           </td>
        </tr>
<?
         }
       }
     }
}

if($IntergrAllHeader){

  print "</div><!-- End .panel-body -->";
  if(!$conclusao_receptivo){
    print "</div>";
  }else{
    print "<br>";

  }
}else{
?>
      </table>
<?}

if($IntergrAllHeader){
  if($nro_modelo == "KS") {?>
      <div class="row div-center">
        <?if($grava_incompleta || strtoupper($libera_alcada) == "BOTAO" || $conteudo_td_bt_enviar) {?>
            <div class="col-sm-4">
              <?print $conteudo_td_bt_enviar?>         <?
              if (strtoupper($libera_alcada) == "BOTAO") {
                ?><input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-warning" value="Enviar c/ Autorização" onClick="verificaLiberaAlcada();"><?
              }
              if (($grava_incompleta) ) {
                $arr_grava_incompleta = explode("¢",$grava_incompleta);
                ?><input type="button" name="bt_incompleta" class="btn btn-danger" value="<?print $objTradutor->Traduzir($arr_grava_incompleta[0])?>"   onClick="this.disabled = true; incompletaReceptivo(document.cadastro);"><?
              }
              ?>
            </div>
        <?}?>
        <div class="col-sm-2 div-center">
          <input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-primary col-sm-12" value="<?print $objTradutor->Traduzir("Enviar");?>"  onClick="javascript: enviarPropostaMK();">
        </div>
      </div><?
  } else {
    if ($repre == 'HONDA-HSF' && $nro_modelo == 'BK') {
      ?>
      <div class="row gap10">
         <div class="col-sm-4"  id='div_btn_enviar_ant_md'><?print $conteudo_td_bt_enviar_ant?></div>
         <div class="col-sm-2 <?if((achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){?> text-center <?}?>" id='div_btn_enviar_md'>
            <input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-primary col-sm-12" value="<?print $objTradutor->traduzir("Enviar")?>"  onClick="javascript: enviarPropostaMK();">
         </div>
         <div class="col-sm-6"  id='div_btn_enviar_meio_md'>
           <?print $conteudo_td_bt_enviar?>
            <?
            if (strtoupper($libera_alcada) == "BOTAO") {
              ?><input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-warning" value="Enviar c/ Autorização" onClick="verificaLiberaAlcada();"><?
            }
            if (($grava_incompleta) ) {
              $arr_grava_incompleta = explode("¢",$grava_incompleta);
              ?><input type="button" name="bt_incompleta" class="btn btn-danger" value="<?print $arr_grava_incompleta[0];?>"   onClick="this.disabled = true; incompletaReceptivo(document.cadastro);"><?
            }
            ?>
         </div>
      </div>
      <?
    } else {
        ?>
      <div class="row gap0">
         <div class="col-sm-6"  id='div_btn_enviar_ant_md'><?print $conteudo_td_bt_enviar_ant?></div>
         <div class="col-sm-4"  id='div_btn_enviar_meio_md'>
           <?print $conteudo_td_bt_enviar?>
            <?
            if (strtoupper($libera_alcada) == "BOTAO") {
              ?><input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-warning" value="Enviar c/ Autorização" onClick="verificaLiberaAlcada();"><?
            }
            if (($grava_incompleta) ) {
              $arr_grava_incompleta = explode("¢",$grava_incompleta);
              ?><input type="button" name="bt_incompleta" class="btn btn-danger" value="<?print $arr_grava_incompleta[0];?>"   onClick="this.disabled = true; incompletaReceptivo(document.cadastro);"><?
            }
            ?>
         </div>
         <div class="col-sm-2 <?if((achaNroModelo($nro_modelo,$tipo_abertura) == "7W" && $include_dados == "es_vitaldent")){?> text-center <?}?>" id='div_btn_enviar_md'>
            <input type="button" name="bt_enviar" id="id_bt_enviar" class="btn btn-primary col-sm-12" value="<?print $objTradutor->traduzir("Enviar")?>"  onClick="javascript: enviarPropostaMK();">
         </div>
      </div>
        <?
    }
  }
}else{
      ?>

      <?if(!$width_table_bt_enviar){$width_table_bt_enviar = "650";}?>
      <table width="<?print $width_table_bt_enviar?>" align="center" border="0" id="table_bt_enviar">
        <?
        if (($grava_incompleta) ) {
          $arr_grava_incompleta = explode("¢",$grava_incompleta);
        ?>
                    <tr>
                      <td align="right"width="50%" nowrap>
                        <input type="button" name="bt_incompleta" value="<?print $arr_grava_incompleta[0];?>" style="WIDTH:150px; background:<?print $amarelo?>;cursor:pointer;"    onClick="this.disabled = true; incompletaReceptivo(document.cadastro);">
                      </td>
                    </tr>
        <?
        }
        ?>     <tr>
        <?if(!$align_td_bt_enviar){$align_td_bt_enviar = "center";}?>
         <td align="<?print $align_td_bt_enviar?>"width="50%" nowrap id="td_bt_enviar">
           <?
           print $conteudo_td_bt_enviar;
           if(!$mdDescBotaoEspecifico) {
             $mdDescBotaoEspecifico = "Enviar";
           }
           ?>

           <input type="button" name="bt_enviar" id="id_bt_enviar" value="<?print $mdDescBotaoEspecifico;?>" style="WIDTH:150px; background:#CCCCFF;cursor:pointer;"    onClick="javascript: enviarPropostaMK();">
            <?
            if (strtoupper($libera_alcada) == "BOTAO") {
            ?>
                <input type="button" name="bt_enviar" id="id_bt_enviar" value="Enviar c/ Autorização" style="WIDTH:150px; background:#CCCCFF;cursor:pointer;"    onClick="verificaLiberaAlcada();">
            <?
            }
            ?>

         </td>
       </tr>
    </table>
<?
}//if do bootstrap
?>
           <input type="hidden" style="border:'none'" readonly size="100" name="desc_botao_env">
           <script type="text/javascript">
           function enviarPropostaMK() {
            <? if(mb_strtoupper($nro_modelo) === "8A") {
               ?>
               if(typeof consBloqueioProcon === "function") {
                 var varConsBloqueioProcon = consBloqueioProcon();

                 if(varConsBloqueioProcon !== "OK") {
                   alert(varConsBloqueioProcon);
                   return false;
                 }
               }
               <?
             }
             ?>
             document.getElementById('id_bt_enviar').disabled = true;
             completaReceptivo(document.cadastro);
           }
           </script>

<?



break;

  default:
    header ("Location:".HTTPHOST.DOCROOT."md_cad_prop.php?msg_erro=".urlencode("<strong>O tipo ".$tipo_modelo."&nbsp;Não está apto para o Modelo, revise as configuraçõesy"));
    break;
}



if (!$qtd_prod_libera_alcada) {
  $qtd_prod_libera_alcada = 0;
}
?>
  <input type="hidden" name="qtd_prod_libera_alcada"   value="<?print $qtd_prod_libera_alcada;?>">
  <input type="hidden" name="trs_do_conf"              value="<?print $trs_do_conf;?>">
  <input type="hidden" name="atv_campo_chave"          value="<?print $atv_campo_chave;?>">
  <input type="hidden" name="vend_login_agret"          value="<?print $vend_login_agret;?>">
<?


//**********************************************************************************************************************
//**********************************************************************************************************************
//***********************************************MSG ALERTA*************************************************************
//**********************************************************************************************************************
//**********************************************************************************************************************
if ($usa_rotina_msg_alerta != "") {
?>
<style type="text/css">
#btn_mk_msg_alerta {
  margin: 0;
  padding: 0;
 position: absolute;
  z-index: 1;
  top: <?
  if ($session["versao_sistema"] == "novo_v2") {
    ?>1<?
  } else {
    // se a variavel $dk_campanha tiver valor, é pq o sistema utiliza abre modelo
    if (empty($dk_campanha) === false) {
      ?>20<?
    } else if ($IntergrAllHeader) {
      ?>18<?
    }else {
      ?>95<?
    }
  }
  ?>px;
  right: <? if ($IntergrAllHeader) { ?> 18px<? } else {?>1px<?}?>;
}
</style>
<script type="text/javascript" src="/js/<?=$montaDivPopUp?>.js"></script>
<script type="text/javascript">
function mkMsgAlerta() {
  <?
  // RETIRANDO ESSA FUNCIONALIDADE POIS NÃO IREMOS MAIS GRAVAR O HTML
  if (!$usa_rotina_msg_alerta_versao == 'V02') {
    ?>
    $("#mk_msg_alerta").val($("#table_mk_msg_alerta").html());
    <?
  }
  ?>
  fechaMsgAlerta();
}

function fechaMsgAlerta() {
  $("#JanelaMsgAlerta").hide();
  $("#JanelaMsgAlerta_screenBlock").hide();

  <?
  //**********************************\\
  //* INI - fechaMsgAlertaEspecifico *\\
  //**********************************************************************************************************************************\\
  //* FUNÇÃO CRIADA PARA REALIZAR A CHAMADA DE QUALQUER ALTERAÇÃO QUE SE FAÇA NECESSÁRIA DENTRO DO SEU SISTEMA ESPECÍFICO
  //* BASTA REESCREVER A FUNÇÃO fechaMsgAlertaEspecifico() EM SEU PROGRAMA QUE ELA SERÁ CHAMADA SEMPRE QUE:
  //* A) A FUNÇÃO abreMsgAlerta NÃO ENCONTRAR MENSAGENS PARA O ATENDIMENTO;
  //* B) O OPERADOR CLICAR SOBRE O BOTÃO "Estou Ciente" DA MENSAGEM DE ALERTA ()
  //**********************************************************************************************************************************\\
  ?>
  if (typeof(fechaMsgAlertaEspecifico) == 'function') {
    fechaMsgAlertaEspecifico();
  }
  //**********************************\\
  //* FIM - fechaMsgAlertaEspecifico *\\
  //**********************************\\
}

function btnAbreMsgAlerta() {
  var_botao_ciente = "<div align=\"center\"><input type=\"button\" style=\"cursor:pointer;\" value=\"Estou Ciente\" onclick=\"Javascript: fechaMsgAlerta();\" class=\"but_proc_on\"></div>";
<?
  // se a variavel $dk_campanha tiver valor, é pq o sistema utiliza abre modelo, entao a msg aparece na tela de baixo
  if ($usa_rotina_msg_alerta_versao == 'V02' ) {
?>
    msg_alerta = $("#mk_msg_alerta").val();
    <? if (empty($dk_campanha) === false) {?>parent.<?}?>montaDivPopUp(1,"","JanelaMsgAlerta",'90%','90%',"<?print $usa_rotina_msg_alerta;?>", "CC", "<?print $_SESSION['session']['td_destaque']?>","N","","S", msg_alerta);
<?
  } else {
?>
    msg_alerta = $("#mk_msg_alerta").val()+var_botao_ciente;
<?
    // se a variavel $dk_campanha tiver valor, é pq o sistema utiliza abre modelo, entao a msg aparece na tela de baixo
    if (empty($dk_campanha) === false) {?>parent.<?}?>montaDivPopUp(1,"","JanelaMsgAlerta",600,500,"<?print $usa_rotina_msg_alerta;?>","CC","<?print $session["td_destaque"]?>","N","","S", msg_alerta);
<?
  }
?>
}
<?
if ($usa_rotina_msg_alerta_versao == 'V02' ) {
?>
  function abreRotinaMsgAlerta(dados_env) {

    $.ajax({
      url: "mk_msg_alerta_ajax_slider.php?",
      type: 'POST',
      data: {mensagens:  dados_env },
      dataType: 'text',
      timeout: 10000,
      // contentType: 'application/json',
      beforeSend: function(){
      },
      error: function (XMLHttpRequest, textStatus, errorThrown) {
        var iOf = XMLHttpRequest.responseText.indexOf('<script');
        if (iOf != -1) {
          var mensagem = XMLHttpRequest.responseText.substring(0, iOf);
        } else {
          var mensagem = XMLHttpRequest.responseText;
        }
        if (mensagem != ''){
          alert(mensagem);
        }


      },
      success: function(xml) {
        <?
        if (empty($dk_campanha) === false) {
          ?>
          parent.$('#returnAjaxTemp').html(xml);
          parent.montaDivPopUp(1,"","JanelaMsgAlerta",'90%','90%',"<?print $usa_rotina_msg_alerta;?>","CC","<?print $session["td_destaque"]?>","N","","S", parent.$('#returnAjaxTemp > *'));
          parent.$('#JanelaMsgAlerta_img_fechar').hide();
          $('#btn_mk_msg_alerta').css('display','block');

          <?
        } else {
          ?>
          $('#returnAjaxTemp').html(xml);
          montaDivPopUp(1,"","JanelaMsgAlerta",'90%','90%',"<?print $usa_rotina_msg_alerta;?>","CC","<?print $session["td_destaque"]?>","N","","S", $("#returnAjaxTemp > *"));
          $('#JanelaMsgAlerta_img_fechar').hide();
          $('#btn_mk_msg_alerta').css('display','block');
          $('#returnAjaxTemp').html("");
          <?
        }
        ?>
      }
    });
  }
  <?
}
?>

function abreMsgAlerta() {
  $.ajax({
    url: "mk_msg_alerta_ajax.php?repre_param=<?print $repre_param?>&nro_modelo=<?print $nro_modelo;?>",
    type: 'POST',
    data: $('form[name=cadastro]').serialize(),
    dataType: 'text',
    timeout: 10000,
    contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
    beforeSend: function(){
    },
    error: function (XMLHttpRequest, textStatus, errorThrown) {
      var iOf = XMLHttpRequest.responseText.indexOf('<script');
      if (iOf != -1) {
        var mensagem = XMLHttpRequest.responseText.substring(0, iOf);
        //        var scriptExec = XMLHttpRequest.responseText.substring(iOf, XMLHttpRequest.responseText.length);
      } else {
        var mensagem = XMLHttpRequest.responseText;
        //        var scriptExec = '';
      }
      if (mensagem != ''){
        alert(mensagem);
      }

    },
    success: function(xml) {
      <?
      if ($usa_rotina_msg_alerta_versao == 'V02') {
        ?>
        arr_volta = xml.split('|');
        if (arr_volta[0] != "ERRO") {
          dados_env = xml;

          <?
          // se a variavel $dk_campanha tiver valor, é pq o sistema utiliza abre modelo, entao a msg aparece na tela de baixo
          if (empty($dk_campanha) === false) {
            ?>
            parent.$("#mk_msg_alerta").val(dados_env);
            $("#mk_msg_alerta").val(dados_env);
            abreRotinaMsgAlerta(dados_env);
            <?
          } else {
            ?>
            $("#mk_msg_alerta").val(dados_env);
            abreRotinaMsgAlerta(dados_env);
            <?
          }
          ?>

        } else {
          fechaMsgAlerta();
        }

        <?
      } else {
        ?>
        arr_volta = xml.split('|');
        if (arr_volta[0] != "ERRO") {
          <?
          // se a variavel $dk_campanha tiver valor, é pq o sistema utiliza abre modelo, entao a msg aparece na tela de baixo
          if (empty($dk_campanha) === false) {?>parent.<?}?>montaDivPopUp(1,"","JanelaMsgAlerta",600,500,"<?print $usa_rotina_msg_alerta;?>","CC","<?print $session["td_destaque"]?>","N","","S",xml);

          $('#btn_mk_msg_alerta').css('display','block');
        } else {
          fechaMsgAlerta();
        }
        <?
      }
      ?>
    }
  });
}

$(document).ready(function() {
  $(window)
  // .scroll(function () {
  //   $("#btn_mk_msg_alerta").animate({
  //     top: ($("#btn_mk_msg_alerta").offset().top + $(document).scrollTop()) + "px"
  //   },{duration:0, queue:false}
  //   );
  // })
  .load(function() {
    <?
    if ((empty($mk_msg_alerta) === true) && ($rotina_msg_alerta_especifico != "S")) {
      ?>
      abreMsgAlerta();
      <?
    }
    ?>
  });
});
</script>





<?
}
//*********************************************************************************************************************
//*********************************************************************************************************************
//*************************************************FIM MSG ALERTA******************************************************
//*********************************************************************************************************************
//*********************************************************************************************************************




//********************************************************************
//**************TRATAMENTO SCRIPT ARGUMENTOS**************************
//********************************************************************
if ($mtr_script_argumento[0] == "S") {
  $classe_mkpro = "MD".achaNroModelo($nro_modelo,$tipo_abertura);
  include_once('funcoes/ScriptInteligente.php');
  $connect_script = ConnectSCRIPT();
  mostraRegraScript($repre_vendedor, 'MKARG', 'ARR');
  $string_forms_arg = "";
  //  $arrayAIaux[1] = "02";
  //  $arrayAIaux[2] = "03";
  if (is_array($arrayAIaux)) {
    if (count($arrayAIaux) == 1) {
      $where_argumentos = " cod_formulario = '".$arrayAIaux[0]."'";
      $esconde_forms_agumento = "N";
    } else {
      foreach ($arrayAIaux as $chave => $valor) {
        $formulario_script_argumento .= "'".$valor."',";
      }
      $where_argumentos = " cod_formulario IN (".substr($formulario_script_argumento, 0, -1).") ";
      $esconde_forms_agumento = "S";
    }
    $msg_erro_arg = "";
    $q = "SELECT * FROM tb_script_argumentos WHERE representante = '".$repre_vendedor."' AND ".$where_argumentos." AND status = 'A' order by cod_formulario, cod_pergunta ";
    if ($query = DescExecQuery($q, $connect_script)) {
      if ($rec_scri = mysql_fetch_assoc($query)) {
        do {
          $mtr_argumento[$rec_scri["cod_formulario"]][$rec_scri["cod_pergunta"]]["DESCRICAO"]   = $rec_scri["desc_pergunta"];
          if ($rec_scri["obrigatorio"] == "S") {
            $mtr_argumento[$rec_scri["cod_formulario"]][$rec_scri["cod_pergunta"]]["CONSISTIR"]   = "sempre";
          } else {
            $mtr_argumento[$rec_scri["cod_formulario"]][$rec_scri["cod_pergunta"]]["CONSISTIR"]   = "sopreenchido";
          }
          $mtr_argumento[$rec_scri["cod_formulario"]][$rec_scri["cod_pergunta"]]["COR_FONTE"]   = $rec_scri["cor_pergunta"];
        } while ($rec_scri = mysql_fetch_assoc($query));
      } else {
        $msg_erro_arg = "Nenhum argumento encontrado para o formulário ".ValorClassePrint("ARG01", $arrayAIaux[0], $param_repre_vendedor);
      }
    } else {
      print "<font class='txtvermelho3'><strong>ERRO NA ROTINA DE SCRIPT_ARGUMENTO. ENTRE EM CONTATO COM O SAC URANET E INFORME: <br>".mysql_error($connect_script)."<br><br>Query: ".$q."</strong></font>";
      exit();
    }
?>
  <div id="div_script_argumento">
    <img src="imagens/script_argumento.gif" onclick="scriptObrigMostraEsconde('div_script_argumento_conteudo');" style="cursor: pointer;" title="Argumentos">
    <div id="div_script_argumento_conteudo">
      <input type="hidden" name="controle_div_script_argumento_conteudo" id="controle_div_script_argumento_conteudo" value="<?if (empty($controle_div_script_argumento_conteudo) === true) { if ($mtr_script_argumento[4] == "A") {print "M";} else {print "E";} } else {print $controle_div_script_argumento_conteudo;}?>">
      <script type="text/javascript">
      if ($("#controle_div_script_argumento_conteudo").val() == "E") {
        $("#div_script_argumento_conteudo").hide();
      } else {
        $("#div_script_argumento_conteudo").show();
      }
      </script>
      <table width="100%">
<?
if (is_array($mtr_argumento) === true) {
  foreach ($mtr_argumento as $form_args => $mtr_args) {
?>
        <tr>
          <td width="100%" bgcolor="<?print $session["td_destaque"];?>" <?if ($esconde_forms_agumento == "S") {?>onclick="javascript: scriptObrigMostraEsconde('tr_script_argumento_conteudo_<?print $form_args;?>');" style="cursor: pointer;"<?}?> ><font class="txt6"><strong><?print ValorClassePrint("ARG01", $form_args, $repre_vendedor);?></strong></font></td>
        </tr>
        <tr id="tr_script_argumento_conteudo_<?print $form_args;?>" <?if (empty(${"controle_tr_script_argumento_conteudo_".$form_args}) === true) { if ($mtr_script_argumento[4] == "A" || count($arrayAIaux) == 1) {print "style=\"display: block;\"";} else {print "style=\"display: none;\"";} }?>>
          <input type="hidden" name="controle_tr_script_argumento_conteudo_<?print $form_args;?>" id="controle_tr_script_argumento_conteudo_<?print $form_args;?>" value="<?if (empty(${"controle_tr_script_argumento_conteudo_".$form_args}) === true) { if ($mtr_script_argumento[4] == "A" || count($arrayAIaux) == 1) {print "M";} else {print "E";} } else {print ${"controle_tr_script_argumento_conteudo_".$form_args};}?>">
          <script type="text/javascript">
          if ($("#controle_tr_script_argumento_conteudo_<?print $form_args;?>").val() == "E") {
            $("#tr_script_argumento_conteudo_<?print $form_args;?>").hide();
          } else {
            $("#tr_script_argumento_conteudo_<?print $form_args;?>").show();
          }
          </script>
          <td>
            <table width="100%">
<?
$x=0;
foreach ($mtr_args as $cod_arg => $param_arg) {
  if ($x%2 == 0) {
    $cor_td_arg = "#FFFFFF";
  } else {
    $cor_td_arg = "#F2F2F2";
  }
  $x++;
?>
              <tr>
                <td bgcolor="<?print $cor_td_arg;?>" width="100%">
                  <input type="checkbox" name="check_arg_<?print $form_args."_".$cod_arg;?>" <?if (${"hidden_arg_".$form_args."_".$cod_arg} == "§".$cod_arg."§") {print " checked ";}?> value="<?print $cod_arg;?>" onclick="if(this.checked) {$('#hidden_arg_<?print $form_args."_".$cod_arg;?>').val('§'+this.value+'§'); $('#forms_args_<?print $form_args;?>').val($('#forms_args_<?print $form_args;?>').val()+'§'+this.value+'§');} else {$('#hidden_arg_<?print $form_args."_".$cod_arg;?>').val(''); document.getElementById('forms_args_<?print $form_args;?>').value = document.getElementById('forms_args_<?print $form_args;?>').value.replace('§<?print $cod_arg;?>§', '');}">
                  <font class="txt5" style="color: <?print $param_arg["COR_FONTE"];?>"><?
                  if ($param_arg["CONSISTIR"] == "sempre") {
                    print "<font class='txtvermelho3'><strong>*</strong></font>";
                  }
                  print $param_arg["DESCRICAO"];
?></font>
                  <input type="hidden" id="hidden_arg_<?print $form_args."_".$cod_arg;?>" name="hidden_arg_<?print $form_args."_".$cod_arg;?>" value="<?print ${"hidden_arg_".$form_args."_".$cod_arg};?>" consistir="<?print $param_arg["CONSISTIR"];?>" tipodado="preenchido" msg="Não é permitido finalizar o atendimento sem selecionar os argumentos obrigatórios." divAlvo="div_script_argumento_conteudo">
                </td>
              </tr>
<?
}
?>
              <input type="hidden" id="forms_args_<?print $form_args;?>" name="forms_args_<?print $form_args;?>" value="<?print ${"forms_args_".$form_args};?>">
            </table>
          </td>
        </tr>
<?
$string_forms_arg .= "§".$form_args."§";
  }
} else {
  if (empty($msg_erro_arg) === false) {
    print "<tr><td><font class='txtvermelho3'><strong>".$msg_erro_arg."</strong></font></td></tr>";
  }
}
?>
        <input type="hidden" id="forms_args" name="forms_args" value="<?print $string_forms_arg;?>">
      </table>
    </div>
  </div>
<?
  }
}
//********************************************************************
//********************************************************************
//********************************************************************

//********************************************************************
//**************TRATAMENTO SCRIPT OPERADOR**************************
//********************************************************************
if ($mtr_script_flutuante[0] == "S") {
  $classe_mkpro = "MD".achaNroModelo($nro_modelo,$tipo_abertura);
  include_once('funcoes/ScriptInteligente.php');
  //  $ddd_bina = $atv_ddd_tel;
  $arr_script_flutuante = mostraRegraScript(DefineRepre($repre_vendedor), "AJDOP", 'ARR');
?>
  <div id="div_script_flutuante" align="right">
    <img src="imagens/info_flutuante.gif" onclick="scriptOperadorMostraEsconde('div_script_flutuante_conteudo');" style="cursor: pointer;" title="Ajuda Inteligente.">
    <div id="div_script_flutuante_conteudo">
      <input type="hidden" name="controle_div_script_flutuante_conteudo" id="controle_div_script_flutuante_conteudo" value="<?if (empty($controle_div_script_flutuante_conteudo) === true) { if ($mtr_script_flutuante[4] == "A") {print "M";} else {print "E";} } else {print $controle_div_script_flutuante_conteudo;}?>">
      <script type="text/javascript">
      if ($("#controle_div_script_flutuante_conteudo").val() == "E") {
        $("#div_script_flutuante_conteudo").hide();
      } else {
        $("#div_script_flutuante_conteudo").show();
      }
      </script>
      <table width="100%">
<?
if (is_array($arraySIassunto) === true) {
  if (count($arraySIassunto) == 1) {
    $esconde_script_flutuante = "N";
  } else {
    $esconde_script_flutuante = "S";
  }
  foreach ($arraySIassunto as $chave => $valor) {
?>
        <tr>
          <td width="100%" bgcolor="<?print $session["td_destaque"];?>" <?if ($esconde_script_flutuante == "S") {?>onclick="javascript: scriptOperadorMostraEsconde('tr_script_flutuante_conteudo_<?print $chave;?>');" style="cursor: pointer;"<?}?> ><font class="txt6"><strong><img src='imagens/farol_verde.gif' border='0' width='12px' height='12px'>&nbsp;<?print $valor;?></strong></font></td>
        </tr>
        <tr id="tr_script_flutuante_conteudo_<?print $chave;?>" <?if (empty(${"controle_tr_script_flutuante_conteudo_".$chave}) === true) { if ($mtr_script_flutuante[4] == "A" || count($arraySIassunto) == 1) {print "style=\"display: block;\"";} else {print "style=\"display: none;\"";} }?>>
          <input type="hidden" name="controle_tr_script_flutuante_conteudo_<?print $chave;?>" id="controle_tr_script_flutuante_conteudo_<?print $chave;?>" value="<?if (empty(${"controle_tr_script_flutuante_conteudo_".$chave}) === true) { if ($mtr_script_flutuante[4] == "A" || count($arraySIassunto) == 1) {print "M";} else {print "E";} } else {print ${"controle_tr_script_flutuante_conteudo_".$chave};}?>">
          <script type="text/javascript">
          if ($("#controle_tr_script_flutuante_conteudo_<?print $chave;?>").val() == "E") {
            $("#tr_script_flutuante_conteudo_<?print $chave;?>").hide();
          } else {
            $("#tr_script_flutuante_conteudo_<?print $chave;?>").show();
          }
          </script>
          <td>
            <table width="100%">
              <tr>
                <td bgcolor="<?print $cor_td_arg;?>" width="100%">
                  <font class="txt5"><?print $arr_script_flutuante[$chave];?></font>
                </td>
              </tr>
            </table>
          </td>
        </tr>
<?
  }
} else {
  print "<tr><td><font class='txtvermelho3'><strong>Nenhum script de ajuda cadastrado.</strong></font></td></tr>";
}
?>
      </table>
    </div>
  </div>
<?
}
//********************************************************************
//********************************************************************
//********************************************************************


?>
<div id="returnAjaxTemp" style="display:none"></div>
<?

if (strpos($tipo_abre_historico, 'spider') !== false && $local_abre_historico == "bottom" && $exibe_spider) {

if($campo_pesq_historico != ""){
if($campo_pesq_historico == ""){print "O Parametro historico está setado como NOVO, porém os campos de pesquisa não estão Setados.";exit;}
if($pesq_historico == ""){print "O Parametro historico está setado como NOVO, porém o campo ".$campo_pesq_historico." está vazio";exit;}
	$spd_prop->setWhereAdicional(" AND ".$campo_pesq_historico." = '".$pesq_historico."'");
	$spd_prop->printJavascript();

?>
<br><br>
    <div class="simple-panel simple-panel-primary" >
      <div class="simple-panel-heading">
        <h4 class="simple-panel-title primary"><i class="icon10 primary i-history"></i> Histórico </h4>
          <a class="<?=$display_class_inicial_abre_historico?>" href="#"></a>
      </div>
      <div class="simple-panel-body pad0 gap0" style=<?=$display_inicial_abre_historico?>>
        <div class="row" ">
          <div class="col-sm-12">

		  <?

			$spd_prop->imprimeGrafico();
			?>
          </div>
        </div>
      </div>
    </div>
<?
}
}

if (strpos($tipo_abre_historico, 'ficha') !== false) {
  if ((!$campo_pesq_historico) && (!$pesq_historico)) {
    $campo_pesq_historico      = $campo_campo_clique_cliente;
    $pesq_historico            = $campo_clique_cliente;
    if (empty($campo_pesq_historico) === true) {
      $campo_pesq_historico      = $campo_campo_clique_cliente_passa;
      $pesq_historico            = $campo_clique_cliente_passa;
    }
  }

  if (substr(strtolower($include_dados), 0, 3) == "flw") {
    $width_id_iframe_pesquisa = "780";
  } else {
    $width_id_iframe_pesquisa = "650";
  }

  if ($nro_modelo == "Y3"){//BMG ATENDIMENTO LOJA
    require_once("md_hist_cliente_ficha_flw_bmg_lj.php");
  } else {

    if ($IntergrAllHeader) {
		?>
		<br class="clear">
		<br class="clear">
    <div class="simple-panel simple-panel-primary" style="margin:0px; width: 100%">
      <div class="simple-panel-heading">
        <h4 class="simple-panel-title primary"><i class="icon10 primary i-history"></i> Histórico </h4>
          <a class="minimize" href="#"></a>
      </div>
      <div class="simple-panel-body">
        <div class="row" style="margin-right:0px; margin-left:0px;">
          <div class="col-sm-12">
            <iframe  width="100%" src="<?print "md_hist_cliente_ficha.php?nro_modelo=".achaNroModelo($nro_modelo,$tipo_abertura)."&repre_param=".$repre_param."&nivel_atual=".$nivel_atual."&tipo_abertura=".$tipo_abertura."&id_receptivo=".$id_receptivo."&campo_pesq_historico=".$campo_pesq_historico."&pesq_historico=".$pesq_historico?>"  name="iframe_pesquisa" id="id_iframe_pesquisa" frameborder="0"  height="400" scrolling="yes" Style="scrollbar-face-color:#748DBE; scrollbar-highlight-color:#9DB7E7; scrollbar-3dlight-color:#34548F; scrollbar-darkshadow-color:#C4D6F7; scrollbar-shadow-color:#4768A4; scrollbar-arrow-color:#FFFFFF; scrollbar-track-color:#C4D0E7; " align="center" ></iframe>
          </div>
        </div>
      </div>
    </div>
		<?
    } else {
    ?>
    <div align="center">
      <iframe  src="<?print "md_hist_cliente_ficha.php?nro_modelo=".achaNroModelo($nro_modelo,$tipo_abertura)."&repre_param=".$repre_param."&nivel_atual=".$nivel_atual."&tipo_abertura=".$tipo_abertura."&id_receptivo=".$id_receptivo."&campo_pesq_historico=".$campo_pesq_historico."&pesq_historico=".$pesq_historico?>"  name="iframe_pesquisa" id="id_iframe_pesquisa" frameborder="0" width="<?print $width_id_iframe_pesquisa;?>" height="200" scrolling="yes" Style="scrollbar-face-color:#748DBE; scrollbar-highlight-color:#9DB7E7; scrollbar-3dlight-color:#34548F; scrollbar-darkshadow-color:#C4D6F7; scrollbar-shadow-color:#4768A4; scrollbar-arrow-color:#FFFFFF; scrollbar-track-color:#C4D0E7; " align="center" >&nbsp;</iframe>
    </div>
    <?
    }
  }
}


if (strpos(" ".$tipo_abre_historico,"resumo") > 0 ) {
  if ((!$campo_pesq_historico) && (!$pesq_historico)) {
    $campo_pesq_historico      = $campo_campo_clique_cliente;
    $pesq_historico            = $campo_clique_cliente;
    if (empty($campo_pesq_historico) === true) {
      $campo_pesq_historico      = $campo_campo_clique_cliente_passa;
      $pesq_historico            = $campo_clique_cliente_passa;
    }
  }

  if (substr(strtolower($include_dados), 0, 3) == "flw") {
    $width_id_iframe_pesquisa = "780";
  } else {
    $width_id_iframe_pesquisa = "650";
  }
  ?>
  <div align="center" id="mkHistResumo">
  </div>
  <script language="Javascript">

  function atualizaResumo(){
    $.ajax({
      url: 'mk_hist_resumo.php',
      type: 'POST',
      data: '',
      dataType: 'text',
      timeout: 30000,
      contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
      beforeSend: function(){
      },
      error: function(){
        alert('Não foi possivel completar a Operação, Contate um Analista da Uranet');
      },
      success: function(xml) {
        $("#mkHistResumo").html(xml);
      }
    });
  }
  atualizaResumo();
  </script>
  <?
}

if ((empty($botao_finaliza_cliente) === false) && (substr($botao_finaliza_cliente, 0, 1) == "A")) {
  print getRegAtdCampos();
}
?>
</form>
<form name='form_extra'>
<?print $conteudo_form_extra;?>
</form>



<script type="text/javascript">
<?
if ($focus && $nro_modelo != "BF") {
  if ($focus == "contentWindow") {
    ?>
    //if (document.getElementById("conteudo")) {
    //  updateRTE("conteudo");
    //  document.getElementById("conteudo").contentWindow.focus();
    //}
    <?
  } else {
    ?>
    if ((document.cadastro.<?print $focus?>) && (document.cadastro.<?print $focus?>.type != "hidden")) {
      document.cadastro.<?print $focus?>.focus();
    }
    <?
  }
}
?>

function checaMK(st_venda_cartao) {
  <?
  print $script_checaMK;
  print $LE_script_checaMK;///variavel gerada pelo lista extra
  print "return true;";
  ?>
}
</script>
<?
if ($fechar_abas_mk == "S") {
  ?></div></td></tr></table><?
}

if ($flw_faz_submit == "S") {
  ?>
  <script type="text/javascript">
  atualizaMK();
  </script>
  <?
}
?>
<?
if ($IntergrAllHeader) {
  print "</DIV>";//container
}
?>
<script type="text/javascript">
  function MontarRespostaCliente() {
    if($("#tr_obs_receptivo")[0]) {
      $.ajax({
        <?if($IntergrAllHeader) {?>
            url: "flw_exibir_email_finaliza_atd.php?repre_param=<?print $repre_param?>&IntergrAllHeader=S&nro_modelo=<?print $nro_modelo;?>",
        <?}else{?>
            url: "flw_exibir_email_finaliza_atd.php?repre_param=<?print $repre_param?>&nro_modelo=<?print $nro_modelo;?>",
        <?}?>
        type: 'POST',
        data: $('form[name=cadastro]').serialize(),
        dataType: 'text',
        timeout: 10000,
        contentType: 'application/x-www-form-urlencoded; charset=iso-8859-1',
        beforeSend: function(){
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
          var iOf = XMLHttpRequest.responseText.indexOf('<script');
          if (iOf != -1) {
            var mensagem = XMLHttpRequest.responseText.substring(0, iOf);
          } else {
            var mensagem = XMLHttpRequest.responseText;
          }
        },
        success: function(xml) {
          if(xml) {
            $("#tr_obs_receptivo").show();
          } else {
            $("#tr_obs_receptivo").hide();
          }
          $("#tr_obs_receptivo").html(xml);
        }
      });
    }
  }

  $(document).ready(function() {
    $("input").change(function(){
      MontarRespostaCliente();
    });
    $("select").change(function(){
      MontarRespostaCliente();
    });
    $("textarea").change(function(){
      if(this.name != "flw_descricao") {
        MontarRespostaCliente();
      }
    });
  });
  MontarRespostaCliente();
</script>


<?if ($session["representante"] == "KONECTA-FIN") {?>
  <script type="text/javascript">
    $(document).ready(function() {

      var ctrlDown = false,
          ctrlKey  = 17,
          cmdKey   = 91,
          vKey     = 86,
          cKey     = 67,
          bkspace  = 8;

      $("input[tipodado='ldigitavel']").keydown(function(e) {
          if (e.keyCode == ctrlKey || e.keyCode == cmdKey) ctrlDown = true;
      }).keyup(function(e) {
          if (e.keyCode == ctrlKey || e.keyCode == cmdKey) ctrlDown = false;
      });

      $("input[tipodado='ldigitavel']").keydown(function(e) {
          if ( e.keyCode == bkspace || (ctrlDown && (e.keyCode == vKey || e.keyCode == cKey))) {
            // permite
          } else {
            e.preventDefault();
          }
      });

    });
  </script>
<? } ?>

<?
  if ($arr_conclusao[1] == "" && $arr_conclusao[2] == "" && $arr_conclusao[3] == "" && $arr_conclusao[4] != "") {?>
    <script type="text/javascript">
      $(document).ready(function(){
        setTimeout(function(){
          $("#teste4bs").click();
        }, 1000);
      })
    </script>
<?}?>

<?

if ($classe_mkpro == 'MDXF') {
    // SU-96916 | Bradesco Jeep/Exceção
    print '<p class="gap-left10 gap-right10">Os dados [presentes neste documento e/ou que serão tratados para a prestação dos serviços aqui previstos]  serão utilizados única e exclusivamente para cumprir com a finalidade a que se destinam e em respeito a toda a legislação aplicável sobre segurança da informação, privacidade e proteção de dados, inclusive, mas não se limitando a Lei Geral de Proteção de Dados (Lei Federal n. 13.709/2018).
    Em razão da natureza do documento, ele pode conter dados sensíveis, que devem ser tratados com a máxima confidencialidade, jamais sendo copiados, mantidos ou utilizados para outros fins, sob pena das consequências disciplinares, administrativas e judiciais aplicáveis.</p>';
  }
?>

<?print GerarRodape();?>
</body>
</html>