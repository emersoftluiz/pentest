<?
session_start();
session_register("session");
require_once("cc_libcallcenter.php");

if(!isset($session)) {
  header("Location:".HTTPHOST.DOCROOT."cc_login.php");
  exit();
}

if($flw_opcao_click_final == "mostra_n_contato") {
  $campo_campo_clique_cliente = "cpf_cnpj";
  $campo_clique_cliente = "61186680000174";
}

require_once($_SERVER['DOCUMENT_ROOT']."/libs/bd/ConexaoDocumentos.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/bd/ConexaoEmail.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/bd/ConexaoRamal.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/bd/ConexaoBmg.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/ctr/Valida.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/AJAXFunc.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/DateTime.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/func/FuncDocs.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgAtendimento.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgProtocolo.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWS.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWSConductor.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorAutorizacaoWS.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorCartao.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorConta.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorContaCartaoService.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorDadosCadastrais.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgWsConductorServicos.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgAtendimentoConductor.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/PlusoftWS.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/ConductorPier.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgTbSimulacao.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BiometriaWs.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/MeuNegocioBmgWs.php");
require_once($_SERVER['DOCUMENT_ROOT']."/libs/cli/BmgFuncAtd.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/funcoes/ScriptInteligente.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_funcoes.php");
require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/mk_funcoes.php");

$BmgProtocolo = new BmgProtocolo($session["operador"], $GLOBALS["sistema_identificacao"]);
$objBMG = new BmgWS("MDYB", $session["operador"]);

if($mesmo_cliente_n_pedido) {
  $mtzProtocolo = $BmgProtocolo->openProtocoloAbertoAtd("A", " n_pedido = '".$mesmo_cliente_n_pedido."' ");
}

if($mesmo_cliente_n_pedido) {
  if(!$mtzProtocolo["grupo"] && !$mtzProtocolo["nb"]) {
    if((!$mtzProtocolo["cod_nivel_ci_1"] || !$mtzProtocolo["cod_nivel_ci_2"] || !$mtzProtocolo["frm_contato"]) && $_GET["cod_nivel_ci_1"] && $_GET["cod_nivel_ci_2"] && $_GET["bmg_frm_contato_banco"] && $mtzProtocolo["cod_nivel_ci_1"] != "009") {
      $arrUpd["cod_nivel_ci_1"] = $_GET["cod_nivel_ci_1"];
      $arrUpd["cod_nivel_ci_2"] = $_GET["cod_nivel_ci_2"];
      $arrUpd["frm_contato"] = $_GET["bmg_frm_contato_banco"];
      $mtzProtocolo["cod_nivel_ci_1"] = $_GET["cod_nivel_ci_1"];
      $mtzProtocolo["cod_nivel_ci_2"] = $_GET["cod_nivel_ci_2"];
      $mtzProtocolo["frm_contato"] = $_GET["bmg_frm_contato_banco"];

      $BmgProtocolo->setInfoAdicionalProtocoloAtd($arrUpd, $mesmo_cliente_n_pedido);

      unset($arrUpd);
    }
  }
} elseif(($_GET["cod_nivel_ci_1"] && $_GET["cod_nivel_ci_2"] && $_GET["bmg_frm_contato_banco"])) {
  $arrUpd["cod_nivel_ci_1"] = $_GET["cod_nivel_ci_1"];
  $arrUpd["cod_nivel_ci_2"] = $_GET["cod_nivel_ci_2"];
  $arrUpd["frm_contato"] = $_GET["bmg_frm_contato_banco"];
  $mtzProtocolo["cod_nivel_ci_1"] = $_GET["cod_nivel_ci_1"];
  $mtzProtocolo["cod_nivel_ci_2"] = $_GET["cod_nivel_ci_2"];
  $mtzProtocolo["frm_contato"] = $_GET["bmg_frm_contato_banco"];
}

if(mb_strtoupper($usa_ajax) == "S" && mb_strtoupper($acao_ajax) == "ATUALIZA_SESSAO") {
  print "OK";
  exit();
}

if(mb_strtoupper($usa_ajax) == "S") {
  if(!$nro_modelo) {
    $nro_modelo = "YB";
  }

  if($repre_vendedor) {
    $repre_vendedor = "BMG-OPER";
  }

  carregaArrParam("MD".$nro_modelo."A", $repre_vendedor);
  carregaArrParam("MD".$nro_modelo."B", $repre_vendedor);

  $_SESSION["ssitgl_voltou_mk_".$nro_modelo] = false;

  //flw_bmg_atd_ajax -> Prefixo Padro dos Programas
  //strtolower($acao_ajax) -> Sufixo Padro dos Programas
  if(file_exists($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_bmg_atd_ajax_".strtolower($acao_ajax).".php")) {
    require_once($_SERVER['DOCUMENT_ROOT']."/callcenter/flw_bmg_atd_ajax_".strtolower($acao_ajax).".php");
  }
}
?>